# Payload CMS Migrations Skill

## Що це це?

Цей skill допомагає AI-агентам правильно працювати з міграціями бази даних в Payload CMS проектах. Він гарантує, що всі зміни схеми БД виконуються безпечно і передбачувано.

## Коли використовується

AI агент автоматично застосовує цей skill коли ти:
- Додаєш нові поля до колекцій
- Створюєш нові колекції
- Змінюєш властивості полів
- Додаєш зв'язки між колекціями
- Виконуєш будь-які зміни структури БД

## Структура Skill

```
.cursor/skills/payload-migrations/
├── SKILL.md          # Головний файл (AI читає це завжди)
├── reference.md      # Детальна документація (для складних випадків)
├── examples.md       # Реальні приклади (для навчання)
└── README.md         # Цей файл (для тебе)
```

## Як це працює

Коли ти просиш зробити зміни в БД, AI агент:

1. **Читає SKILL.md** - отримує швидкий чек-лист дій
2. **Пояснює план** - розказує, яку міграцію буде створено
3. **Запитує підтвердження** - показує заплановані зміни
4. **Виконує workflow** - створює міграцію, тестує, комітить
5. **Звітують про результат** - показує що було зроблено

## Швидкий старт

Приклад додавання поля:

```bash
# Ти: "Додай поле alt text до Media колекції"

# AI автоматично:
1. Модифікує src/collections/Media.ts
2. Створить міграцію: npm run payload -- migrate:create add-alt-text-to-media
3. Покаже SQL для перевірки
4. Застосує: npm run migrate
5. Запустить: npm run dev:next
6. Запитає чи все працює в адмін-панелі
7. Зкомітить: git add src/migrations/ src/collections/
```

## Ключові правила

⛔ **НИКОЛИ не можна:**
- Змінювати БД напряму (через psql, тощо)
- Пропускати створення міграцій
- Комітити без тестування
- Застосовувати міграції в продакшені без локального тестування

✅ **ЗАВЖДИ треба:**
- Створювати міграцію одразу після змін конфігурації
- Перевіряти згенерований SQL
- Застосовувати міграцію локально перед комітом
- Тестувати в dev режимі
- Включати файли міграцій в коміт

## Приклади використання

Дивіться `examples.md` для детальних прикладів:
- Додавання простого поля
- Створення нової колекції
- Додавання зв'язків між колекціями
- Модифікація типів полів
- Видалення полів (небезпечно!)
- Додавання індексів для продуктивності

## Де знаходиться документация

- **SKILL.md** - швидкий старт і правила
- **reference.md** - повна документація з поясненнями "чому"
- **examples.md** - реальні сценарії з кодом
- `docs/MIGRATION_WORKFLOW.md` - проектна документація (в репозиторії)

## Потенційні проблеми

### "column already exists"
Міграція вже застосована. Перевір: `npm run payload -- migrate:status`

### "relation does not exist"
Міграція не застосована. Запусти: `npm run migrate`

### Dev mode artifacts
```bash
node scripts/cleanup-dev-migrations.js
npm run migrate
```

## Додаткові ресурси

- [Payload CMS Migrations Docs](https://payloadcms.com/docs/database/migrations)
- [PostgreSQL Schema Changes](https://www.postgresql.org/docs/current/ddl.html)

---

**Створено:** 2026-02-01
**Для:** ways2spain-landing проект
**Місцезнаходження:** `.cursor/skills/payload-migrations/`
