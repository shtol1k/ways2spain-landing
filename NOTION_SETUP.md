# 📝 Налаштування інтеграції з Notion

Цей гайд допоможе налаштувати автоматичне додавання заявок з форми зворотного зв'язку в базу даних Notion.

## 🎯 Як це працює?

Після відправки форми:
1. ✅ Email відправляється через Gmail SMTP
2. ✅ Автоматично створюється запис в Notion базі даних
3. ✅ Всі дані зберігаються в структурованому вигляді

## 📋 Крок 1: Створення бази даних в Notion

1. Відкрий Notion і створи нову сторінку або використай існуючу
2. Створи базу даних (Database):
   - Напиши `/database` або вибери "Table" з меню
   - Вибери тип "Table - Inline" або "Table - Full page"
3. Налаштуй колонки (properties):

| Назва колонки | Тип | Опис |
|--------------|-----|------|
| **Ім'я** | Title | Головна колонка (обов'язкова) |
| **Email** | Email | Email адреса клієнта |
| **Телефон** | Text | Номер телефону |
| **Послуга** | Select | Вибрана послуга (можна додати опції) |
| **Кейс** | Select | Ситуація клієнта (можна додати опції) |
| **Повідомлення** | Text | Текст повідомлення |
| **Дата** | Date | Дата отримання заявки |

**Примітка:** Назви колонок мають **точно** відповідати тим, що в коді (див. `api/contact.js`)

## 🔑 Крок 2: Створення Notion Integration

1. Перейди на [notion.so/my-integrations](https://www.notion.so/my-integrations)
2. Натисни **"+ New integration"**
3. Заповни:
   - **Name**: `Ways 2 Spain Contact Form`
   - **Type**: Internal (якщо база в твоєму workspace) або Public
   - **Associated workspace**: вибери свій workspace
4. Натисни **Submit**
5. Скопіюй **Internal Integration Token** (Secret) - це твій API ключ
   - Формат: `secret_xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx`
   - **ВАЖЛИВО**: Збережи його, показується один раз!

## 🔗 Крок 3: Поділитися базою даних з Integration

1. Відкрий свою базу даних в Notion
2. Натисни **"..."** (три крапки) у верхньому правому куті
3. Вибери **"Connections"** або **"Add connections"**
4. Знайди свою інтеграцію **"Ways 2 Spain Contact Form"**
5. Натисни на неї, щоб підключити

**Без цього кроку інтеграція не зможе створювати записи!**

## 🆔 Крок 4: Отримання Database ID

1. Відкрий свою базу даних в Notion
2. Скопіюй URL з адресного рядка браузера
3. URL виглядає так:
   ```
   https://www.notion.so/workspace/29efcef3872d809a907ffb5ff5ea4d7f?v=...
   ```
4. **Database ID** - це частина між останнім `/` та `?`
   - Приклад з твого URL: `29efcef3872d809a907ffb5ff5ea4d7f`
   - **Можеш скопіювати повний ID з `?v=` - код автоматично його очистить!**
   
   **ВАЖЛИВО:** Можеш додати ID в будь-якому форматі:
   - `29efcef3872d809a907ffb5ff5ea4d7f` ✅
   - `29efcef3-872d-809a-907f-f5ff5ea4d7f` ✅ (з дефісами)
   - `29efcef3872d809a907ffb5ff5ea4d7f?v=...` ✅ (з параметрами - код очистить)
5. Скопіюй цей ID (або залиш як є з параметрами)

## ⚙️ Крок 5: Додавання змінних в Vercel

1. Перейди в Vercel Dashboard → твій проєкт
2. **Settings** → **Environment Variables**
3. Додай дві змінні:

| Name | Value | Environment |
|------|-------|-------------|
| `NOTION_API_KEY` | `secret_xxxxxxxx...` | Production, Preview, Development |
| `NOTION_DATABASE_ID` | `a1b2c3d4e5f6...` | Production, Preview, Development |

4. **Save**

## 🚀 Крок 6: Redeploy

Після додавання Environment Variables:
1. Зроби redeploy проєкту
2. Або просто зроби новий push в GitHub

## ✅ Перевірка

1. Заповни форму на сайті
2. Надішли заявку
3. Перевір Notion - має з'явитися новий запис в базі даних!

## 🔧 Налаштування Select полів (опціонально)

Якщо хочеш, щоб поля "Послуга" та "Кейс" мали випадаючі списки:

1. Відкрий базу даних в Notion
2. Знайди колонку "Послуга"
3. Налаштуй опції:
   - Консультація
   - Базовий пакет
   - Під ключ
   - Преміум
4. Те саме для "Кейс":
   - Планую переїзд
   - Вже в Іспанії
   - Маю тимчасовий захист
   - Потрібно продовження

**Важливо:** Назви опцій мають точно відповідати значенням у формі!

## 🐛 Розв'язання проблем

### Помилка "object_not_found" або "database not found"

- Перевір `NOTION_DATABASE_ID` - чи правильно скопійований
- Переконайся, що поділився базою з інтеграцією (Крок 3)

### Помилка "unauthorized"

- Перевір `NOTION_API_KEY` - чи правильно скопійований
- Переконайся, що використовуєш Internal Integration Token

### Запис не створюється, але email відправляється

- Перевір логи в Vercel Dashboard → Functions → `/api/contact` → Logs
- Шукай повідомлення з префіксом `⚠️ Notion error`
- Переконайся, що Environment Variables додані і зроблено redeploy

### Помилка з типами властивостей

- Перевір, що типи колонок в Notion відповідають коді:
  - `Ім'я` - Title
  - `Email` - Email
  - `Телефон` - Text (rich_text)
  - `Послуга` - Select
  - `Кейс` - Select
  - `Повідомлення` - Text (rich_text)
  - `Дата` - Date

## 📊 Структура бази даних (приклад)

```
┌─────────────┬──────────┬──────────┬──────────┬───────────┬─────────────┬─────────┐
│ Ім'я        │ Email    │ Телефон  │ Послуга  │ Кейс      │ Повідомлення│ Дата    │
├─────────────┼──────────┼──────────┼──────────┼───────────┼─────────────┼─────────┤
│ Іван Петрен│ ivan@... │ +34 62...│ Консульт.│ Планую... │ Розкажу...  │ 2024-...│
└─────────────┴──────────┴──────────┴──────────┴───────────┴─────────────┴─────────┘
```

## 💡 Додаткові можливості

Після налаштування базової інтеграції можна:
- Додати статуси заявок (Нова, У роботі, Завершена)
- Створити автоматизації через Notion
- Налаштувати сповіщення в Notion
- Експортувати дані для аналітики

## 🔗 Корисні посилання

- [Notion API Documentation](https://developers.notion.com/)
- [Notion Integrations](https://www.notion.so/my-integrations)
- [Notion API Client (JavaScript)](https://github.com/makenotion/notion-sdk-js)

---

**Питання?** Звертайся! 🚀

