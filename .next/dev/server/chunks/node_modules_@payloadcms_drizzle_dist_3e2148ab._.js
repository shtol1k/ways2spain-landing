module.exports = [
"[project]/node_modules/@payloadcms/drizzle/dist/transactions/beginTransaction.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "beginTransaction",
    ()=>beginTransaction
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$node_modules$2f$uuid$2f$dist$2f$esm$2d$node$2f$v4$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__default__as__v4$3e$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/node_modules/uuid/dist/esm-node/v4.js [app-route] (ecmascript) <export default as v4>");
;
const beginTransaction = async function beginTransaction(options) {
    let id;
    try {
        id = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$node_modules$2f$uuid$2f$dist$2f$esm$2d$node$2f$v4$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__default__as__v4$3e$__["v4"])();
        let reject;
        let resolve;
        let transaction;
        let transactionReady;
        // Await initialization here
        // Prevent race conditions where the adapter may be
        // re-initializing, and `this.drizzle` is potentially undefined
        await this.initializing;
        // Drizzle only exposes a transactions API that is sufficient if you
        // can directly pass around the `tx` argument. But our operations are spread
        // over many files and we don't want to pass the `tx` around like that,
        // so instead, we "lift" up the `resolve` and `reject` methods
        // and will call them in our respective transaction methods
        const done = this.drizzle.transaction(async (tx)=>{
            transaction = tx;
            await new Promise((res, rej)=>{
                resolve = ()=>{
                    res();
                    return done;
                };
                reject = ()=>{
                    // eslint-disable-next-line @typescript-eslint/prefer-promise-reject-errors
                    rej();
                    return done;
                };
                transactionReady();
            });
        }, options || this.transactionOptions).catch(()=>{
        // swallow
        });
        // Need to wait until the transaction is ready
        // before binding its `resolve` and `reject` methods below
        await new Promise((resolve)=>transactionReady = resolve);
        this.sessions[id] = {
            db: transaction,
            reject,
            resolve
        };
    } catch (err) {
        this.payload.logger.error({
            err,
            msg: `Error: cannot begin transaction: ${err.message}`
        });
        throw new Error(`Error: cannot begin transaction: ${err.message}`);
    }
    return id;
}; //# sourceMappingURL=beginTransaction.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/utilities/getMigrationTemplate.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "getMigrationTemplate",
    ()=>getMigrationTemplate,
    "indent",
    ()=>indent
]);
const indent = (text)=>text.split('\n').map((line)=>`  ${line}`).join('\n');
const getMigrationTemplate = ({ downSQL, imports, packageName, upSQL })=>`import { MigrateUpArgs, MigrateDownArgs, sql } from '${packageName}'
${imports ? `${imports}\n` : ''}
export async function up({ db, payload, req }: MigrateUpArgs): Promise<void> {
${indent(upSQL)}
}

export async function down({ db, payload, req }: MigrateDownArgs): Promise<void> {
${indent(downSQL)}
}
`; //# sourceMappingURL=getMigrationTemplate.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/utilities/buildCreateMigration.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "buildCreateMigration",
    ()=>buildCreateMigration
]);
var __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/fs [external] (fs, cjs)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$path__$5b$external$5d$__$28$path$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/path [external] (path, cjs)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$database$2f$migrations$2f$getPredefinedMigration$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/database/migrations/getPredefinedMigration.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$database$2f$migrations$2f$writeMigrationIndex$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/database/migrations/writeMigrationIndex.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$prompts$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/prompts/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getMigrationTemplate$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getMigrationTemplate.js [app-route] (ecmascript)");
;
;
;
;
;
const buildCreateMigration = ({ executeMethod, filename, sanitizeStatements })=>{
    const dirname = __TURBOPACK__imported__module__$5b$externals$5d2f$path__$5b$external$5d$__$28$path$2c$__cjs$29$__["default"].dirname(filename);
    return async function createMigration({ file, forceAcceptWarning, migrationName, payload, skipEmpty }) {
        const dir = payload.db.migrationDir;
        if (!__TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__["default"].existsSync(dir)) {
            __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__["default"].mkdirSync(dir);
        }
        const { generateDrizzleJson, generateMigration, upSnapshot } = this.requireDrizzleKit();
        const drizzleJsonAfter = await generateDrizzleJson(this.schema);
        const [yyymmdd, hhmmss] = new Date().toISOString().split('T');
        const formattedDate = yyymmdd.replace(/\D/g, '');
        const formattedTime = hhmmss.split('.')[0].replace(/\D/g, '');
        let imports = '';
        let downSQL;
        let upSQL;
        const predefinedMigration = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$database$2f$migrations$2f$getPredefinedMigration$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getPredefinedMigration"])({
            dirname,
            file,
            migrationName,
            payload
        });
        imports = predefinedMigration.imports;
        downSQL = predefinedMigration.downSQL;
        upSQL = predefinedMigration.upSQL;
        const timestamp = `${formattedDate}_${formattedTime}`;
        const name = migrationName || file?.split('/').slice(2).join('/');
        const fileName = `${timestamp}${name ? `_${name.replace(/\W/g, '_')}` : ''}`;
        const filePath = `${dir}/${fileName}`;
        if (typeof predefinedMigration.dynamic === 'function') {
            const dynamicResult = await predefinedMigration.dynamic({
                filePath,
                payload
            });
            if (dynamicResult.upSQL) {
                upSQL = dynamicResult.upSQL;
            }
            if (dynamicResult.downSQL) {
                downSQL = dynamicResult.downSQL;
            }
            if (dynamicResult.imports) {
                imports = dynamicResult.imports;
            }
        }
        let drizzleJsonBefore = this.defaultDrizzleSnapshot;
        if (this.schemaName) {
            drizzleJsonBefore.schemas = {
                [this.schemaName]: this.schemaName
            };
        }
        if (!upSQL) {
            // Get latest migration snapshot
            const latestSnapshot = __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__["default"].readdirSync(dir).filter((file)=>file.endsWith('.json')).sort().reverse()?.[0];
            if (latestSnapshot) {
                drizzleJsonBefore = JSON.parse(__TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__["default"].readFileSync(`${dir}/${latestSnapshot}`, 'utf8'));
                if (upSnapshot && drizzleJsonBefore.version < drizzleJsonAfter.version) {
                    drizzleJsonBefore = upSnapshot(drizzleJsonBefore);
                }
            }
            const sqlStatementsUp = await generateMigration(drizzleJsonBefore, drizzleJsonAfter);
            const sqlStatementsDown = await generateMigration(drizzleJsonAfter, drizzleJsonBefore);
            const sqlExecute = `await db.${executeMethod}(` + 'sql`';
            if (sqlStatementsUp?.length) {
                upSQL = sanitizeStatements({
                    sqlExecute,
                    statements: sqlStatementsUp
                });
            }
            if (sqlStatementsDown?.length) {
                downSQL = sanitizeStatements({
                    sqlExecute,
                    statements: sqlStatementsDown
                });
            }
            if (!upSQL?.length && !downSQL?.length && !forceAcceptWarning) {
                if (skipEmpty) {
                    process.exit(0);
                }
                const { confirm: shouldCreateBlankMigration } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$prompts$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])({
                    name: 'confirm',
                    type: 'confirm',
                    initial: false,
                    message: 'No schema changes detected. Would you like to create a blank migration file?'
                }, {
                    onCancel: ()=>{
                        process.exit(0);
                    }
                });
                if (!shouldCreateBlankMigration) {
                    process.exit(0);
                }
            }
            // write schema
            __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__["default"].writeFileSync(`${filePath}.json`, JSON.stringify(drizzleJsonAfter, null, 2));
        }
        const data = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getMigrationTemplate$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getMigrationTemplate"])({
            downSQL: downSQL || `  // Migration code`,
            imports,
            packageName: payload.db.packageName,
            upSQL: upSQL || `  // Migration code`
        });
        const fullPath = `${filePath}.ts`;
        // write migration
        __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__["default"].writeFileSync(fullPath, data);
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$database$2f$migrations$2f$writeMigrationIndex$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["writeMigrationIndex"])({
            migrationsDir: payload.db.migrationDir
        });
        payload.logger.info({
            msg: `Migration created at ${fullPath}`
        });
    };
}; //# sourceMappingURL=buildCreateMigration.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/transactions/commitTransaction.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "commitTransaction",
    ()=>commitTransaction
]);
const commitTransaction = async function commitTransaction(incomingID = '') {
    const transactionID = incomingID instanceof Promise ? await incomingID : incomingID;
    // if the session was deleted it has already been aborted
    if (!this.sessions[transactionID]) {
        return;
    }
    const session = this.sessions[transactionID];
    // Delete from registry FIRST to prevent race conditions
    // This ensures other operations can't retrieve this session while we're ending it
    delete this.sessions[transactionID];
    try {
        await session.resolve();
    } catch (_) {
        await session.reject();
    }
}; //# sourceMappingURL=commitTransaction.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/utilities/getNameFromDrizzleTable.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "getNameFromDrizzleTable",
    ()=>getNameFromDrizzleTable
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$table$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/table.js [app-route] (ecmascript)");
;
const getNameFromDrizzleTable = (table)=>{
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$table$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTableName"])(table);
}; //# sourceMappingURL=getNameFromDrizzleTable.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/utilities/isPolymorphicRelationship.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "isPolymorphicRelationship",
    ()=>isPolymorphicRelationship
]);
const isPolymorphicRelationship = (value)=>{
    return value && typeof value === 'object' && 'relationTo' in value && typeof value.relationTo === 'string' && 'value' in value;
}; //# sourceMappingURL=isPolymorphicRelationship.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/utilities/json.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "jsonAgg",
    ()=>jsonAgg,
    "jsonAggBuildObject",
    ()=>jsonAggBuildObject,
    "jsonBuildObject",
    ()=>jsonBuildObject
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/sql/sql.js [app-route] (ecmascript)");
;
function jsonAgg(adapter, expression) {
    if (adapter.name === 'sqlite') {
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`coalesce(json_group_array(${expression}), '[]')`;
    }
    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`coalesce(json_agg(${expression}), '[]'::json)`;
}
function jsonBuildObject(adapter, shape) {
    const chunks = [];
    Object.entries(shape).forEach(([key, value])=>{
        if (chunks.length > 0) {
            chunks.push(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"].raw(','));
        }
        chunks.push(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"].raw(`'${key}',`));
        chunks.push(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`${value}`);
    });
    if (adapter.name === 'sqlite') {
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`json_object(${__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"].join(chunks)})`;
    }
    return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`json_build_object(${__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"].join(chunks)})`;
}
const jsonAggBuildObject = (adapter, shape)=>{
    return jsonAgg(adapter, jsonBuildObject(adapter, shape));
}; //# sourceMappingURL=json.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/utilities/rawConstraint.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "DistinctSymbol",
    ()=>DistinctSymbol,
    "isRawConstraint",
    ()=>isRawConstraint,
    "rawConstraint",
    ()=>rawConstraint
]);
const RawConstraintSymbol = Symbol('RawConstraint');
const DistinctSymbol = Symbol('DistinctSymbol');
const rawConstraint = (value)=>({
        type: RawConstraintSymbol,
        value
    });
const isRawConstraint = (value)=>{
    return value && typeof value === 'object' && 'type' in value && value.type === RawConstraintSymbol;
}; //# sourceMappingURL=rawConstraint.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/utilities/validateExistingBlockIsIdentical.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "InternalBlockTableNameIndex",
    ()=>InternalBlockTableNameIndex,
    "resolveBlockTableName",
    ()=>resolveBlockTableName,
    "setInternalBlockIndex",
    ()=>setInternalBlockIndex,
    "validateExistingBlockIsIdentical",
    ()=>validateExistingBlockIsIdentical
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/fields/config/types.js [app-route] (ecmascript)");
;
const getFlattenedFieldNames = (args)=>{
    const { fields, parentIsLocalized, prefix = '' } = args;
    return fields.reduce((fieldsToUse, field)=>{
        let fieldPrefix = prefix;
        if ([
            'array',
            'blocks',
            'relationship',
            'upload'
        ].includes(field.type) || 'hasMany' in field && field.hasMany === true) {
            return fieldsToUse;
        }
        if ((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["fieldHasSubFields"])(field)) {
            fieldPrefix = 'name' in field ? `${prefix}${field.name}_` : prefix;
            return [
                ...fieldsToUse,
                ...getFlattenedFieldNames({
                    fields: field.fields,
                    parentIsLocalized: parentIsLocalized || 'localized' in field && field.localized,
                    prefix: fieldPrefix
                })
            ];
        }
        if (field.type === 'tabs') {
            return [
                ...fieldsToUse,
                ...field.tabs.reduce((tabFields, tab)=>{
                    fieldPrefix = 'name' in tab ? `${prefix}_${tab.name}` : prefix;
                    return [
                        ...tabFields,
                        ...(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["tabHasName"])(tab) ? [
                            {
                                ...tab,
                                type: 'tab'
                            }
                        ] : getFlattenedFieldNames({
                            fields: tab.fields,
                            parentIsLocalized: parentIsLocalized || tab.localized,
                            prefix: fieldPrefix
                        })
                    ];
                }, [])
            ];
        }
        if ((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["fieldAffectsData"])(field)) {
            return [
                ...fieldsToUse,
                {
                    name: `${fieldPrefix}${field.name}`,
                    localized: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["fieldShouldBeLocalized"])({
                        field,
                        parentIsLocalized
                    })
                }
            ];
        }
        return fieldsToUse;
    }, []);
};
const validateExistingBlockIsIdentical = ({ block, localized, parentIsLocalized, table, tableLocales })=>{
    const fieldNames = getFlattenedFieldNames({
        fields: block.fields,
        parentIsLocalized: parentIsLocalized || localized
    });
    const missingField = fieldNames.find(({ name, localized })=>{
        const fieldTable = localized && tableLocales ? tableLocales : table;
        return Object.keys(fieldTable.columns).indexOf(name) === -1;
    }) || // ensure every table column is matched for every field from the config
    Object.keys(table).find((fieldName)=>{
        if (![
            '_locale',
            '_order',
            '_parentID',
            '_path',
            '_uuid'
        ].includes(fieldName)) {
            return fieldNames.findIndex((field)=>field.name) === -1;
        }
    });
    if (missingField) {
        return false;
    }
    return Boolean(localized) === Boolean(table.columns._locale);
};
const InternalBlockTableNameIndex = Symbol('InternalBlockTableNameIndex');
const setInternalBlockIndex = (block, index)=>{
    block[InternalBlockTableNameIndex] = index;
};
const resolveBlockTableName = (block, originalTableName)=>{
    if (!block[InternalBlockTableNameIndex]) {
        return originalTableName;
    }
    return `${originalTableName}_${block[InternalBlockTableNameIndex]}`;
}; //# sourceMappingURL=validateExistingBlockIsIdentical.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/queries/addJoinTable.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "addJoinTable",
    ()=>addJoinTable
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getNameFromDrizzleTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getNameFromDrizzleTable.js [app-route] (ecmascript)");
;
const addJoinTable = ({ type, condition, joins, queryPath, table })=>{
    const name = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getNameFromDrizzleTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getNameFromDrizzleTable"])(table);
    if (!joins.some((eachJoin)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getNameFromDrizzleTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getNameFromDrizzleTable"])(eachJoin.table) === name)) {
        joins.push({
            type,
            condition,
            queryPath,
            table
        });
    }
}; //# sourceMappingURL=addJoinTable.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/queries/getTableAlias.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "getTableAlias",
    ()=>getTableAlias
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$alias$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/pg-core/alias.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sqlite$2d$core$2f$alias$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/sqlite-core/alias.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$node_modules$2f$uuid$2f$dist$2f$esm$2d$node$2f$v4$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__default__as__v4$3e$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/node_modules/uuid/dist/esm-node/v4.js [app-route] (ecmascript) <export default as v4>");
;
;
;
;
const getTableAlias = ({ adapter, tableName })=>{
    const newAliasTableName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$node_modules$2f$uuid$2f$dist$2f$esm$2d$node$2f$v4$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__default__as__v4$3e$__["v4"])());
    let newAliasTable;
    if (adapter.name === 'postgres') {
        newAliasTable = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$alias$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["alias"])(adapter.tables[tableName], newAliasTableName);
    }
    if (adapter.name === 'sqlite') {
        newAliasTable = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sqlite$2d$core$2f$alias$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["alias"])(adapter.tables[tableName], newAliasTableName);
    }
    return {
        newAliasTable,
        newAliasTableName
    };
}; //# sourceMappingURL=getTableAlias.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/queries/getTableColumnFromPath.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "getTableColumnFromPath",
    ()=>getTableColumnFromPath
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/sql/expressions/conditions.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$table$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/table.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/sql/sql.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$APIError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/errors/APIError.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$getFieldByPath$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/utilities/getFieldByPath.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/fields/config/types.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$node_modules$2f$uuid$2f$dist$2f$esm$2d$node$2f$validate$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__default__as__validate$3e$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/node_modules/uuid/dist/esm-node/validate.js [app-route] (ecmascript) <export default as validate>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$isPolymorphicRelationship$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/isPolymorphicRelationship.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$json$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/json.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$rawConstraint$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/rawConstraint.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$validateExistingBlockIsIdentical$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/validateExistingBlockIsIdentical.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$addJoinTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/queries/addJoinTable.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$getTableAlias$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/queries/getTableAlias.js [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
;
;
;
const getTableColumnFromPath = ({ adapter, aliasTable, collectionPath, columnPrefix = '', constraintPath: incomingConstraintPath, constraints = [], fields, joins, locale: incomingLocale, parentAliasTable, parentIsLocalized, pathSegments: incomingSegments, rootTableName: incomingRootTableName, selectFields, selectLocale, tableName, tableNameSuffix = '', value })=>{
    const fieldPath = incomingSegments[0];
    let locale = incomingLocale;
    const rootTableName = incomingRootTableName || tableName;
    let constraintPath = incomingConstraintPath || '';
    const field = fields.find((fieldToFind)=>fieldToFind.name === fieldPath);
    let newTableName = tableName;
    if (!field && fieldPath === 'id') {
        selectFields.id = adapter.tables[newTableName].id;
        return {
            columnName: 'id',
            constraints,
            field: {
                name: 'id',
                type: adapter.idType === 'uuid' ? 'text' : 'number'
            },
            table: adapter.tables[newTableName]
        };
    }
    let localizedPathQuery = false;
    if (field) {
        const pathSegments = [
            ...incomingSegments
        ];
        const isFieldLocalized = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["fieldShouldBeLocalized"])({
            field,
            parentIsLocalized
        });
        // If next segment is a locale,
        // we need to take it out and use it as the locale from this point on
        if (isFieldLocalized && adapter.payload.config.localization) {
            const matchedLocale = adapter.payload.config.localization.localeCodes.find((locale)=>locale === pathSegments[1]);
            if (matchedLocale) {
                locale = matchedLocale;
                localizedPathQuery = true;
                pathSegments.splice(1, 1);
            }
        }
        switch(field.type){
            case 'array':
                {
                    newTableName = adapter.tableNameMap.get(`${tableName}_${tableNameSuffix}${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(field.name)}`);
                    const arrayParentTable = aliasTable || adapter.tables[tableName];
                    constraintPath = `${constraintPath}${field.name}.%.`;
                    if (locale && isFieldLocalized && adapter.payload.config.localization) {
                        const conditions = [
                            (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(arrayParentTable.id, adapter.tables[newTableName]._parentID)
                        ];
                        if (selectLocale) {
                            selectFields._locale = adapter.tables[newTableName]._locale;
                        }
                        if (locale !== 'all') {
                            conditions.push((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(adapter.tables[newTableName]._locale, locale));
                        }
                        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$addJoinTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["addJoinTable"])({
                            condition: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["and"])(...conditions),
                            joins,
                            table: adapter.tables[newTableName]
                        });
                    } else {
                        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$addJoinTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["addJoinTable"])({
                            condition: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(arrayParentTable.id, adapter.tables[newTableName]._parentID),
                            joins,
                            table: adapter.tables[newTableName]
                        });
                    }
                    return getTableColumnFromPath({
                        adapter,
                        collectionPath,
                        constraintPath,
                        constraints,
                        fields: field.flattenedFields,
                        joins,
                        locale,
                        parentAliasTable: aliasTable,
                        parentIsLocalized: parentIsLocalized || field.localized,
                        pathSegments: pathSegments.slice(1),
                        rootTableName,
                        selectFields,
                        selectLocale,
                        tableName: newTableName,
                        value
                    });
                }
            case 'blocks':
                {
                    if (adapter.blocksAsJSON) {
                        break;
                    }
                    let blockTableColumn;
                    let newTableName;
                    // handle blockType queries
                    if (pathSegments[1] === 'blockType') {
                        // find the block config using the value
                        const blockTypes = Array.isArray(value) ? value : [
                            value
                        ];
                        blockTypes.forEach((blockType)=>{
                            const block = adapter.payload.blocks[blockType] ?? (field.blockReferences ?? field.blocks).find((block)=>typeof block !== 'string' && block.slug === blockType);
                            newTableName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$validateExistingBlockIsIdentical$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["resolveBlockTableName"])(block, adapter.tableNameMap.get(`${tableName}_blocks_${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(block.slug)}`));
                            const { newAliasTable } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$getTableAlias$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTableAlias"])({
                                adapter,
                                tableName: newTableName
                            });
                            joins.push({
                                condition: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(adapter.tables[tableName].id, newAliasTable._parentID),
                                table: newAliasTable
                            });
                            constraints.push({
                                columnName: '_path',
                                table: newAliasTable,
                                value: pathSegments[0]
                            });
                        });
                        return {
                            constraints,
                            field,
                            getNotNullColumnByValue: ()=>'id',
                            table: adapter.tables[tableName]
                        };
                    }
                    const hasBlockField = (field.blockReferences ?? field.blocks).some((_block)=>{
                        const block = typeof _block === 'string' ? adapter.payload.blocks[_block] : _block;
                        newTableName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$validateExistingBlockIsIdentical$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["resolveBlockTableName"])(block, adapter.tableNameMap.get(`${tableName}_blocks_${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(block.slug)}`));
                        constraintPath = `${constraintPath}${field.name}.%.`;
                        let result;
                        const blockConstraints = [];
                        const blockSelectFields = {};
                        let blockJoin;
                        if (isFieldLocalized && adapter.payload.config.localization) {
                            const conditions = [
                                (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])((aliasTable || adapter.tables[tableName]).id, adapter.tables[newTableName]._parentID)
                            ];
                            if (locale !== 'all') {
                                conditions.push((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(adapter.tables[newTableName]._locale, locale));
                            }
                            blockJoin = {
                                condition: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["and"])(...conditions),
                                table: adapter.tables[newTableName]
                            };
                        } else {
                            blockJoin = {
                                condition: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])((aliasTable || adapter.tables[tableName]).id, adapter.tables[newTableName]._parentID),
                                table: adapter.tables[newTableName]
                            };
                        }
                        // Create a new reference for nested joins
                        const newJoins = [
                            ...joins
                        ];
                        try {
                            result = getTableColumnFromPath({
                                adapter,
                                collectionPath,
                                constraintPath,
                                constraints: blockConstraints,
                                fields: block.flattenedFields,
                                joins: newJoins,
                                locale,
                                parentIsLocalized: parentIsLocalized || field.localized,
                                pathSegments: pathSegments.slice(1),
                                rootTableName,
                                selectFields: blockSelectFields,
                                selectLocale,
                                tableName: newTableName,
                                value
                            });
                        } catch (_) {
                        // this is fine, not every block will have the field
                        }
                        if (!result) {
                            return;
                        }
                        blockTableColumn = result;
                        constraints = constraints.concat(blockConstraints);
                        selectFields = {
                            ...selectFields,
                            ...blockSelectFields
                        };
                        const previousLength = joins.length;
                        joins.push(blockJoin);
                        // Append new joins AFTER the block join to prevent errors with missing FROM clause.
                        if (newJoins.length > previousLength) {
                            for(let i = previousLength; i < newJoins.length; i++){
                                joins.push(newJoins[i]);
                            }
                        }
                        return true;
                    });
                    if (hasBlockField) {
                        return {
                            columnName: blockTableColumn.columnName,
                            constraints,
                            field: blockTableColumn.field,
                            pathSegments: pathSegments.slice(1),
                            rawColumn: blockTableColumn.rawColumn,
                            table: blockTableColumn.table
                        };
                    }
                    break;
                }
            case 'group':
                {
                    if (locale && isFieldLocalized && adapter.payload.config.localization) {
                        newTableName = `${tableName}${adapter.localesSuffix}`;
                        let condition = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(adapter.tables[tableName].id, adapter.tables[newTableName]._parentID);
                        if (locale !== 'all') {
                            condition = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["and"])(condition, (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(adapter.tables[newTableName]._locale, locale));
                        }
                        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$addJoinTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["addJoinTable"])({
                            condition,
                            joins,
                            table: adapter.tables[newTableName]
                        });
                    }
                    return getTableColumnFromPath({
                        adapter,
                        aliasTable,
                        collectionPath,
                        columnPrefix: `${columnPrefix}${field.name}_`,
                        constraintPath: `${constraintPath}${field.name}.`,
                        constraints,
                        fields: field.flattenedFields,
                        joins,
                        locale,
                        parentIsLocalized: parentIsLocalized || field.localized,
                        pathSegments: pathSegments.slice(1),
                        rootTableName,
                        selectFields,
                        selectLocale,
                        tableName: newTableName,
                        tableNameSuffix: `${tableNameSuffix}${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(field.name)}_`,
                        value
                    });
                }
            case 'join':
                {
                    if (Array.isArray(field.collection)) {
                        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$APIError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]('Not supported');
                    }
                    const newCollectionPath = pathSegments.slice(1).join('.');
                    if (field.hasMany) {
                        const relationTableName = `${adapter.tableNameMap.get((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(field.collection))}${adapter.relationshipsSuffix}`;
                        const existingTable = joins.find((e)=>e.queryPath === `${constraintPath}${field.name}._rels`);
                        const aliasRelationshipTable = existingTable?.table ?? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$getTableAlias$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTableAlias"])({
                            adapter,
                            tableName: relationTableName
                        }).newAliasTable;
                        const relationshipField = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$getFieldByPath$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getFieldByPath"])({
                            fields: adapter.payload.collections[field.collection].config.flattenedFields,
                            path: field.on
                        });
                        if (!relationshipField) {
                            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$APIError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]('Relationship was not found');
                        }
                        if (!existingTable) {
                            (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$addJoinTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["addJoinTable"])({
                                condition: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["and"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(adapter.tables[rootTableName].id, aliasRelationshipTable[`${relationshipField.field.relationTo}ID`]), (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["like"])(aliasRelationshipTable.path, field.on)),
                                joins,
                                queryPath: `${constraintPath}${field.name}._rels`,
                                table: aliasRelationshipTable
                            });
                        }
                        if (newCollectionPath === 'id') {
                            return {
                                columnName: 'parent',
                                constraints,
                                field: {
                                    name: 'id',
                                    type: adapter.idType === 'uuid' ? 'text' : 'number'
                                },
                                table: aliasRelationshipTable
                            };
                        }
                        const relationshipConfig = adapter.payload.collections[field.collection].config;
                        const relationshipTableName = adapter.tableNameMap.get((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(relationshipConfig.slug));
                        // parent to relationship join table
                        const relationshipFields = relationshipConfig.flattenedFields;
                        const existingMainTable = joins.find((e)=>e.queryPath === `${constraintPath}${field.name}`);
                        const relationshipTable = existingMainTable?.table ?? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$getTableAlias$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTableAlias"])({
                            adapter,
                            tableName: relationshipTableName
                        }).newAliasTable;
                        if (!existingMainTable) {
                            joins.push({
                                condition: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(aliasRelationshipTable.parent, relationshipTable.id),
                                queryPath: `${constraintPath}${field.name}`,
                                table: relationshipTable
                            });
                        }
                        return getTableColumnFromPath({
                            adapter,
                            aliasTable: relationshipTable,
                            collectionPath: newCollectionPath,
                            constraints,
                            // relationshipFields are fields from a different collection => no parentIsLocalized
                            fields: relationshipFields,
                            joins,
                            locale,
                            parentIsLocalized: false,
                            pathSegments: pathSegments.slice(1),
                            rootTableName: relationshipTableName,
                            selectFields,
                            selectLocale,
                            tableName: relationshipTableName,
                            value
                        });
                    }
                    const newTableName = adapter.tableNameMap.get((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(adapter.payload.collections[field.collection].config.slug));
                    const existingTable = joins.find((e)=>e.queryPath === `${constraintPath}${field.name}`)?.table;
                    const newAliasTable = existingTable || (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$getTableAlias$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTableAlias"])({
                        adapter,
                        tableName: newTableName
                    }).newAliasTable;
                    if (!existingTable) {
                        joins.push({
                            condition: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(newAliasTable[field.on.replaceAll('.', '_')], aliasTable ? aliasTable.id : adapter.tables[tableName].id),
                            queryPath: `${constraintPath}${field.name}`,
                            table: newAliasTable
                        });
                    }
                    if (newCollectionPath === 'id') {
                        return {
                            columnName: 'id',
                            constraints,
                            field: {
                                name: 'id',
                                type: adapter.idType === 'uuid' ? 'text' : 'number'
                            },
                            table: newAliasTable
                        };
                    }
                    return getTableColumnFromPath({
                        adapter,
                        aliasTable: newAliasTable,
                        collectionPath: newCollectionPath,
                        constraintPath: '',
                        constraints,
                        fields: adapter.payload.collections[field.collection].config.flattenedFields,
                        joins,
                        locale,
                        parentIsLocalized: parentIsLocalized || field.localized,
                        pathSegments: pathSegments.slice(1),
                        selectFields,
                        tableName: newTableName,
                        value
                    });
                    //TURBOPACK unreachable
                    ;
                }
            case 'number':
            case 'text':
                {
                    if (field.hasMany) {
                        let tableType = 'texts';
                        let columnName = 'text';
                        if (field.type === 'number') {
                            tableType = 'numbers';
                            columnName = 'number';
                        }
                        newTableName = `${rootTableName}_${tableType}`;
                        const existingTable = joins.find((e)=>e.queryPath === `${constraintPath}${field.name}`);
                        const table = existingTable?.table ?? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$getTableAlias$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTableAlias"])({
                            adapter,
                            tableName: newTableName
                        }).newAliasTable;
                        const joinConstraints = [
                            (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(adapter.tables[rootTableName].id, table.parent),
                            (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["like"])(table.path, `${constraintPath}${field.name}`)
                        ];
                        if (locale && isFieldLocalized && adapter.payload.config.localization) {
                            const conditions = [
                                ...joinConstraints
                            ];
                            if (locale !== 'all') {
                                conditions.push((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(table._locale, locale));
                            }
                            (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$addJoinTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["addJoinTable"])({
                                condition: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["and"])(...conditions),
                                joins,
                                queryPath: `${constraintPath}${field.name}`,
                                table
                            });
                        } else {
                            (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$addJoinTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["addJoinTable"])({
                                condition: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["and"])(...joinConstraints),
                                joins,
                                queryPath: `${constraintPath}${field.name}`,
                                table
                            });
                        }
                        return {
                            columnName,
                            constraints,
                            field,
                            table
                        };
                    }
                    break;
                }
            case 'relationship':
            case 'upload':
                {
                    const newCollectionPath = pathSegments.slice(1).join('.');
                    if (Array.isArray(field.relationTo) || field.hasMany) {
                        let relationshipFields;
                        const relationTableName = `${rootTableName}${adapter.relationshipsSuffix}`;
                        const existingJoin = joins.find((e)=>e.queryPath === `${constraintPath}.${field.name}`);
                        let aliasRelationshipTable;
                        let aliasRelationshipTableName;
                        if (existingJoin) {
                            aliasRelationshipTable = existingJoin.table;
                            aliasRelationshipTableName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$table$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTableName"])(existingJoin.table);
                        } else {
                            const res = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$getTableAlias$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTableAlias"])({
                                adapter,
                                tableName: relationTableName
                            });
                            aliasRelationshipTable = res.newAliasTable;
                            aliasRelationshipTableName = res.newAliasTableName;
                        }
                        if (selectLocale && isFieldLocalized && adapter.payload.config.localization) {
                            selectFields._locale = aliasRelationshipTable.locale;
                        }
                        // Join in the relationships table
                        if (locale && isFieldLocalized && adapter.payload.config.localization) {
                            const conditions = [
                                (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])((parentAliasTable || aliasTable || adapter.tables[rootTableName]).id, aliasRelationshipTable.parent),
                                (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["like"])(aliasRelationshipTable.path, `${constraintPath}${field.name}`)
                            ];
                            if (locale !== 'all') {
                                conditions.push((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(aliasRelationshipTable.locale, locale));
                            }
                            (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$addJoinTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["addJoinTable"])({
                                condition: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["and"])(...conditions),
                                joins,
                                queryPath: `${constraintPath}.${field.name}`,
                                table: aliasRelationshipTable
                            });
                        } else {
                            // Join in the relationships table
                            (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$addJoinTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["addJoinTable"])({
                                condition: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["and"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])((parentAliasTable || aliasTable || adapter.tables[rootTableName]).id, aliasRelationshipTable.parent), (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["like"])(aliasRelationshipTable.path, `${constraintPath}${field.name}`)),
                                joins,
                                queryPath: `${constraintPath}.${field.name}`,
                                table: aliasRelationshipTable
                            });
                        }
                        selectFields[`${relationTableName}.path`] = aliasRelationshipTable.path;
                        let newAliasTable;
                        if (typeof field.relationTo === 'string') {
                            const relationshipConfig = adapter.payload.collections[field.relationTo].config;
                            newTableName = adapter.tableNameMap.get((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(relationshipConfig.slug));
                            // parent to relationship join table
                            relationshipFields = relationshipConfig.flattenedFields;
                            ({ newAliasTable } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$getTableAlias$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTableAlias"])({
                                adapter,
                                tableName: newTableName
                            }));
                            joins.push({
                                condition: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(newAliasTable.id, aliasRelationshipTable[`${field.relationTo}ID`]),
                                table: newAliasTable
                            });
                            if (newCollectionPath === '' || newCollectionPath === 'id') {
                                return {
                                    columnName: `${field.relationTo}ID`,
                                    constraints,
                                    field,
                                    table: aliasRelationshipTable
                                };
                            }
                        } else if (newCollectionPath === 'value') {
                            const hasCustomCollectionWithCustomID = field.relationTo.some((relationTo)=>!!adapter.payload.collections[relationTo].customIDType);
                            const columns = field.relationTo.map((relationTo)=>{
                                let idType = adapter.idType === 'uuid' ? 'uuid' : 'number';
                                const { customIDType } = adapter.payload.collections[relationTo];
                                if (customIDType) {
                                    idType = customIDType;
                                }
                                const idTypeTextOrUuid = idType === 'text' || idType === 'uuid';
                                // Do not add the column to OR if we know that it can't match by the type
                                // We can't do the same with idType: 'number' because `value` can be from the REST search query params
                                if (typeof value === 'number' && idTypeTextOrUuid) {
                                    return null;
                                }
                                if (Array.isArray(value) && value.every((val)=>typeof val === 'number') && idTypeTextOrUuid) {
                                    return null;
                                }
                                // Do not add the UUID type column if incoming query value doesn't match UUID. If there aren't any collections with
                                // a custom ID type, we skip this check
                                // We need this because Postgres throws an error if querying by UUID column with a value that isn't a valid UUID.
                                if (value && !Array.isArray(value) && idType === 'uuid' && hasCustomCollectionWithCustomID) {
                                    if (!(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$node_modules$2f$uuid$2f$dist$2f$esm$2d$node$2f$validate$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__default__as__validate$3e$__["validate"])(value)) {
                                        return null;
                                    }
                                }
                                if (Array.isArray(value) && idType === 'uuid' && hasCustomCollectionWithCustomID && !value.some((val)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$node_modules$2f$uuid$2f$dist$2f$esm$2d$node$2f$validate$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__default__as__validate$3e$__["validate"])(val))) {
                                    return null;
                                }
                                const relationTableName = adapter.tableNameMap.get((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(adapter.payload.collections[relationTo].config.slug));
                                return {
                                    idType,
                                    rawColumn: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"].raw(`"${aliasRelationshipTableName}"."${relationTableName}_id"`)
                                };
                            }).filter(Boolean);
                            return {
                                columns,
                                constraints,
                                field,
                                table: aliasRelationshipTable
                            };
                        } else if (newCollectionPath === 'relationTo') {
                            const relationTo = Array.isArray(field.relationTo) ? field.relationTo : [
                                field.relationTo
                            ];
                            return {
                                constraints,
                                field,
                                getNotNullColumnByValue: (val)=>{
                                    const matchedRelation = relationTo.find((relation)=>relation === val);
                                    if (matchedRelation) {
                                        return `${matchedRelation}ID`;
                                    }
                                    return undefined;
                                },
                                table: aliasRelationshipTable
                            };
                        } else if ((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$isPolymorphicRelationship$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["isPolymorphicRelationship"])(value)) {
                            const { relationTo } = value;
                            const relationTableName = adapter.tableNameMap.get((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(adapter.payload.collections[relationTo].config.slug));
                            return {
                                constraints,
                                field,
                                rawColumn: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"].raw(`"${aliasRelationshipTableName}"."${relationTableName}_id"`),
                                table: aliasRelationshipTable
                            };
                        } else if (value === __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$rawConstraint$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["DistinctSymbol"]) {
                            const obj = {};
                            field.relationTo.forEach((relationTo)=>{
                                const relationTableName = adapter.tableNameMap.get((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(adapter.payload.collections[relationTo].config.slug));
                                obj[relationTo] = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"].raw(`"${aliasRelationshipTableName}"."${relationTableName}_id"`);
                            });
                            let rawColumn = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$json$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["jsonBuildObject"])(adapter, obj);
                            if (adapter.name === 'postgres') {
                                rawColumn = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`${rawColumn}::text`;
                            }
                            return {
                                constraints,
                                field,
                                rawColumn,
                                table: aliasRelationshipTable
                            };
                        } else {
                            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$APIError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]('Not supported');
                        }
                        return getTableColumnFromPath({
                            adapter,
                            aliasTable: newAliasTable,
                            collectionPath: newCollectionPath,
                            constraints,
                            // relationshipFields are fields from a different collection => no parentIsLocalized
                            fields: relationshipFields,
                            joins,
                            locale,
                            parentIsLocalized: false,
                            pathSegments: pathSegments.slice(1),
                            rootTableName: newTableName,
                            selectFields,
                            selectLocale,
                            tableName: newTableName,
                            value
                        });
                    } else if (pathSegments.length > 1 && !(pathSegments.length === 2 && pathSegments[1] === 'id')) {
                        // simple relationships
                        const columnName = `${columnPrefix}${field.name}`;
                        const newTableName = adapter.tableNameMap.get((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(adapter.payload.collections[field.relationTo].config.slug));
                        const { newAliasTable } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$getTableAlias$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTableAlias"])({
                            adapter,
                            tableName: newTableName
                        });
                        if (isFieldLocalized && adapter.payload.config.localization) {
                            const { newAliasTable: aliasLocaleTable } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$getTableAlias$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTableAlias"])({
                                adapter,
                                tableName: `${rootTableName}${adapter.localesSuffix}`
                            });
                            const condtions = [
                                (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(aliasLocaleTable._parentID, adapter.tables[rootTableName].id)
                            ];
                            if (selectLocale) {
                                selectFields._locale = aliasLocaleTable._locale;
                            }
                            if (locale !== 'all') {
                                condtions.push((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(aliasLocaleTable._locale, locale));
                            }
                            const localesTable = adapter.tables[`${rootTableName}${adapter.localesSuffix}`];
                            (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$addJoinTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["addJoinTable"])({
                                condition: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["and"])(...condtions),
                                joins,
                                table: localesTable
                            });
                            joins.push({
                                condition: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(localesTable[columnName], newAliasTable.id),
                                table: newAliasTable
                            });
                        } else {
                            joins.push({
                                condition: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(newAliasTable.id, aliasTable ? aliasTable[columnName] : adapter.tables[tableName][columnName]),
                                table: newAliasTable
                            });
                        }
                        return getTableColumnFromPath({
                            adapter,
                            aliasTable: newAliasTable,
                            collectionPath: newCollectionPath,
                            constraintPath: '',
                            constraints,
                            fields: adapter.payload.collections[field.relationTo].config.flattenedFields,
                            joins,
                            locale,
                            parentIsLocalized: parentIsLocalized || field.localized,
                            pathSegments: pathSegments.slice(1),
                            selectFields,
                            tableName: newTableName,
                            value
                        });
                    }
                    break;
                }
            case 'select':
                {
                    if (field.hasMany) {
                        const newTableName = adapter.tableNameMap.get(`${tableName}_${tableNameSuffix}${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(field.name)}`);
                        const idColumn = (aliasTable ?? adapter.tables[tableName]).id;
                        if (locale && isFieldLocalized && adapter.payload.config.localization) {
                            const conditions = [
                                (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(idColumn, adapter.tables[newTableName].parent),
                                (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(adapter.tables[newTableName]._locale, locale)
                            ];
                            if (locale !== 'all') {
                                conditions.push((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(adapter.tables[newTableName]._locale, locale));
                            }
                            (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$addJoinTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["addJoinTable"])({
                                condition: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["and"])(...conditions),
                                joins,
                                table: adapter.tables[newTableName]
                            });
                        } else {
                            (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$addJoinTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["addJoinTable"])({
                                condition: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(idColumn, adapter.tables[newTableName].parent),
                                joins,
                                table: adapter.tables[newTableName]
                            });
                        }
                        return {
                            columnName: 'value',
                            constraints,
                            field,
                            table: adapter.tables[newTableName]
                        };
                    }
                    break;
                }
            case 'tab':
                {
                    if ((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["tabHasName"])(field)) {
                        return getTableColumnFromPath({
                            adapter,
                            aliasTable,
                            collectionPath,
                            columnPrefix: `${columnPrefix}${field.name}_`,
                            constraintPath: `${constraintPath}${field.name}.`,
                            constraints,
                            fields: field.flattenedFields,
                            joins,
                            locale,
                            parentIsLocalized: parentIsLocalized || field.localized,
                            pathSegments: pathSegments.slice(1),
                            rootTableName,
                            selectFields,
                            selectLocale,
                            tableName: newTableName,
                            tableNameSuffix: `${tableNameSuffix}${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(field.name)}_`,
                            value
                        });
                    }
                    return getTableColumnFromPath({
                        adapter,
                        aliasTable,
                        collectionPath,
                        columnPrefix,
                        constraintPath,
                        constraints,
                        fields: field.flattenedFields,
                        joins,
                        locale,
                        parentIsLocalized: parentIsLocalized || field.localized,
                        pathSegments: pathSegments.slice(1),
                        rootTableName,
                        selectFields,
                        selectLocale,
                        tableName: newTableName,
                        tableNameSuffix,
                        value
                    });
                }
            default:
                {
                    break;
                }
        }
        let newTable = adapter.tables[newTableName];
        if (isFieldLocalized && adapter.payload.config.localization) {
            // If localized, we go to localized table and set aliasTable to undefined
            // so it is not picked up below to be used as targetTable
            const parentTable = aliasTable || adapter.tables[tableName];
            newTableName = `${tableName}${adapter.localesSuffix}`;
            // use an alias because the same query may contain constraints with different locale value
            if (localizedPathQuery) {
                const { newAliasTable } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$getTableAlias$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTableAlias"])({
                    adapter,
                    tableName: newTableName
                });
                newTable = newAliasTable;
            } else {
                newTable = adapter.tables[newTableName];
            }
            let condition = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(parentTable.id, newTable._parentID);
            if (locale !== 'all') {
                condition = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["and"])(condition, (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(newTable._locale, locale));
            }
            if (selectLocale) {
                selectFields._locale = newTable._locale;
            }
            (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$addJoinTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["addJoinTable"])({
                condition,
                joins,
                table: newTable
            });
            aliasTable = undefined;
        }
        const targetTable = aliasTable || newTable;
        selectFields[`${newTableName}.${columnPrefix}${field.name}`] = targetTable[`${columnPrefix}${field.name}`];
        return {
            columnName: `${columnPrefix}${field.name}`,
            constraints,
            field,
            pathSegments,
            table: targetTable
        };
    }
    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$APIError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"](`Cannot find field for path at ${fieldPath}`);
}; //# sourceMappingURL=getTableColumnFromPath.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/queries/buildOrderBy.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "buildOrderBy",
    ()=>buildOrderBy
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$select$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/sql/expressions/select.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getNameFromDrizzleTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getNameFromDrizzleTable.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$getTableColumnFromPath$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/queries/getTableColumnFromPath.js [app-route] (ecmascript)");
;
;
;
const buildOrderBy = ({ adapter, aliasTable, fields, joins, locale, parentIsLocalized, rawSort, selectFields, sort, tableName })=>{
    const orderBy = [];
    const createdAt = adapter.tables[tableName]?.createdAt;
    if (!sort) {
        if (createdAt) {
            sort = '-createdAt';
        } else {
            sort = '-id';
        }
    }
    if (typeof sort === 'string') {
        sort = [
            sort
        ];
    }
    // In the case of Mongo, when sorting by a field that is not unique, the results are not guaranteed to be in the same order each time.
    // So we add a fallback sort to ensure that the results are always in the same order.
    let fallbackSort = '-id';
    if (createdAt) {
        fallbackSort = '-createdAt';
    }
    if (!(sort.includes(fallbackSort) || sort.includes(fallbackSort.replace('-', '')))) {
        sort.push(fallbackSort);
    }
    for (const sortItem of sort){
        let sortProperty;
        let sortDirection;
        if (sortItem[0] === '-') {
            sortProperty = sortItem.substring(1);
            sortDirection = 'desc';
        } else {
            sortProperty = sortItem;
            sortDirection = 'asc';
        }
        try {
            const { columnName: sortTableColumnName, table: sortTable } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$getTableColumnFromPath$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTableColumnFromPath"])({
                adapter,
                collectionPath: sortProperty,
                fields,
                joins,
                locale,
                parentIsLocalized,
                pathSegments: sortProperty.replace(/__/g, '.').split('.'),
                selectFields,
                tableName,
                value: sortProperty
            });
            if (sortTable?.[sortTableColumnName]) {
                let order = sortDirection === 'asc' ? __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$select$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["asc"] : __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$select$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["desc"];
                if (rawSort) {
                    order = ()=>rawSort;
                }
                orderBy.push({
                    column: aliasTable && tableName === (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getNameFromDrizzleTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getNameFromDrizzleTable"])(sortTable) ? aliasTable[sortTableColumnName] : sortTable[sortTableColumnName],
                    order
                });
                selectFields[sortTableColumnName] = sortTable[sortTableColumnName];
            }
        } catch (_) {
        // continue
        }
    }
    return orderBy;
}; //# sourceMappingURL=buildOrderBy.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/utilities/escapeSQLValue.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "SAFE_STRING_REGEX",
    ()=>SAFE_STRING_REGEX,
    "escapeSQLValue",
    ()=>escapeSQLValue
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$APIError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/errors/APIError.js [app-route] (ecmascript)");
;
const SAFE_STRING_REGEX = /^[\w @.\-+:]*$/;
const escapeSQLValue = (value)=>{
    if (value === null) {
        return null;
    }
    if (typeof value === 'number' || typeof value === 'boolean') {
        return value;
    }
    if (typeof value !== 'string') {
        throw new Error('Invalid value type');
    }
    if (!SAFE_STRING_REGEX.test(value)) {
        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$APIError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"](`${value} is not allowed as a JSON query value`, 400);
    }
    const escaped = value.replace(/\\/g, '\\\\').replace(/"/g, '\\"');
    return escaped;
}; //# sourceMappingURL=escapeSQLValue.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/utilities/isValidStringID.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "isValidStringID",
    ()=>isValidStringID
]);
function isValidStringID(value) {
    return /^[\w-]+$/.test(value);
} //# sourceMappingURL=isValidStringID.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/queries/buildAndOrConditions.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "buildAndOrConditions",
    ()=>buildAndOrConditions
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$parseParams$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/queries/parseParams.js [app-route] (ecmascript)");
;
function buildAndOrConditions({ adapter, aliasTable, context, fields, joins, locale, parentIsLocalized, selectFields, selectLocale, tableName, where }) {
    const completedConditions = [];
    // Loop over all AND / OR operations and add them to the AND / OR query param
    // Operations should come through as an array
    for (const condition of where){
        // If the operation is properly formatted as an object
        if (typeof condition === 'object') {
            const result = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$parseParams$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["parseParams"])({
                adapter,
                aliasTable,
                context,
                fields,
                joins,
                locale,
                parentIsLocalized,
                selectFields,
                selectLocale,
                tableName,
                where: condition
            });
            if (result && Object.keys(result).length > 0) {
                completedConditions.push(result);
            }
        }
    }
    return completedConditions;
} //# sourceMappingURL=buildAndOrConditions.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/utilities/getCollectionIdType.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "getCollectionIdType",
    ()=>getCollectionIdType
]);
const typeMap = {
    number: 'number',
    serial: 'number',
    text: 'text',
    uuid: 'text'
};
const getCollectionIdType = ({ adapter, collection })=>{
    return collection.customIDType ?? typeMap[adapter.idType];
}; //# sourceMappingURL=getCollectionIdType.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/queries/sanitizeQueryValue.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "sanitizeQueryValue",
    ()=>sanitizeQueryValue
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$APIError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/errors/APIError.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$createArrayFromCommaDelineated$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/utilities/createArrayFromCommaDelineated.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/fields/config/types.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$node_modules$2f$uuid$2f$dist$2f$esm$2d$node$2f$validate$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__default__as__validate$3e$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/node_modules/uuid/dist/esm-node/validate.js [app-route] (ecmascript) <export default as validate>");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getCollectionIdType$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getCollectionIdType.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$isPolymorphicRelationship$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/isPolymorphicRelationship.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$rawConstraint$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/rawConstraint.js [app-route] (ecmascript)");
;
;
;
;
;
;
const sanitizeQueryValue = ({ adapter, columns, field, isUUID, operator: operatorArg, relationOrPath, val })=>{
    let operator = operatorArg;
    let formattedValue = val;
    let formattedColumns;
    if (!(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["fieldAffectsData"])(field)) {
        return {
            operator,
            value: formattedValue
        };
    }
    if ((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$rawConstraint$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["isRawConstraint"])(val)) {
        return {
            operator,
            value: val.value
        };
    }
    if ((field.type === 'relationship' || field.type === 'upload') && !relationOrPath.endsWith('relationTo') && Array.isArray(formattedValue)) {
        const allPossibleIDTypes = [];
        formattedValue.forEach((val)=>{
            if (adapter.idType !== 'uuid' && typeof val === 'string') {
                allPossibleIDTypes.push(val, parseInt(val));
            } else if (typeof val === 'string') {
                allPossibleIDTypes.push(val);
            } else {
                allPossibleIDTypes.push(val, String(val));
            }
        });
        formattedValue = allPossibleIDTypes;
    }
    // Cast incoming values as proper searchable types
    if (field.type === 'checkbox' && typeof val === 'string') {
        if (val.toLowerCase() === 'true') {
            formattedValue = true;
        }
        if (val.toLowerCase() === 'false') {
            formattedValue = false;
        }
    }
    if ([
        'all',
        'in',
        'not_in'
    ].includes(operator)) {
        if (typeof formattedValue === 'string') {
            formattedValue = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$createArrayFromCommaDelineated$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createArrayFromCommaDelineated"])(formattedValue);
            if (field.type === 'number') {
                formattedValue = formattedValue.map((arrayVal)=>parseFloat(arrayVal));
            }
        } else if (typeof formattedValue === 'number') {
            formattedValue = [
                formattedValue
            ];
        }
        if (!Array.isArray(formattedValue)) {
            return null;
        }
    }
    if (field.type === 'number' && typeof formattedValue === 'string') {
        formattedValue = Number(val);
        if (Number.isNaN(formattedValue)) {
            formattedValue = null;
        }
    }
    if (isUUID && typeof formattedValue === 'string') {
        if (!(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$node_modules$2f$uuid$2f$dist$2f$esm$2d$node$2f$validate$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__default__as__validate$3e$__["validate"])(val)) {
            formattedValue = null;
        }
    }
    // Helper function to convert a single date value to ISO string
    const convertDateToISO = (item)=>{
        if (typeof item === 'string') {
            if (item === 'null' || item === '') {
                return null;
            }
            const date = new Date(item);
            return Number.isNaN(date.getTime()) ? undefined : date.toISOString();
        } else if (typeof item === 'number') {
            return new Date(item).toISOString();
        } else if (item instanceof Date) {
            return item.toISOString();
        }
        return item;
    };
    if (field.type === 'date' && operator !== 'exists') {
        if (Array.isArray(formattedValue)) {
            // Handle arrays of dates for 'in' and 'not_in' operators
            formattedValue = formattedValue.map(convertDateToISO).filter((item)=>item !== undefined);
        } else {
            const converted = convertDateToISO(val);
            if (converted === undefined) {
                return {
                    operator,
                    value: undefined
                };
            }
            formattedValue = converted;
        }
    }
    if (field.type === 'relationship' || field.type === 'upload') {
        if (val === 'null') {
            formattedValue = null;
        } else if (!(formattedValue === null || typeof formattedValue === 'boolean')) {
            // convert the value to the idType of the relationship
            let idType;
            if (typeof field.relationTo === 'string') {
                idType = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getCollectionIdType$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCollectionIdType"])({
                    adapter,
                    collection: adapter.payload.collections[field.relationTo]
                });
            } else {
                if ((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$isPolymorphicRelationship$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["isPolymorphicRelationship"])(val)) {
                    if (operator !== 'equals') {
                        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$APIError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"](`Only 'equals' operator is supported for polymorphic relationship object notation. Given - ${operator}`);
                    }
                    idType = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getCollectionIdType$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getCollectionIdType"])({
                        adapter,
                        collection: adapter.payload.collections[val.relationTo]
                    });
                    if ((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$rawConstraint$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["isRawConstraint"])(val.value)) {
                        return {
                            operator,
                            value: val.value.value
                        };
                    }
                    return {
                        operator,
                        value: idType === 'number' ? Number(val.value) : String(val.value)
                    };
                }
                formattedColumns = columns.map(({ idType, rawColumn })=>{
                    let formattedValue;
                    if (Array.isArray(val)) {
                        formattedValue = val.map((eachVal)=>{
                            let formattedValue;
                            if (idType === 'number') {
                                formattedValue = Number(eachVal);
                                if (Number.isNaN(formattedValue)) {
                                    return null;
                                }
                            } else {
                                if (idType === 'uuid' && !(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$node_modules$2f$uuid$2f$dist$2f$esm$2d$node$2f$validate$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__$3c$export__default__as__validate$3e$__["validate"])(eachVal)) {
                                    return null;
                                }
                                formattedValue = String(eachVal);
                            }
                            return formattedValue;
                        }).filter(Boolean);
                    } else if (idType === 'number') {
                        formattedValue = Number(val);
                        if (Number.isNaN(formattedValue)) {
                            return null;
                        }
                    } else {
                        formattedValue = String(val);
                    }
                    return {
                        rawColumn,
                        value: formattedValue
                    };
                }).filter(Boolean);
            }
            if (Array.isArray(formattedValue)) {
                formattedValue = formattedValue.map((value)=>{
                    if (idType === 'number') {
                        return Number(value);
                    }
                    if (idType === 'text') {
                        return String(value);
                    }
                    return value;
                });
            } else {
                if (idType === 'number') {
                    formattedValue = Number(val);
                }
                if (idType === 'text') {
                    formattedValue = String(val);
                }
            }
        }
    }
    if ('hasMany' in field && field.hasMany && operator === 'contains') {
        operator = 'equals';
    }
    if (operator === 'near' && field.type === 'point' && typeof formattedValue === 'string') {
        const [lng, lat, maxDistance, minDistance] = formattedValue.split(',');
        formattedValue = [
            Number(lng),
            Number(lat),
            Number(maxDistance),
            Number(minDistance)
        ];
    }
    if (operator === 'contains') {
        formattedValue = `%${formattedValue}%`;
    }
    if (operator === 'exists') {
        formattedValue = val === 'true' || val === true;
        if (formattedValue) {
            operator = 'exists';
        } else {
            operator = 'isNull';
        }
    }
    return {
        columns: formattedColumns,
        operator,
        value: formattedValue
    };
}; //# sourceMappingURL=sanitizeQueryValue.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/queries/parseParams.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "parseParams",
    ()=>parseParams
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/sql/expressions/conditions.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$table$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/table.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/sql/sql.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$uuid$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/pg-core/columns/uuid.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$APIError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/errors/APIError.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$QueryError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/errors/QueryError.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$types$2f$constants$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/types/constants.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$escapeSQLValue$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/escapeSQLValue.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getNameFromDrizzleTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getNameFromDrizzleTable.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$isValidStringID$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/isValidStringID.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$rawConstraint$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/rawConstraint.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$buildAndOrConditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/queries/buildAndOrConditions.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$getTableColumnFromPath$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/queries/getTableColumnFromPath.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$sanitizeQueryValue$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/queries/sanitizeQueryValue.js [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
;
;
;
function parseParams({ adapter, aliasTable, context, fields, joins, locale, parentIsLocalized, selectFields, selectLocale, tableName, where }) {
    let result;
    const constraints = [];
    if (typeof where === 'object' && Object.keys(where).length > 0) {
        // We need to determine if the whereKey is an AND, OR, or a schema path
        for (const relationOrPath of Object.keys(where)){
            if (relationOrPath) {
                const condition = where[relationOrPath];
                let conditionOperator;
                if (relationOrPath.toLowerCase() === 'and') {
                    conditionOperator = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["and"];
                } else if (relationOrPath.toLowerCase() === 'or') {
                    conditionOperator = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["or"];
                }
                if (Array.isArray(condition)) {
                    const builtConditions = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$buildAndOrConditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildAndOrConditions"])({
                        adapter,
                        aliasTable,
                        context,
                        fields,
                        joins,
                        locale,
                        parentIsLocalized,
                        selectFields,
                        selectLocale,
                        tableName,
                        where: condition
                    });
                    if (builtConditions.length > 0) {
                        result = conditionOperator(...builtConditions);
                    }
                } else {
                    // It's a path - and there can be multiple comparisons on a single path.
                    // For example - title like 'test' and title not equal to 'tester'
                    // So we need to loop on keys again here to handle each operator independently
                    const pathOperators = where[relationOrPath];
                    if (typeof pathOperators === 'object') {
                        for (let operator of Object.keys(pathOperators)){
                            if (__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$types$2f$constants$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["validOperatorSet"].has(operator)) {
                                const val = where[relationOrPath][operator];
                                const { columnName, columns, constraints: queryConstraints, field, getNotNullColumnByValue, pathSegments, rawColumn, table } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$getTableColumnFromPath$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTableColumnFromPath"])({
                                    adapter,
                                    aliasTable,
                                    collectionPath: relationOrPath,
                                    fields,
                                    joins,
                                    locale,
                                    parentIsLocalized,
                                    pathSegments: relationOrPath.replace(/__/g, '.').split('.'),
                                    selectFields,
                                    selectLocale,
                                    tableName,
                                    value: val
                                });
                                const resolvedColumn = rawColumn || (aliasTable && tableName === (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getNameFromDrizzleTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getNameFromDrizzleTable"])(table) ? aliasTable[columnName] : table[columnName]);
                                if (val === __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$rawConstraint$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["DistinctSymbol"]) {
                                    selectFields['_selected'] = resolvedColumn;
                                    break;
                                }
                                queryConstraints.forEach(({ columnName: col, table: constraintTable, value })=>{
                                    if (typeof value === 'string' && value.indexOf('%') > -1) {
                                        constraints.push(adapter.operators.like(constraintTable[col], value));
                                    } else {
                                        constraints.push(adapter.operators.equals(constraintTable[col], value));
                                    }
                                });
                                if (([
                                    'json',
                                    'richText'
                                ].includes(field.type) || field.type === 'blocks' && adapter.blocksAsJSON) && Array.isArray(pathSegments) && pathSegments.length > 1) {
                                    if (adapter.name === 'postgres') {
                                        const constraint = adapter.createJSONQuery({
                                            column: rawColumn || table[columnName],
                                            operator,
                                            pathSegments,
                                            value: val
                                        });
                                        constraints.push(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"].raw(constraint));
                                        break;
                                    }
                                    const segments = pathSegments.slice(1);
                                    segments.unshift(table[columnName].name);
                                    if (field.type === 'richText') {
                                        // use the table name from the nearest join to handle blocks, arrays, etc. or use the tableName arg
                                        const jsonTable = joins.length === 0 ? tableName : joins[joins.length - 1].table[Object.getOwnPropertySymbols(joins[joins.length - 1].table)[0]];
                                        const jsonQuery = adapter.createJSONQuery({
                                            operator,
                                            pathSegments: segments,
                                            table: jsonTable,
                                            treatAsArray: [
                                                'children'
                                            ],
                                            treatRootAsArray: true,
                                            value: val
                                        });
                                        constraints.push(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"].raw(jsonQuery));
                                        break;
                                    }
                                    const jsonQuery = adapter.convertPathToJSONTraversal(pathSegments);
                                    const operatorKeys = {
                                        contains: {
                                            operator: 'like',
                                            wildcard: '%'
                                        },
                                        equals: {
                                            operator: '=',
                                            wildcard: ''
                                        },
                                        exists: {
                                            operator: val === true ? 'is not null' : 'is null',
                                            wildcard: ''
                                        },
                                        in: {
                                            operator: 'in',
                                            wildcard: ''
                                        },
                                        like: {
                                            operator: 'like',
                                            wildcard: '%'
                                        },
                                        not_equals: {
                                            operator: '<>',
                                            wildcard: ''
                                        },
                                        not_in: {
                                            operator: 'not in',
                                            wildcard: ''
                                        },
                                        not_like: {
                                            operator: 'not like',
                                            wildcard: '%'
                                        }
                                    };
                                    let formattedValue = val;
                                    if (adapter.name === 'sqlite' && operator === 'equals' && !isNaN(val)) {
                                        formattedValue = val;
                                    } else if ([
                                        'in',
                                        'not_in'
                                    ].includes(operator) && Array.isArray(val)) {
                                        formattedValue = `(${val.map((v)=>`${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$escapeSQLValue$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["escapeSQLValue"])(v)}`).join(',')})`;
                                    } else {
                                        formattedValue = `'${operatorKeys[operator].wildcard}${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$escapeSQLValue$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["escapeSQLValue"])(val)}${operatorKeys[operator].wildcard}'`;
                                    }
                                    if (operator === 'exists') {
                                        formattedValue = '';
                                    }
                                    let jsonQuerySelector = `${table[columnName].name}${jsonQuery}`;
                                    if (adapter.name === 'sqlite' && operator === 'not_like') {
                                        jsonQuerySelector = `COALESCE(${table[columnName].name}${jsonQuery}, '')`;
                                    }
                                    const rawSQLQuery = `${jsonQuerySelector} ${operatorKeys[operator].operator} ${formattedValue}`;
                                    constraints.push(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"].raw(rawSQLQuery));
                                    break;
                                }
                                if (getNotNullColumnByValue) {
                                    const columnName = getNotNullColumnByValue(val);
                                    if (columnName) {
                                        constraints.push((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["isNotNull"])(table[columnName]));
                                    } else {
                                        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$QueryError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["QueryError"]([
                                            {
                                                path: relationOrPath
                                            }
                                        ]);
                                    }
                                    break;
                                }
                                if (operator === 'like' && (field.type === 'number' || field.type === 'relationship' || field.type === 'upload' || table[columnName].columnType === 'PgUUID')) {
                                    operator = 'equals';
                                }
                                if (operator === 'like') {
                                    constraints.push((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["and"])(...val.split(' ').map((word)=>adapter.operators.like(table[columnName], `%${word}%`))));
                                    break;
                                }
                                const sanitizedQueryValue = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$sanitizeQueryValue$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sanitizeQueryValue"])({
                                    adapter,
                                    columns,
                                    field,
                                    isUUID: table?.[columnName] instanceof __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$uuid$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["PgUUID"],
                                    operator,
                                    relationOrPath,
                                    val
                                });
                                if (sanitizedQueryValue === null) {
                                    break;
                                }
                                const { columns: queryColumns, operator: queryOperator, value: queryValue } = sanitizedQueryValue;
                                // Handle polymorphic relationships by value
                                if (queryColumns) {
                                    if (!queryColumns.length) {
                                        break;
                                    }
                                    let wrapOperator = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["or"];
                                    if (queryValue === null && [
                                        'equals',
                                        'not_equals'
                                    ].includes(operator)) {
                                        if (operator === 'equals') {
                                            wrapOperator = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["and"];
                                        }
                                        constraints.push(wrapOperator(...queryColumns.map(({ rawColumn })=>operator === 'equals' ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["isNull"])(rawColumn) : (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["isNotNull"])(rawColumn))));
                                        break;
                                    }
                                    if ([
                                        'not_equals',
                                        'not_in'
                                    ].includes(operator)) {
                                        wrapOperator = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["and"];
                                    }
                                    constraints.push(wrapOperator(...queryColumns.map(({ rawColumn, value })=>adapter.operators[queryOperator](rawColumn, value))));
                                    break;
                                }
                                if (queryOperator === 'not_equals' && queryValue !== null) {
                                    constraints.push((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["or"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["isNull"])(resolvedColumn), /* eslint-disable @typescript-eslint/no-explicit-any */ (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ne"])(resolvedColumn, queryValue)));
                                    break;
                                }
                                if ((field.type === 'relationship' || field.type === 'upload') && Array.isArray(queryValue) && operator === 'not_in') {
                                    constraints.push(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`(${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["notInArray"])(table[columnName], queryValue)} OR
                    ${table[columnName]}
                    IS
                    NULL)`);
                                    break;
                                }
                                if (operator === 'equals' && queryValue === null) {
                                    constraints.push((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["isNull"])(resolvedColumn));
                                    break;
                                }
                                if (operator === 'not_equals' && queryValue === null) {
                                    constraints.push((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["isNotNull"])(resolvedColumn));
                                    break;
                                }
                                if (field.type === 'point' && adapter.name === 'postgres') {
                                    switch(operator){
                                        case 'intersects':
                                            {
                                                constraints.push(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`ST_Intersects(${table[columnName]}, ST_GeomFromGeoJSON(${JSON.stringify(queryValue)}))`);
                                                break;
                                            }
                                        case 'near':
                                            {
                                                const [lng, lat, maxDistance, minDistance] = queryValue;
                                                const geoConstraints = [];
                                                if (typeof maxDistance === 'number' && !Number.isNaN(maxDistance)) {
                                                    geoConstraints.push(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`ST_DWithin(ST_Transform(${table[columnName]}, 3857), ST_Transform(ST_SetSRID(ST_MakePoint(${lng}, ${lat}), 4326), 3857), ${maxDistance})`);
                                                }
                                                if (typeof minDistance === 'number' && !Number.isNaN(minDistance)) {
                                                    geoConstraints.push(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`ST_Distance(ST_Transform(${table[columnName]}, 3857), ST_Transform(ST_SetSRID(ST_MakePoint(${lng}, ${lat}), 4326), 3857)) >= ${minDistance}`);
                                                }
                                                if (geoConstraints.length) {
                                                    context.sort = relationOrPath;
                                                    context.rawSort = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`${table[columnName]} <-> ST_SetSRID(ST_MakePoint(${lng}, ${lat}), 4326)`;
                                                    constraints.push((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["and"])(...geoConstraints));
                                                }
                                                break;
                                            }
                                        case 'within':
                                            {
                                                constraints.push(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`ST_Within(${table[columnName]}, ST_GeomFromGeoJSON(${JSON.stringify(queryValue)}))`);
                                                break;
                                            }
                                        default:
                                            break;
                                    }
                                    break;
                                }
                                const orConditions = [];
                                let resolvedQueryValue = queryValue;
                                if (operator === 'in' && Array.isArray(queryValue) && queryValue.some((v)=>v === null)) {
                                    orConditions.push((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["isNull"])(resolvedColumn));
                                    resolvedQueryValue = queryValue.filter((v)=>v !== null);
                                }
                                let constraint = adapter.operators[queryOperator](resolvedColumn, resolvedQueryValue);
                                if (adapter.limitedBoundParameters && (operator === 'in' || operator === 'not_in') && relationOrPath === 'id' && Array.isArray(queryValue)) {
                                    let isInvalid = false;
                                    for (const val of queryValue){
                                        if (typeof val === 'number' || val === null) {
                                            continue;
                                        }
                                        if (typeof val === 'string') {
                                            if (!(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$isValidStringID$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["isValidStringID"])(val)) {
                                                isInvalid = true;
                                                break;
                                            } else {
                                                continue;
                                            }
                                        }
                                        isInvalid = true;
                                        break;
                                    }
                                    if (isInvalid) {
                                        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$APIError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"](`Invalid ID value in ${JSON.stringify(queryValue)}`);
                                    }
                                    constraints.push(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"].raw(`"${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$table$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTableName"])(resolvedColumn.table)}"."${resolvedColumn.name}" ${operator === 'in' ? 'IN' : 'NOT IN'} (${queryValue.map((e)=>{
                                        if (e === null) {
                                            return `NULL`;
                                        }
                                        if (typeof e === 'number') {
                                            return e;
                                        }
                                        return `'${e}'`;
                                    }).join(',')})`));
                                    break;
                                }
                                if (orConditions.length) {
                                    orConditions.push(constraint);
                                    constraint = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["or"])(...orConditions);
                                }
                                constraints.push(constraint);
                            }
                        }
                    }
                }
            }
        }
    }
    if (constraints.length > 0) {
        if (result) {
            result = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["and"])(result, ...constraints);
        } else {
            result = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["and"])(...constraints);
        }
    }
    if (constraints.length === 1 && !result) {
        ;
        [result] = constraints;
    }
    return result;
} //# sourceMappingURL=parseParams.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/queries/buildQuery.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "buildQuery",
    ()=>buildQuery
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$buildOrderBy$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/queries/buildOrderBy.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$parseParams$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/queries/parseParams.js [app-route] (ecmascript)");
;
;
const buildQuery = function buildQuery({ adapter, aliasTable, fields, joins = [], locale, parentIsLocalized, selectLocale, sort, tableName, where: incomingWhere }) {
    const selectFields = {
        id: adapter.tables[tableName].id
    };
    let where;
    const context = {
        sort
    };
    if (incomingWhere && Object.keys(incomingWhere).length > 0) {
        where = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$parseParams$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["parseParams"])({
            adapter,
            aliasTable,
            context,
            fields,
            joins,
            locale,
            parentIsLocalized,
            selectFields,
            selectLocale,
            tableName,
            where: incomingWhere
        });
    }
    const orderBy = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$buildOrderBy$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildOrderBy"])({
        adapter,
        aliasTable,
        fields,
        joins,
        locale,
        parentIsLocalized,
        rawSort: context.rawSort,
        selectFields,
        sort: context.sort,
        tableName
    });
    return {
        joins,
        orderBy,
        selectFields,
        where
    };
}; //# sourceMappingURL=buildQuery.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/utilities/getTransaction.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

/**
 * Returns current db transaction instance from req or adapter.drizzle itself
 *
 * If a transaction session doesn't exist (e.g., it was already committed/rolled back),
 * falls back to the default adapter.drizzle instance to prevent errors.
 */ __turbopack_context__.s([
    "getTransaction",
    ()=>getTransaction
]);
const getTransaction = async (adapter, req)=>{
    if (!req?.transactionID) {
        return adapter.drizzle;
    }
    return adapter.sessions[await req.transactionID]?.db || adapter.drizzle;
}; //# sourceMappingURL=getTransaction.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/count.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "count",
    ()=>count
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$buildQuery$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/queries/buildQuery.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getTransaction.js [app-route] (ecmascript)");
;
;
;
const count = async function count({ collection, locale, req, where: whereArg }) {
    const collectionConfig = this.payload.collections[collection].config;
    const tableName = this.tableNameMap.get((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(collectionConfig.slug));
    const { joins, where } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$buildQuery$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildQuery"])({
        adapter: this,
        fields: collectionConfig.flattenedFields,
        locale,
        tableName,
        where: whereArg
    });
    const db = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTransaction"])(this, req);
    const countResult = await this.countDistinct({
        db,
        joins,
        tableName,
        where
    });
    return {
        totalDocs: countResult
    };
}; //# sourceMappingURL=count.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/countGlobalVersions.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "countGlobalVersions",
    ()=>countGlobalVersions
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildGlobalFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/versions/buildGlobalFields.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$buildQuery$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/queries/buildQuery.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getTransaction.js [app-route] (ecmascript)");
;
;
;
;
const countGlobalVersions = async function countGlobalVersions({ global, locale, req, where: whereArg }) {
    const globalConfig = this.payload.globals.config.find(({ slug })=>slug === global);
    const tableName = this.tableNameMap.get(`_${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(globalConfig.slug)}${this.versionsSuffix}`);
    const fields = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildGlobalFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildVersionGlobalFields"])(this.payload.config, globalConfig, true);
    const { joins, where } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$buildQuery$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildQuery"])({
        adapter: this,
        fields,
        locale,
        tableName,
        where: whereArg
    });
    const db = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTransaction"])(this, req);
    const countResult = await this.countDistinct({
        db,
        joins,
        tableName,
        where
    });
    return {
        totalDocs: countResult
    };
}; //# sourceMappingURL=countGlobalVersions.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/countVersions.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "countVersions",
    ()=>countVersions
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildCollectionFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/versions/buildCollectionFields.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$buildQuery$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/queries/buildQuery.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getTransaction.js [app-route] (ecmascript)");
;
;
;
;
const countVersions = async function countVersions({ collection, locale, req, where: whereArg }) {
    const collectionConfig = this.payload.collections[collection].config;
    const tableName = this.tableNameMap.get(`_${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(collectionConfig.slug)}${this.versionsSuffix}`);
    const fields = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildCollectionFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildVersionCollectionFields"])(this.payload.config, collectionConfig, true);
    const { joins, where } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$buildQuery$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildQuery"])({
        adapter: this,
        fields,
        locale,
        tableName,
        where: whereArg
    });
    const db = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTransaction"])(this, req);
    const countResult = await this.countDistinct({
        db,
        joins,
        tableName,
        where
    });
    return {
        totalDocs: countResult
    };
}; //# sourceMappingURL=countVersions.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/queries/operatorMap.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "operatorMap",
    ()=>operatorMap
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/sql/expressions/conditions.js [app-route] (ecmascript)");
;
const operatorMap = {
    and: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["and"],
    contains: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ilike"],
    equals: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"],
    exists: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["isNotNull"],
    greater_than: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["gt"],
    greater_than_equal: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["gte"],
    in: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["inArray"],
    isNull: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["isNull"],
    less_than: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["lt"],
    less_than_equal: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["lte"],
    like: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ilike"],
    not_equals: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ne"],
    not_like: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["notIlike"],
    // TODO: support this
    // all: all,
    not_in: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["notInArray"],
    or: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["or"]
}; //# sourceMappingURL=operatorMap.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/utilities/getArrayRelationName.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "getArrayRelationName",
    ()=>getArrayRelationName
]);
const getArrayRelationName = ({ field, path, tableName })=>{
    if (field.dbName && path.length > 63) {
        return `_${tableName}`;
    }
    return path;
}; //# sourceMappingURL=getArrayRelationName.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/find/traverseFields.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "traverseFields",
    ()=>traverseFields
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/sql/expressions/conditions.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$select$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/sql/expressions/select.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$functions$2f$aggregate$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/sql/functions/aggregate.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$table$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/table.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/sql/sql.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$drafts$2f$appendVersionToQueryKey$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/versions/drafts/appendVersionToQueryKey.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildCollectionFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/versions/buildCollectionFields.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$database$2f$combineQueries$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/database/combineQueries.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$getFieldByPath$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/utilities/getFieldByPath.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$drafts$2f$getQueryDraftsSort$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/versions/drafts/getQueryDraftsSort.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/fields/config/types.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$getVersionsConfig$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/utilities/getVersionsConfig.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$buildQuery$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/queries/buildQuery.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$getTableAlias$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/queries/getTableAlias.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$operatorMap$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/queries/operatorMap.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getArrayRelationName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getArrayRelationName.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getNameFromDrizzleTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getNameFromDrizzleTable.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$json$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/json.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$rawConstraint$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/rawConstraint.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$validateExistingBlockIsIdentical$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/validateExistingBlockIsIdentical.js [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
;
;
;
;
const flattenAllWherePaths = (where, paths)=>{
    for(const k in where){
        if ([
            'AND',
            'OR'
        ].includes(k.toUpperCase())) {
            if (Array.isArray(where[k])) {
                for (const whereField of where[k]){
                    flattenAllWherePaths(whereField, paths);
                }
            }
        } else {
            // TODO: explore how to support arrays/relationship querying.
            paths.push({
                path: k.split('.').join('_'),
                ref: where
            });
        }
    }
};
const buildSQLWhere = (where, alias)=>{
    for(const k in where){
        if ([
            'AND',
            'OR'
        ].includes(k.toUpperCase())) {
            if (Array.isArray(where[k])) {
                const op = 'AND' === k.toUpperCase() ? __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["and"] : __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["or"];
                const accumulated = [];
                for (const whereField of where[k]){
                    accumulated.push(buildSQLWhere(whereField, alias));
                }
                return op(...accumulated);
            }
        } else {
            let payloadOperator = Object.keys(where[k])[0];
            const value = where[k][payloadOperator];
            if (payloadOperator === '$raw') {
                return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"].raw(value);
            }
            // Handle exists: false -> use isNull instead of isNotNull
            // This logic is duplicated from sanitizeQueryValue.ts because buildSQLWhere
            // is a simplified WHERE builder for polymorphic joins that doesn't have access
            // to field definitions needed by sanitizeQueryValue
            if (payloadOperator === 'exists' && value === false) {
                payloadOperator = 'isNull';
            }
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$operatorMap$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["operatorMap"][payloadOperator](__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"].raw(`"${alias}"."${k.split('.').join('_')}"`), value);
        }
    }
};
const traverseFields = ({ _locales, adapter, collectionSlug, currentArgs, currentTableName, depth, draftsEnabled, fields, forceWithFields, joinQuery = {}, joins, locale, parentIsLocalized = false, path, select, selectAllOnCurrentLevel = false, selectMode, tablePath, topLevelArgs, topLevelTableName, versions, withTabledFields })=>{
    fields.forEach((field)=>{
        if ((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["fieldIsVirtual"])(field)) {
            return;
        }
        const isFieldLocalized = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["fieldShouldBeLocalized"])({
            field,
            parentIsLocalized
        });
        // handle simple relationship
        if (depth > 0 && (field.type === 'upload' || field.type === 'relationship') && !field.hasMany && typeof field.relationTo === 'string') {
            if (isFieldLocalized) {
                _locales.with[`${path}${field.name}`] = true;
            } else {
                currentArgs.with[`${path}${field.name}`] = true;
            }
        }
        switch(field.type){
            case 'array':
                {
                    const arraySelect = selectAllOnCurrentLevel ? true : select?.[field.name];
                    if (select) {
                        if (selectMode === 'include' && typeof arraySelect === 'undefined' || selectMode === 'exclude' && arraySelect === false) {
                            break;
                        }
                    }
                    const withArray = {
                        columns: typeof arraySelect === 'object' ? {
                            id: true,
                            _order: true
                        } : {
                            _parentID: false
                        },
                        orderBy: ({ _order }, { asc })=>[
                                asc(_order)
                            ],
                        with: {}
                    };
                    const arrayTableName = adapter.tableNameMap.get(`${currentTableName}_${tablePath}${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(field.name)}`);
                    if (typeof arraySelect === 'object') {
                        if (adapter.tables[arrayTableName]._locale) {
                            withArray.columns._locale = true;
                        }
                        if (adapter.tables[arrayTableName]._uuid) {
                            withArray.columns._uuid = true;
                        }
                    }
                    const arrayTableNameWithLocales = `${arrayTableName}${adapter.localesSuffix}`;
                    if (adapter.tables[arrayTableNameWithLocales]) {
                        withArray.with._locales = {
                            columns: typeof arraySelect === 'object' ? {
                                _locale: true
                            } : {
                                id: false,
                                _parentID: false
                            },
                            with: {}
                        };
                    }
                    const relationName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getArrayRelationName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getArrayRelationName"])({
                        field,
                        path: `${path}${field.name}`,
                        tableName: arrayTableName
                    });
                    currentArgs.with[relationName] = withArray;
                    traverseFields({
                        _locales: withArray.with._locales,
                        adapter,
                        currentArgs: withArray,
                        currentTableName: arrayTableName,
                        depth,
                        draftsEnabled,
                        fields: field.flattenedFields,
                        forceWithFields,
                        joinQuery,
                        locale,
                        parentIsLocalized: parentIsLocalized || field.localized,
                        path: '',
                        select: typeof arraySelect === 'object' ? arraySelect : undefined,
                        selectMode,
                        tablePath: '',
                        topLevelArgs,
                        topLevelTableName,
                        withTabledFields
                    });
                    if (typeof arraySelect === 'object' && withArray.with._locales && Object.keys(withArray.with._locales).length === 1) {
                        delete withArray.with._locales;
                    }
                    break;
                }
            case 'blocks':
                {
                    const blocksSelect = selectAllOnCurrentLevel ? true : select?.[field.name];
                    if (select) {
                        if (selectMode === 'include' && !blocksSelect || selectMode === 'exclude' && blocksSelect === false) {
                            break;
                        }
                    }
                    if (adapter.blocksAsJSON) {
                        if (select || selectAllOnCurrentLevel) {
                            const fieldPath = `${path}${field.name}`;
                            if ((isFieldLocalized || parentIsLocalized) && _locales) {
                                _locales.columns[fieldPath] = true;
                            } else if (adapter.tables[currentTableName]?.[fieldPath]) {
                                currentArgs.columns[fieldPath] = true;
                            }
                        }
                        break;
                    }
                    ;
                    (field.blockReferences ?? field.blocks).forEach((_block)=>{
                        const block = typeof _block === 'string' ? adapter.payload.blocks[_block] : _block;
                        const blockKey = `_blocks_${block.slug}${!block[__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$validateExistingBlockIsIdentical$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["InternalBlockTableNameIndex"]] ? '' : `_${block[__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$validateExistingBlockIsIdentical$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["InternalBlockTableNameIndex"]]}`}`;
                        let blockSelect;
                        let blockSelectMode = selectMode;
                        if (selectMode === 'include' && blocksSelect === true) {
                            blockSelect = true;
                        }
                        if (typeof blocksSelect === 'object') {
                            if (typeof blocksSelect[block.slug] === 'object') {
                                blockSelect = blocksSelect[block.slug];
                            } else if (selectMode === 'include' && typeof blocksSelect[block.slug] === 'undefined' || selectMode === 'exclude' && blocksSelect[block.slug] === false) {
                                blockSelect = {};
                                blockSelectMode = 'include';
                            } else if (selectMode === 'include' && Boolean(blocksSelect[block.slug])) {
                                blockSelect = true;
                            }
                        }
                        if (!topLevelArgs[blockKey]) {
                            const withBlock = {
                                columns: typeof blockSelect === 'object' ? {
                                    id: true,
                                    _order: true,
                                    _path: true
                                } : {
                                    _parentID: false
                                },
                                orderBy: ({ _order }, { asc })=>[
                                        asc(_order)
                                    ],
                                with: {}
                            };
                            const tableName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$validateExistingBlockIsIdentical$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["resolveBlockTableName"])(block, adapter.tableNameMap.get(`${topLevelTableName}_blocks_${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(block.slug)}`));
                            if (typeof blockSelect === 'object') {
                                if (adapter.tables[tableName]._locale) {
                                    withBlock.columns._locale = true;
                                }
                                if (adapter.tables[tableName]._uuid) {
                                    withBlock.columns._uuid = true;
                                }
                            }
                            if (adapter.tables[`${tableName}${adapter.localesSuffix}`]) {
                                withBlock.with._locales = {
                                    with: {}
                                };
                                if (typeof blockSelect === 'object') {
                                    withBlock.with._locales.columns = {
                                        _locale: true
                                    };
                                }
                            }
                            topLevelArgs.with[blockKey] = withBlock;
                            traverseFields({
                                _locales: withBlock.with._locales,
                                adapter,
                                currentArgs: withBlock,
                                currentTableName: tableName,
                                depth,
                                draftsEnabled,
                                fields: block.flattenedFields,
                                forceWithFields: blockSelect === true,
                                joinQuery,
                                locale,
                                parentIsLocalized: parentIsLocalized || field.localized,
                                path: '',
                                select: typeof blockSelect === 'object' ? blockSelect : undefined,
                                selectMode: blockSelectMode,
                                tablePath: '',
                                topLevelArgs,
                                topLevelTableName,
                                withTabledFields
                            });
                            if (typeof blockSelect === 'object' && withBlock.with._locales && Object.keys(withBlock.with._locales.columns).length === 1) {
                                delete withBlock.with._locales;
                            }
                        }
                    });
                    break;
                }
            case 'group':
            case 'tab':
                {
                    const fieldSelect = select?.[field.name];
                    if (fieldSelect === false) {
                        break;
                    }
                    traverseFields({
                        _locales,
                        adapter,
                        collectionSlug,
                        currentArgs,
                        currentTableName,
                        depth,
                        draftsEnabled,
                        fields: field.flattenedFields,
                        forceWithFields,
                        joinQuery,
                        joins,
                        locale,
                        parentIsLocalized: parentIsLocalized || field.localized,
                        path: `${path}${field.name}_`,
                        select: typeof fieldSelect === 'object' ? fieldSelect : undefined,
                        selectAllOnCurrentLevel: selectAllOnCurrentLevel || fieldSelect === true || selectMode === 'exclude' && typeof fieldSelect === 'undefined',
                        selectMode,
                        tablePath: `${tablePath}${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(field.name)}_`,
                        topLevelArgs,
                        topLevelTableName,
                        versions,
                        withTabledFields
                    });
                    break;
                }
            case 'join':
                {
                    // when `joinsQuery` is false, do not join
                    if (joinQuery === false) {
                        break;
                    }
                    if (select && selectMode === 'include' && !select[field.name] || selectMode === 'exclude' && select[field.name] === false) {
                        break;
                    }
                    const joinSchemaPath = `${path.replaceAll('_', '.')}${field.name}`;
                    if (joinQuery[joinSchemaPath] === false) {
                        break;
                    }
                    const { count: shouldCount = false, limit: limitArg = field.defaultLimit ?? 10, page, sort = field.defaultSort, where } = joinQuery[joinSchemaPath] || {};
                    let limit = limitArg;
                    if (limit !== 0) {
                        // get an additional document and slice it later to determine if there is a next page
                        limit += 1;
                    }
                    const columnName = `${path.replaceAll('.', '_')}${field.name}`;
                    const db = adapter.drizzle;
                    if (Array.isArray(field.collection)) {
                        let currentQuery = null;
                        const onPath = field.on.split('.').join('_');
                        if (Array.isArray(sort)) {
                            throw new Error('Not implemented');
                        }
                        let sanitizedSort = sort;
                        if (!sanitizedSort) {
                            if (field.collection.some((collection)=>adapter.payload.collections[collection].config.fields.some((f)=>f.type === 'date' && f.name === 'createdAt'))) {
                                sanitizedSort = '-createdAt';
                            } else {
                                sanitizedSort = 'id';
                            }
                        }
                        const sortOrder = sanitizedSort.startsWith('-') ? __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$select$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["desc"] : __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$select$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["asc"];
                        sanitizedSort = sanitizedSort.replace('-', '');
                        const sortPath = sanitizedSort.split('.').join('_');
                        const wherePaths = [];
                        if (where) {
                            flattenAllWherePaths(where, wherePaths);
                        }
                        for (const collection of field.collection){
                            const joinCollectionTableName = adapter.tableNameMap.get((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(collection));
                            const table = adapter.tables[joinCollectionTableName];
                            const sortColumn = table[sortPath];
                            const selectFields = {
                                id: adapter.tables[joinCollectionTableName].id,
                                parent: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`${adapter.tables[joinCollectionTableName][onPath]}`.as(onPath),
                                relationTo: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`${collection}`.as('relationTo'),
                                sortPath: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`${sortColumn ? sortColumn : null}`.as('sortPath')
                            };
                            const collectionQueryWhere = [];
                            // Select for WHERE and Fallback NULL
                            for (const { path, ref } of wherePaths){
                                const collectioConfig = adapter.payload.collections[collection].config;
                                const field = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$getFieldByPath$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getFieldByPath"])({
                                    fields: collectioConfig.flattenedFields,
                                    path
                                });
                                if (field && field.field.type === 'select' && field.field.hasMany) {
                                    let tableName = adapter.tableNameMap.get(`${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(collection)}_${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(path)}`);
                                    let parentTable = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$table$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTableName"])(table);
                                    if (adapter.schemaName) {
                                        tableName = `"${adapter.schemaName}"."${tableName}"`;
                                        parentTable = `"${adapter.schemaName}"."${parentTable}"`;
                                    }
                                    if (adapter.name === 'postgres') {
                                        selectFields[path] = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"].raw(`(select jsonb_agg(${tableName}.value) from ${tableName} where ${tableName}.parent_id = ${parentTable}.id)`).as(path);
                                    } else {
                                        selectFields[path] = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"].raw(`(select json_group_array(${tableName}.value) from ${tableName} where ${tableName}.parent_id = ${parentTable}.id)`).as(path);
                                    }
                                    const constraint = ref[path];
                                    const operator = Object.keys(constraint)[0];
                                    const value = Object.values(constraint)[0];
                                    const query = adapter.createJSONQuery({
                                        column: `"${path}"`,
                                        operator,
                                        pathSegments: [
                                            field.field.name
                                        ],
                                        table: parentTable,
                                        value
                                    });
                                    ref[path] = {
                                        $raw: query
                                    };
                                } else if (adapter.tables[joinCollectionTableName][path]) {
                                    selectFields[path] = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`${adapter.tables[joinCollectionTableName][path]}`.as(path);
                                // Allow to filter by collectionSlug
                                } else if (path !== 'relationTo') {
                                    // For timestamp fields like deletedAt, we need to cast to timestamp in Postgres
                                    // SQLite doesn't require explicit type casting for UNION queries
                                    if (path === 'deletedAt' && adapter.name === 'postgres') {
                                        selectFields[path] = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`null::timestamp with time zone`.as(path);
                                    } else {
                                        selectFields[path] = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`null`.as(path);
                                    }
                                }
                            }
                            let query = db.select(selectFields).from(adapter.tables[joinCollectionTableName]);
                            if (collectionQueryWhere.length) {
                                query = query.where((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["and"])(...collectionQueryWhere));
                            }
                            if (currentQuery === null) {
                                currentQuery = query;
                            } else {
                                currentQuery = currentQuery.unionAll(query);
                            }
                        }
                        const subQueryAlias = `${columnName}_subquery`;
                        let sqlWhere = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"].raw(`"${currentTableName}"."id"`), __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"].raw(`"${subQueryAlias}"."${onPath}"`));
                        if (where && Object.keys(where).length > 0) {
                            sqlWhere = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["and"])(sqlWhere, buildSQLWhere(where, subQueryAlias));
                        }
                        if (shouldCount) {
                            currentArgs.extras[`${columnName}_count`] = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`${db.select({
                                count: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$functions$2f$aggregate$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["count"])()
                            }).from(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`${currentQuery.as(subQueryAlias)}`).where(sqlWhere)}`.as(`${columnName}_count`);
                        }
                        currentQuery = currentQuery.orderBy(sortOrder(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`"sortPath"`));
                        if (page && limit !== 0) {
                            const offset = (page - 1) * limit;
                            if (offset > 0) {
                                currentQuery = currentQuery.offset(offset);
                            }
                        }
                        if (limit) {
                            currentQuery = currentQuery.limit(limit);
                        }
                        currentArgs.extras[columnName] = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`${db.select({
                            id: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$json$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["jsonAggBuildObject"])(adapter, {
                                id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"].raw(`"${subQueryAlias}"."id"`),
                                relationTo: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"].raw(`"${subQueryAlias}"."relationTo"`)
                            })
                        }).from(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`${currentQuery.as(subQueryAlias)}`).where(sqlWhere)}`.as(columnName);
                    } else {
                        const useDrafts = (versions || draftsEnabled) && (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$getVersionsConfig$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["hasDraftsEnabled"])(adapter.payload.collections[field.collection].config);
                        const fields = useDrafts ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildCollectionFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildVersionCollectionFields"])(adapter.payload.config, adapter.payload.collections[field.collection].config, true) : adapter.payload.collections[field.collection].config.flattenedFields;
                        const joinCollectionTableName = adapter.tableNameMap.get(useDrafts ? `_${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(field.collection)}${adapter.versionsSuffix}` : (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(field.collection));
                        const joins = [];
                        const currentIDColumn = versions ? adapter.tables[currentTableName].parent : adapter.tables[currentTableName].id;
                        let joinQueryWhere;
                        const currentIDRaw = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"].raw(`"${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getNameFromDrizzleTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getNameFromDrizzleTable"])(currentIDColumn.table)}"."${currentIDColumn.name}"`);
                        if (Array.isArray(field.targetField.relationTo)) {
                            joinQueryWhere = {
                                [field.on]: {
                                    equals: {
                                        relationTo: collectionSlug,
                                        value: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$rawConstraint$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["rawConstraint"])(currentIDRaw)
                                    }
                                }
                            };
                        } else {
                            joinQueryWhere = {
                                [field.on]: {
                                    equals: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$rawConstraint$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["rawConstraint"])(currentIDRaw)
                                }
                            };
                        }
                        if (where && Object.keys(where).length) {
                            joinQueryWhere = {
                                and: [
                                    joinQueryWhere,
                                    where
                                ]
                            };
                        }
                        if (useDrafts) {
                            joinQueryWhere = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$database$2f$combineQueries$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["combineQueries"])((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$drafts$2f$appendVersionToQueryKey$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["appendVersionToQueryKey"])(joinQueryWhere), {
                                latest: {
                                    equals: true
                                }
                            });
                        }
                        const columnName = `${path.replaceAll('.', '_')}${field.name}`;
                        const subQueryAlias = `${columnName}_alias`;
                        const { newAliasTable } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$getTableAlias$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTableAlias"])({
                            adapter,
                            tableName: joinCollectionTableName
                        });
                        const { orderBy, selectFields, where: subQueryWhere } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$buildQuery$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildQuery"])({
                            adapter,
                            aliasTable: newAliasTable,
                            fields,
                            joins,
                            locale,
                            parentIsLocalized,
                            selectLocale: true,
                            sort: useDrafts ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$drafts$2f$getQueryDraftsSort$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getQueryDraftsSort"])({
                                collectionConfig: adapter.payload.collections[field.collection].config,
                                sort
                            }) : sort,
                            tableName: joinCollectionTableName,
                            where: joinQueryWhere
                        });
                        for(let key in selectFields){
                            const val = selectFields[key];
                            if (val.table && (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getNameFromDrizzleTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getNameFromDrizzleTable"])(val.table) === joinCollectionTableName) {
                                delete selectFields[key];
                                key = key.split('.').pop();
                                selectFields[key] = newAliasTable[key];
                            }
                        }
                        if (useDrafts) {
                            selectFields.parent = newAliasTable.parent;
                        }
                        let query = db.select(selectFields).from(newAliasTable).where(subQueryWhere).orderBy(()=>orderBy.map(({ column, order })=>order(column))).$dynamic();
                        joins.forEach(({ type, condition, table })=>{
                            query = query[type ?? 'leftJoin'](table, condition);
                        });
                        if (page && limit !== 0) {
                            const offset = (page - 1) * limit - 1;
                            if (offset > 0) {
                                query = query.offset(offset);
                            }
                        }
                        if (limit !== 0) {
                            query = query.limit(limit);
                        }
                        const subQuery = query.as(subQueryAlias);
                        if (shouldCount) {
                            let countSubquery = db.select(selectFields).from(newAliasTable).where(subQueryWhere).$dynamic();
                            joins.forEach(({ type, condition, table })=>{
                                countSubquery = countSubquery[type ?? 'leftJoin'](table, condition);
                            });
                            currentArgs.extras[`${columnName}_count`] = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`${db.select({
                                count: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$functions$2f$aggregate$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["count"])()
                            }).from(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`${countSubquery.as(`${subQueryAlias}_count_subquery`)}`)}`.as(`${subQueryAlias}_count`);
                        }
                        currentArgs.extras[columnName] = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`${db.select({
                            result: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$json$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["jsonAggBuildObject"])(adapter, {
                                id: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"].raw(`"${subQueryAlias}".${useDrafts ? 'parent_id' : 'id'}`),
                                ...selectFields._locale && {
                                    locale: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"].raw(`"${subQueryAlias}".${selectFields._locale.name}`)
                                }
                            })
                        }).from(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`${subQuery}`)}`.as(subQueryAlias);
                    }
                    break;
                }
            case 'point':
                {
                    if (adapter.name === 'sqlite') {
                        break;
                    }
                    const args = isFieldLocalized ? _locales : currentArgs;
                    if (!args.columns) {
                        args.columns = {};
                    }
                    if (!args.extras) {
                        args.extras = {};
                    }
                    const name = `${path}${field.name}`;
                    // Drizzle handles that poorly. See https://github.com/drizzle-team/drizzle-orm/issues/2526
                    // Additionally, this way we format the column value straight in the database using ST_AsGeoJSON
                    args.columns[name] = false;
                    let shouldSelect = false;
                    if (select || selectAllOnCurrentLevel) {
                        if (selectAllOnCurrentLevel || selectMode === 'include' && Boolean(select[field.name]) || selectMode === 'exclude' && typeof select[field.name] === 'undefined') {
                            shouldSelect = true;
                        }
                    } else {
                        shouldSelect = true;
                    }
                    const tableName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["fieldShouldBeLocalized"])({
                        field,
                        parentIsLocalized
                    }) ? `${currentTableName}${adapter.localesSuffix}` : currentTableName;
                    if (shouldSelect) {
                        args.extras[name] = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"].raw(`ST_AsGeoJSON("${adapter.tables[tableName][name].name}")::jsonb`).as(name);
                    }
                    break;
                }
            case 'select':
                {
                    if (select && !selectAllOnCurrentLevel) {
                        if (selectMode === 'include' && !select[field.name] || selectMode === 'exclude' && select[field.name] === false) {
                            break;
                        }
                    }
                    if (field.hasMany) {
                        const withSelect = {
                            columns: {
                                id: false,
                                order: false,
                                parent: false
                            },
                            orderBy: ({ order }, { asc })=>[
                                    asc(order)
                                ]
                        };
                        currentArgs.with[`${path}${field.name}`] = withSelect;
                        break;
                    }
                    if (select || selectAllOnCurrentLevel) {
                        const fieldPath = `${path}${field.name}`;
                        if ((isFieldLocalized || parentIsLocalized) && _locales) {
                            _locales.columns[fieldPath] = true;
                        } else if (adapter.tables[currentTableName]?.[fieldPath]) {
                            currentArgs.columns[fieldPath] = true;
                        }
                    }
                    break;
                }
            default:
                {
                    if (forceWithFields) {
                        if ((field.type === 'relationship' || field.type === 'upload') && (field.hasMany || Array.isArray(field.relationTo))) {
                            withTabledFields.rels = true;
                        }
                        if (field.type === 'number' && field.hasMany) {
                            withTabledFields.numbers = true;
                        }
                        if (field.type === 'text' && field.hasMany) {
                            withTabledFields.texts = true;
                        }
                    }
                    if (!select && !selectAllOnCurrentLevel) {
                        break;
                    }
                    if (selectAllOnCurrentLevel || selectMode === 'include' && Boolean(select[field.name]) || selectMode === 'exclude' && typeof select[field.name] === 'undefined') {
                        const fieldPath = `${path}${field.name}`;
                        if ((isFieldLocalized || parentIsLocalized) && _locales) {
                            _locales.columns[fieldPath] = true;
                        } else if (adapter.tables[currentTableName]?.[fieldPath]) {
                            currentArgs.columns[fieldPath] = true;
                        }
                        if (!withTabledFields.rels && (field.type === 'relationship' || field.type === 'upload') && (field.hasMany || Array.isArray(field.relationTo))) {
                            withTabledFields.rels = true;
                        }
                        if (!withTabledFields.numbers && field.type === 'number' && field.hasMany) {
                            withTabledFields.numbers = true;
                        }
                        if (!withTabledFields.texts && field.type === 'text' && field.hasMany) {
                            withTabledFields.texts = true;
                        }
                    }
                    break;
                }
        }
    });
    return topLevelArgs;
}; //# sourceMappingURL=traverseFields.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/find/buildFindManyArgs.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "buildFindManyArgs",
    ()=>buildFindManyArgs
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$getSelectMode$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/utilities/getSelectMode.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$find$2f$traverseFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/find/traverseFields.js [app-route] (ecmascript)");
;
;
const buildFindManyArgs = ({ adapter, collectionSlug, depth, draftsEnabled, fields, joinQuery, joins = [], locale, select, tableName, versions })=>{
    const result = {
        extras: {},
        with: {}
    };
    if (select) {
        result.columns = {
            id: true
        };
    }
    const _locales = {
        columns: select ? {
            _locale: true
        } : {
            id: false,
            _parentID: false
        },
        extras: {},
        with: {}
    };
    const withTabledFields = select ? {} : {
        numbers: true,
        rels: true,
        texts: true
    };
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$find$2f$traverseFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["traverseFields"])({
        _locales,
        adapter,
        collectionSlug,
        currentArgs: result,
        currentTableName: tableName,
        depth,
        draftsEnabled,
        fields,
        joinQuery,
        joins,
        locale,
        path: '',
        select,
        selectMode: select ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$getSelectMode$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getSelectMode"])(select) : undefined,
        tablePath: '',
        topLevelArgs: result,
        topLevelTableName: tableName,
        versions,
        withTabledFields
    });
    if (adapter.tables[`${tableName}_texts`] && withTabledFields.texts) {
        result.with._texts = {
            columns: {
                id: false,
                parent: false
            },
            orderBy: ({ order }, { asc: ASC })=>[
                    ASC(order)
                ]
        };
    }
    if (adapter.tables[`${tableName}_numbers`] && withTabledFields.numbers) {
        result.with._numbers = {
            columns: {
                id: false,
                parent: false
            },
            orderBy: ({ order }, { asc: ASC })=>[
                    ASC(order)
                ]
        };
    }
    if (adapter.tables[`${tableName}${adapter.relationshipsSuffix}`] && withTabledFields.rels) {
        result.with._rels = {
            columns: {
                id: false,
                parent: false
            },
            orderBy: ({ order }, { asc: ASC })=>[
                    ASC(order)
                ]
        };
    }
    if (adapter.tables[`${tableName}${adapter.localesSuffix}`] && (!select || Object.keys(_locales.columns).length > 1)) {
        result.with._locales = _locales;
    }
    // Delete properties that are empty
    for (const key of Object.keys(result)){
        if (!Object.keys(result[key]).length) {
            delete result[key];
        }
    }
    return result;
}; //# sourceMappingURL=buildFindManyArgs.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/utilities/createBlocksMap.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "createBlocksMap",
    ()=>createBlocksMap
]);
const createBlocksMap = (data)=>{
    const blocksMap = {};
    Object.entries(data).forEach(([key, rows])=>{
        if (key.startsWith('_blocks_') && Array.isArray(rows)) {
            let blockType = key.replace('_blocks_', '');
            const parsed = blockType.split('_');
            if (parsed.length === 2 && Number.isInteger(Number(parsed[1]))) {
                blockType = parsed[0];
            }
            rows.forEach((row)=>{
                if ('_path' in row) {
                    if (!(row._path in blocksMap)) {
                        blocksMap[row._path] = [];
                    }
                    row.blockType = blockType;
                    blocksMap[row._path].push(row);
                    delete row._path;
                }
            });
            delete data[key];
        }
    });
    Object.entries(blocksMap).reduce((sortedBlocksMap, [path, blocks])=>{
        sortedBlocksMap[path] = blocks.sort((a, b)=>{
            if (typeof a._order === 'number' && typeof b._order === 'number') {
                return a._order - b._order;
            }
            return 0;
        });
        return sortedBlocksMap;
    }, {});
    return blocksMap;
}; //# sourceMappingURL=createBlocksMap.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/utilities/createRelationshipMap.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

// Flatten rows to object with path keys
// for easier retrieval
__turbopack_context__.s([
    "createPathMap",
    ()=>createPathMap
]);
const createPathMap = (rows)=>{
    let rowsByPath = {};
    if (Array.isArray(rows)) {
        rowsByPath = rows.reduce((res, row)=>{
            const formattedRow = {
                ...row
            };
            delete formattedRow.path;
            if (!res[row.path]) {
                res[row.path] = [];
            }
            res[row.path].push(row);
            return res;
        }, {});
    }
    return rowsByPath;
}; //# sourceMappingURL=createRelationshipMap.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/transform/read/hasManyNumber.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "transformHasManyNumber",
    ()=>transformHasManyNumber
]);
const transformHasManyNumber = ({ field, locale, numberRows, ref, withinArrayOrBlockLocale })=>{
    let result;
    if (withinArrayOrBlockLocale) {
        result = numberRows.reduce((acc, { locale, number })=>{
            if (locale === withinArrayOrBlockLocale) {
                if (typeof number === 'string') {
                    number = Number(number);
                }
                acc.push(number);
            }
            return acc;
        }, []);
    } else {
        result = numberRows.map(({ number })=>{
            if (typeof number === 'string') {
                number = Number(number);
            }
            return number;
        });
    }
    if (locale) {
        ref[field.name][locale] = result;
    } else {
        ref[field.name] = result;
    }
}; //# sourceMappingURL=hasManyNumber.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/transform/read/hasManyText.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "transformHasManyText",
    ()=>transformHasManyText
]);
const transformHasManyText = ({ field, locale, ref, textRows, withinArrayOrBlockLocale })=>{
    let result;
    if (withinArrayOrBlockLocale) {
        result = textRows.reduce((acc, { locale, text })=>{
            if (locale === withinArrayOrBlockLocale) {
                acc.push(text);
            }
            return acc;
        }, []);
    } else {
        result = textRows.map(({ text })=>text);
    }
    if (locale) {
        ref[field.name][locale] = result;
    } else {
        ref[field.name] = result;
    }
}; //# sourceMappingURL=hasManyText.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/transform/read/relationship.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "transformRelationship",
    ()=>transformRelationship
]);
const transformRelationship = ({ field, locale, ref, relations, withinArrayOrBlockLocale })=>{
    let result;
    if (!('hasMany' in field) || field.hasMany === false) {
        let relation = relations[0];
        if (withinArrayOrBlockLocale) {
            relation = relations.find((rel)=>rel.locale === withinArrayOrBlockLocale);
        }
        if (relation) {
            // Handle hasOne Poly
            if (Array.isArray(field.relationTo)) {
                const matchedRelation = Object.entries(relation).find(([key, val])=>{
                    return val !== null && ![
                        'id',
                        'locale',
                        'order',
                        'parent',
                        'path'
                    ].includes(key);
                });
                if (matchedRelation) {
                    const relationTo = matchedRelation[0].replace('ID', '');
                    result = {
                        relationTo,
                        value: matchedRelation[1]
                    };
                }
            }
        }
    } else {
        const transformedRelations = [];
        relations.forEach((relation)=>{
            let matchedLocale = true;
            if (withinArrayOrBlockLocale) {
                matchedLocale = relation.locale === withinArrayOrBlockLocale;
            }
            // Handle hasMany
            if (!Array.isArray(field.relationTo)) {
                const relatedData = relation[`${field.relationTo}ID`];
                if (relatedData && matchedLocale) {
                    transformedRelations.push(relatedData);
                }
            } else {
                // Handle hasMany Poly
                const matchedRelation = Object.entries(relation).find(([key, val])=>val !== null && ![
                        'id',
                        'locale',
                        'order',
                        'parent',
                        'path'
                    ].includes(key) && matchedLocale);
                if (matchedRelation) {
                    const relationTo = matchedRelation[0].replace('ID', '');
                    transformedRelations.push({
                        relationTo,
                        value: matchedRelation[1]
                    });
                }
            }
        });
        result = transformedRelations;
    }
    if (locale) {
        ref[field.name][locale] = result;
    } else {
        ref[field.name] = result;
    }
}; //# sourceMappingURL=relationship.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/transform/read/traverseFields.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "traverseFields",
    ()=>traverseFields
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/fields/config/types.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getArrayRelationName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getArrayRelationName.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$validateExistingBlockIsIdentical$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/validateExistingBlockIsIdentical.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$read$2f$hasManyNumber$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/transform/read/hasManyNumber.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$read$2f$hasManyText$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/transform/read/hasManyText.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$read$2f$relationship$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/transform/read/relationship.js [app-route] (ecmascript)");
;
;
;
;
;
;
;
const traverseFields = ({ adapter, blocks, config, currentTableName, dataRef, deletions, fieldPrefix, fields, joinQuery, numbers, parentIsLocalized, path, relationships, table, tablePath, texts, topLevelTableName, withinArrayOrBlockLocale })=>{
    const sanitizedPath = path ? `${path}.` : path;
    const localeCodes = adapter.payload.config.localization && adapter.payload.config.localization.localeCodes;
    const formatted = fields.reduce((result, field)=>{
        if ((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["fieldIsVirtual"])(field)) {
            return result;
        }
        const fieldName = `${fieldPrefix || ''}${field.name}`;
        let fieldData = table[fieldName];
        const localizedFieldData = {};
        const valuesToTransform = [];
        if (fieldPrefix) {
            deletions.push(()=>delete table[fieldName]);
        }
        const isLocalized = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["fieldShouldBeLocalized"])({
            field,
            parentIsLocalized
        });
        if (field.type === 'array') {
            const arrayTableName = adapter.tableNameMap.get(`${currentTableName}_${tablePath}${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(field.name)}`);
            fieldData = table[(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getArrayRelationName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getArrayRelationName"])({
                field,
                path: fieldName,
                tableName: arrayTableName
            })];
            if (Array.isArray(fieldData)) {
                if (isLocalized) {
                    result[field.name] = fieldData.reduce((arrayResult, row)=>{
                        if (typeof row._locale === 'string') {
                            if (!arrayResult[row._locale]) {
                                arrayResult[row._locale] = [];
                            }
                            const locale = row._locale;
                            const data = {};
                            delete row._locale;
                            if (row._uuid) {
                                row.id = row._uuid;
                                delete row._uuid;
                            }
                            const rowResult = traverseFields({
                                adapter,
                                blocks,
                                config,
                                currentTableName: arrayTableName,
                                dataRef: data,
                                deletions,
                                fieldPrefix: '',
                                fields: field.flattenedFields,
                                numbers,
                                parentIsLocalized: parentIsLocalized || field.localized,
                                path: `${sanitizedPath}${field.name}.${row._order - 1}`,
                                relationships,
                                table: row,
                                tablePath: '',
                                texts,
                                topLevelTableName,
                                withinArrayOrBlockLocale: locale
                            });
                            if ('_order' in rowResult) {
                                delete rowResult._order;
                            }
                            arrayResult[locale].push(rowResult);
                        }
                        return arrayResult;
                    }, {});
                } else {
                    result[field.name] = fieldData.reduce((acc, row, i)=>{
                        if (row._uuid) {
                            row.id = row._uuid;
                            delete row._uuid;
                        }
                        if ('_order' in row) {
                            delete row._order;
                        }
                        if (!withinArrayOrBlockLocale || withinArrayOrBlockLocale && withinArrayOrBlockLocale === row._locale) {
                            if (row._locale) {
                                delete row._locale;
                            }
                            acc.push(traverseFields({
                                adapter,
                                blocks,
                                config,
                                currentTableName: arrayTableName,
                                dataRef: row,
                                deletions,
                                fieldPrefix: '',
                                fields: field.flattenedFields,
                                numbers,
                                parentIsLocalized: parentIsLocalized || field.localized,
                                path: `${sanitizedPath}${field.name}.${i}`,
                                relationships,
                                table: row,
                                tablePath: '',
                                texts,
                                topLevelTableName,
                                withinArrayOrBlockLocale
                            }));
                        }
                        return acc;
                    }, []);
                }
            }
            return result;
        }
        if (field.type === 'blocks' && !adapter.blocksAsJSON) {
            const blockFieldPath = `${sanitizedPath}${field.name}`;
            const blocksByPath = blocks[blockFieldPath];
            if (Array.isArray(blocksByPath)) {
                if (isLocalized) {
                    result[field.name] = {};
                    blocksByPath.forEach((row)=>{
                        if (row._uuid) {
                            row.id = row._uuid;
                            delete row._uuid;
                        }
                        if (typeof row._locale === 'string') {
                            if (!result[field.name][row._locale]) {
                                result[field.name][row._locale] = [];
                            }
                            result[field.name][row._locale].push(row);
                            delete row._locale;
                        }
                    });
                    Object.entries(result[field.name]).forEach(([locale, localizedBlocks])=>{
                        result[field.name][locale] = localizedBlocks.map((row)=>{
                            const block = adapter.payload.blocks[row.blockType] ?? (field.blockReferences ?? field.blocks).find((block)=>typeof block !== 'string' && block.slug === row.blockType);
                            const tableName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$validateExistingBlockIsIdentical$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["resolveBlockTableName"])(block, adapter.tableNameMap.get(`${topLevelTableName}_blocks_${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(block.slug)}`));
                            if (block) {
                                const blockResult = traverseFields({
                                    adapter,
                                    blocks,
                                    config,
                                    currentTableName: tableName,
                                    dataRef: row,
                                    deletions,
                                    fieldPrefix: '',
                                    fields: block.flattenedFields,
                                    numbers,
                                    parentIsLocalized: parentIsLocalized || field.localized,
                                    path: `${blockFieldPath}.${row._order - 1}`,
                                    relationships,
                                    table: row,
                                    tablePath: '',
                                    texts,
                                    topLevelTableName,
                                    withinArrayOrBlockLocale: locale
                                });
                                delete blockResult._order;
                                return blockResult;
                            }
                            return {};
                        });
                    });
                } else {
                    // Add locale-specific index to have a proper blockFieldPath for current locale
                    // because blocks can be in the same array for different locales!
                    if (withinArrayOrBlockLocale && config.localization) {
                        for (const locale of config.localization.localeCodes){
                            let localeIndex = 0;
                            for(let i = 0; i < blocksByPath.length; i++){
                                const row = blocksByPath[i];
                                if (row._locale === locale) {
                                    row._index = localeIndex;
                                    localeIndex++;
                                }
                            }
                        }
                    }
                    result[field.name] = blocksByPath.reduce((acc, row, i)=>{
                        delete row._order;
                        if (row._uuid) {
                            row.id = row._uuid;
                            delete row._uuid;
                        }
                        if (typeof row.blockType !== 'string') {
                            return acc;
                        }
                        const block = adapter.payload.blocks[row.blockType] ?? (field.blockReferences ?? field.blocks).find((block)=>typeof block !== 'string' && block.slug === row.blockType);
                        if (block) {
                            if (!withinArrayOrBlockLocale || withinArrayOrBlockLocale && withinArrayOrBlockLocale === row._locale) {
                                if (row._locale) {
                                    delete row._locale;
                                }
                                if (typeof row._index === 'number') {
                                    i = row._index;
                                    delete row._index;
                                }
                                const tableName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$validateExistingBlockIsIdentical$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["resolveBlockTableName"])(block, adapter.tableNameMap.get(`${topLevelTableName}_blocks_${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(block.slug)}`));
                                acc.push(traverseFields({
                                    adapter,
                                    blocks,
                                    config,
                                    currentTableName: tableName,
                                    dataRef: row,
                                    deletions,
                                    fieldPrefix: '',
                                    fields: block.flattenedFields,
                                    numbers,
                                    parentIsLocalized: parentIsLocalized || field.localized,
                                    path: `${blockFieldPath}.${i}`,
                                    relationships,
                                    table: row,
                                    tablePath: '',
                                    texts,
                                    topLevelTableName,
                                    withinArrayOrBlockLocale
                                }));
                                return acc;
                            }
                        } else {
                            acc.push({});
                        }
                        return acc;
                    }, []);
                }
            }
            return result;
        }
        if ((field.type === 'relationship' || field.type === 'upload') && (Array.isArray(field.relationTo) || field.hasMany)) {
            const relationPathMatch = relationships[`${sanitizedPath}${field.name}`];
            if (!relationPathMatch) {
                if ('hasMany' in field && field.hasMany) {
                    if (isLocalized && config.localization && config.localization.locales) {
                        result[field.name] = {
                            [config.localization.defaultLocale]: []
                        };
                    } else {
                        result[field.name] = [];
                    }
                }
                return result;
            }
            if (isLocalized) {
                result[field.name] = {};
                const relationsByLocale = {};
                relationPathMatch.forEach((row)=>{
                    if (typeof row.locale === 'string') {
                        if (!relationsByLocale[row.locale]) {
                            relationsByLocale[row.locale] = [];
                        }
                        relationsByLocale[row.locale].push(row);
                    }
                });
                Object.entries(relationsByLocale).forEach(([locale, relations])=>{
                    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$read$2f$relationship$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["transformRelationship"])({
                        field,
                        locale,
                        ref: result,
                        relations
                    });
                });
            } else {
                (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$read$2f$relationship$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["transformRelationship"])({
                    field,
                    ref: result,
                    relations: relationPathMatch,
                    withinArrayOrBlockLocale
                });
            }
            return result;
        }
        if (field.type === 'join') {
            const { count, limit = field.defaultLimit ?? 10 } = joinQuery?.[`${fieldPrefix.replaceAll('_', '.')}${field.name}`] || {};
            // raw hasMany results from SQLite
            if (typeof fieldData === 'string') {
                fieldData = JSON.parse(fieldData);
            }
            let fieldResult;
            if (Array.isArray(fieldData)) {
                if (isLocalized && adapter.payload.config.localization) {
                    fieldResult = fieldData.reduce((joinResult, row)=>{
                        if (typeof row.locale === 'string') {
                            joinResult[row.locale].docs.push(row.id);
                        }
                        return joinResult;
                    }, adapter.payload.config.localization.localeCodes.reduce((acc, code)=>{
                        acc[code] = {
                            docs: [],
                            hasNextPage: false
                        };
                        return acc;
                    }, {}));
                    Object.keys(fieldResult).forEach((locale)=>{
                        fieldResult[locale].hasNextPage = fieldResult[locale].docs.length > limit;
                        fieldResult[locale].docs = fieldResult[locale].docs.slice(0, limit);
                    });
                } else {
                    const hasNextPage = limit !== 0 && fieldData.length > limit;
                    fieldResult = {
                        docs: (hasNextPage ? fieldData.slice(0, limit) : fieldData).map(({ id, relationTo })=>{
                            if (relationTo) {
                                return {
                                    relationTo,
                                    value: id
                                };
                            }
                            return {
                                id
                            };
                        }),
                        hasNextPage
                    };
                }
            }
            if (count) {
                const countPath = `${fieldName}_count`;
                if (typeof table[countPath] !== 'undefined') {
                    let value = Number(table[countPath]);
                    if (Number.isNaN(value)) {
                        value = 0;
                    }
                    fieldResult.totalDocs = value;
                }
            }
            result[field.name] = fieldResult;
            return result;
        }
        if (field.type === 'text' && field?.hasMany) {
            const textPathMatch = texts[`${sanitizedPath}${field.name}`];
            if (!textPathMatch) {
                result[field.name] = isLocalized && localeCodes ? Object.fromEntries(localeCodes.map((locale)=>[
                        locale,
                        []
                    ])) : [];
                return result;
            }
            if (isLocalized) {
                result[field.name] = {};
                const textsByLocale = {};
                textPathMatch.forEach((row)=>{
                    if (typeof row.locale === 'string') {
                        if (!textsByLocale[row.locale]) {
                            textsByLocale[row.locale] = [];
                        }
                        textsByLocale[row.locale].push(row);
                    }
                });
                Object.entries(textsByLocale).forEach(([locale, texts])=>{
                    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$read$2f$hasManyText$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["transformHasManyText"])({
                        field,
                        locale,
                        ref: result,
                        textRows: texts
                    });
                });
            } else {
                (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$read$2f$hasManyText$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["transformHasManyText"])({
                    field,
                    ref: result,
                    textRows: textPathMatch,
                    withinArrayOrBlockLocale
                });
            }
            return result;
        }
        if (field.type === 'number' && field.hasMany) {
            const numberPathMatch = numbers[`${sanitizedPath}${field.name}`];
            if (!numberPathMatch) {
                result[field.name] = isLocalized && localeCodes ? Object.fromEntries(localeCodes.map((locale)=>[
                        locale,
                        []
                    ])) : [];
                return result;
            }
            if (isLocalized) {
                result[field.name] = {};
                const numbersByLocale = {};
                numberPathMatch.forEach((row)=>{
                    if (typeof row.locale === 'string') {
                        if (!numbersByLocale[row.locale]) {
                            numbersByLocale[row.locale] = [];
                        }
                        numbersByLocale[row.locale].push(row);
                    }
                });
                Object.entries(numbersByLocale).forEach(([locale, numbers])=>{
                    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$read$2f$hasManyNumber$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["transformHasManyNumber"])({
                        field,
                        locale,
                        numberRows: numbers,
                        ref: result
                    });
                });
            } else {
                (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$read$2f$hasManyNumber$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["transformHasManyNumber"])({
                    field,
                    numberRows: numberPathMatch,
                    ref: result,
                    withinArrayOrBlockLocale
                });
            }
            return result;
        }
        if (field.type === 'select' && field.hasMany) {
            if (Array.isArray(fieldData)) {
                if (isLocalized) {
                    result[field.name] = fieldData.reduce((selectResult, row)=>{
                        if (typeof row.locale === 'string') {
                            if (!selectResult[row.locale]) {
                                selectResult[row.locale] = [];
                            }
                            selectResult[row.locale].push(row.value);
                        }
                        return selectResult;
                    }, {});
                } else {
                    let selectData = fieldData;
                    if (withinArrayOrBlockLocale) {
                        selectData = selectData.filter(({ locale })=>locale === withinArrayOrBlockLocale);
                    }
                    result[field.name] = selectData.map(({ value })=>value);
                }
            }
            return result;
        }
        if (isLocalized && Array.isArray(table._locales)) {
            if (!table._locales.length && localeCodes) {
                localeCodes.forEach((_locale)=>table._locales.push({
                        _locale
                    }));
            }
            table._locales.forEach((localeRow)=>{
                valuesToTransform.push({
                    ref: localizedFieldData,
                    table: {
                        ...table,
                        ...localeRow
                    }
                });
            });
        } else {
            valuesToTransform.push({
                ref: result,
                table
            });
        }
        valuesToTransform.forEach(({ ref, table })=>{
            const fieldData = table[`${fieldPrefix || ''}${field.name}`];
            const locale = table?._locale;
            let val = fieldData;
            switch(field.type){
                case 'date':
                    {
                        if (typeof fieldData === 'string') {
                            val = new Date(fieldData).toISOString();
                        }
                        break;
                    }
                case 'group':
                case 'tab':
                    {
                        const groupFieldPrefix = `${fieldPrefix || ''}${field.name}_`;
                        const groupData = {};
                        const locale = table._locale;
                        const refKey = isLocalized && locale ? locale : field.name;
                        if (isLocalized && locale) {
                            delete table._locale;
                        }
                        ref[refKey] = traverseFields({
                            adapter,
                            blocks,
                            config,
                            currentTableName,
                            dataRef: groupData,
                            deletions,
                            fieldPrefix: groupFieldPrefix,
                            fields: field.flattenedFields,
                            joinQuery,
                            numbers,
                            parentIsLocalized: parentIsLocalized || field.localized,
                            path: `${sanitizedPath}${field.name}`,
                            relationships,
                            table,
                            tablePath: `${tablePath}${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(field.name)}_`,
                            texts,
                            topLevelTableName,
                            withinArrayOrBlockLocale: locale || withinArrayOrBlockLocale
                        });
                        return;
                    }
                case 'number':
                    {
                        if (typeof fieldData === 'string') {
                            val = Number.parseFloat(fieldData);
                        }
                        break;
                    }
                case 'point':
                    {
                        if (typeof fieldData === 'string') {
                            val = JSON.parse(fieldData);
                        }
                        break;
                    }
                case 'relationship':
                case 'upload':
                    {
                        if (val && typeof field.relationTo === 'string' && adapter.payload.collections[field.relationTo].customIDType === 'number') {
                            val = Number(val);
                        }
                        break;
                    }
                case 'text':
                    {
                        if (typeof fieldData === 'string') {
                            val = String(fieldData);
                        }
                        break;
                    }
                default:
                    {
                        break;
                    }
            }
            if (typeof locale === 'string') {
                ref[locale] = val;
            } else {
                result[field.name] = val;
            }
        });
        if (Object.keys(localizedFieldData).length > 0) {
            result[field.name] = localizedFieldData;
        }
        return result;
    }, dataRef);
    if (Array.isArray(table._locales)) {
        deletions.push(()=>delete table._locales);
    }
    return formatted;
}; //# sourceMappingURL=traverseFields.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/transform/read/index.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "transform",
    ()=>transform
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$createBlocksMap$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/createBlocksMap.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$createRelationshipMap$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/createRelationshipMap.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$read$2f$traverseFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/transform/read/traverseFields.js [app-route] (ecmascript)");
;
;
;
const transform = ({ adapter, config, data, fields, joinQuery, parentIsLocalized, tableName })=>{
    let relationships = {};
    let texts = {};
    let numbers = {};
    if ('_rels' in data) {
        relationships = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$createRelationshipMap$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createPathMap"])(data._rels);
        delete data._rels;
    }
    if ('_texts' in data) {
        texts = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$createRelationshipMap$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createPathMap"])(data._texts);
        delete data._texts;
    }
    if ('_numbers' in data) {
        numbers = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$createRelationshipMap$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createPathMap"])(data._numbers);
        delete data._numbers;
    }
    const blocks = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$createBlocksMap$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createBlocksMap"])(data);
    const deletions = [];
    const result = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$read$2f$traverseFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["traverseFields"])({
        adapter,
        blocks,
        config,
        currentTableName: tableName,
        dataRef: {
            id: data.id
        },
        deletions,
        fieldPrefix: '',
        fields,
        joinQuery,
        numbers,
        parentIsLocalized,
        path: '',
        relationships,
        table: data,
        tablePath: '',
        texts,
        topLevelTableName: tableName
    });
    deletions.forEach((deletion)=>deletion());
    return result;
}; //# sourceMappingURL=index.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/utilities/isArrayOfRows.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "isArrayOfRows",
    ()=>isArrayOfRows
]);
function isArrayOfRows(data) {
    return Array.isArray(data);
} //# sourceMappingURL=isArrayOfRows.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/transform/write/array.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "transformArray",
    ()=>transformArray
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/fields/config/types.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$isArrayOfRows$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/isArrayOfRows.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$write$2f$traverseFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/transform/write/traverseFields.js [app-route] (ecmascript)");
;
;
;
const transformArray = ({ adapter, arrayTableName, baseTableName, blocks, blocksToDelete, data, field, locale, numbers, numbersToDelete, parentIsLocalized, path, relationships, relationshipsToDelete, selects, texts, textsToDelete, withinArrayOrBlockLocale })=>{
    const newRows = [];
    const hasUUID = adapter.tables[arrayTableName]._uuid;
    if ((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$isArrayOfRows$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["isArrayOfRows"])(data)) {
        data.forEach((arrayRow, i)=>{
            const newRow = {
                arrays: {},
                arraysToPush: {},
                locales: {},
                row: {
                    _order: i + 1
                }
            };
            // If we have declared a _uuid field on arrays,
            // that means the ID has to be unique,
            // and our ids within arrays are not unique.
            // So move the ID to a uuid field for storage
            // and allow the database to generate a serial id automatically
            if (hasUUID) {
                newRow.row._uuid = arrayRow.id;
                delete arrayRow.id;
            }
            if (locale) {
                newRow.locales[locale] = {
                    _locale: locale
                };
            }
            if ((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["fieldShouldBeLocalized"])({
                field,
                parentIsLocalized
            }) && locale) {
                newRow.row._locale = locale;
            }
            if (withinArrayOrBlockLocale) {
                newRow.row._locale = withinArrayOrBlockLocale;
            }
            (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$write$2f$traverseFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["traverseFields"])({
                adapter,
                arrays: newRow.arrays,
                arraysToPush: newRow.arraysToPush,
                baseTableName,
                blocks,
                blocksToDelete,
                columnPrefix: '',
                data: arrayRow,
                fieldPrefix: '',
                fields: field.flattenedFields,
                insideArrayOrBlock: true,
                locales: newRow.locales,
                numbers,
                numbersToDelete,
                parentIsLocalized: parentIsLocalized || field.localized,
                parentTableName: arrayTableName,
                path: `${path || ''}${field.name}.${i}.`,
                relationships,
                relationshipsToAppend: [],
                relationshipsToDelete,
                row: newRow.row,
                selects,
                texts,
                textsToDelete,
                withinArrayOrBlockLocale
            });
            newRows.push(newRow);
        });
    }
    return newRows;
}; //# sourceMappingURL=array.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/transform/write/blocks.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "transformBlocks",
    ()=>transformBlocks
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/fields/config/types.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$validateExistingBlockIsIdentical$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/validateExistingBlockIsIdentical.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$write$2f$traverseFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/transform/write/traverseFields.js [app-route] (ecmascript)");
;
;
;
;
const transformBlocks = ({ adapter, baseTableName, blocks, blocksToDelete, data, field, locale, numbers, numbersToDelete, parentIsLocalized, path, relationships, relationshipsToDelete, selects, texts, textsToDelete, withinArrayOrBlockLocale })=>{
    data.forEach((blockRow, i)=>{
        if (typeof blockRow.blockType !== 'string') {
            return;
        }
        const matchedBlock = adapter.payload.blocks[blockRow.blockType] ?? (field.blockReferences ?? field.blocks).find((block)=>typeof block !== 'string' && block.slug === blockRow.blockType);
        if (!matchedBlock) {
            return;
        }
        const blockType = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(blockRow.blockType);
        const newRow = {
            arrays: {},
            arraysToPush: {},
            locales: {},
            row: {
                _order: i + 1,
                _path: `${path}${field.name}`
            }
        };
        if ((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["fieldShouldBeLocalized"])({
            field,
            parentIsLocalized
        }) && locale) {
            newRow.row._locale = locale;
        }
        if (withinArrayOrBlockLocale) {
            newRow.row._locale = withinArrayOrBlockLocale;
        }
        const blockTableName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$validateExistingBlockIsIdentical$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["resolveBlockTableName"])(matchedBlock, adapter.tableNameMap.get(`${baseTableName}_blocks_${blockType}`));
        if (!blocks[blockTableName]) {
            blocks[blockTableName] = [];
        }
        const hasUUID = adapter.tables[blockTableName]._uuid;
        // If we have declared a _uuid field on arrays,
        // that means the ID has to be unique,
        // and our ids within arrays are not unique.
        // So move the ID to a uuid field for storage
        // and allow the database to generate a serial id automatically
        if (hasUUID) {
            newRow.row._uuid = blockRow.id;
            delete blockRow.id;
        }
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$write$2f$traverseFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["traverseFields"])({
            adapter,
            arrays: newRow.arrays,
            arraysToPush: newRow.arraysToPush,
            baseTableName,
            blocks,
            blocksToDelete,
            columnPrefix: '',
            data: blockRow,
            fieldPrefix: '',
            fields: matchedBlock.flattenedFields,
            insideArrayOrBlock: true,
            locales: newRow.locales,
            numbers,
            numbersToDelete,
            parentIsLocalized: parentIsLocalized || field.localized,
            parentTableName: blockTableName,
            path: `${path || ''}${field.name}.${i}.`,
            relationships,
            relationshipsToAppend: [],
            relationshipsToDelete,
            row: newRow.row,
            selects,
            texts,
            textsToDelete,
            withinArrayOrBlockLocale
        });
        blocks[blockTableName].push(newRow);
    });
}; //# sourceMappingURL=blocks.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/transform/write/numbers.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "transformNumbers",
    ()=>transformNumbers
]);
const transformNumbers = ({ baseRow, data, numbers })=>{
    data.forEach((val, i)=>{
        numbers.push({
            ...baseRow,
            number: val,
            order: i + 1
        });
    });
}; //# sourceMappingURL=numbers.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/transform/write/relationships.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "transformRelationship",
    ()=>transformRelationship
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/fields/config/types.js [app-route] (ecmascript)");
;
const transformRelationship = ({ baseRow, data, field, relationships })=>{
    const relations = Array.isArray(data) ? data : [
        data
    ];
    relations.forEach((relation, i)=>{
        if (relation) {
            const relationRow = {
                ...baseRow
            };
            if ('hasMany' in field && field.hasMany) {
                relationRow.order = i + 1;
            }
            if (Array.isArray(field.relationTo) && (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["valueIsValueWithRelation"])(relation)) {
                relationRow[`${relation.relationTo}ID`] = relation.value;
                relationships.push(relationRow);
            } else if (typeof field.relationTo === 'string') {
                relationRow[`${field.relationTo}ID`] = relation;
                if (relation) {
                    relationships.push(relationRow);
                }
            }
        }
    });
}; //# sourceMappingURL=relationships.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/transform/write/selects.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "transformSelects",
    ()=>transformSelects
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$isArrayOfRows$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/isArrayOfRows.js [app-route] (ecmascript)");
;
const transformSelects = ({ id, data, locale })=>{
    const newRows = [];
    if ((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$isArrayOfRows$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["isArrayOfRows"])(data)) {
        data.forEach((value, i)=>{
            const newRow = {
                order: i + 1,
                parent: id,
                value
            };
            if (locale) {
                newRow.locale = locale;
            }
            newRows.push(newRow);
        });
    }
    return newRows;
}; //# sourceMappingURL=selects.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/transform/write/texts.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "transformTexts",
    ()=>transformTexts
]);
const transformTexts = ({ baseRow, data, texts })=>{
    data.forEach((val, i)=>{
        texts.push({
            ...baseRow,
            order: i + 1,
            text: val
        });
    });
}; //# sourceMappingURL=texts.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/transform/write/traverseFields.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "traverseFields",
    ()=>traverseFields
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/sql/sql.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$APIError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/errors/APIError.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/fields/config/types.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$isArrayOfRows$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/isArrayOfRows.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$validateExistingBlockIsIdentical$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/validateExistingBlockIsIdentical.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$write$2f$array$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/transform/write/array.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$write$2f$blocks$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/transform/write/blocks.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$write$2f$numbers$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/transform/write/numbers.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$write$2f$relationships$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/transform/write/relationships.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$write$2f$selects$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/transform/write/selects.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$write$2f$texts$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/transform/write/texts.js [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
;
;
;
;
const traverseFields = ({ adapter, arrays, arraysToPush, baseTableName, blocks, blocksToDelete, columnPrefix, data, enableAtomicWrites, existingLocales, fieldPrefix, fields, forcedLocale, insideArrayOrBlock = false, locales, numbers, numbersToDelete, parentIsLocalized, parentTableName, path, relationships, relationshipsToAppend, relationshipsToDelete, row, selects, texts, textsToDelete, withinArrayOrBlockLocale })=>{
    let fieldsMatched = false;
    if (row._uuid) {
        data._uuid = row._uuid;
    }
    fields.forEach((field)=>{
        let columnName = '';
        let fieldName = '';
        let fieldData;
        if ((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["fieldIsVirtual"])(field)) {
            return;
        }
        // Mark that we found a matching field
        if (data[field.name] !== undefined) {
            fieldsMatched = true;
        }
        columnName = `${columnPrefix || ''}${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(field.name)}`;
        fieldName = `${fieldPrefix || ''}${field.name}`;
        fieldData = data[field.name];
        const isLocalized = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["fieldShouldBeLocalized"])({
            field,
            parentIsLocalized
        });
        if (field.type === 'array') {
            const arrayTableName = adapter.tableNameMap.get(`${parentTableName}_${columnName}`);
            if (isLocalized) {
                const value = data[field.name];
                if (typeof value === 'object' && value !== null) {
                    Object.entries(value).forEach(([localeKey, localeValue])=>{
                        let localeData = localeValue;
                        let push = false;
                        if (localeValue && typeof localeValue === 'object' && '$push' in localeValue) {
                            localeData = localeValue.$push;
                            push = true;
                            if (!Array.isArray(localeData)) {
                                localeData = [
                                    localeData
                                ];
                            }
                        }
                        if (Array.isArray(localeData)) {
                            const newRows = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$write$2f$array$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["transformArray"])({
                                adapter,
                                arrayTableName,
                                baseTableName,
                                blocks,
                                blocksToDelete,
                                data: localeData,
                                field,
                                locale: localeKey,
                                numbers,
                                numbersToDelete,
                                parentIsLocalized: parentIsLocalized || field.localized,
                                path,
                                relationships,
                                relationshipsToDelete,
                                selects,
                                texts,
                                textsToDelete,
                                withinArrayOrBlockLocale: localeKey
                            });
                            if (push) {
                                if (!arraysToPush[arrayTableName]) {
                                    arraysToPush[arrayTableName] = [];
                                }
                                arraysToPush[arrayTableName] = arraysToPush[arrayTableName].concat(newRows);
                            } else {
                                if (!arrays[arrayTableName]) {
                                    arrays[arrayTableName] = [];
                                }
                                arrays[arrayTableName] = arrays[arrayTableName].concat(newRows);
                            }
                        }
                    });
                }
            } else {
                let value = data[field.name];
                let push = false;
                if (typeof value === 'object' && '$push' in value) {
                    value = Array.isArray(value.$push) ? value.$push : [
                        value.$push
                    ];
                    push = true;
                }
                const newRows = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$write$2f$array$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["transformArray"])({
                    adapter,
                    arrayTableName,
                    baseTableName,
                    blocks,
                    blocksToDelete,
                    data: value,
                    field,
                    numbers,
                    numbersToDelete,
                    parentIsLocalized: parentIsLocalized || field.localized,
                    path,
                    relationships,
                    relationshipsToDelete,
                    selects,
                    texts,
                    textsToDelete,
                    withinArrayOrBlockLocale
                });
                if (push) {
                    if (!arraysToPush[arrayTableName]) {
                        arraysToPush[arrayTableName] = [];
                    }
                    arraysToPush[arrayTableName] = arraysToPush[arrayTableName].concat(newRows);
                } else {
                    if (!arrays[arrayTableName]) {
                        arrays[arrayTableName] = [];
                    }
                    arrays[arrayTableName] = arrays[arrayTableName].concat(newRows);
                }
            }
            return;
        }
        if (field.type === 'blocks' && !adapter.blocksAsJSON) {
            ;
            (field.blockReferences ?? field.blocks).forEach((block)=>{
                const matchedBlock = typeof block === 'string' ? adapter.payload.config.blocks.find((each)=>each.slug === block) : block;
                blocksToDelete.add((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$validateExistingBlockIsIdentical$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["resolveBlockTableName"])(matchedBlock, adapter.tableNameMap.get(`${baseTableName}_blocks_${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(matchedBlock.slug)}`)));
            });
            if (isLocalized) {
                if (typeof data[field.name] === 'object' && data[field.name] !== null) {
                    Object.entries(data[field.name]).forEach(([localeKey, localeData])=>{
                        if (Array.isArray(localeData)) {
                            (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$write$2f$blocks$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["transformBlocks"])({
                                adapter,
                                baseTableName,
                                blocks,
                                blocksToDelete,
                                data: localeData,
                                field,
                                locale: localeKey,
                                numbers,
                                numbersToDelete,
                                parentIsLocalized: parentIsLocalized || field.localized,
                                path,
                                relationships,
                                relationshipsToDelete,
                                selects,
                                texts,
                                textsToDelete,
                                withinArrayOrBlockLocale: localeKey
                            });
                        }
                    });
                }
            } else if ((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$isArrayOfRows$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["isArrayOfRows"])(fieldData)) {
                (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$write$2f$blocks$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["transformBlocks"])({
                    adapter,
                    baseTableName,
                    blocks,
                    blocksToDelete,
                    data: fieldData,
                    field,
                    numbers,
                    numbersToDelete,
                    parentIsLocalized: parentIsLocalized || field.localized,
                    path,
                    relationships,
                    relationshipsToDelete,
                    selects,
                    texts,
                    textsToDelete,
                    withinArrayOrBlockLocale
                });
            }
            return;
        }
        if (field.type === 'group' || field.type === 'tab') {
            if (typeof data[field.name] === 'object' && data[field.name] !== null) {
                if (isLocalized) {
                    Object.entries(data[field.name]).forEach(([localeKey, localeData])=>{
                        // preserve array ID if there is
                        localeData._uuid = data.id || data._uuid;
                        traverseFields({
                            adapter,
                            arrays,
                            arraysToPush,
                            baseTableName,
                            blocks,
                            blocksToDelete,
                            columnPrefix: `${columnName}_`,
                            data: localeData,
                            enableAtomicWrites,
                            existingLocales,
                            fieldPrefix: `${fieldName}_`,
                            fields: field.flattenedFields,
                            forcedLocale: localeKey,
                            insideArrayOrBlock,
                            locales,
                            numbers,
                            numbersToDelete,
                            parentIsLocalized: parentIsLocalized || field.localized,
                            parentTableName,
                            path: `${path || ''}${field.name}.`,
                            relationships,
                            relationshipsToAppend,
                            relationshipsToDelete,
                            row,
                            selects,
                            texts,
                            textsToDelete,
                            withinArrayOrBlockLocale: localeKey
                        });
                    });
                } else {
                    // preserve array ID if there is
                    const groupData = data[field.name];
                    groupData._uuid = data.id || data._uuid;
                    traverseFields({
                        adapter,
                        arrays,
                        arraysToPush,
                        baseTableName,
                        blocks,
                        blocksToDelete,
                        columnPrefix: `${columnName}_`,
                        data: groupData,
                        existingLocales,
                        fieldPrefix: `${fieldName}_`,
                        fields: field.flattenedFields,
                        insideArrayOrBlock,
                        locales,
                        numbers,
                        numbersToDelete,
                        parentIsLocalized: parentIsLocalized || field.localized,
                        parentTableName,
                        path: `${path || ''}${field.name}.`,
                        relationships,
                        relationshipsToAppend,
                        relationshipsToDelete,
                        row,
                        selects,
                        texts,
                        textsToDelete,
                        withinArrayOrBlockLocale
                    });
                }
            }
            return;
        }
        if (field.type === 'relationship' || field.type === 'upload') {
            const relationshipPath = `${path || ''}${field.name}`;
            // Handle $push operation for relationship fields
            if (fieldData && typeof fieldData === 'object' && 'hasMany' in field && field.hasMany && ('$push' in fieldData || field.localized && Object.values(fieldData).some((localeValue)=>localeValue && typeof localeValue === 'object' && '$push' in localeValue))) {
                let itemsToAppend;
                if (field.localized) {
                    let hasLocaleOperations = false;
                    Object.entries(fieldData).forEach(([localeKey, localeValue])=>{
                        if (localeValue && typeof localeValue === 'object' && '$push' in localeValue) {
                            hasLocaleOperations = true;
                            const push = localeValue.$push;
                            const localeItems = Array.isArray(push) ? push : [
                                push
                            ];
                            localeItems.forEach((item)=>{
                                const relationshipToAppend = {
                                    locale: localeKey,
                                    path: relationshipPath,
                                    value: item
                                };
                                // Handle polymorphic relationships
                                if (Array.isArray(field.relationTo) && item && typeof item === 'object' && 'relationTo' in item) {
                                    relationshipToAppend.relationTo = item.relationTo;
                                    relationshipToAppend.value = item.value;
                                } else if (typeof field.relationTo === 'string') {
                                    // Simple relationship
                                    relationshipToAppend.relationTo = field.relationTo;
                                    relationshipToAppend.value = item;
                                }
                                relationshipsToAppend.push(relationshipToAppend);
                            });
                        }
                    });
                    if (hasLocaleOperations) {
                        return;
                    }
                } else {
                    // Handle non-localized fields: { field: { $push: data } }
                    itemsToAppend = Array.isArray(fieldData.$push) ? fieldData.$push : [
                        fieldData.$push
                    ];
                    itemsToAppend.forEach((item)=>{
                        const relationshipToAppend = {
                            locale: isLocalized ? withinArrayOrBlockLocale : undefined,
                            path: relationshipPath,
                            value: item
                        };
                        // Handle polymorphic relationships
                        if (Array.isArray(field.relationTo) && item && typeof item === 'object' && 'relationTo' in item && 'value' in item) {
                            relationshipToAppend.relationTo = item.relationTo;
                            relationshipToAppend.value = item.value;
                        } else if (typeof field.relationTo === 'string') {
                            // Simple relationship
                            relationshipToAppend.relationTo = field.relationTo;
                            relationshipToAppend.value = item;
                        }
                        relationshipsToAppend.push(relationshipToAppend);
                    });
                }
                return;
            }
            // Handle $remove operation for relationship fields
            if (fieldData && typeof fieldData === 'object' && 'hasMany' in field && field.hasMany && ('$remove' in fieldData || field.localized && Object.values(fieldData).some((localeValue)=>localeValue && typeof localeValue === 'object' && '$remove' in localeValue))) {
                // Check for new locale-first syntax: { field: { locale: { $remove: data } } }
                if (field.localized) {
                    let hasLocaleOperations = false;
                    Object.entries(fieldData).forEach(([localeKey, localeValue])=>{
                        if (localeValue && typeof localeValue === 'object' && '$remove' in localeValue) {
                            hasLocaleOperations = true;
                            const remove = localeValue.$remove;
                            const localeItems = Array.isArray(remove) ? remove : [
                                remove
                            ];
                            localeItems.forEach((item)=>{
                                const relationshipToDelete = {
                                    itemToRemove: item,
                                    locale: localeKey,
                                    path: relationshipPath
                                };
                                // Store relationTo for simple relationships
                                if (typeof field.relationTo === 'string') {
                                    relationshipToDelete.relationTo = field.relationTo;
                                }
                                relationshipsToDelete.push(relationshipToDelete);
                            });
                        }
                    });
                    if (hasLocaleOperations) {
                        return;
                    }
                } else {
                    // Handle non-localized fields: { field: { $remove: data } }
                    const itemsToRemove = Array.isArray(fieldData.$remove) ? fieldData.$remove : [
                        fieldData.$remove
                    ];
                    itemsToRemove.forEach((item)=>{
                        const relationshipToDelete = {
                            itemToRemove: item,
                            locale: isLocalized ? withinArrayOrBlockLocale : undefined,
                            path: relationshipPath
                        };
                        // Store relationTo for simple relationships
                        if (typeof field.relationTo === 'string') {
                            relationshipToDelete.relationTo = field.relationTo;
                        }
                        relationshipsToDelete.push(relationshipToDelete);
                    });
                }
                return;
            }
            if (isLocalized && (Array.isArray(field.relationTo) || 'hasMany' in field && field.hasMany)) {
                if (typeof fieldData === 'object') {
                    Object.entries(fieldData).forEach(([localeKey, localeData])=>{
                        if (localeData === null) {
                            relationshipsToDelete.push({
                                locale: localeKey,
                                path: relationshipPath
                            });
                            return;
                        }
                        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$write$2f$relationships$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["transformRelationship"])({
                            baseRow: {
                                locale: localeKey,
                                path: relationshipPath
                            },
                            data: localeData,
                            field,
                            relationships
                        });
                    });
                }
                return;
            } else if (Array.isArray(field.relationTo) || 'hasMany' in field && field.hasMany) {
                if (fieldData === null || Array.isArray(fieldData) && fieldData.length === 0) {
                    relationshipsToDelete.push({
                        path: relationshipPath
                    });
                    return;
                }
                (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$write$2f$relationships$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["transformRelationship"])({
                    baseRow: {
                        locale: withinArrayOrBlockLocale,
                        path: relationshipPath
                    },
                    data: fieldData,
                    field,
                    relationships
                });
                return;
            } else {
                if (!isLocalized && fieldData && typeof fieldData === 'object' && 'id' in fieldData && fieldData?.id) {
                    fieldData = fieldData.id;
                } else if (isLocalized) {
                    if (typeof fieldData === 'object') {
                        Object.entries(fieldData).forEach(([localeKey, localeData])=>{
                            if (typeof localeData === 'object') {
                                if (localeData && 'id' in localeData && localeData?.id) {
                                    fieldData[localeKey] = localeData.id;
                                }
                            } else {
                                fieldData[localeKey] = localeData;
                            }
                        });
                    }
                }
            }
        }
        if (field.type === 'text' && field.hasMany) {
            const textPath = `${path || ''}${field.name}`;
            if (isLocalized) {
                if (typeof fieldData === 'object') {
                    Object.entries(fieldData).forEach(([localeKey, localeData])=>{
                        if (Array.isArray(localeData)) {
                            if (!localeData.length) {
                                textsToDelete.push({
                                    locale: localeKey,
                                    path: textPath
                                });
                                return;
                            }
                            (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$write$2f$texts$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["transformTexts"])({
                                baseRow: {
                                    locale: localeKey,
                                    path: textPath
                                },
                                data: localeData,
                                texts
                            });
                        }
                    });
                }
            } else if (Array.isArray(fieldData)) {
                if (!fieldData.length) {
                    textsToDelete.push({
                        locale: withinArrayOrBlockLocale,
                        path: textPath
                    });
                    return;
                }
                (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$write$2f$texts$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["transformTexts"])({
                    baseRow: {
                        locale: withinArrayOrBlockLocale,
                        path: textPath
                    },
                    data: fieldData,
                    texts
                });
            }
            return;
        }
        if (field.type === 'number' && field.hasMany) {
            const numberPath = `${path || ''}${field.name}`;
            if (isLocalized) {
                if (typeof fieldData === 'object') {
                    Object.entries(fieldData).forEach(([localeKey, localeData])=>{
                        if (Array.isArray(localeData)) {
                            if (!localeData.length) {
                                numbersToDelete.push({
                                    locale: localeKey,
                                    path: numberPath
                                });
                                return;
                            }
                            (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$write$2f$numbers$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["transformNumbers"])({
                                baseRow: {
                                    locale: localeKey,
                                    path: numberPath
                                },
                                data: localeData,
                                numbers
                            });
                        }
                    });
                }
            } else if (Array.isArray(fieldData)) {
                if (!fieldData.length) {
                    numbersToDelete.push({
                        locale: withinArrayOrBlockLocale,
                        path: numberPath
                    });
                    return;
                }
                (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$write$2f$numbers$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["transformNumbers"])({
                    baseRow: {
                        locale: withinArrayOrBlockLocale,
                        path: numberPath
                    },
                    data: fieldData,
                    numbers
                });
            }
            return;
        }
        if (field.type === 'select' && field.hasMany) {
            const selectTableName = adapter.tableNameMap.get(`${parentTableName}_${columnName}`);
            if (!selects[selectTableName]) {
                selects[selectTableName] = [];
            }
            if (isLocalized) {
                if (typeof data[field.name] === 'object' && data[field.name] !== null) {
                    Object.entries(data[field.name]).forEach(([localeKey, localeData])=>{
                        if (Array.isArray(localeData)) {
                            const newRows = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$write$2f$selects$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["transformSelects"])({
                                id: insideArrayOrBlock ? data._uuid || data.id : undefined,
                                data: localeData,
                                locale: localeKey
                            });
                            selects[selectTableName] = selects[selectTableName].concat(newRows);
                        }
                    });
                }
            } else if (Array.isArray(data[field.name])) {
                const newRows = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$write$2f$selects$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["transformSelects"])({
                    id: insideArrayOrBlock ? data._uuid || data.id : undefined,
                    data: data[field.name],
                    locale: withinArrayOrBlockLocale
                });
                selects[selectTableName] = selects[selectTableName].concat(newRows);
            }
            return;
        }
        const valuesToTransform = [];
        if (isLocalized) {
            if (typeof fieldData === 'object' && fieldData !== null) {
                Object.entries(fieldData).forEach(([localeKey, localeData])=>{
                    if (!locales[localeKey]) {
                        locales[localeKey] = {};
                    }
                    valuesToTransform.push({
                        localeKey,
                        ref: locales,
                        value: localeData
                    });
                });
            }
        } else {
            let ref = row;
            if (forcedLocale) {
                if (!locales[forcedLocale]) {
                    locales[forcedLocale] = {};
                }
                ref = locales[forcedLocale];
            }
            valuesToTransform.push({
                ref,
                value: fieldData
            });
        }
        valuesToTransform.forEach(({ localeKey, ref, value })=>{
            let formattedValue = value;
            if (field.type === 'date') {
                if (fieldName === 'updatedAt' && formattedValue === null) {
                    // If updatedAt is explicitly set to null, skip it entirely - don't add to row
                    // This prevents the timestamp from being updated for session-only operations
                    return; // Skip this iteration
                } else if (fieldName === 'updatedAt' && typeof formattedValue === 'undefined') {
                    // If updatedAt is undefined, set it to current time (normal behavior)
                    formattedValue = new Date().toISOString();
                } else {
                    if (typeof value === 'number' && !Number.isNaN(value)) {
                        formattedValue = new Date(value).toISOString();
                    } else if (value instanceof Date) {
                        formattedValue = value.toISOString();
                    }
                }
            }
            if (typeof value !== 'undefined') {
                if (value && field.type === 'point' && adapter.name !== 'sqlite') {
                    formattedValue = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`ST_GeomFromGeoJSON(${JSON.stringify(value)})`;
                }
                if (field.type === 'text' && value && typeof value !== 'string') {
                    formattedValue = JSON.stringify(value);
                }
                if (field.type === 'number' && value && typeof value === 'object' && '$inc' in value && typeof value.$inc === 'number') {
                    if (!enableAtomicWrites) {
                        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$APIError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]('The passed data must not contain any nested fields for atomic writes');
                    }
                    formattedValue = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"].raw(`${columnName} + ${value.$inc}`);
                }
            }
            if (typeof formattedValue !== 'undefined') {
                if (localeKey) {
                    ref[localeKey][fieldName] = formattedValue;
                } else {
                    ref[fieldName] = formattedValue;
                }
            }
        });
    });
    // Handle dot-notation paths when no fields matched
    if (!fieldsMatched) {
        Object.keys(data).forEach((key)=>{
            if (key.includes('.')) {
                // Split on first dot only
                const firstDotIndex = key.indexOf('.');
                const fieldName = key.substring(0, firstDotIndex);
                const remainingPath = key.substring(firstDotIndex + 1);
                // Create nested structure for this field
                if (!data[fieldName]) {
                    data[fieldName] = {};
                }
                const nestedData = data[fieldName];
                // Move the value to the nested structure
                nestedData[remainingPath] = data[key];
                delete data[key];
                // Recursively process the newly created nested structure
                // The field traversal will naturally handle it if the field exists in the schema
                traverseFields({
                    adapter,
                    arrays,
                    arraysToPush,
                    baseTableName,
                    blocks,
                    blocksToDelete,
                    columnPrefix,
                    data,
                    enableAtomicWrites,
                    existingLocales,
                    fieldPrefix,
                    fields,
                    forcedLocale,
                    insideArrayOrBlock,
                    locales,
                    numbers,
                    numbersToDelete,
                    parentIsLocalized,
                    parentTableName,
                    path,
                    relationships,
                    relationshipsToAppend,
                    relationshipsToDelete,
                    row,
                    selects,
                    texts,
                    textsToDelete,
                    withinArrayOrBlockLocale
                });
            }
        });
    }
}; //# sourceMappingURL=traverseFields.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/transform/write/index.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "transformForWrite",
    ()=>transformForWrite
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$write$2f$traverseFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/transform/write/traverseFields.js [app-route] (ecmascript)");
;
const transformForWrite = ({ adapter, data, enableAtomicWrites, fields, parentIsLocalized, path = '', tableName })=>{
    // Split out the incoming data into rows to insert / delete
    const rowToInsert = {
        arrays: {},
        arraysToPush: {},
        blocks: {},
        blocksToDelete: new Set(),
        locales: {},
        numbers: [],
        numbersToDelete: [],
        relationships: [],
        relationshipsToAppend: [],
        relationshipsToDelete: [],
        row: {},
        selects: {},
        texts: [],
        textsToDelete: []
    };
    // This function is responsible for building up the
    // above rowToInsert
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$write$2f$traverseFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["traverseFields"])({
        adapter,
        arrays: rowToInsert.arrays,
        arraysToPush: rowToInsert.arraysToPush,
        baseTableName: tableName,
        blocks: rowToInsert.blocks,
        blocksToDelete: rowToInsert.blocksToDelete,
        columnPrefix: '',
        data,
        enableAtomicWrites,
        fieldPrefix: '',
        fields,
        locales: rowToInsert.locales,
        numbers: rowToInsert.numbers,
        numbersToDelete: rowToInsert.numbersToDelete,
        parentIsLocalized,
        parentTableName: tableName,
        path,
        relationships: rowToInsert.relationships,
        relationshipsToAppend: rowToInsert.relationshipsToAppend,
        relationshipsToDelete: rowToInsert.relationshipsToDelete,
        row: rowToInsert.row,
        selects: rowToInsert.selects,
        texts: rowToInsert.texts,
        textsToDelete: rowToInsert.textsToDelete
    });
    return rowToInsert;
}; //# sourceMappingURL=index.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/upsertRow/deleteExistingArrayRows.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "deleteExistingArrayRows",
    ()=>deleteExistingArrayRows
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/sql/expressions/conditions.js [app-route] (ecmascript)");
;
const deleteExistingArrayRows = async ({ adapter, db, parentID, tableName })=>{
    const table = adapter.tables[tableName];
    const whereConstraints = [
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(table._parentID, parentID)
    ];
    await adapter.deleteWhere({
        db,
        tableName,
        where: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["and"])(...whereConstraints)
    });
}; //# sourceMappingURL=deleteExistingArrayRows.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/upsertRow/deleteExistingRowsByPath.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "deleteExistingRowsByPath",
    ()=>deleteExistingRowsByPath
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/sql/expressions/conditions.js [app-route] (ecmascript)");
;
const deleteExistingRowsByPath = async ({ adapter, db, localeColumnName = '_locale', parentColumnName = '_parentID', parentID, pathColumnName = '_path', rows, tableName })=>{
    const localizedPathsToDelete = new Set();
    const pathsToDelete = new Set();
    const table = adapter.tables[tableName];
    rows.forEach((row)=>{
        const path = row[pathColumnName];
        const localeData = row[localeColumnName];
        if (typeof path === 'string') {
            if (typeof localeData === 'string') {
                localizedPathsToDelete.add(path);
            } else {
                pathsToDelete.add(path);
            }
        }
    });
    if (localizedPathsToDelete.size > 0) {
        const whereConstraints = [
            (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(table[parentColumnName], parentID)
        ];
        if (pathColumnName) {
            whereConstraints.push((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["inArray"])(table[pathColumnName], Array.from(localizedPathsToDelete)));
        }
        await adapter.deleteWhere({
            db,
            tableName,
            where: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["and"])(...whereConstraints)
        });
    }
    if (pathsToDelete.size > 0) {
        const whereConstraints = [
            (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(table[parentColumnName], parentID)
        ];
        if (pathColumnName) {
            whereConstraints.push((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["inArray"])(table[pathColumnName], Array.from(pathsToDelete)));
        }
        await adapter.deleteWhere({
            db,
            tableName,
            where: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["and"])(...whereConstraints)
        });
    }
}; //# sourceMappingURL=deleteExistingRowsByPath.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/upsertRow/handleUpsertError.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "handleUpsertError",
    ()=>handleUpsertError
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$ValidationError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/errors/ValidationError.js [app-route] (ecmascript)");
;
const handleUpsertError = ({ id, adapter, collectionSlug, error: caughtError, globalSlug, req, tableName })=>{
    let error = caughtError;
    if (typeof caughtError === 'object' && caughtError !== null && 'cause' in caughtError) {
        error = caughtError.cause;
    }
    // PostgreSQL: 23505, SQLite: SQLITE_CONSTRAINT_UNIQUE
    if (error?.code === '23505' || error?.code === 'SQLITE_CONSTRAINT_UNIQUE') {
        let fieldName = null;
        if (error.code === '23505') {
            // PostgreSQL - extract field name from constraint
            if (adapter.fieldConstraints?.[tableName]?.[error.constraint]) {
                fieldName = adapter.fieldConstraints[tableName][error.constraint];
            } else {
                const replacement = `${tableName}_`;
                if (error.constraint?.includes(replacement)) {
                    const replacedConstraint = error.constraint.replace(replacement, '');
                    if (replacedConstraint && adapter.fieldConstraints[tableName]?.[replacedConstraint]) {
                        fieldName = adapter.fieldConstraints[tableName][replacedConstraint];
                    }
                }
            }
            if (!fieldName && error.detail) {
                // Extract from detail: "Key (field)=(value) already exists."
                const regex = /Key \(([^)]+)\)=\(([^)]+)\)/;
                const match = error.detail.match(regex);
                if (match && match[1]) {
                    fieldName = match[1];
                }
            }
        } else if (error.code === 'SQLITE_CONSTRAINT_UNIQUE') {
            // SQLite - extract from message: "UNIQUE constraint failed: table.field"
            const regex = /UNIQUE constraint failed: ([^.]+)\.([^.]+)/;
            const match = error.message?.match(regex);
            if (match && match[2]) {
                if (adapter.fieldConstraints[tableName]) {
                    fieldName = adapter.fieldConstraints[tableName][`${match[2]}_idx`];
                }
                if (!fieldName) {
                    fieldName = match[2];
                }
            }
        }
        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$ValidationError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["ValidationError"]({
            id,
            collection: collectionSlug,
            errors: [
                {
                    message: req?.t ? req.t('error:valueMustBeUnique') : 'Value must be unique',
                    path: fieldName
                }
            ],
            global: globalSlug,
            req
        }, req?.t);
    }
    // Re-throw non-constraint errors
    throw caughtError;
}; //# sourceMappingURL=handleUpsertError.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/upsertRow/insertArrays.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "insertArrays",
    ()=>insertArrays
]);
const insertArrays = async ({ adapter, arrays, db, parentRows, uuidMap = {} })=>{
    // Maintain a map of flattened rows by table
    const rowsByTable = {};
    arrays.forEach((arraysByTable, parentRowIndex)=>{
        if (!arraysByTable || Object.keys(arraysByTable).length === 0) {
            return;
        }
        Object.entries(arraysByTable).forEach(([tableName, arrayRows])=>{
            // If the table doesn't exist in map, initialize it
            if (!rowsByTable[tableName]) {
                rowsByTable[tableName] = {
                    arrays: [],
                    locales: [],
                    rows: []
                };
            }
            const parentID = parentRows[parentRowIndex].id;
            // Add any sub arrays that need to be created
            // We will call this recursively below
            arrayRows.forEach((arrayRow)=>{
                if (Object.keys(arrayRow.arrays).length > 0) {
                    rowsByTable[tableName].arrays.push(arrayRow.arrays);
                }
                // Set up parent IDs for both row and locale row
                arrayRow.row._parentID = parentID;
                rowsByTable[tableName].rows.push(arrayRow.row);
                Object.entries(arrayRow.locales).forEach(([arrayRowLocale, arrayRowLocaleData])=>{
                    arrayRowLocaleData._parentID = arrayRow.row.id;
                    arrayRowLocaleData._locale = arrayRowLocale;
                    rowsByTable[tableName].locales.push(arrayRowLocaleData);
                    if (!arrayRow.row.id) {
                        arrayRowLocaleData._getParentID = (rows)=>{
                            const { id } = rows.find((each)=>each._uuid === arrayRow.row._uuid);
                            return id;
                        };
                    }
                });
            });
        });
    });
    // Insert all corresponding arrays
    // (one insert per array table)
    for (const [tableName, row] of Object.entries(rowsByTable)){
        // the nested arrays need the ID for the parentID foreign key
        let insertedRows;
        if (row.rows.length > 0) {
            insertedRows = await adapter.insert({
                db,
                tableName,
                values: row.rows
            });
            insertedRows.forEach((row)=>{
                if (typeof row._uuid === 'string' && (typeof row.id === 'string' || typeof row.id === 'number')) {
                    uuidMap[row._uuid] = row.id;
                }
            });
        }
        // Insert locale rows
        if (adapter.tables[`${tableName}${adapter.localesSuffix}`] && row.locales.length > 0) {
            if (!row.locales[0]._parentID) {
                row.locales = row.locales.map((localeRow)=>{
                    if (typeof localeRow._getParentID === 'function') {
                        localeRow._parentID = localeRow._getParentID(insertedRows);
                        delete localeRow._getParentID;
                    }
                    return localeRow;
                });
            }
            await adapter.insert({
                db,
                tableName: `${tableName}${adapter.localesSuffix}`,
                values: row.locales
            });
        }
        // If there are sub arrays, call this function recursively
        if (row.arrays.length > 0) {
            await insertArrays({
                adapter,
                arrays: row.arrays,
                db,
                parentRows: insertedRows
            });
        }
    }
}; //# sourceMappingURL=insertArrays.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/upsertRow/shouldUseOptimizedUpsertRow.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

/**
 * Checks whether we should use the upsertRow function for the passed data and otherwise use a simple SQL SET call.
 * We need to use upsertRow only when the data has arrays, blocks, hasMany select/text/number, localized fields, complex relationships.
 */ __turbopack_context__.s([
    "shouldUseOptimizedUpsertRow",
    ()=>shouldUseOptimizedUpsertRow
]);
const shouldUseOptimizedUpsertRow = ({ data, fields })=>{
    let fieldsMatched = false;
    for(const key in data){
        const value = data[key];
        const field = fields.find((each)=>each.name === key);
        if (!field) {
            continue;
        }
        fieldsMatched = true;
        if (field.type === 'blocks' || (field.type === 'text' || field.type === 'relationship' || field.type === 'upload' || field.type === 'select' || field.type === 'number') && field.hasMany || (field.type === 'relationship' || field.type === 'upload') && Array.isArray(field.relationTo) || field.localized) {
            return false;
        }
        if (field.type === 'array') {
            if (typeof value === 'object' && '$push' in value && value.$push) {
                return shouldUseOptimizedUpsertRow({
                    // Only check first row - this function cares about field definitions. Each array row will have the same field definitions.
                    data: Array.isArray(value.$push) ? value.$push?.[0] : value.$push,
                    fields: field.flattenedFields
                });
            }
            return false;
        }
        // Handle relationship $push and $remove operations
        if ((field.type === 'relationship' || field.type === 'upload') && field.hasMany) {
            if (typeof value === 'object' && ('$push' in value || '$remove' in value)) {
                return false // Use full upsertRow for relationship operations
                ;
            }
        }
        if ((field.type === 'group' || field.type === 'tab') && value && typeof value === 'object' && !shouldUseOptimizedUpsertRow({
            data: value,
            fields: field.flattenedFields
        })) {
            return false;
        }
    }
    // Handle dot-notation paths when no fields matched
    if (!fieldsMatched) {
        for(const key in data){
            if (key.includes('.')) {
                // Split on first dot only
                const firstDotIndex = key.indexOf('.');
                const fieldName = key.substring(0, firstDotIndex);
                const remainingPath = key.substring(firstDotIndex + 1);
                const nestedData = {
                    [fieldName]: {
                        [remainingPath]: data[key]
                    }
                };
                return shouldUseOptimizedUpsertRow({
                    data: nestedData,
                    fields
                });
            }
        }
    }
    return true;
}; //# sourceMappingURL=shouldUseOptimizedUpsertRow.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/upsertRow/index.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "upsertRow",
    ()=>upsertRow
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/sql/expressions/conditions.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$select$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/sql/expressions/select.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$find$2f$buildFindManyArgs$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/find/buildFindManyArgs.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$read$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/transform/read/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$write$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/transform/write/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$deleteExistingArrayRows$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/upsertRow/deleteExistingArrayRows.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$deleteExistingRowsByPath$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/upsertRow/deleteExistingRowsByPath.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$handleUpsertError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/upsertRow/handleUpsertError.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$insertArrays$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/upsertRow/insertArrays.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$shouldUseOptimizedUpsertRow$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/upsertRow/shouldUseOptimizedUpsertRow.js [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
;
const upsertRow = async ({ id, adapter, collectionSlug, data, db, fields, globalSlug, ignoreResult, // When we support joins for write operations (create/update) - pass collectionSlug to the buildFindManyArgs
// Make a new argument in upsertRow.ts and pass the slug from every operation.
joinQuery: _joinQuery, operation, path = '', req, select, tableName, upsertTarget, where })=>{
    if (operation === 'create' && !data.createdAt) {
        data.createdAt = new Date().toISOString();
    }
    let insertedRow = {
        id
    };
    if (id && (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$shouldUseOptimizedUpsertRow$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["shouldUseOptimizedUpsertRow"])({
        data,
        fields
    })) {
        try {
            const transformedForWrite = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$write$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["transformForWrite"])({
                adapter,
                data,
                enableAtomicWrites: true,
                fields,
                tableName
            });
            const { row } = transformedForWrite;
            const { arraysToPush } = transformedForWrite;
            const drizzle = db;
            // First, handle $push arrays
            if (arraysToPush && Object.keys(arraysToPush)?.length) {
                await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$insertArrays$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["insertArrays"])({
                    adapter,
                    arrays: [
                        arraysToPush
                    ],
                    db,
                    parentRows: [
                        insertedRow
                    ],
                    uuidMap: {}
                });
            }
            // If row.updatedAt is not set, delete it to avoid triggering hasDataToUpdate. `updatedAt` may be explicitly set to null to
            // disable triggering hasDataToUpdate.
            if (typeof row.updatedAt === 'undefined' || row.updatedAt === null) {
                delete row.updatedAt;
            }
            const hasDataToUpdate = row && Object.keys(row)?.length;
            // Then, handle regular row update
            if (ignoreResult) {
                if (hasDataToUpdate) {
                    // Only update row if there is something to update.
                    // Example: if the data only consists of a single $push, calling insertArrays is enough - we don't need to update the row.
                    await drizzle.update(adapter.tables[tableName]).set(row).where((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(adapter.tables[tableName].id, id));
                }
                return ignoreResult === 'idOnly' ? {
                    id
                } : null;
            }
            const findManyArgs = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$find$2f$buildFindManyArgs$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildFindManyArgs"])({
                adapter,
                depth: 0,
                fields,
                joinQuery: false,
                select,
                tableName
            });
            const findManyKeysLength = Object.keys(findManyArgs).length;
            const hasOnlyColumns = Object.keys(findManyArgs.columns || {}).length > 0;
            if (!hasDataToUpdate) {
                // Nothing to update => just fetch current row and return
                findManyArgs.where = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(adapter.tables[tableName].id, insertedRow.id);
                const doc = await db.query[tableName].findFirst(findManyArgs);
                return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$read$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["transform"])({
                    adapter,
                    config: adapter.payload.config,
                    data: doc,
                    fields,
                    joinQuery: false,
                    tableName
                });
            }
            if (findManyKeysLength === 0 || hasOnlyColumns) {
                // Optimization - No need for joins => can simply use returning(). This is optimal for very simple collections
                // without complex fields that live in separate tables like blocks, arrays, relationships, etc.
                const selectedFields = {};
                if (hasOnlyColumns) {
                    for (const [column, enabled] of Object.entries(findManyArgs.columns)){
                        if (enabled) {
                            selectedFields[column] = adapter.tables[tableName][column];
                        }
                    }
                }
                const docs = await drizzle.update(adapter.tables[tableName]).set(row).where((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(adapter.tables[tableName].id, id)).returning(Object.keys(selectedFields).length ? selectedFields : undefined);
                return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$read$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["transform"])({
                    adapter,
                    config: adapter.payload.config,
                    data: docs[0],
                    fields,
                    joinQuery: false,
                    tableName
                });
            }
            // DB Update that needs the result, potentially with joins => need to update first, then find. returning() does not work with joins.
            await drizzle.update(adapter.tables[tableName]).set(row).where((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(adapter.tables[tableName].id, id));
            findManyArgs.where = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(adapter.tables[tableName].id, insertedRow.id);
            const doc = await db.query[tableName].findFirst(findManyArgs);
            return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$read$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["transform"])({
                adapter,
                config: adapter.payload.config,
                data: doc,
                fields,
                joinQuery: false,
                tableName
            });
        } catch (error) {
            (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$handleUpsertError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["handleUpsertError"])({
                id,
                adapter,
                collectionSlug,
                error,
                globalSlug,
                req,
                tableName
            });
        }
    }
    // Split out the incoming data into the corresponding:
    // base row, locales, relationships, blocks, and arrays
    const rowToInsert = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$write$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["transformForWrite"])({
        adapter,
        data,
        enableAtomicWrites: false,
        fields,
        path,
        tableName
    });
    // First, we insert the main row
    try {
        if (operation === 'update') {
            const target = upsertTarget || adapter.tables[tableName].id;
            // Check if we only have relationship operations and no main row data to update
            // Exclude timestamp-only updates when we only have relationship operations
            const rowKeys = Object.keys(rowToInsert.row);
            const hasMainRowData = rowKeys.length > 0 && !rowKeys.every((key)=>key === 'updatedAt' || key === 'createdAt');
            if (hasMainRowData) {
                if (id) {
                    rowToInsert.row.id = id;
                    [insertedRow] = await adapter.insert({
                        db,
                        onConflictDoUpdate: {
                            set: rowToInsert.row,
                            target
                        },
                        tableName,
                        values: rowToInsert.row
                    });
                } else {
                    ;
                    [insertedRow] = await adapter.insert({
                        db,
                        onConflictDoUpdate: {
                            set: rowToInsert.row,
                            target,
                            where
                        },
                        tableName,
                        values: rowToInsert.row
                    });
                }
            } else {
                // No main row data to update, just use the existing ID
                insertedRow = {
                    id
                };
            }
        } else {
            if (adapter.allowIDOnCreate && data.id) {
                rowToInsert.row.id = data.id;
            }
            ;
            [insertedRow] = await adapter.insert({
                db,
                tableName,
                values: rowToInsert.row
            });
        }
        const localesToInsert = [];
        const relationsToInsert = [];
        const textsToInsert = [];
        const numbersToInsert = [];
        const blocksToInsert = {};
        const selectsToInsert = {};
        // If there are locale rows with data, add the parent and locale to each
        if (Object.keys(rowToInsert.locales).length > 0) {
            Object.entries(rowToInsert.locales).forEach(([locale, localeRow])=>{
                localeRow._parentID = insertedRow.id;
                localeRow._locale = locale;
                localesToInsert.push(localeRow);
            });
        }
        // If there are relationships, add parent to each
        if (rowToInsert.relationships.length > 0) {
            rowToInsert.relationships.forEach((relation)=>{
                relation.parent = insertedRow.id;
                relationsToInsert.push(relation);
            });
        }
        // If there are texts, add parent to each
        if (rowToInsert.texts.length > 0) {
            rowToInsert.texts.forEach((textRow)=>{
                textRow.parent = insertedRow.id;
                textsToInsert.push(textRow);
            });
        }
        // If there are numbers, add parent to each
        if (rowToInsert.numbers.length > 0) {
            rowToInsert.numbers.forEach((numberRow)=>{
                numberRow.parent = insertedRow.id;
                numbersToInsert.push(numberRow);
            });
        }
        // If there are selects, add parent to each, and then
        // store by table name and rows
        if (Object.keys(rowToInsert.selects).length > 0) {
            Object.entries(rowToInsert.selects).forEach(([selectTableName, selectRows])=>{
                selectsToInsert[selectTableName] = [];
                selectRows.forEach((row)=>{
                    if (typeof row.parent === 'undefined') {
                        row.parent = insertedRow.id;
                    }
                    selectsToInsert[selectTableName].push(row);
                });
            });
        }
        // If there are blocks, add parent to each, and then
        // store by table name and rows
        Object.keys(rowToInsert.blocks).forEach((tableName)=>{
            rowToInsert.blocks[tableName].forEach((blockRow)=>{
                blockRow.row._parentID = insertedRow.id;
                if (!blocksToInsert[tableName]) {
                    blocksToInsert[tableName] = [];
                }
                if (blockRow.row.uuid) {
                    delete blockRow.row.uuid;
                }
                blocksToInsert[tableName].push(blockRow);
            });
        });
        // //////////////////////////////////
        // INSERT LOCALES
        // //////////////////////////////////
        if (localesToInsert.length > 0) {
            const localeTableName = `${tableName}${adapter.localesSuffix}`;
            const localeTable = adapter.tables[`${tableName}${adapter.localesSuffix}`];
            if (operation === 'update') {
                await adapter.deleteWhere({
                    db,
                    tableName: localeTableName,
                    where: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(localeTable._parentID, insertedRow.id)
                });
            }
            await adapter.insert({
                db,
                tableName: localeTableName,
                values: localesToInsert
            });
        }
        // //////////////////////////////////
        // INSERT RELATIONSHIPS
        // //////////////////////////////////
        const relationshipsTableName = `${tableName}${adapter.relationshipsSuffix}`;
        if (operation === 'update') {
            // Filter out specific item deletions (those with itemToRemove) from general path deletions
            const generalRelationshipDeletes = rowToInsert.relationshipsToDelete.filter((rel)=>!('itemToRemove' in rel));
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$deleteExistingRowsByPath$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["deleteExistingRowsByPath"])({
                adapter,
                db,
                localeColumnName: 'locale',
                parentColumnName: 'parent',
                parentID: insertedRow.id,
                pathColumnName: 'path',
                rows: [
                    ...relationsToInsert,
                    ...generalRelationshipDeletes
                ],
                tableName: relationshipsTableName
            });
        }
        if (relationsToInsert.length > 0) {
            await adapter.insert({
                db,
                tableName: relationshipsTableName,
                values: relationsToInsert
            });
        }
        // //////////////////////////////////
        // HANDLE RELATIONSHIP $push OPERATIONS
        // //////////////////////////////////
        if (rowToInsert.relationshipsToAppend.length > 0) {
            // Prepare all relationships for batch insert (order will be set after max query)
            const relationshipsToInsert = rowToInsert.relationshipsToAppend.map((rel)=>{
                const parentId = id || insertedRow.id;
                const row = {
                    parent: parentId,
                    path: rel.path
                };
                // Only add locale if this relationship table has a locale column
                const relationshipTable = adapter.rawTables[relationshipsTableName];
                if (rel.locale && relationshipTable && relationshipTable.columns.locale) {
                    row.locale = rel.locale;
                }
                if (rel.relationTo) {
                    // Use camelCase key for Drizzle table (e.g., categoriesID not categories_id)
                    row[`${rel.relationTo}ID`] = rel.value;
                }
                return row;
            });
            if (relationshipsToInsert.length > 0) {
                // Check for potential duplicates
                const relationshipTable = adapter.tables[relationshipsTableName];
                if (relationshipTable) {
                    // Build conditions only if we have relationships to check
                    if (relationshipsToInsert.length === 0) {
                        return; // No relationships to insert
                    }
                    const conditions = relationshipsToInsert.map((row)=>{
                        const parts = [
                            (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(relationshipTable.parent, row.parent),
                            (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(relationshipTable.path, row.path)
                        ];
                        // Add locale condition
                        if (row.locale !== undefined && relationshipTable.locale) {
                            parts.push((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(relationshipTable.locale, row.locale));
                        } else if (relationshipTable.locale) {
                            parts.push((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["isNull"])(relationshipTable.locale));
                        }
                        // Add all relationship ID matches using schema fields
                        for (const [key, value] of Object.entries(row)){
                            if (key.endsWith('ID') && value != null) {
                                const column = relationshipTable[key];
                                if (column && typeof column === 'object') {
                                    parts.push((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(column, value));
                                }
                            }
                        }
                        return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["and"])(...parts);
                    });
                    // Get both existing relationships AND max order in a single query
                    let existingRels = [];
                    let maxOrder = 0;
                    if (conditions.length > 0) {
                        // Query for existing relationships
                        existingRels = await db.select().from(relationshipTable).where((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["or"])(...conditions));
                    }
                    // Get max order for this parent across all paths in a single query
                    const parentId = id || insertedRow.id;
                    const maxOrderResult = await db.select({
                        maxOrder: relationshipTable.order
                    }).from(relationshipTable).where((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(relationshipTable.parent, parentId)).orderBy((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$select$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["desc"])(relationshipTable.order)).limit(1);
                    if (maxOrderResult.length > 0 && maxOrderResult[0].maxOrder) {
                        maxOrder = maxOrderResult[0].maxOrder;
                    }
                    // Set order values for all relationships based on max order
                    relationshipsToInsert.forEach((row, index)=>{
                        row.order = maxOrder + index + 1;
                    });
                    // Filter out relationships that already exist
                    const relationshipsToActuallyInsert = relationshipsToInsert.filter((newRow)=>{
                        return !existingRels.some((existingRow)=>{
                            // Check if this relationship already exists
                            let matches = existingRow.parent === newRow.parent && existingRow.path === newRow.path;
                            if (newRow.locale !== undefined) {
                                matches = matches && existingRow.locale === newRow.locale;
                            }
                            // Check relationship value matches - convert to camelCase for comparison
                            for (const key of Object.keys(newRow)){
                                if (key.endsWith('ID')) {
                                    // Now using camelCase keys
                                    matches = matches && existingRow[key] === newRow[key];
                                }
                            }
                            return matches;
                        });
                    });
                    // Insert only non-duplicate relationships
                    if (relationshipsToActuallyInsert.length > 0) {
                        await adapter.insert({
                            db,
                            tableName: relationshipsTableName,
                            values: relationshipsToActuallyInsert
                        });
                    }
                }
            }
        }
        // //////////////////////////////////
        // HANDLE RELATIONSHIP $remove OPERATIONS
        // //////////////////////////////////
        if (rowToInsert.relationshipsToDelete.some((rel)=>'itemToRemove' in rel)) {
            const relationshipTable = adapter.tables[relationshipsTableName];
            if (relationshipTable) {
                for (const relToDelete of rowToInsert.relationshipsToDelete){
                    if ('itemToRemove' in relToDelete && relToDelete.itemToRemove) {
                        const item = relToDelete.itemToRemove;
                        const parentId = id || insertedRow.id;
                        const conditions = [
                            (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(relationshipTable.parent, parentId),
                            (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(relationshipTable.path, relToDelete.path)
                        ];
                        // Add locale condition if this relationship table has a locale column
                        if (adapter.rawTables[relationshipsTableName]?.columns.locale) {
                            if (relToDelete.locale) {
                                conditions.push((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(relationshipTable.locale, relToDelete.locale));
                            } else {
                                conditions.push((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["isNull"])(relationshipTable.locale));
                            }
                        }
                        // Handle polymorphic vs simple relationships
                        if (typeof item === 'object' && 'relationTo' in item) {
                            // Polymorphic relationship - convert to camelCase key
                            const camelKey = `${item.relationTo}ID`;
                            if (relationshipTable[camelKey]) {
                                conditions.push((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(relationshipTable[camelKey], item.value));
                            }
                        } else if (relToDelete.relationTo) {
                            // Simple relationship - convert to camelCase key
                            const camelKey = `${relToDelete.relationTo}ID`;
                            if (relationshipTable[camelKey]) {
                                conditions.push((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(relationshipTable[camelKey], item));
                            }
                        }
                        // Execute DELETE using Drizzle query builder
                        await adapter.deleteWhere({
                            db,
                            tableName: relationshipsTableName,
                            where: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["and"])(...conditions)
                        });
                    }
                }
            }
        }
        // //////////////////////////////////
        // INSERT hasMany TEXTS
        // //////////////////////////////////
        const textsTableName = `${tableName}_texts`;
        if (operation === 'update') {
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$deleteExistingRowsByPath$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["deleteExistingRowsByPath"])({
                adapter,
                db,
                localeColumnName: 'locale',
                parentColumnName: 'parent',
                parentID: insertedRow.id,
                pathColumnName: 'path',
                rows: [
                    ...textsToInsert,
                    ...rowToInsert.textsToDelete
                ],
                tableName: textsTableName
            });
        }
        if (textsToInsert.length > 0) {
            await adapter.insert({
                db,
                tableName: textsTableName,
                values: textsToInsert
            });
        }
        // //////////////////////////////////
        // INSERT hasMany NUMBERS
        // //////////////////////////////////
        const numbersTableName = `${tableName}_numbers`;
        if (operation === 'update') {
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$deleteExistingRowsByPath$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["deleteExistingRowsByPath"])({
                adapter,
                db,
                localeColumnName: 'locale',
                parentColumnName: 'parent',
                parentID: insertedRow.id,
                pathColumnName: 'path',
                rows: [
                    ...numbersToInsert,
                    ...rowToInsert.numbersToDelete
                ],
                tableName: numbersTableName
            });
        }
        if (numbersToInsert.length > 0) {
            await adapter.insert({
                db,
                tableName: numbersTableName,
                values: numbersToInsert
            });
        }
        // //////////////////////////////////
        // INSERT BLOCKS
        // //////////////////////////////////
        const insertedBlockRows = {};
        if (operation === 'update') {
            for (const tableName of rowToInsert.blocksToDelete){
                const blockTable = adapter.tables[tableName];
                await adapter.deleteWhere({
                    db,
                    tableName,
                    where: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(blockTable._parentID, insertedRow.id)
                });
            }
        }
        // When versions are enabled, adapter is used to track mapping between blocks/arrays ObjectID to their numeric generated representation, then we use it for nested to arrays/blocks select hasMany in versions.
        const arraysBlocksUUIDMap = {};
        for (const [tableName, blockRows] of Object.entries(blocksToInsert)){
            insertedBlockRows[tableName] = await adapter.insert({
                db,
                tableName,
                values: blockRows.map(({ row })=>row)
            });
            insertedBlockRows[tableName].forEach((row, i)=>{
                blockRows[i].row = row;
                if (typeof row._uuid === 'string' && (typeof row.id === 'string' || typeof row.id === 'number')) {
                    arraysBlocksUUIDMap[row._uuid] = row.id;
                }
            });
            const blockLocaleIndexMap = [];
            const blockLocaleRowsToInsert = blockRows.reduce((acc, blockRow, i)=>{
                if (Object.entries(blockRow.locales).length > 0) {
                    Object.entries(blockRow.locales).forEach(([blockLocale, blockLocaleData])=>{
                        if (Object.keys(blockLocaleData).length > 0) {
                            blockLocaleData._parentID = blockRow.row.id;
                            blockLocaleData._locale = blockLocale;
                            acc.push(blockLocaleData);
                            blockLocaleIndexMap.push(i);
                        }
                    });
                }
                return acc;
            }, []);
            if (blockLocaleRowsToInsert.length > 0) {
                await adapter.insert({
                    db,
                    tableName: `${tableName}${adapter.localesSuffix}`,
                    values: blockLocaleRowsToInsert
                });
            }
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$insertArrays$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["insertArrays"])({
                adapter,
                arrays: blockRows.map(({ arrays })=>arrays),
                db,
                parentRows: insertedBlockRows[tableName],
                uuidMap: arraysBlocksUUIDMap
            });
        }
        // //////////////////////////////////
        // INSERT ARRAYS RECURSIVELY
        // //////////////////////////////////
        if (operation === 'update') {
            for (const arrayTableName of Object.keys(rowToInsert.arrays)){
                await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$deleteExistingArrayRows$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["deleteExistingArrayRows"])({
                    adapter,
                    db,
                    parentID: insertedRow.id,
                    tableName: arrayTableName
                });
            }
        }
        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$insertArrays$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["insertArrays"])({
            adapter,
            arrays: [
                rowToInsert.arrays,
                rowToInsert.arraysToPush
            ],
            db,
            parentRows: [
                insertedRow,
                insertedRow
            ],
            uuidMap: arraysBlocksUUIDMap
        });
        // //////////////////////////////////
        // INSERT hasMany SELECTS
        // //////////////////////////////////
        for (const [selectTableName, tableRows] of Object.entries(selectsToInsert)){
            const selectTable = adapter.tables[selectTableName];
            if (operation === 'update') {
                await adapter.deleteWhere({
                    db,
                    tableName: selectTableName,
                    where: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(selectTable.parent, insertedRow.id)
                });
            }
            if (Object.keys(arraysBlocksUUIDMap).length > 0) {
                tableRows.forEach((row)=>{
                    if (row.parent in arraysBlocksUUIDMap) {
                        row.parent = arraysBlocksUUIDMap[row.parent];
                    }
                });
            }
            if (tableRows.length) {
                await adapter.insert({
                    db,
                    tableName: selectTableName,
                    values: tableRows
                });
            }
        }
    } catch (error) {
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$handleUpsertError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["handleUpsertError"])({
            id,
            adapter,
            collectionSlug,
            error,
            globalSlug,
            req,
            tableName
        });
    }
    if (ignoreResult === 'idOnly') {
        return {
            id: insertedRow.id
        };
    }
    if (ignoreResult) {
        return data;
    }
    // //////////////////////////////////
    // RETRIEVE NEWLY UPDATED ROW
    // //////////////////////////////////
    const findManyArgs = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$find$2f$buildFindManyArgs$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildFindManyArgs"])({
        adapter,
        depth: 0,
        fields,
        joinQuery: false,
        select,
        tableName
    });
    findManyArgs.where = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(adapter.tables[tableName].id, insertedRow.id);
    const doc = await db.query[tableName].findFirst(findManyArgs);
    // //////////////////////////////////
    // TRANSFORM DATA
    // //////////////////////////////////
    const result = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$read$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["transform"])({
        adapter,
        config: adapter.payload.config,
        data: doc,
        fields,
        joinQuery: false,
        tableName
    });
    return result;
}; //# sourceMappingURL=index.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/create.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "create",
    ()=>create
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/upsertRow/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getTransaction.js [app-route] (ecmascript)");
;
;
;
const create = async function create({ collection: collectionSlug, data, req, returning, select }) {
    const collection = this.payload.collections[collectionSlug].config;
    const tableName = this.tableNameMap.get((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(collection.slug));
    const db = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTransaction"])(this, req);
    const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["upsertRow"])({
        adapter: this,
        collectionSlug,
        data,
        db,
        fields: collection.flattenedFields,
        ignoreResult: returning === false,
        operation: 'create',
        req,
        select,
        tableName
    });
    if (returning === false) {
        return null;
    }
    return result;
}; //# sourceMappingURL=create.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/utilities/blocksToJsonMigrator.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "buildDynamicPredefinedBlocksToJsonMigration",
    ()=>buildDynamicPredefinedBlocksToJsonMigration,
    "createBlocksToJsonMigrator",
    ()=>createBlocksToJsonMigrator,
    "getBlocksToJsonMigrator",
    ()=>getBlocksToJsonMigrator
]);
var __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/fs [external] (fs, cjs)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$path__$5b$external$5d$__$28$path$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/path [external] (path, cjs)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$APIError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/errors/APIError.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildCollectionFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/versions/buildCollectionFields.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildGlobalFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/versions/buildGlobalFields.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$dynamicImport$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/utilities/dynamicImport.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$config$2f$find$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/config/find.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/fields/config/types.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$typescript__$5b$external$5d$__$28$typescript$2c$__cjs$2c$__$5b$project$5d2f$node_modules$2f$typescript$29$__ = __turbopack_context__.i("[externals]/typescript [external] (typescript, cjs, [project]/node_modules/typescript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getTransaction.js [app-route] (ecmascript)");
;
;
;
;
;
;
;
const DEFAULT_BATCH_SIZE = 100;
const TEMP_FOLDER_NAME = '.payload-blocks-migration';
const writeEntitiesToTempFile = (entities, tempFolderPath, batchIndex)=>{
    const filePath = __TURBOPACK__imported__module__$5b$externals$5d2f$path__$5b$external$5d$__$28$path$2c$__cjs$29$__["default"].join(tempFolderPath, `entities-batch-${batchIndex}.json`);
    (0, __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__["writeFileSync"])(filePath, JSON.stringify(entities, null, 2), 'utf-8');
};
const acceptDrizzlePrompts = async (callPrompt, { silenceLogs = false } = {})=>{
    // eslint-disable-next-line @typescript-eslint/unbound-method
    const write = process.stdout.write;
    if (silenceLogs) {
        process.stdout.write = ()=>true;
    }
    const promise = callPrompt();
    const interval = setInterval(()=>process.stdin.emit('keypress', '\n', {
            name: 'return',
            ctrl: false
        }), 25);
    const res = await promise;
    if (silenceLogs) {
        process.stdout.write = write;
    }
    clearInterval(interval);
    return res;
};
const entityHasBlocksField = (entity)=>{
    for (const field of entity.flattenedFields){
        if (field.type === 'blocks') {
            return true;
        }
        if ('flattenedFields' in field && entityHasBlocksField({
            flattenedFields: field.flattenedFields
        })) {
            return true;
        }
    }
    return false;
};
const collectBlocksToMigrate = ({ config, data, fields, parentAccessor, parentIsLocalized })=>{
    const result = [];
    for (const field of fields){
        switch(field.type){
            case 'array':
                {
                    const arrayData = data[field.name];
                    if (!Array.isArray(arrayData)) {
                        continue;
                    }
                    if (config.localization && (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["fieldShouldBeLocalized"])({
                        field,
                        parentIsLocalized
                    })) {
                        result.push(...collectBlocksToMigrate({
                            config,
                            data: arrayData,
                            fields: config.localization.localeCodes.map((code)=>({
                                    ...field,
                                    name: code,
                                    localized: false
                                })),
                            parentAccessor: [
                                ...parentAccessor,
                                field.name
                            ],
                            parentIsLocalized: true
                        }));
                        continue;
                    }
                    for (const [index, row] of arrayData.entries()){
                        result.push(...collectBlocksToMigrate({
                            config,
                            data: row,
                            fields: field.flattenedFields,
                            parentAccessor: [
                                ...parentAccessor,
                                field.name,
                                index
                            ],
                            parentIsLocalized
                        }));
                    }
                    break;
                }
            case 'blocks':
                {
                    result.push({
                        data: data[field.name],
                        fieldAccessor: [
                            ...parentAccessor,
                            field.name
                        ]
                    });
                    break;
                }
            case 'group':
            case 'tab':
                {
                    if (config.localization && (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["fieldShouldBeLocalized"])({
                        field,
                        parentIsLocalized
                    })) {
                        result.push(...collectBlocksToMigrate({
                            config,
                            data: data[field.name],
                            fields: config.localization.localeCodes.map((code)=>({
                                    ...field,
                                    name: code,
                                    localized: false
                                })),
                            parentAccessor: [
                                ...parentAccessor,
                                field.name
                            ],
                            parentIsLocalized: true
                        }));
                        continue;
                    }
                    result.push(...collectBlocksToMigrate({
                        config,
                        data: data[field.name],
                        fields: field.flattenedFields,
                        parentAccessor: [
                            ...parentAccessor,
                            field.name
                        ],
                        parentIsLocalized
                    }));
                    break;
                }
            default:
                {
                    continue;
                }
        }
    }
    return result;
};
class BlocksToJsonMigratorImpl {
    adapter;
    sanitizeStatements;
    executeMethod;
    batchSize;
    tempFolderPath;
    constructor(adapter, sanitizeStatements, executeMethod, batchSize){
        this.adapter = adapter;
        this.sanitizeStatements = sanitizeStatements;
        this.executeMethod = executeMethod;
        this.batchSize = batchSize || DEFAULT_BATCH_SIZE;
        this.tempFolderPath = __TURBOPACK__imported__module__$5b$externals$5d2f$path__$5b$external$5d$__$28$path$2c$__cjs$29$__["default"].resolve(this.adapter.migrationDir, TEMP_FOLDER_NAME);
    }
    ensureTempFolder() {
        if (!(0, __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__["existsSync"])(this.tempFolderPath)) {
            (0, __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__["mkdirSync"])(this.tempFolderPath, {
                recursive: true
            });
        }
    }
    *fetchEntitiesFromJsonBatches() {
        if (!(0, __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__["existsSync"])(this.tempFolderPath)) {
            return;
        }
        const files = (0, __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__["readdirSync"])(this.tempFolderPath).filter((file)=>file.startsWith('entities-batch-') && file.endsWith('.json')).sort((a, b)=>{
            const aNum = parseInt(a.match(/\d+/)?.[0] || '0', 10);
            const bNum = parseInt(b.match(/\d+/)?.[0] || '0', 10);
            return aNum - bNum;
        });
        for (const file of files){
            const filePath = __TURBOPACK__imported__module__$5b$externals$5d2f$path__$5b$external$5d$__$28$path$2c$__cjs$29$__["default"].join(this.tempFolderPath, file);
            const fileContent = (0, __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__["readFileSync"])(filePath, 'utf-8');
            const batchEntities = JSON.parse(fileContent);
            yield batchEntities;
        }
    }
    async migrateEntities(entities, req) {
        this.adapter.blocksAsJSON = true;
        this.resetSchema();
        await this.adapter.init();
        await this.adapter.connect();
        await this.syncTransactionDrizzleInstance(req);
        const totalEntities = entities.length;
        let processed = 0;
        for (const entity of entities){
            switch(entity.type){
                case 'collection':
                    {
                        await this.adapter.updateOne({
                            collection: entity.slug,
                            data: entity.originalData,
                            joins: false,
                            req,
                            where: {
                                id: {
                                    equals: entity.id
                                }
                            }
                        });
                        break;
                    }
                case 'collectionVersion':
                    {
                        await this.adapter.updateVersion({
                            id: entity.id,
                            collection: entity.slug,
                            req,
                            versionData: entity.originalData
                        });
                        break;
                    }
                case 'global':
                    {
                        await this.adapter.updateGlobal({
                            slug: entity.slug,
                            data: entity.originalData,
                            req
                        });
                        break;
                    }
                case 'globalVersion':
                    {
                        await this.adapter.updateGlobalVersion({
                            id: entity.id,
                            global: entity.slug,
                            req,
                            versionData: entity.originalData
                        });
                        break;
                    }
            }
            processed++;
            if (processed % this.batchSize === 0 || processed === totalEntities) {
                this.adapter.payload.logger.info(`Migrated ${processed}/${totalEntities} entities (${Math.round(processed / totalEntities * 100)}%)`);
            }
        }
    }
    resetSchema() {
        this.adapter.schema = {};
        this.adapter.tables = {};
        this.adapter.indexes = new Set();
        this.adapter.foreignKeys = new Set();
        this.adapter.relations = {};
        this.adapter.rawTables = {};
        this.adapter.rawRelations = {};
        this.adapter.tableNameMap = new Map();
        this.adapter.enums = {};
    }
    async syncTransactionDrizzleInstance(req) {
        const tsx = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTransaction"])(this.adapter, req);
        tsx._ = this.adapter.drizzle._;
        tsx.schema = this.adapter.drizzle._;
        tsx.session.schema = this.adapter.drizzle.session.schema;
    }
    cleanupTempFolder() {
        (0, __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__["rmSync"])(this.tempFolderPath, {
            force: true,
            recursive: true
        });
        this.adapter.payload.logger.info(`Cleaned up temp folder at ${this.tempFolderPath}`);
    }
    async collectAndSaveEntitiesToBatches(req, options) {
        const batchSize = options?.batchSize ?? this.batchSize;
        this.cleanupTempFolder();
        this.ensureTempFolder();
        this.adapter.blocksAsJSON = false;
        this.resetSchema();
        await this.adapter.init();
        await this.adapter.connect();
        // Count total entities to migrate
        let totalExpected = 0;
        for (const collection of this.adapter.payload.config.collections.filter(entityHasBlocksField)){
            const { totalDocs } = await this.adapter.count({
                collection: collection.slug
            });
            totalExpected += totalDocs;
            if (collection.versions) {
                const { totalDocs: totalVersions } = await this.adapter.countVersions({
                    collection: collection.slug
                });
                totalExpected += totalVersions;
            }
        }
        for (const globalConfig of this.adapter.payload.config.globals.filter(entityHasBlocksField)){
            totalExpected += 1; // Global itself
            if (globalConfig.versions) {
                const { totalDocs: totalGlobalVersions } = await this.adapter.countGlobalVersions({
                    global: globalConfig.slug
                });
                totalExpected += totalGlobalVersions;
            }
        }
        this.adapter.payload.logger.info(`Found ${totalExpected} total entities to collect and save to batches`);
        let batchIndex = 0;
        let currentBatch = [];
        let totalCollected = 0;
        const flushBatch = ()=>{
            if (currentBatch.length > 0) {
                writeEntitiesToTempFile(currentBatch, this.tempFolderPath, batchIndex);
                const percentage = totalExpected > 0 ? Math.round(totalCollected / totalExpected * 100) : 0;
                this.adapter.payload.logger.info(`Saved batch ${batchIndex} with ${currentBatch.length} entities (${totalCollected}/${totalExpected} - ${percentage}%)`);
                batchIndex++;
                currentBatch = [];
            }
        };
        const addEntity = (entity)=>{
            currentBatch.push(entity);
            totalCollected++;
            if (currentBatch.length >= batchSize) {
                flushBatch();
            }
        };
        for (const collection of this.adapter.payload.config.collections.filter(entityHasBlocksField)){
            let page = 1;
            let hasMore = true;
            while(hasMore){
                const { docs, hasNextPage } = await this.adapter.find({
                    collection: collection.slug,
                    limit: batchSize,
                    page
                });
                for (const doc of docs){
                    const entity = {
                        id: doc.id,
                        slug: collection.slug,
                        type: 'collection',
                        blocks: collectBlocksToMigrate({
                            config: this.adapter.payload.config,
                            data: doc,
                            fields: collection.flattenedFields,
                            parentAccessor: [],
                            parentIsLocalized: false
                        }),
                        originalData: doc
                    };
                    addEntity(entity);
                }
                this.adapter.payload.logger.info(`Collected ${docs.length} entries from ${collection.slug} (page ${page})`);
                hasMore = hasNextPage;
                page++;
            }
            if (collection.versions) {
                let versionPage = 1;
                let hasMoreVersions = true;
                while(hasMoreVersions){
                    const { docs: versionDocs, hasNextPage: hasNextVersionPage } = await this.adapter.findVersions({
                        collection: collection.slug,
                        limit: batchSize,
                        page: versionPage
                    });
                    for (const versionDoc of versionDocs){
                        const entity = {
                            id: versionDoc.id,
                            slug: collection.slug,
                            type: 'collectionVersion',
                            blocks: collectBlocksToMigrate({
                                config: this.adapter.payload.config,
                                data: versionDoc,
                                fields: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildCollectionFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildVersionCollectionFields"])(this.adapter.payload.config, collection, true),
                                parentAccessor: [],
                                parentIsLocalized: false
                            }),
                            originalData: versionDoc
                        };
                        addEntity(entity);
                    }
                    this.adapter.payload.logger.info(`Collected ${versionDocs.length} versions from ${collection.slug} (page ${versionPage})`);
                    hasMoreVersions = hasNextVersionPage;
                    versionPage++;
                }
            }
        }
        for (const globalConfig of this.adapter.payload.config.globals.filter(entityHasBlocksField)){
            const globalDoc = await this.adapter.findGlobal({
                slug: globalConfig.slug
            });
            const entity = {
                slug: globalConfig.slug,
                type: 'global',
                blocks: collectBlocksToMigrate({
                    config: this.adapter.payload.config,
                    data: globalDoc,
                    fields: globalConfig.flattenedFields,
                    parentAccessor: [],
                    parentIsLocalized: false
                }),
                originalData: globalDoc
            };
            addEntity(entity);
            this.adapter.payload.logger.info(`Collected global ${globalConfig.slug}`);
            if (globalConfig.versions) {
                let globalVersionPage = 1;
                let hasMoreGlobalVersions = true;
                while(hasMoreGlobalVersions){
                    const { docs: globalVersionDocs, hasNextPage: hasNextGlobalVersionPage } = await this.adapter.findGlobalVersions({
                        global: globalConfig.slug,
                        limit: batchSize,
                        page: globalVersionPage
                    });
                    for (const globalVersionDoc of globalVersionDocs){
                        const entity = {
                            id: globalVersionDoc.id,
                            slug: globalConfig.slug,
                            type: 'globalVersion',
                            blocks: collectBlocksToMigrate({
                                config: this.adapter.payload.config,
                                data: globalVersionDoc,
                                fields: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildGlobalFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildVersionGlobalFields"])(this.adapter.payload.config, globalConfig, true),
                                parentAccessor: [],
                                parentIsLocalized: false
                            }),
                            originalData: globalVersionDoc
                        };
                        addEntity(entity);
                    }
                    this.adapter.payload.logger.info(`Collected ${globalVersionDocs.length} versions from global ${globalConfig.slug} (page ${globalVersionPage})`);
                    hasMoreGlobalVersions = hasNextGlobalVersionPage;
                    globalVersionPage++;
                }
            }
        }
        flushBatch();
        this.adapter.payload.logger.info(`Collected total of ${totalCollected} entities across ${batchIndex} batches`);
    }
    async getMigrationStatements() {
        const { generateDrizzleJson, generateMigration } = this.adapter.requireDrizzleKit();
        const drizzleJsonBefore = await generateDrizzleJson(this.adapter.schema);
        this.adapter.blocksAsJSON = true;
        this.resetSchema();
        await this.adapter.init();
        const drizzleJsonAfter = await generateDrizzleJson(this.adapter.schema);
        this.adapter.blocksAsJSON = false;
        this.resetSchema();
        await this.adapter.init();
        const statements = await acceptDrizzlePrompts(()=>generateMigration(drizzleJsonBefore, drizzleJsonAfter), {
            silenceLogs: true
        });
        const sqlExecute = `await db.${this.executeMethod}(` + 'sql`';
        return {
            statements: this.sanitizeStatements({
                sqlExecute,
                statements
            }),
            writeDrizzleSnapshot (filePath) {
                (0, __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__["writeFileSync"])(`${filePath}.json`, JSON.stringify(drizzleJsonAfter, null, 2));
            }
        };
    }
    async migrateEntitiesFromTempFolder(req, options) {
        const clearBatches = options?.clearBatches ?? true;
        let totalEntities = 0;
        let hasEntities = false;
        for (const entities of this.fetchEntitiesFromJsonBatches()){
            hasEntities = true;
            totalEntities += entities.length;
            this.adapter.payload.logger.info(`Migrating batch with ${entities.length} entities (total: ${totalEntities})`);
            await this.migrateEntities(entities, req);
        }
        if (!hasEntities) {
            this.adapter.payload.logger.warn('No entities found in temp folder to migrate');
            return;
        }
        this.adapter.payload.logger.info(`Completed migration of ${totalEntities} entities from temp folder`);
        if (clearBatches) {
            this.cleanupTempFolder();
        } else {
            this.adapter.payload.logger.info(`Temp folder preserved at ${this.tempFolderPath} (clearBatches: false)`);
        }
    }
    setTempFolder(tempFolderPath) {
        this.tempFolderPath = tempFolderPath;
    }
    async updatePayloadConfigFile() {
        let configPath;
        try {
            configPath = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$config$2f$find$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["findConfig"])();
        } catch  {
            this.adapter.payload.logger.info('updatePayloadConfigFile failed - could not find the payload config. Please set the blocksAsJSON DB adapter property manually to "true"');
            return;
        }
        const configFile = (0, __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__["readFileSync"])(configPath, 'utf-8');
        const source = __TURBOPACK__imported__module__$5b$externals$5d2f$typescript__$5b$external$5d$__$28$typescript$2c$__cjs$2c$__$5b$project$5d2f$node_modules$2f$typescript$29$__["createSourceFile"](configPath, configFile, __TURBOPACK__imported__module__$5b$externals$5d2f$typescript__$5b$external$5d$__$28$typescript$2c$__cjs$2c$__$5b$project$5d2f$node_modules$2f$typescript$29$__["ScriptTarget"].ESNext);
        let hadChanges = false;
        const result = __TURBOPACK__imported__module__$5b$externals$5d2f$typescript__$5b$external$5d$__$28$typescript$2c$__cjs$2c$__$5b$project$5d2f$node_modules$2f$typescript$29$__["transform"](source, [
            (ctx)=>(sourceFile)=>{
                    const factory = ctx.factory;
                    const visit = (node)=>{
                        if (__TURBOPACK__imported__module__$5b$externals$5d2f$typescript__$5b$external$5d$__$28$typescript$2c$__cjs$2c$__$5b$project$5d2f$node_modules$2f$typescript$29$__["isPropertyAssignment"](node) && __TURBOPACK__imported__module__$5b$externals$5d2f$typescript__$5b$external$5d$__$28$typescript$2c$__cjs$2c$__$5b$project$5d2f$node_modules$2f$typescript$29$__["isIdentifier"](node.name) && node.name.text === 'db' && __TURBOPACK__imported__module__$5b$externals$5d2f$typescript__$5b$external$5d$__$28$typescript$2c$__cjs$2c$__$5b$project$5d2f$node_modules$2f$typescript$29$__["isCallExpression"](node.initializer) && node.initializer.arguments.length > 0 && __TURBOPACK__imported__module__$5b$externals$5d2f$typescript__$5b$external$5d$__$28$typescript$2c$__cjs$2c$__$5b$project$5d2f$node_modules$2f$typescript$29$__["isObjectLiteralExpression"](node.initializer.arguments[0])) {
                            const call = node.initializer;
                            const obj = node.initializer.arguments[0];
                            const filteredProps = obj.properties.filter((prop)=>{
                                if (!__TURBOPACK__imported__module__$5b$externals$5d2f$typescript__$5b$external$5d$__$28$typescript$2c$__cjs$2c$__$5b$project$5d2f$node_modules$2f$typescript$29$__["isPropertyAssignment"](prop)) {
                                    return true;
                                }
                                return !(__TURBOPACK__imported__module__$5b$externals$5d2f$typescript__$5b$external$5d$__$28$typescript$2c$__cjs$2c$__$5b$project$5d2f$node_modules$2f$typescript$29$__["isIdentifier"](prop.name) && prop.name.text === 'blocksAsJSON');
                            });
                            const newProperty = factory.createPropertyAssignment('blocksAsJSON', factory.createTrue());
                            hadChanges = true;
                            const newObject = factory.updateObjectLiteralExpression(obj, [
                                ...filteredProps,
                                newProperty
                            ]);
                            const newCall = factory.updateCallExpression(call, call.expression, call.typeArguments, [
                                newObject
                            ]);
                            return factory.updatePropertyAssignment(node, node.name, newCall);
                        }
                        return __TURBOPACK__imported__module__$5b$externals$5d2f$typescript__$5b$external$5d$__$28$typescript$2c$__cjs$2c$__$5b$project$5d2f$node_modules$2f$typescript$29$__["visitEachChild"](node, visit, ctx);
                    };
                    return __TURBOPACK__imported__module__$5b$externals$5d2f$typescript__$5b$external$5d$__$28$typescript$2c$__cjs$2c$__$5b$project$5d2f$node_modules$2f$typescript$29$__["visitNode"](sourceFile, visit);
                }
        ]);
        if (!hadChanges) {
            this.adapter.payload.logger.info('No changes made to payload config. Set blocksAsJSON to true manually.');
            return;
        }
        const printer = __TURBOPACK__imported__module__$5b$externals$5d2f$typescript__$5b$external$5d$__$28$typescript$2c$__cjs$2c$__$5b$project$5d2f$node_modules$2f$typescript$29$__["createPrinter"]({
            newLine: __TURBOPACK__imported__module__$5b$externals$5d2f$typescript__$5b$external$5d$__$28$typescript$2c$__cjs$2c$__$5b$project$5d2f$node_modules$2f$typescript$29$__["NewLineKind"].LineFeed
        });
        let output = printer.printFile(result.transformed[0]);
        try {
            // eslint-disable-next-line @typescript-eslint/consistent-type-imports
            const prettier = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$dynamicImport$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["dynamicImport"])('prettier');
            const configPath = await prettier.resolveConfigFile();
            const config = configPath ? await prettier.resolveConfig(configPath) : {};
            output = await prettier.format(output, {
                ...config,
                parser: 'typescript'
            });
        } catch (err) {
            this.adapter.payload.logger.error({
                err,
                msg: 'Could not format payload config with Prettier'
            });
        }
        (0, __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__["writeFileSync"])(configPath, output, 'utf-8');
        this.adapter.payload.logger.info(`Updated ${configPath} with blocksAsJSON: true`);
    }
}
const createBlocksToJsonMigrator = ({ adapter, executeMethod, sanitizeStatements })=>{
    return new BlocksToJsonMigratorImpl(adapter, sanitizeStatements, executeMethod);
};
const getBlocksToJsonMigrator = (payload)=>{
    const migrator = payload.db.blocksToJsonMigrator;
    if (!migrator) {
        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$APIError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"](`blocksToJsonMigrator is not defined for ${payload.db.packageName}`);
    }
    return migrator;
};
const buildDynamicPredefinedBlocksToJsonMigration = ({ packageName })=>{
    return async ({ filePath, payload })=>{
        const migrator = getBlocksToJsonMigrator(payload);
        const migrationStatements = await migrator.getMigrationStatements();
        migrationStatements.writeDrizzleSnapshot(filePath);
        await migrator.updatePayloadConfigFile();
        const upSQL = `
const migrator = getBlocksToJsonMigrator(payload)
migrator.setTempFolder(TEMP_FOLDER)
await migrator.collectAndSaveEntitiesToBatches(req, { batchSize: BATCH_SIZE })

${migrationStatements.statements}
payload.logger.info("Executed blocks to JSON migration statements.")

await migrator.migrateEntitiesFromTempFolder(req, { clearBatches: true })
  `;
        return {
            imports: `
import { getBlocksToJsonMigrator } from '${packageName}/migration-utils'
import { fileURLToPath } from 'url'
import path from 'path'

const filename = fileURLToPath(import.meta.url)
const dirname = path.dirname(filename)

// Configure migration options (optional)
const BATCH_SIZE = 100 // Number of entities to process per batch
const TEMP_FOLDER = path.resolve(dirname, '${TEMP_FOLDER_NAME}') // Folder path to store migration batch
`,
            upSQL
        };
    };
}; //# sourceMappingURL=blocksToJsonMigrator.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/createGlobal.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "createGlobal",
    ()=>createGlobal
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/upsertRow/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getTransaction.js [app-route] (ecmascript)");
;
;
;
async function createGlobal({ slug, data, req, returning }) {
    const globalConfig = this.payload.globals.config.find((config)=>config.slug === slug);
    const tableName = this.tableNameMap.get((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(globalConfig.slug));
    data.createdAt = new Date().toISOString();
    const db = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTransaction"])(this, req);
    const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["upsertRow"])({
        adapter: this,
        data,
        db,
        fields: globalConfig.flattenedFields,
        globalSlug: slug,
        ignoreResult: returning === false,
        operation: 'create',
        req,
        tableName
    });
    if (returning === false) {
        return null;
    }
    result.globalType = slug;
    return result;
} //# sourceMappingURL=createGlobal.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/createGlobalVersion.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "createGlobalVersion",
    ()=>createGlobalVersion
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/sql/sql.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildGlobalFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/versions/buildGlobalFields.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$getVersionsConfig$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/utilities/getVersionsConfig.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/upsertRow/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getTransaction.js [app-route] (ecmascript)");
;
;
;
;
;
;
async function createGlobalVersion({ autosave, createdAt, globalSlug, publishedLocale, req, returning, select, snapshot, updatedAt, versionData }) {
    const global = this.payload.globals.config.find(({ slug })=>slug === globalSlug);
    const tableName = this.tableNameMap.get(`_${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(global.slug)}${this.versionsSuffix}`);
    const db = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTransaction"])(this, req);
    const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["upsertRow"])({
        adapter: this,
        data: {
            autosave,
            createdAt,
            latest: true,
            publishedLocale,
            snapshot,
            updatedAt,
            version: versionData
        },
        db,
        fields: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildGlobalFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildVersionGlobalFields"])(this.payload.config, global, true),
        globalSlug,
        ignoreResult: returning === false ? 'idOnly' : false,
        operation: 'create',
        req,
        select,
        tableName
    });
    const table = this.tables[tableName];
    if ((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$getVersionsConfig$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["hasDraftsEnabled"])(global)) {
        await this.execute({
            db,
            sql: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`
          UPDATE ${table}
          SET latest = false
          WHERE ${table.id} != ${result.id};
        `
        });
    }
    if (returning === false) {
        return null;
    }
    return result;
} //# sourceMappingURL=createGlobalVersion.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/utilities/createSchemaGenerator.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "createSchemaGenerator",
    ()=>createSchemaGenerator
]);
var __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/fs [external] (fs, cjs)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$fs$2f$promises__$5b$external$5d$__$28$fs$2f$promises$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/fs/promises [external] (fs/promises, cjs)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$path__$5b$external$5d$__$28$path$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/path [external] (path, cjs)");
;
;
;
/**
 * @example
 * console.log(sanitizeObjectKey("oneTwo"));   // oneTwo
 * console.log(sanitizeObjectKey("one-two"));  // 'one-two'
 * console.log(sanitizeObjectKey("_one$Two3")); // _one$Two3
 * console.log(sanitizeObjectKey("3invalid")); // '3invalid'
 */ const sanitizeObjectKey = (key)=>{
    // Regular expression for a valid identifier
    const identifierRegex = /^[a-z_$][\w$]*$/i;
    if (identifierRegex.test(key)) {
        return key;
    }
    return `'${key}'`;
};
/**
 * @example
 * (columns default-valuesID) -> columns['default-valuesID']
 * (columns defaultValues) -> columns.defaultValues
 */ const accessProperty = (objName, key)=>{
    const sanitized = sanitizeObjectKey(key);
    if (sanitized.startsWith("'")) {
        return `${objName}[${sanitized}]`;
    }
    return `${objName}.${key}`;
};
const createSchemaGenerator = ({ columnToCodeConverter, corePackageSuffix, defaultOutputFile, enumImport, schemaImport, tableImport })=>{
    return async function generateSchema({ log = true, outputFile = defaultOutputFile, prettify = true } = {}) {
        const importDeclarations = {};
        const tableDeclarations = [];
        const enumDeclarations = [];
        const relationsDeclarations = [];
        const addImport = (from, name)=>{
            if (!importDeclarations[from]) {
                importDeclarations[from] = new Set();
            }
            importDeclarations[from].add(name);
        };
        const corePackage = `${this.packageName}/drizzle/${corePackageSuffix}`;
        let schemaDeclaration = null;
        if (this.schemaName) {
            addImport(corePackage, schemaImport);
            schemaDeclaration = `export const db_schema = ${schemaImport}('${this.schemaName}')`;
        }
        const enumFn = this.schemaName ? `db_schema.enum` : enumImport;
        const enumsList = [];
        const addEnum = (name, options)=>{
            if (enumsList.some((each)=>each === name)) {
                return;
            }
            enumsList.push(name);
            enumDeclarations.push(`export const ${name} = ${enumFn}('${name}', [${options.map((option)=>`'${option}'`).join(', ')}])`);
        };
        if (this.payload.config.localization && enumImport) {
            addEnum('enum__locales', this.payload.config.localization.localeCodes);
        }
        const tableFn = this.schemaName ? `db_schema.table` : tableImport;
        if (!this.schemaName) {
            addImport(corePackage, tableImport);
        }
        addImport(corePackage, 'index');
        addImport(corePackage, 'uniqueIndex');
        addImport(corePackage, 'foreignKey');
        addImport(`${this.packageName}/drizzle`, 'sql');
        addImport(`${this.packageName}/drizzle`, 'relations');
        for(const tableName in this.rawTables){
            const table = this.rawTables[tableName];
            const extrasDeclarations = [];
            if (table.indexes) {
                for(const key in table.indexes){
                    const index = table.indexes[key];
                    let indexDeclaration = `${index.unique ? 'uniqueIndex' : 'index'}('${index.name}')`;
                    indexDeclaration += `.on(${typeof index.on === 'string' ? `${accessProperty('columns', index.on)}` : `${index.on.map((on)=>`${accessProperty('columns', on)}`).join(', ')}`}),`;
                    extrasDeclarations.push(indexDeclaration);
                }
            }
            if (table.foreignKeys) {
                for(const key in table.foreignKeys){
                    const foreignKey = table.foreignKeys[key];
                    let foreignKeyDeclaration = `foreignKey({
      columns: [${foreignKey.columns.map((col)=>`columns['${col}']`).join(', ')}],
      foreignColumns: [${foreignKey.foreignColumns.map((col)=>`${accessProperty(col.table, col.name)}`).join(', ')}],
      name: '${foreignKey.name}'
    })`;
                    if (foreignKey.onDelete) {
                        foreignKeyDeclaration += `.onDelete('${foreignKey.onDelete}')`;
                    }
                    if (foreignKey.onUpdate) {
                        foreignKeyDeclaration += `.onUpdate('${foreignKey.onDelete}')`;
                    }
                    foreignKeyDeclaration += ',';
                    extrasDeclarations.push(foreignKeyDeclaration);
                }
            }
            const tableCode = `
export const ${tableName} = ${tableFn}('${tableName}', {
${Object.entries(table.columns).map(([key, column])=>`  ${sanitizeObjectKey(key)}: ${columnToCodeConverter({
                    adapter: this,
                    addEnum,
                    addImport,
                    column,
                    locales: this.payload.config.localization ? this.payload.config.localization.localeCodes : undefined,
                    tableKey: tableName
                })},`).join('\n')}
}${extrasDeclarations.length ? `, (columns) => [
    ${extrasDeclarations.join(' ')}
]` : ''}
)
`;
            tableDeclarations.push(tableCode);
        }
        for(const tableName in this.rawRelations){
            const relations = this.rawRelations[tableName];
            const properties = [];
            for(const key in relations){
                const relation = relations[key];
                let declaration;
                if (relation.type === 'one') {
                    declaration = `${sanitizeObjectKey(key)}: one(${relation.to}, {
    ${relation.fields.some((field)=>field.table !== tableName) ? '// @ts-expect-error Drizzle TypeScript bug for ONE relationships with a field in different table' : ''}
    fields: [${relation.fields.map((field)=>`${accessProperty(field.table, field.name)}`).join(', ')}],
    references: [${relation.references.map((col)=>`${accessProperty(relation.to, col)}`).join(', ')}],
    ${relation.relationName ? `relationName: '${relation.relationName}',` : ''}
    }),`;
                } else {
                    declaration = `${sanitizeObjectKey(key)}: many(${relation.to}, {
            ${relation.relationName ? `relationName: '${relation.relationName}',` : ''}
    }),`;
                }
                properties.push(declaration);
            }
            // beautify / lintify relations callback output, when no many for example, don't add it
            const args = [];
            if (Object.values(relations).some((rel)=>rel.type === 'one')) {
                args.push('one');
            }
            if (Object.values(relations).some((rel)=>rel.type === 'many')) {
                args.push('many');
            }
            const arg = args.length ? `{ ${args.join(', ')} }` : '';
            const declaration = `export const relations_${tableName} = relations(${tableName}, (${arg}) => ({
  ${properties.join('\n    ')}
      }))`;
            relationsDeclarations.push(declaration);
        }
        if (enumDeclarations.length && !this.schemaName) {
            addImport(corePackage, enumImport);
        }
        const importDeclarationsSanitized = [];
        for(const moduleName in importDeclarations){
            const moduleImports = importDeclarations[moduleName];
            importDeclarationsSanitized.push(`import { ${Array.from(moduleImports).join(', ')} } from '${moduleName}'`);
        }
        const schemaType = `
type DatabaseSchema = {
  ${[
            this.schemaName ? 'db_schema' : null,
            ...enumsList,
            ...Object.keys(this.rawTables),
            ...Object.keys(this.rawRelations).map((table)=>`relations_${table}`)
        ].filter(Boolean).map((name)=>`${name}: typeof ${name}`).join('\n  ')}
}
    `;
        const finalDeclaration = `
declare module '${this.packageName}' {
  export interface GeneratedDatabaseSchema {
    schema: DatabaseSchema
  }
}
    `;
        const warning = `
/* tslint:disable */
/* eslint-disable */
/**
 * This file was automatically generated by Payload.
 * DO NOT MODIFY IT BY HAND. Instead, modify your source Payload config,
 * and re-run \`payload generate:db-schema\` to regenerate this file.
 */
`;
        const importTypes = `import type {} from '${this.packageName}'`;
        let code = [
            warning,
            importTypes,
            ...importDeclarationsSanitized,
            schemaDeclaration,
            ...enumDeclarations,
            ...tableDeclarations,
            ...relationsDeclarations,
            schemaType,
            finalDeclaration
        ].filter(Boolean).join('\n');
        if (!outputFile) {
            const cwd = process.cwd();
            const srcDir = __TURBOPACK__imported__module__$5b$externals$5d2f$path__$5b$external$5d$__$28$path$2c$__cjs$29$__["default"].resolve(cwd, 'src');
            if ((0, __TURBOPACK__imported__module__$5b$externals$5d2f$fs__$5b$external$5d$__$28$fs$2c$__cjs$29$__["existsSync"])(srcDir)) {
                outputFile = __TURBOPACK__imported__module__$5b$externals$5d2f$path__$5b$external$5d$__$28$path$2c$__cjs$29$__["default"].resolve(srcDir, 'payload-generated-schema.ts');
            } else {
                outputFile = __TURBOPACK__imported__module__$5b$externals$5d2f$path__$5b$external$5d$__$28$path$2c$__cjs$29$__["default"].resolve(cwd, 'payload-generated-schema.ts');
            }
        }
        if (prettify) {
            try {
                const prettier = await eval('import("prettier")');
                const configPath = await prettier.resolveConfigFile();
                const config = configPath ? await prettier.resolveConfig(configPath) : {};
                code = await prettier.format(code, {
                    ...config,
                    parser: 'typescript'
                });
            } catch  {
            /* empty */ }
        }
        await (0, __TURBOPACK__imported__module__$5b$externals$5d2f$fs$2f$promises__$5b$external$5d$__$28$fs$2f$promises$2c$__cjs$29$__["writeFile"])(outputFile, code, 'utf-8');
        if (log) {
            this.payload.logger.info(`Written ${outputFile}`);
        }
    };
}; //# sourceMappingURL=createSchemaGenerator.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/createVersion.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "createVersion",
    ()=>createVersion
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/sql/sql.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildCollectionFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/versions/buildCollectionFields.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$getVersionsConfig$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/utilities/getVersionsConfig.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/upsertRow/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getTransaction.js [app-route] (ecmascript)");
;
;
;
;
;
;
async function createVersion({ autosave, collectionSlug, createdAt, parent, publishedLocale, req, returning, select, snapshot, updatedAt, versionData }) {
    const collection = this.payload.collections[collectionSlug].config;
    if (collection.versions.drafts) {
        if (typeof select === 'object') {
            select.updatedAt = true;
        }
    }
    const defaultTableName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(collection.slug);
    const tableName = this.tableNameMap.get(`_${defaultTableName}${this.versionsSuffix}`);
    const version = {
        ...versionData
    };
    if (version.id) {
        delete version.id;
    }
    const data = {
        autosave,
        createdAt,
        latest: true,
        parent,
        publishedLocale,
        snapshot,
        updatedAt,
        version
    };
    const db = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTransaction"])(this, req);
    const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["upsertRow"])({
        adapter: this,
        collectionSlug,
        data,
        db,
        fields: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildCollectionFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildVersionCollectionFields"])(this.payload.config, collection, true),
        ignoreResult: returning === false ? 'idOnly' : undefined,
        operation: 'create',
        req,
        select,
        tableName
    });
    const table = this.tables[tableName];
    if ((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$getVersionsConfig$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["hasDraftsEnabled"])(collection)) {
        await this.execute({
            db,
            sql: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`
        UPDATE ${table}
        SET latest = false
        WHERE ${table.id} != ${result.id}
          AND ${table.parent} = ${parent}
          AND ${table.updatedAt} < ${result.updatedAt || updatedAt}
      `
        });
    }
    if (returning === false) {
        return null;
    }
    return result;
} //# sourceMappingURL=createVersion.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/queries/selectDistinct.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

/**
 * Selects distinct records from a table only if there are joins that need to be used, otherwise return null
 */ __turbopack_context__.s([
    "selectDistinct",
    ()=>selectDistinct
]);
const selectDistinct = ({ adapter, db, forceRun, hasAggregates, joins, query: queryModifier = ({ query })=>query, selectFields, tableName, where })=>{
    if (forceRun || Object.keys(joins).length > 0) {
        let query;
        const table = adapter.tables[tableName];
        // With hasAggregate we use groupBy so we don't need to use selectDistinct in that case
        // @ts-expect-error - Drizzle types are not accurate here
        let selectFunc = hasAggregates ? db.select : db.selectDistinct;
        // bind this otherwise we get TypeError: Cannot read properties of undefined (reading 'session')
        selectFunc = selectFunc.bind(db);
        query = selectFunc(selectFields).from(table).$dynamic();
        if (where) {
            query = query.where(where);
        }
        joins.forEach(({ type, condition, table })=>{
            query = query[type ?? 'leftJoin'](table, condition);
        });
        if (hasAggregates && '_selected' in selectFields) {
            // @ts-expect-error - Drizzle types are not accurate here
            query = query.groupBy(selectFields['_selected']);
        }
        return queryModifier({
            query
        });
    }
}; //# sourceMappingURL=selectDistinct.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/find/findMany.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "findMany",
    ()=>findMany
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/sql/expressions/conditions.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$buildQuery$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/queries/buildQuery.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$selectDistinct$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/queries/selectDistinct.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$read$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/transform/read/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getNameFromDrizzleTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getNameFromDrizzleTable.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getTransaction.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$find$2f$buildFindManyArgs$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/find/buildFindManyArgs.js [app-route] (ecmascript)");
;
;
;
;
;
;
;
const findMany = async function find({ adapter, collectionSlug, draftsEnabled, fields, joins: joinQuery, limit: limitArg, locale, page = 1, pagination, req, select, sort, tableName, versions, where: whereArg }) {
    let limit = limitArg;
    let totalDocs;
    let totalPages;
    let hasPrevPage;
    let hasNextPage;
    let pagingCounter;
    const offset = (page - 1) * limit;
    if (limit === 0) {
        pagination = false;
        limit = undefined;
    }
    const { joins, orderBy, selectFields, where } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$buildQuery$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildQuery"])({
        adapter,
        fields,
        locale,
        sort,
        tableName,
        where: whereArg
    });
    const orderedIDMap = {};
    let orderedIDs;
    const findManyArgs = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$find$2f$buildFindManyArgs$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildFindManyArgs"])({
        adapter,
        collectionSlug,
        depth: 0,
        draftsEnabled,
        fields,
        joinQuery,
        joins,
        locale,
        select,
        tableName,
        versions
    });
    if (orderBy) {
        for(const key in selectFields){
            const column = selectFields[key];
            if (!column || column.primary) {
                continue;
            }
            if (!orderBy.some((col)=>col.column.name === column.name && (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getNameFromDrizzleTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getNameFromDrizzleTable"])(col.column.table) === (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getNameFromDrizzleTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getNameFromDrizzleTable"])(column.table))) {
                delete selectFields[key];
            }
        }
    }
    const db = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTransaction"])(adapter, req);
    const selectDistinctResult = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$selectDistinct$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["selectDistinct"])({
        adapter,
        db,
        joins,
        query: ({ query })=>{
            if (orderBy) {
                query = query.orderBy(()=>orderBy.map(({ column, order })=>order(column)));
            }
            return query.offset(offset).limit(limit);
        },
        selectFields,
        tableName,
        where
    });
    if (selectDistinctResult) {
        if (selectDistinctResult.length === 0) {
            return {
                docs: [],
                hasNextPage: false,
                hasPrevPage: false,
                limit,
                nextPage: null,
                page: 1,
                pagingCounter: 0,
                prevPage: null,
                totalDocs: 0,
                totalPages: 0
            };
        } else {
            // set the id in an object for sorting later
            selectDistinctResult.forEach(({ id }, i)=>{
                orderedIDMap[id] = i;
            });
            orderedIDs = Object.keys(orderedIDMap);
            findManyArgs.where = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["inArray"])(adapter.tables[tableName].id, orderedIDs);
        }
    } else {
        findManyArgs.limit = limit;
        findManyArgs.offset = offset;
        findManyArgs.orderBy = ()=>orderBy.map(({ column, order })=>order(column));
        if (where) {
            findManyArgs.where = where;
        }
    }
    const findPromise = db.query[tableName].findMany(findManyArgs);
    if (pagination !== false && (orderedIDs ? orderedIDs?.length <= limit : true)) {
        totalDocs = await adapter.countDistinct({
            db,
            joins,
            tableName,
            where
        });
        totalPages = typeof limit === 'number' && limit !== 0 ? Math.ceil(totalDocs / limit) : 1;
        hasPrevPage = page > 1;
        hasNextPage = totalPages > page;
        pagingCounter = (page - 1) * limit + 1;
    }
    const rawDocs = await findPromise;
    // sort rawDocs from selectQuery
    if (Object.keys(orderedIDMap).length > 0) {
        rawDocs.sort((a, b)=>orderedIDMap[a.id] - orderedIDMap[b.id]);
    }
    if (pagination === false || !totalDocs) {
        totalDocs = rawDocs.length;
        totalPages = 1;
        pagingCounter = 1;
        hasPrevPage = false;
        hasNextPage = false;
    }
    const docs = rawDocs.map((data)=>{
        return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$read$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["transform"])({
            adapter,
            config: adapter.payload.config,
            data,
            fields,
            joinQuery,
            tableName
        });
    });
    return {
        docs,
        hasNextPage,
        hasPrevPage,
        limit: limitArg,
        nextPage: hasNextPage ? page + 1 : null,
        page,
        pagingCounter,
        prevPage: hasPrevPage ? page - 1 : null,
        totalDocs,
        totalPages
    };
}; //# sourceMappingURL=findMany.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/deleteMany.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "deleteMany",
    ()=>deleteMany
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/sql/expressions/conditions.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$find$2f$findMany$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/find/findMany.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$buildQuery$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/queries/buildQuery.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getTransaction.js [app-route] (ecmascript)");
;
;
;
;
;
const deleteMany = async function deleteMany({ collection, req, where: whereArg }) {
    const collectionConfig = this.payload.collections[collection].config;
    const tableName = this.tableNameMap.get((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(collectionConfig.slug));
    const table = this.tables[tableName];
    const { joins, where } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$buildQuery$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildQuery"])({
        adapter: this,
        fields: collectionConfig.flattenedFields,
        locale: req?.locale,
        tableName,
        where: whereArg
    });
    let whereToUse = where;
    if (joins?.length) {
        // Difficult to support joins (through where referencing other tables) in deleteMany. => 2 separate queries.
        // We can look into supporting this using one single query (through a subquery) in the future, though that's difficult to do in a generic way.
        const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$find$2f$findMany$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["findMany"])({
            adapter: this,
            fields: collectionConfig.flattenedFields,
            joins: false,
            limit: 0,
            locale: req?.locale,
            page: 1,
            pagination: false,
            req,
            select: {
                id: true
            },
            tableName,
            where: whereArg
        });
        whereToUse = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["inArray"])(table.id, result.docs.map((doc)=>doc.id));
    }
    const db = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTransaction"])(this, req);
    await this.deleteWhere({
        db,
        tableName,
        where: whereToUse
    });
}; //# sourceMappingURL=deleteMany.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/deleteOne.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "deleteOne",
    ()=>deleteOne
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/sql/expressions/conditions.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$find$2f$buildFindManyArgs$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/find/buildFindManyArgs.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$buildQuery$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/queries/buildQuery.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$selectDistinct$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/queries/selectDistinct.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$read$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/transform/read/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getTransaction.js [app-route] (ecmascript)");
;
;
;
;
;
;
;
const deleteOne = async function deleteOne({ collection: collectionSlug, req, returning, select, where: whereArg }) {
    const collection = this.payload.collections[collectionSlug].config;
    const tableName = this.tableNameMap.get((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(collection.slug));
    let docToDelete;
    const { joins, selectFields, where } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$buildQuery$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildQuery"])({
        adapter: this,
        fields: collection.flattenedFields,
        locale: req?.locale,
        tableName,
        where: whereArg
    });
    const db = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTransaction"])(this, req);
    const selectDistinctResult = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$selectDistinct$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["selectDistinct"])({
        adapter: this,
        db,
        joins,
        query: ({ query })=>query.limit(1),
        selectFields,
        tableName,
        where
    });
    if (selectDistinctResult?.[0]?.id) {
        docToDelete = await db.query[tableName].findFirst({
            where: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(this.tables[tableName].id, selectDistinctResult[0].id)
        });
    } else {
        const findManyArgs = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$find$2f$buildFindManyArgs$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildFindManyArgs"])({
            adapter: this,
            depth: 0,
            fields: collection.flattenedFields,
            joinQuery: false,
            select,
            tableName
        });
        findManyArgs.where = where;
        docToDelete = await db.query[tableName].findFirst(findManyArgs);
    }
    if (!docToDelete) {
        return null;
    }
    const result = returning === false ? null : (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$transform$2f$read$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["transform"])({
        adapter: this,
        config: this.payload.config,
        data: docToDelete,
        fields: collection.flattenedFields,
        joinQuery: false,
        tableName
    });
    await this.deleteWhere({
        db,
        tableName,
        where: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["eq"])(this.tables[tableName].id, docToDelete.id)
    });
    return result;
}; //# sourceMappingURL=deleteOne.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/deleteVersions.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "deleteVersions",
    ()=>deleteVersions
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/sql/expressions/conditions.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$APIError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/errors/APIError.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildCollectionFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/versions/buildCollectionFields.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildGlobalFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/versions/buildGlobalFields.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$find$2f$findMany$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/find/findMany.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getTransaction.js [app-route] (ecmascript)");
;
;
;
;
;
const deleteVersions = async function deleteVersion({ collection: collectionSlug, globalSlug, locale, req, where: where }) {
    let tableName;
    let fields;
    if (globalSlug) {
        const globalConfig = this.payload.globals.config.find(({ slug })=>slug === globalSlug);
        tableName = this.tableNameMap.get(`_${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(globalSlug)}${this.versionsSuffix}`);
        fields = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildGlobalFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildVersionGlobalFields"])(this.payload.config, globalConfig, true);
    } else if (collectionSlug) {
        const collectionConfig = this.payload.collections[collectionSlug].config;
        tableName = this.tableNameMap.get(`_${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(collectionConfig.slug)}${this.versionsSuffix}`);
        fields = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildCollectionFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildVersionCollectionFields"])(this.payload.config, collectionConfig, true);
    } else {
        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$APIError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"]('Either collection or globalSlug must be passed.');
    }
    const { docs } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$find$2f$findMany$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["findMany"])({
        adapter: this,
        fields,
        joins: false,
        limit: 0,
        locale,
        page: 1,
        pagination: false,
        req,
        tableName,
        where
    });
    const ids = [];
    docs.forEach((doc)=>{
        ids.push(doc.id);
    });
    if (ids.length > 0) {
        const db = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTransaction"])(this, req);
        await this.deleteWhere({
            db,
            tableName,
            where: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$expressions$2f$conditions$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["inArray"])(this.tables[tableName].id, ids)
        });
    }
    return docs;
}; //# sourceMappingURL=deleteVersions.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/destroy.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

// eslint-disable-next-line @typescript-eslint/require-await
__turbopack_context__.s([
    "destroy",
    ()=>destroy
]);
const destroy = async function destroy() {
    if (this.enums) {
        this.enums = {};
    }
    this.schema = {};
    this.tables = {};
    this.relations = {};
    this.fieldConstraints = {};
    this.drizzle = undefined;
    this.initializing = new Promise((res, rej)=>{
        this.resolveInitializing = res;
        this.rejectInitializing = rej;
    });
}; //# sourceMappingURL=destroy.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/find.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "find",
    ()=>find
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$find$2f$findMany$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/find/findMany.js [app-route] (ecmascript)");
;
;
const find = async function find({ collection, draftsEnabled, joins, limit, locale, page = 1, pagination, req, select, sort: sortArg, where }) {
    const collectionConfig = this.payload.collections[collection].config;
    const sort = sortArg !== undefined && sortArg !== null ? sortArg : collectionConfig.defaultSort;
    const tableName = this.tableNameMap.get((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(collectionConfig.slug));
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$find$2f$findMany$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["findMany"])({
        adapter: this,
        collectionSlug: collectionConfig.slug,
        draftsEnabled,
        fields: collectionConfig.flattenedFields,
        joins,
        limit,
        locale,
        page,
        pagination,
        req,
        select,
        sort,
        tableName,
        where
    });
}; //# sourceMappingURL=find.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/findDistinct.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "findDistinct",
    ()=>findDistinct
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$functions$2f$aggregate$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/sql/functions/aggregate.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/sql/sql.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$getFieldByPath$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/utilities/getFieldByPath.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$buildQuery$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/queries/buildQuery.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$selectDistinct$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/queries/selectDistinct.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getTransaction.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$rawConstraint$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/rawConstraint.js [app-route] (ecmascript)");
;
;
;
;
;
;
;
const getOrderColumn = (orderBy, selectFields, joins)=>{
    if (orderBy.length === 0) {
        return null;
    }
    if (orderBy[0].column === selectFields['_selected']) {
        return null;
    }
    if (joins.length > 0) {
        return orderBy[0].column;
    }
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$functions$2f$aggregate$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["max"])(orderBy[0]?.column).as('_order');
};
const findDistinct = async function(args) {
    const collectionConfig = this.payload.collections[args.collection].config;
    const page = args.page || 1;
    const offset = args.limit ? (page - 1) * args.limit : undefined;
    const tableName = this.tableNameMap.get((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(collectionConfig.slug));
    const { joins, orderBy, selectFields, where } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$buildQuery$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildQuery"])({
        adapter: this,
        fields: collectionConfig.flattenedFields,
        locale: args.locale,
        sort: args.sort ?? args.field,
        tableName,
        where: {
            and: [
                args.where ?? {},
                {
                    [args.field]: {
                        equals: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$rawConstraint$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["DistinctSymbol"]
                    }
                }
            ]
        }
    });
    orderBy.pop();
    const db = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTransaction"])(this, args.req);
    const _order = getOrderColumn(orderBy, selectFields, joins);
    const selectDistinctResult = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$selectDistinct$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["selectDistinct"])({
        adapter: this,
        db,
        forceRun: true,
        hasAggregates: Boolean(_order) && !joins.length,
        joins,
        query: ({ query })=>{
            if (_order && orderBy.length > 0 && !joins.length) {
                query = query.orderBy(orderBy[0].order(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`_order`));
            } else {
                query = query.orderBy(()=>orderBy.map(({ column, order })=>order(column)));
            }
            if (args.limit) {
                if (offset) {
                    query = query.offset(offset);
                }
                query = query.limit(args.limit);
            }
            return query;
        },
        selectFields: {
            _selected: selectFields['_selected'],
            ..._order ? {
                _order
            } : {}
        },
        tableName,
        where
    });
    const field = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$getFieldByPath$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getFieldByPath"])({
        config: this.payload.config,
        fields: collectionConfig.flattenedFields,
        includeRelationships: true,
        path: args.field
    })?.field;
    if (field && 'relationTo' in field && Array.isArray(field.relationTo)) {
        for (const row of selectDistinctResult){
            const json = JSON.parse(row._selected);
            const relationTo = Object.keys(json).find((each)=>Boolean(json[each]));
            const value = json[relationTo];
            if (!value) {
                row._selected = null;
            } else {
                row._selected = {
                    relationTo,
                    value
                };
            }
        }
    }
    const values = selectDistinctResult.map((each)=>({
            [args.field]: each._selected
        }));
    if (args.limit) {
        const totalDocs = await this.countDistinct({
            column: selectFields['_selected'],
            db,
            joins,
            tableName,
            where
        });
        const totalPages = Math.ceil(totalDocs / args.limit);
        const hasPrevPage = page > 1;
        const hasNextPage = totalPages > page;
        const pagingCounter = (page - 1) * args.limit + 1;
        return {
            hasNextPage,
            hasPrevPage,
            limit: args.limit,
            nextPage: hasNextPage ? page + 1 : null,
            page,
            pagingCounter,
            prevPage: hasPrevPage ? page - 1 : null,
            totalDocs,
            totalPages,
            values
        };
    }
    return {
        hasNextPage: false,
        hasPrevPage: false,
        limit: 0,
        page: 1,
        pagingCounter: 1,
        totalDocs: values.length,
        totalPages: 1,
        values
    };
}; //# sourceMappingURL=findDistinct.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/findGlobal.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "findGlobal",
    ()=>findGlobal
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$find$2f$findMany$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/find/findMany.js [app-route] (ecmascript)");
;
;
const findGlobal = async function findGlobal({ slug, locale, req, select, where }) {
    const globalConfig = this.payload.globals.config.find((config)=>config.slug === slug);
    const tableName = this.tableNameMap.get((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(globalConfig.slug));
    const { docs: [doc] } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$find$2f$findMany$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["findMany"])({
        adapter: this,
        fields: globalConfig.flattenedFields,
        limit: 1,
        locale,
        pagination: false,
        req,
        select,
        tableName,
        where
    });
    if (doc) {
        doc.globalType = slug;
        return doc;
    }
    return {};
}; //# sourceMappingURL=findGlobal.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/findGlobalVersions.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "findGlobalVersions",
    ()=>findGlobalVersions
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildGlobalFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/versions/buildGlobalFields.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$find$2f$findMany$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/find/findMany.js [app-route] (ecmascript)");
;
;
;
const findGlobalVersions = async function findGlobalVersions({ global, limit, locale, page, pagination, req, select, sort: sortArg, where }) {
    const globalConfig = this.payload.globals.config.find(({ slug })=>slug === global);
    const sort = sortArg !== undefined && sortArg !== null ? sortArg : '-createdAt';
    const tableName = this.tableNameMap.get(`_${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(globalConfig.slug)}${this.versionsSuffix}`);
    const fields = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildGlobalFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildVersionGlobalFields"])(this.payload.config, globalConfig, true);
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$find$2f$findMany$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["findMany"])({
        adapter: this,
        fields,
        limit,
        locale,
        page,
        pagination,
        req,
        select,
        sort,
        tableName,
        where
    });
}; //# sourceMappingURL=findGlobalVersions.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/findOne.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "findOne",
    ()=>findOne
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$find$2f$findMany$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/find/findMany.js [app-route] (ecmascript)");
;
;
async function findOne({ collection, draftsEnabled, joins, locale, req, select, where }) {
    const collectionConfig = this.payload.collections[collection].config;
    const tableName = this.tableNameMap.get((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(collectionConfig.slug));
    const { docs } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$find$2f$findMany$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["findMany"])({
        adapter: this,
        collectionSlug: collection,
        draftsEnabled,
        fields: collectionConfig.flattenedFields,
        joins,
        limit: 1,
        locale,
        page: 1,
        pagination: false,
        req,
        select,
        sort: undefined,
        tableName,
        where
    });
    return docs?.[0] || null;
} //# sourceMappingURL=findOne.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/findVersions.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "findVersions",
    ()=>findVersions
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildCollectionFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/versions/buildCollectionFields.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$find$2f$findMany$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/find/findMany.js [app-route] (ecmascript)");
;
;
;
const findVersions = async function findVersions({ collection, limit, locale, page, pagination, req, select, sort: sortArg, where }) {
    const collectionConfig = this.payload.collections[collection].config;
    const sort = sortArg !== undefined && sortArg !== null ? sortArg : collectionConfig.defaultSort;
    const tableName = this.tableNameMap.get(`_${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(collectionConfig.slug)}${this.versionsSuffix}`);
    const fields = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildCollectionFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildVersionCollectionFields"])(this.payload.config, collectionConfig, true);
    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$find$2f$findMany$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["findMany"])({
        adapter: this,
        fields,
        joins: false,
        limit,
        locale,
        page,
        pagination,
        req,
        select,
        sort,
        tableName,
        where
    });
}; //# sourceMappingURL=findVersions.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/utilities/migrationTableExists.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "migrationTableExists",
    ()=>migrationTableExists
]);
const migrationTableExists = async (adapter, db)=>{
    let statement;
    if (adapter.name === 'postgres') {
        const prependSchema = adapter.schemaName ? `"${adapter.schemaName}".` : '';
        statement = `SELECT to_regclass('${prependSchema}"payload_migrations"') AS exists;`;
    }
    if (adapter.name === 'sqlite') {
        statement = `
      SELECT CASE
               WHEN COUNT(*) > 0 THEN 1
               ELSE 0
               END AS 'exists'
      FROM sqlite_master
      WHERE type = 'table'
        AND name = 'payload_migrations';`;
    }
    const result = await adapter.execute({
        drizzle: db ?? adapter.drizzle,
        raw: statement
    });
    const [row] = result.rows;
    return row && typeof row === 'object' && 'exists' in row && !!row.exists;
}; //# sourceMappingURL=migrationTableExists.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/utilities/parseError.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

/**
 * Format error message with hint if available
 */ __turbopack_context__.s([
    "parseError",
    ()=>parseError
]);
const parseError = (err, msg)=>{
    let formattedMsg = `${msg}`;
    if (err instanceof Error) {
        formattedMsg += ` ${err.message}.`;
        // Check if the error has a hint property
        if ('hint' in err && typeof err.hint === 'string') {
            formattedMsg += ` ${err.hint}.`;
        }
    }
    return formattedMsg;
}; //# sourceMappingURL=parseError.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/migrate.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "migrate",
    ()=>migrate
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$commitTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/utilities/commitTransaction.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$createLocalReq$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/utilities/createLocalReq.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$initTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/utilities/initTransaction.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$killTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/utilities/killTransaction.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$database$2f$migrations$2f$readMigrationFiles$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/database/migrations/readMigrationFiles.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$prompts$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/prompts/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getTransaction.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$migrationTableExists$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/migrationTableExists.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$parseError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/parseError.js [app-route] (ecmascript)");
;
;
;
;
;
const migrate = async function migrate(args) {
    const { payload } = this;
    const migrationFiles = args?.migrations || await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$database$2f$migrations$2f$readMigrationFiles$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["readMigrationFiles"])({
        payload
    });
    if (!migrationFiles.length) {
        payload.logger.info({
            msg: 'No migrations to run.'
        });
        return;
    }
    if ('createExtensions' in this && typeof this.createExtensions === 'function') {
        await this.createExtensions();
    }
    let latestBatch = 0;
    let migrationsInDB = [];
    const hasMigrationTable = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$migrationTableExists$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["migrationTableExists"])(this);
    if (hasMigrationTable) {
        ;
        ({ docs: migrationsInDB } = await payload.find({
            collection: 'payload-migrations',
            limit: 0,
            sort: '-name'
        }));
        if (migrationsInDB.find((m)=>m.batch === -1)) {
            const { confirm: runMigrations } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$prompts$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])({
                name: 'confirm',
                type: 'confirm',
                initial: false,
                message: "It looks like you've run Payload in dev mode, meaning you've dynamically pushed changes to your database.\n\n" + "If you'd like to run migrations, data loss will occur. Would you like to proceed?"
            }, {
                onCancel: ()=>{
                    process.exit(0);
                }
            });
            if (!runMigrations) {
                process.exit(0);
            }
            // ignore the dev migration so that the latest batch number increments correctly
            migrationsInDB = migrationsInDB.filter((m)=>m.batch !== -1);
        }
        if (Number(migrationsInDB?.[0]?.batch) > 0) {
            latestBatch = Number(migrationsInDB[0]?.batch);
        }
    }
    const newBatch = latestBatch + 1;
    // Execute 'up' function for each migration sequentially
    for (const migration of migrationFiles){
        const alreadyRan = migrationsInDB.find((existing)=>existing.name === migration.name);
        // If already ran, skip
        if (alreadyRan) {
            continue;
        }
        await runMigrationFile(payload, migration, newBatch);
    }
};
async function runMigrationFile(payload, migration, batch) {
    const start = Date.now();
    const req = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$createLocalReq$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createLocalReq"])({}, payload);
    payload.logger.info({
        msg: `Migrating: ${migration.name}`
    });
    try {
        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$initTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["initTransaction"])(req);
        const db = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTransaction"])(payload.db, req);
        await migration.up({
            db,
            payload,
            req
        });
        payload.logger.info({
            msg: `Migrated:  ${migration.name} (${Date.now() - start}ms)`
        });
        await payload.create({
            collection: 'payload-migrations',
            data: {
                name: migration.name,
                batch
            },
            req
        });
        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$commitTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["commitTransaction"])(req);
    } catch (err) {
        await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$killTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["killTransaction"])(req);
        payload.logger.error({
            err,
            msg: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$parseError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["parseError"])(err, `Error running migration ${migration.name}`)
        });
        process.exit(1);
    }
} //# sourceMappingURL=migrate.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/migrateDown.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "migrateDown",
    ()=>migrateDown
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$commitTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/utilities/commitTransaction.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$createLocalReq$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/utilities/createLocalReq.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$database$2f$migrations$2f$getMigrations$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/database/migrations/getMigrations.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$initTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/utilities/initTransaction.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$killTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/utilities/killTransaction.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$database$2f$migrations$2f$readMigrationFiles$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/database/migrations/readMigrationFiles.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getTransaction.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$migrationTableExists$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/migrationTableExists.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$parseError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/parseError.js [app-route] (ecmascript)");
;
;
;
;
async function migrateDown() {
    const { payload } = this;
    const migrationFiles = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$database$2f$migrations$2f$readMigrationFiles$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["readMigrationFiles"])({
        payload
    });
    const { existingMigrations, latestBatch } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$database$2f$migrations$2f$getMigrations$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getMigrations"])({
        payload
    });
    if (!existingMigrations?.length) {
        payload.logger.info({
            msg: 'No migrations to rollback.'
        });
        return;
    }
    payload.logger.info({
        msg: `Rolling back batch ${latestBatch} consisting of ${existingMigrations.length} migration(s).`
    });
    const latestBatchMigrations = existingMigrations.filter(({ batch })=>batch === latestBatch);
    for (const migration of latestBatchMigrations){
        const migrationFile = migrationFiles.find((m)=>m.name === migration.name);
        if (!migrationFile) {
            throw new Error(`Migration ${migration.name} not found locally.`);
        }
        const start = Date.now();
        const req = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$createLocalReq$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createLocalReq"])({}, payload);
        try {
            payload.logger.info({
                msg: `Migrating down: ${migrationFile.name}`
            });
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$initTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["initTransaction"])(req);
            const db = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTransaction"])(this, req);
            await migrationFile.down({
                db,
                payload,
                req
            });
            payload.logger.info({
                msg: `Migrated down:  ${migrationFile.name} (${Date.now() - start}ms)`
            });
            const tableExists = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$migrationTableExists$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["migrationTableExists"])(this, db);
            if (tableExists) {
                await payload.delete({
                    id: migration.id,
                    collection: 'payload-migrations',
                    req
                });
            }
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$commitTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["commitTransaction"])(req);
        } catch (err) {
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$killTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["killTransaction"])(req);
            payload.logger.error({
                err,
                msg: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$parseError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["parseError"])(err, `Error migrating down ${migrationFile.name}. Rolling back.`)
            });
            process.exit(1);
        }
    }
} //# sourceMappingURL=migrateDown.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/migrateFresh.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "migrateFresh",
    ()=>migrateFresh
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$commitTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/utilities/commitTransaction.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$createLocalReq$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/utilities/createLocalReq.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$initTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/utilities/initTransaction.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$killTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/utilities/killTransaction.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$database$2f$migrations$2f$readMigrationFiles$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/database/migrations/readMigrationFiles.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$prompts$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/prompts/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getTransaction.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$parseError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/parseError.js [app-route] (ecmascript)");
;
;
;
;
async function migrateFresh({ forceAcceptWarning = false }) {
    const { payload } = this;
    if (forceAcceptWarning === false) {
        const { confirm: acceptWarning } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$prompts$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])({
            name: 'confirm',
            type: 'confirm',
            initial: false,
            message: `WARNING: This will drop your database and run all migrations. Are you sure you want to proceed?`
        }, {
            onCancel: ()=>{
                process.exit(0);
            }
        });
        if (!acceptWarning) {
            process.exit(0);
        }
    }
    payload.logger.info({
        msg: `Dropping database.`
    });
    await this.dropDatabase({
        adapter: this
    });
    const migrationFiles = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$database$2f$migrations$2f$readMigrationFiles$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["readMigrationFiles"])({
        payload
    });
    payload.logger.debug({
        msg: `Found ${migrationFiles.length} migration files.`
    });
    const req = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$createLocalReq$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createLocalReq"])({}, payload);
    if ('createExtensions' in this && typeof this.createExtensions === 'function') {
        await this.createExtensions();
    }
    // Run all migrate up
    for (const migration of migrationFiles){
        payload.logger.info({
            msg: `Migrating: ${migration.name}`
        });
        try {
            const start = Date.now();
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$initTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["initTransaction"])(req);
            const db = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTransaction"])(this, req);
            await migration.up({
                db,
                payload,
                req
            });
            await payload.create({
                collection: 'payload-migrations',
                data: {
                    name: migration.name,
                    batch: 1
                },
                req
            });
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$commitTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["commitTransaction"])(req);
            payload.logger.info({
                msg: `Migrated:  ${migration.name} (${Date.now() - start}ms)`
            });
        } catch (err) {
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$killTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["killTransaction"])(req);
            payload.logger.error({
                err,
                msg: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$parseError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["parseError"])(err, `Error running migration ${migration.name}. Rolling back`)
            });
            process.exit(1);
        }
    }
} //# sourceMappingURL=migrateFresh.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/migrateRefresh.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "migrateRefresh",
    ()=>migrateRefresh
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$commitTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/utilities/commitTransaction.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$createLocalReq$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/utilities/createLocalReq.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$database$2f$migrations$2f$getMigrations$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/database/migrations/getMigrations.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$initTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/utilities/initTransaction.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$killTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/utilities/killTransaction.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$database$2f$migrations$2f$readMigrationFiles$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/database/migrations/readMigrationFiles.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getTransaction.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$migrationTableExists$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/migrationTableExists.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$parseError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/parseError.js [app-route] (ecmascript)");
;
;
;
;
async function migrateRefresh() {
    const { payload } = this;
    const migrationFiles = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$database$2f$migrations$2f$readMigrationFiles$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["readMigrationFiles"])({
        payload
    });
    const { existingMigrations, latestBatch } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$database$2f$migrations$2f$getMigrations$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getMigrations"])({
        payload
    });
    if (!existingMigrations?.length) {
        payload.logger.info({
            msg: 'No migrations to rollback.'
        });
        return;
    }
    payload.logger.info({
        msg: `Rolling back batch ${latestBatch} consisting of ${existingMigrations.length} migration(s).`
    });
    const req = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$createLocalReq$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createLocalReq"])({}, payload);
    // Reverse order of migrations to rollback
    existingMigrations.reverse();
    for (const migration of existingMigrations){
        try {
            const migrationFile = migrationFiles.find((m)=>m.name === migration.name);
            if (!migrationFile) {
                throw new Error(`Migration ${migration.name} not found locally.`);
            }
            payload.logger.info({
                msg: `Migrating down: ${migration.name}`
            });
            const start = Date.now();
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$initTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["initTransaction"])(req);
            const db = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTransaction"])(this, req);
            await migrationFile.down({
                db,
                payload,
                req
            });
            payload.logger.info({
                msg: `Migrated down:  ${migration.name} (${Date.now() - start}ms)`
            });
            const tableExists = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$migrationTableExists$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["migrationTableExists"])(this, db);
            if (tableExists) {
                await payload.delete({
                    collection: 'payload-migrations',
                    req,
                    where: {
                        name: {
                            equals: migration.name
                        }
                    }
                });
            }
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$commitTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["commitTransaction"])(req);
        } catch (err) {
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$killTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["killTransaction"])(req);
            payload.logger.error({
                err,
                msg: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$parseError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["parseError"])(err, `Error running migration ${migration.name}. Rolling back.`)
            });
            process.exit(1);
        }
    }
    // Run all migrate up
    for (const migration of migrationFiles){
        payload.logger.info({
            msg: `Migrating: ${migration.name}`
        });
        try {
            const start = Date.now();
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$initTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["initTransaction"])(req);
            await migration.up({
                payload,
                req
            });
            await payload.create({
                collection: 'payload-migrations',
                data: {
                    name: migration.name,
                    executed: true
                },
                req
            });
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$commitTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["commitTransaction"])(req);
            payload.logger.info({
                msg: `Migrated:  ${migration.name} (${Date.now() - start}ms)`
            });
        } catch (err) {
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$killTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["killTransaction"])(req);
            payload.logger.error({
                err,
                msg: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$parseError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["parseError"])(err, `Error running migration ${migration.name}. Rolling back.`)
            });
            process.exit(1);
        }
    }
} //# sourceMappingURL=migrateRefresh.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/migrateReset.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "migrateReset",
    ()=>migrateReset
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$commitTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/utilities/commitTransaction.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$createLocalReq$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/utilities/createLocalReq.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$database$2f$migrations$2f$getMigrations$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/database/migrations/getMigrations.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$initTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/utilities/initTransaction.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$killTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/utilities/killTransaction.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$database$2f$migrations$2f$readMigrationFiles$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/database/migrations/readMigrationFiles.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getTransaction.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$migrationTableExists$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/migrationTableExists.js [app-route] (ecmascript)");
;
;
;
async function migrateReset() {
    const { payload } = this;
    const migrationFiles = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$database$2f$migrations$2f$readMigrationFiles$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["readMigrationFiles"])({
        payload
    });
    const { existingMigrations } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$database$2f$migrations$2f$getMigrations$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getMigrations"])({
        payload
    });
    if (!existingMigrations?.length) {
        payload.logger.info({
            msg: 'No migrations to reset.'
        });
        return;
    }
    const req = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$createLocalReq$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createLocalReq"])({}, payload);
    existingMigrations.reverse();
    // Rollback all migrations in order
    for (const migration of existingMigrations){
        const migrationFile = migrationFiles.find((m)=>m.name === migration.name);
        try {
            if (!migrationFile) {
                throw new Error(`Migration ${migration.name} not found locally.`);
            }
            const start = Date.now();
            payload.logger.info({
                msg: `Migrating down: ${migrationFile.name}`
            });
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$initTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["initTransaction"])(req);
            const db = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTransaction"])(this, req);
            await migrationFile.down({
                db,
                payload,
                req
            });
            payload.logger.info({
                msg: `Migrated down:  ${migrationFile.name} (${Date.now() - start}ms)`
            });
            const tableExists = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$migrationTableExists$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["migrationTableExists"])(this, db);
            if (tableExists) {
                await payload.delete({
                    id: migration.id,
                    collection: 'payload-migrations',
                    req
                });
            }
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$commitTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["commitTransaction"])(req);
        } catch (err) {
            let msg = `Error running migration ${migrationFile.name}.`;
            if (err instanceof Error) {
                msg += ` ${err.message}`;
            }
            await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$killTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["killTransaction"])(req);
            payload.logger.error({
                err,
                msg
            });
            process.exit(1);
        }
    }
    // Delete dev migration
    const tableExists = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$migrationTableExists$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["migrationTableExists"])(this);
    if (tableExists) {
        try {
            await payload.delete({
                collection: 'payload-migrations',
                where: {
                    batch: {
                        equals: -1
                    }
                }
            });
        } catch (err) {
            payload.logger.error({
                err,
                msg: 'Error deleting dev migration'
            });
        }
    }
} //# sourceMappingURL=migrateReset.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/migrateStatus.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "migrateStatus",
    ()=>migrateStatus
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$console$2d$table$2d$printer$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/console-table-printer/dist/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$database$2f$migrations$2f$getMigrations$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/database/migrations/getMigrations.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$database$2f$migrations$2f$readMigrationFiles$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/database/migrations/readMigrationFiles.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$migrationTableExists$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/migrationTableExists.js [app-route] (ecmascript)");
;
;
;
async function migrateStatus() {
    const { payload } = this;
    const migrationFiles = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$database$2f$migrations$2f$readMigrationFiles$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["readMigrationFiles"])({
        payload
    });
    payload.logger.debug({
        msg: `Found ${migrationFiles.length} migration files.`
    });
    let existingMigrations = [];
    const hasMigrationTable = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$migrationTableExists$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["migrationTableExists"])(this);
    if (hasMigrationTable) {
        ;
        ({ existingMigrations } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$database$2f$migrations$2f$getMigrations$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getMigrations"])({
            payload
        }));
    }
    if (!migrationFiles.length) {
        payload.logger.info({
            msg: 'No migrations found.'
        });
        return;
    }
    // Compare migration files to existing migrations
    const statuses = migrationFiles.map((migration)=>{
        const existingMigration = existingMigrations.find((m)=>m.name === migration.name);
        return {
            Name: migration.name,
            Batch: existingMigration?.batch,
            Ran: existingMigration ? 'Yes' : 'No'
        };
    });
    const p = new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$console$2d$table$2d$printer$2f$dist$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["Table"]();
    statuses.forEach((s)=>{
        p.addRow(s, {
            color: s.Ran === 'Yes' ? 'green' : 'red'
        });
    });
    p.printTable();
} //# sourceMappingURL=migrateStatus.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/queryDrafts.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "queryDrafts",
    ()=>queryDrafts
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildCollectionFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/versions/buildCollectionFields.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$database$2f$combineQueries$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/database/combineQueries.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$find$2f$findMany$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/find/findMany.js [app-route] (ecmascript)");
;
;
;
const queryDrafts = async function queryDrafts({ collection, joins, limit, locale, page = 1, pagination, req, select, sort, where }) {
    const collectionConfig = this.payload.collections[collection].config;
    const tableName = this.tableNameMap.get(`_${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(collectionConfig.slug)}${this.versionsSuffix}`);
    const fields = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildCollectionFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildVersionCollectionFields"])(this.payload.config, collectionConfig, true);
    const combinedWhere = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$database$2f$combineQueries$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["combineQueries"])({
        latest: {
            equals: true
        }
    }, where);
    const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$find$2f$findMany$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["findMany"])({
        adapter: this,
        collectionSlug: collection,
        fields,
        joins,
        limit,
        locale,
        page,
        pagination,
        req,
        select,
        sort,
        tableName,
        versions: true,
        where: combinedWhere
    });
    return {
        ...result,
        docs: result.docs.map((doc)=>{
            doc = {
                id: doc.parent,
                ...doc.version
            };
            return doc;
        })
    };
}; //# sourceMappingURL=queryDrafts.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/transactions/rollbackTransaction.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "rollbackTransaction",
    ()=>rollbackTransaction
]);
const rollbackTransaction = async function rollbackTransaction(incomingID = '') {
    const transactionID = incomingID instanceof Promise ? await incomingID : incomingID;
    // if multiple operations are using the same transaction, the first will flow through and delete the session.
    // subsequent calls should be ignored.
    if (!this.sessions[transactionID]) {
        return;
    }
    const session = this.sessions[transactionID];
    // Delete from registry FIRST to prevent race conditions
    // This ensures other operations can't retrieve this session while we're ending it
    delete this.sessions[transactionID];
    // end the session promise in failure by calling reject
    await session.reject();
}; //# sourceMappingURL=rollbackTransaction.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/updateGlobal.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "updateGlobal",
    ()=>updateGlobal
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/upsertRow/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getTransaction.js [app-route] (ecmascript)");
;
;
;
async function updateGlobal({ slug, data, req, returning, select }) {
    const globalConfig = this.payload.globals.config.find((config)=>config.slug === slug);
    const tableName = this.tableNameMap.get((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(globalConfig.slug));
    const db = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTransaction"])(this, req);
    const existingGlobal = await db.query[tableName].findFirst({});
    const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["upsertRow"])({
        ...existingGlobal ? {
            id: existingGlobal.id,
            operation: 'update'
        } : {
            operation: 'create'
        },
        adapter: this,
        data,
        db,
        fields: globalConfig.flattenedFields,
        globalSlug: slug,
        ignoreResult: returning === false,
        req,
        select,
        tableName
    });
    if (returning === false) {
        return null;
    }
    result.globalType = slug;
    return result;
} //# sourceMappingURL=updateGlobal.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/updateGlobalVersion.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "updateGlobalVersion",
    ()=>updateGlobalVersion
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildGlobalFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/versions/buildGlobalFields.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$buildQuery$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/queries/buildQuery.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/upsertRow/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getTransaction.js [app-route] (ecmascript)");
;
;
;
;
;
async function updateGlobalVersion({ id, global, locale, req, returning, select, versionData, where: whereArg }) {
    const globalConfig = this.payload.globals.config.find(({ slug })=>slug === global);
    const whereToUse = whereArg || {
        id: {
            equals: id
        }
    };
    const tableName = this.tableNameMap.get(`_${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(globalConfig.slug)}${this.versionsSuffix}`);
    const fields = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildGlobalFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildVersionGlobalFields"])(this.payload.config, globalConfig, true);
    const { where } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$buildQuery$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildQuery"])({
        adapter: this,
        fields,
        locale,
        tableName,
        where: whereToUse
    });
    const db = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTransaction"])(this, req);
    const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["upsertRow"])({
        id,
        adapter: this,
        data: versionData,
        db,
        fields,
        globalSlug: global,
        ignoreResult: returning === false,
        operation: 'update',
        req,
        select,
        tableName,
        where
    });
    if (returning === false) {
        return null;
    }
    return result;
} //# sourceMappingURL=updateGlobalVersion.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/updateJobs.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "updateJobs",
    ()=>updateJobs
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$find$2f$findMany$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/find/findMany.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/upsertRow/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$shouldUseOptimizedUpsertRow$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/upsertRow/shouldUseOptimizedUpsertRow.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getTransaction.js [app-route] (ecmascript)");
;
;
;
;
;
const updateJobs = async function updateMany({ id, data, limit: limitArg, req, returning, sort: sortArg, where: whereArg }) {
    if (!data?.log?.length && !(data.log && typeof data.log === 'object' && '$push' in data.log)) {
        delete data.log;
    }
    const whereToUse = id ? {
        id: {
            equals: id
        }
    } : whereArg;
    const limit = id ? 1 : limitArg;
    const collection = this.payload.collections['payload-jobs'].config;
    const tableName = this.tableNameMap.get((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(collection.slug));
    const sort = sortArg !== undefined && sortArg !== null ? sortArg : collection.defaultSort;
    const useOptimizedUpsertRow = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$shouldUseOptimizedUpsertRow$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["shouldUseOptimizedUpsertRow"])({
        data,
        fields: collection.flattenedFields
    });
    if (useOptimizedUpsertRow && id) {
        const db = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTransaction"])(this, req);
        const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["upsertRow"])({
            id,
            adapter: this,
            collectionSlug: 'payload-jobs',
            data,
            db,
            fields: collection.flattenedFields,
            ignoreResult: returning === false,
            operation: 'update',
            req,
            tableName
        });
        return returning === false ? null : [
            result
        ];
    }
    const jobs = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$find$2f$findMany$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["findMany"])({
        adapter: this,
        collectionSlug: 'payload-jobs',
        fields: collection.flattenedFields,
        limit: id ? 1 : limit,
        pagination: false,
        req,
        sort,
        tableName,
        where: whereToUse
    });
    if (!jobs.docs.length) {
        return [];
    }
    const db = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTransaction"])(this, req);
    const results = [];
    // TODO: We need to batch this to reduce the amount of db calls. This can get very slow if we are updating a lot of rows.
    for (const job of jobs.docs){
        const updateData = useOptimizedUpsertRow ? data : {
            ...job,
            ...data
        };
        const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["upsertRow"])({
            id: job.id,
            adapter: this,
            collectionSlug: 'payload-jobs',
            data: updateData,
            db,
            fields: collection.flattenedFields,
            ignoreResult: returning === false,
            operation: 'update',
            req,
            tableName
        });
        results.push(result);
    }
    if (returning === false) {
        return null;
    }
    return results;
}; //# sourceMappingURL=updateJobs.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/updateMany.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "updateMany",
    ()=>updateMany
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$buildQuery$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/queries/buildQuery.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$selectDistinct$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/queries/selectDistinct.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/upsertRow/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getTransaction.js [app-route] (ecmascript)");
;
;
;
;
;
const updateMany = async function updateMany({ collection: collectionSlug, data, joins: joinQuery, limit, locale, req, returning, select, sort: sortArg, where: whereToUse }) {
    const collection = this.payload.collections[collectionSlug].config;
    const tableName = this.tableNameMap.get((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(collection.slug));
    const sort = sortArg !== undefined && sortArg !== null ? sortArg : collection.defaultSort;
    const { joins, orderBy, selectFields, where } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$buildQuery$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildQuery"])({
        adapter: this,
        fields: collection.flattenedFields,
        locale,
        sort,
        tableName,
        where: whereToUse
    });
    const db = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTransaction"])(this, req);
    let idsToUpdate = [];
    const selectDistinctResult = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$selectDistinct$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["selectDistinct"])({
        adapter: this,
        db,
        joins,
        query: ({ query })=>orderBy ? query.orderBy(()=>orderBy.map(({ column, order })=>order(column))) : query,
        selectFields,
        tableName,
        where
    });
    if (selectDistinctResult?.[0]?.id) {
        idsToUpdate = selectDistinctResult?.map((doc)=>doc.id);
    } else if (whereToUse && !joins.length) {
        // If id wasn't passed but `where` without any joins, retrieve it with findFirst
        const _db = db;
        const table = this.tables[tableName];
        let query = _db.select({
            id: table.id
        }).from(table).where(where).$dynamic();
        if (typeof limit === 'number' && limit > 0) {
            query = query.limit(limit);
        }
        if (orderBy) {
            query = query.orderBy(()=>orderBy.map(({ column, order })=>order(column)));
        }
        const docsToUpdate = await query;
        idsToUpdate = docsToUpdate?.map((doc)=>doc.id);
    }
    if (!idsToUpdate.length) {
        return [];
    }
    const results = [];
    // TODO: We need to batch this to reduce the amount of db calls. This can get very slow if we are updating a lot of rows.
    for (const idToUpdate of idsToUpdate){
        const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["upsertRow"])({
            id: idToUpdate,
            adapter: this,
            collectionSlug,
            data,
            db,
            fields: collection.flattenedFields,
            ignoreResult: returning === false,
            joinQuery,
            operation: 'update',
            req,
            select,
            tableName
        });
        results.push(result);
    }
    if (returning === false) {
        return null;
    }
    return results;
}; //# sourceMappingURL=updateMany.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/updateOne.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "updateOne",
    ()=>updateOne
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$buildQuery$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/queries/buildQuery.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$selectDistinct$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/queries/selectDistinct.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/upsertRow/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getTransaction.js [app-route] (ecmascript)");
;
;
;
;
;
const updateOne = async function updateOne({ id, collection: collectionSlug, data, joins: joinQuery, locale, options = {
    upsert: false
}, req, returning, select, where: whereArg }) {
    const collection = this.payload.collections[collectionSlug].config;
    const tableName = this.tableNameMap.get((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(collection.slug));
    let idToUpdate = id;
    const db = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTransaction"])(this, req);
    if (!idToUpdate) {
        const { joins, selectFields, where } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$buildQuery$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildQuery"])({
            adapter: this,
            fields: collection.flattenedFields,
            locale,
            tableName,
            where: whereArg
        });
        // selectDistinct will only return if there are joins
        const selectDistinctResult = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$selectDistinct$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["selectDistinct"])({
            adapter: this,
            db,
            joins,
            query: ({ query })=>query.limit(1),
            selectFields,
            tableName,
            where
        });
        if (selectDistinctResult?.[0]?.id) {
            idToUpdate = selectDistinctResult?.[0]?.id;
        // If id wasn't passed but `where` without any joins, retrieve it with findFirst
        } else if (whereArg && !joins.length) {
            const table = this.tables[tableName];
            const docsToUpdate = await db.select({
                id: table.id
            }).from(table).where(where).limit(1);
            idToUpdate = docsToUpdate?.[0]?.id;
        }
    }
    if (!idToUpdate && !options.upsert) {
        // TODO: In 4.0, if returning === false, we should differentiate between:
        // - No document found to update
        // - Document found, but returning === false
        return null;
    }
    const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["upsertRow"])({
        id: idToUpdate,
        adapter: this,
        collectionSlug,
        data,
        db,
        fields: collection.flattenedFields,
        ignoreResult: returning === false,
        joinQuery,
        operation: 'update',
        req,
        select,
        tableName
    });
    if (returning === false) {
        return null;
    }
    return result;
}; //# sourceMappingURL=updateOne.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/updateVersion.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "updateVersion",
    ()=>updateVersion
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildCollectionFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/versions/buildCollectionFields.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$buildQuery$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/queries/buildQuery.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/upsertRow/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getTransaction.js [app-route] (ecmascript)");
;
;
;
;
;
async function updateVersion({ id, collection, locale, req, returning, select, versionData, where: whereArg }) {
    const collectionConfig = this.payload.collections[collection].config;
    const whereToUse = whereArg || {
        id: {
            equals: id
        }
    };
    const tableName = this.tableNameMap.get(`_${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(collectionConfig.slug)}${this.versionsSuffix}`);
    const fields = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildCollectionFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildVersionCollectionFields"])(this.payload.config, collectionConfig, true);
    const { where } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$queries$2f$buildQuery$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildQuery"])({
        adapter: this,
        fields,
        locale,
        tableName,
        where: whereToUse
    });
    const db = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getTransaction$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getTransaction"])(this, req);
    const result = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$upsertRow$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["upsertRow"])({
        id,
        adapter: this,
        collectionSlug: collection,
        data: versionData,
        db,
        fields,
        ignoreResult: returning === false,
        joinQuery: false,
        operation: 'update',
        req,
        select,
        tableName,
        where
    });
    if (returning === false) {
        return null;
    }
    return result;
} //# sourceMappingURL=updateVersion.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/upsert.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "upsert",
    ()=>upsert
]);
const upsert = async function upsert({ collection, data, joins, locale, req, returning, select, where }) {
    return this.updateOne({
        collection,
        data,
        joins,
        locale,
        options: {
            upsert: true
        },
        req,
        returning,
        select,
        where
    });
}; //# sourceMappingURL=upsert.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/postgres/columnToCodeConverter.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "columnToCodeConverter",
    ()=>columnToCodeConverter
]);
const columnToCodeConverter = ({ adapter, addEnum, addImport, column, tableKey })=>{
    let columnBuilderFn = column.type;
    if (column.type === 'geometry') {
        columnBuilderFn = 'geometryColumn';
        addImport(adapter.packageName, columnBuilderFn);
    } else if (column.type === 'enum') {
        if ('locale' in column) {
            columnBuilderFn = `enum__locales`;
        } else {
            addEnum(column.enumName, column.options);
            columnBuilderFn = column.enumName;
        }
    } else {
        addImport(`${adapter.packageName}/drizzle/pg-core`, columnBuilderFn);
    }
    const columnBuilderArgsArray = [];
    switch(column.type){
        case 'bit':
        case 'halfvec':
        case 'sparsevec':
        case 'vector':
            {
                if (column.dimensions) {
                    columnBuilderArgsArray.push(`dimensions: ${column.dimensions}`);
                }
                break;
            }
        case 'numeric':
            {
                columnBuilderArgsArray.push("mode: 'number'");
                break;
            }
        case 'timestamp':
            {
                columnBuilderArgsArray.push(`mode: '${column.mode}'`);
                if (column.withTimezone) {
                    columnBuilderArgsArray.push('withTimezone: true');
                }
                if (typeof column.precision === 'number') {
                    columnBuilderArgsArray.push(`precision: ${column.precision}`);
                }
                break;
            }
    }
    let columnBuilderArgs = '';
    if (columnBuilderArgsArray.length) {
        columnBuilderArgs = `, {${columnBuilderArgsArray.join(',')}}`;
    }
    let code = `${columnBuilderFn}('${column.name}'${columnBuilderArgs})`;
    if (column.type === 'timestamp' && column.defaultNow) {
        code = `${code}.defaultNow()`;
    }
    if (column.type === 'uuid' && column.defaultRandom) {
        code = `${code}.defaultRandom()`;
    }
    if (column.notNull) {
        code = `${code}.notNull()`;
    }
    if (column.primaryKey) {
        code = `${code}.primaryKey()`;
    }
    if (typeof column.default !== 'undefined') {
        let sanitizedDefault = column.default;
        if (column.type === 'geometry') {
            sanitizedDefault = `sql\`${column.default}\``;
        } else if (column.type === 'jsonb') {
            sanitizedDefault = `sql\`'${JSON.stringify(column.default)}'::jsonb\``;
        } else if (column.type === 'numeric') {
            sanitizedDefault = `${column.default}`;
        } else if (typeof column.default === 'string') {
            sanitizedDefault = `${JSON.stringify(column.default)}`;
        }
        code = `${code}.default(${sanitizedDefault})`;
    }
    if (column.reference) {
        let callback = `()`;
        if (column.reference.table === tableKey) {
            addImport(`${adapter.packageName}/drizzle/pg-core`, 'type AnyPgColumn');
            callback = `${callback}: AnyPgColumn`;
        }
        callback = `${callback} => ${column.reference.table}.${column.reference.name}`;
        code = `${code}.references(${callback}, {
      ${column.reference.onDelete ? `onDelete: '${column.reference.onDelete}'` : ''}
  })`;
    }
    return code;
}; //# sourceMappingURL=columnToCodeConverter.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/postgres/countDistinct.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "countDistinct",
    ()=>countDistinct
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$functions$2f$aggregate$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/sql/functions/aggregate.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/sql/sql.js [app-route] (ecmascript)");
;
const countDistinct = async function countDistinct({ column, db, joins, tableName, where }) {
    // When we don't have any joins - use a simple COUNT(*) query.
    if (joins.length === 0) {
        const countResult = await db.select({
            count: column ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$functions$2f$aggregate$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["count"])(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`DISTINCT ${column}`) : (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$functions$2f$aggregate$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["count"])()
        }).from(this.tables[tableName]).where(where);
        return Number(countResult?.[0]?.count ?? 0);
    }
    let query = db.select({
        count: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`COUNT(1) OVER()`
    }).from(this.tables[tableName]).where(where).groupBy(column || this.tables[tableName].id).limit(1).$dynamic();
    joins.forEach(({ type, condition, table })=>{
        query = query[type ?? 'leftJoin'](table, condition);
    });
    // When we have any joins, we need to count each individual ID only once.
    // COUNT(*) doesn't work for this well in this case, as it also counts joined tables.
    // SELECT (COUNT DISTINCT id) has a very slow performance on large tables.
    // Instead, COUNT (GROUP BY id) can be used which is still slower than COUNT(*) but acceptable.
    const countResult = await query;
    return Number(countResult?.[0]?.count ?? 0);
}; //# sourceMappingURL=countDistinct.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/postgres/createDatabase.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "createDatabase",
    ()=>createDatabase
]);
const setConnectionStringDatabase = ({ connectionString, database })=>{
    const connectionURL = new URL(connectionString);
    const newConnectionURL = new URL(connectionURL);
    newConnectionURL.pathname = `/${database}`;
    return newConnectionURL.toString();
};
const createDatabase = async function(args = {}) {
    // POSTGRES_URL - default Vercel env
    const connectionString = this.poolOptions?.connectionString ?? process.env.POSTGRES_URL ?? process.env.DATABASE_URL;
    let managementClientConfig = {};
    let dbName = args.name;
    const schemaName = this.schemaName || 'public';
    if (connectionString) {
        if (!dbName) {
            dbName = new URL(connectionString).pathname.slice(1);
        }
        managementClientConfig.connectionString = setConnectionStringDatabase({
            connectionString,
            database: 'postgres'
        });
    } else {
        if (!dbName) {
            dbName = this.poolOptions.database;
        }
        managementClientConfig = {
            ...this.poolOptions,
            database: 'postgres'
        };
    }
    // import pg only when createDatabase is used
    const pg = await __turbopack_context__.A("[externals]/pg [external] (pg, esm_import, [project]/node_modules/pg, async loader)").then((mod)=>mod.default);
    const managementClient = new pg.Client(managementClientConfig);
    try {
        await managementClient.connect();
        await managementClient.query(`CREATE DATABASE "${dbName}"`);
        this.payload.logger.info(`Created database "${dbName}"`);
        if (schemaName !== 'public') {
            let createdDatabaseConfig = {};
            if (connectionString) {
                createdDatabaseConfig.connectionString = setConnectionStringDatabase({
                    connectionString,
                    database: dbName
                });
            } else {
                createdDatabaseConfig = {
                    ...this.poolOptions,
                    database: dbName
                };
            }
            const createdDatabaseClient = new pg.Client(createdDatabaseConfig);
            try {
                await createdDatabaseClient.connect();
                await createdDatabaseClient.query(`CREATE SCHEMA ${schemaName}`);
                this.payload.logger.info(`Created schema "${dbName}.${schemaName}"`);
            } catch (err) {
                this.payload.logger.error({
                    err,
                    msg: `Error: failed to create schema "${dbName}.${schemaName}". Details: ${err.message}`
                });
            } finally{
                await createdDatabaseClient.end();
            }
        }
        return true;
    } catch (err) {
        this.payload.logger.error({
            err,
            msg: `Error: failed to create database ${dbName}. Details: ${err.message}`
        });
        return false;
    } finally{
        await managementClient.end();
    }
}; //# sourceMappingURL=createDatabase.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/postgres/createExtensions.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "createExtensions",
    ()=>createExtensions
]);
const createExtensions = async function() {
    for(const extension in this.extensions){
        if (this.extensions[extension]) {
            try {
                await this.drizzle.execute(`CREATE EXTENSION IF NOT EXISTS "${extension}"`);
            } catch (err) {
                this.payload.logger.error({
                    err,
                    msg: `Failed to create extension ${extension}`
                });
            }
        }
    }
}; //# sourceMappingURL=createExtensions.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/postgres/createJSONQuery/index.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "createJSONQuery",
    ()=>createJSONQuery
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$APIError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/errors/APIError.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$escapeSQLValue$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/escapeSQLValue.js [app-route] (ecmascript)");
;
;
const operatorMap = {
    contains: '~',
    equals: '==',
    in: 'in',
    like: 'like_regex',
    not_equals: '!=',
    not_in: 'in',
    not_like: '!like_regex'
};
const sanitizeValue = (value, operator)=>{
    if (value === null) {
        return `NULL`;
    }
    if (typeof value === 'number' || typeof value === 'boolean') {
        return `${value}`;
    }
    if (typeof value !== 'string') {
        throw new Error('Invalid value type');
    }
    if (!__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$escapeSQLValue$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["SAFE_STRING_REGEX"].test(value)) {
        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$APIError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"](`${value} is not allowed as a JSON query value`, 400);
    }
    const escaped = value.replace(/\\/g, '\\\\').replace(/"/g, '\\"');
    const prefix = [
        'like',
        'not_like'
    ].includes(operator ?? '') ? '(?i)' : '';
    return `"${prefix}${escaped}"`;
};
const createJSONQuery = ({ column, operator, pathSegments, value })=>{
    const columnName = typeof column === 'object' ? column.name : column;
    const jsonPaths = pathSegments.slice(1).map((key)=>{
        return `${key}[*]`;
    }).join('.');
    const fullPath = pathSegments.length === 1 ? '$[*]' : `$.${jsonPaths}`;
    let sql = '';
    if ([
        'in',
        'not_in'
    ].includes(operator) && Array.isArray(value)) {
        sql = '(';
        value.forEach((item, i)=>{
            sql = `${sql}${createJSONQuery({
                column,
                operator: operator === 'in' ? 'equals' : 'not_equals',
                pathSegments,
                value: item
            })}${i === value.length - 1 ? '' : ` ${operator === 'in' ? 'OR' : 'AND'} `}`;
        });
        sql = `${sql})`;
    } else if (operator === 'exists') {
        sql = `${value === false ? 'NOT ' : ''}jsonb_path_exists(${columnName}, '${fullPath}')`;
    } else if ([
        'not_like'
    ].includes(operator)) {
        const mappedOperator = operatorMap[operator];
        sql = `NOT jsonb_path_exists(${columnName}, '${fullPath} ? (@ ${mappedOperator.substring(1)} ${sanitizeValue(value, operator)})')`;
    } else {
        sql = `jsonb_path_exists(${columnName}, '${fullPath} ? (@ ${operatorMap[operator]} ${sanitizeValue(value, operator)})')`;
    }
    return sql;
}; //# sourceMappingURL=index.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/postgres/defaultSnapshot.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "defaultDrizzleSnapshot",
    ()=>defaultDrizzleSnapshot
]);
const defaultDrizzleSnapshot = {
    id: '00000000-0000-0000-0000-000000000000',
    _meta: {
        columns: {},
        schemas: {},
        tables: {}
    },
    dialect: 'postgresql',
    enums: {},
    policies: {},
    prevId: '00000000-0000-0000-0000-00000000000',
    roles: {},
    schemas: {},
    sequences: {},
    tables: {},
    version: '7',
    views: {}
}; //# sourceMappingURL=defaultSnapshot.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/postgres/deleteWhere.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "deleteWhere",
    ()=>deleteWhere
]);
const deleteWhere = async function deleteWhere({ db, tableName, where }) {
    const table = this.tables[tableName];
    await db.delete(table).where(where);
}; //# sourceMappingURL=deleteWhere.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/postgres/dropDatabase.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "dropDatabase",
    ()=>dropDatabase
]);
const dropDatabase = async function dropDatabase({ adapter }) {
    await adapter.execute({
        drizzle: adapter.drizzle,
        raw: `drop schema if exists ${this.schemaName || 'public'} cascade;
    create schema ${this.schemaName || 'public'};`
    });
}; //# sourceMappingURL=dropDatabase.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/postgres/execute.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "execute",
    ()=>execute
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/sql/sql.js [app-route] (ecmascript)");
;
const execute = function execute({ db, drizzle, raw, sql: statement }) {
    const executeFrom = db ?? drizzle;
    if (raw) {
        return executeFrom.execute(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"].raw(raw));
    } else {
        return executeFrom.execute(__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$sql$2f$sql$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sql"]`${statement}`);
    }
}; //# sourceMappingURL=execute.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/schema/buildDrizzleRelations.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "buildDrizzleRelations",
    ()=>buildDrizzleRelations
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$relations$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/relations.js [app-route] (ecmascript)");
;
const buildDrizzleRelations = ({ adapter })=>{
    for(const tableName in adapter.rawRelations){
        const rawRelations = adapter.rawRelations[tableName];
        adapter.relations[`relations_${tableName}`] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$relations$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["relations"])(adapter.tables[tableName], ({ many, one })=>{
            const result = {};
            for(const key in rawRelations){
                const relation = rawRelations[key];
                if (relation.type === 'one') {
                    result[key] = one(adapter.tables[relation.to], {
                        fields: relation.fields.map((field)=>adapter.tables[field.table][field.name]),
                        references: relation.references.map((reference)=>adapter.tables[relation.to][reference]),
                        relationName: relation.relationName
                    });
                } else {
                    if (adapter.tables[relation.to]) {
                        result[key] = many(adapter.tables[relation.to], {
                            relationName: relation.relationName
                        });
                    }
                }
            }
            return result;
        });
    }
}; //# sourceMappingURL=buildDrizzleRelations.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/createTableName.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "createTableName",
    ()=>createTableName
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$APIError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/errors/APIError.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
;
;
const createTableName = ({ adapter, config: { name, slug }, config, parentTableName, prefix = '', target = 'dbName', throwValidationError = false, versions = false, versionsCustomName = false })=>{
    let customNameDefinition = config[target];
    let defaultTableName = `${prefix}${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(name ?? slug)}`;
    if (versions) {
        defaultTableName = `_${defaultTableName}${adapter.versionsSuffix}`;
    }
    let customTableNameResult;
    if (!customNameDefinition && target === 'enumName') {
        customNameDefinition = config['dbName'];
    }
    if (customNameDefinition) {
        customTableNameResult = typeof customNameDefinition === 'function' ? customNameDefinition({
            tableName: parentTableName
        }) : customNameDefinition;
        if (versionsCustomName) {
            customTableNameResult = `_${customTableNameResult}${adapter.versionsSuffix}`;
        }
    }
    const result = customTableNameResult || defaultTableName;
    adapter.tableNameMap.set(defaultTableName, result);
    if (!throwValidationError) {
        return result;
    }
    if (result.length > 63) {
        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$APIError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"](`Exceeded max identifier length for table or enum name of 63 characters. Invalid name: ${result}.
Tip: You can use the dbName property to reduce the table name length.
      `);
    }
    return result;
}; //# sourceMappingURL=createTableName.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/utilities/buildIndexName.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "buildIndexName",
    ()=>buildIndexName
]);
const buildIndexName = ({ name, adapter, appendSuffix = true, number = 0 })=>{
    let indexName = `${name}${number ? `_${number}` : ''}${appendSuffix ? '_idx' : ''}`;
    if (indexName.length > 60) {
        const suffix = `${number ? `_${number}` : ''}${appendSuffix ? '_idx' : ''}`;
        indexName = `${name.slice(0, 60 - suffix.length)}${suffix}`;
    }
    if (!adapter.indexes.has(indexName) && !(indexName in adapter.rawTables)) {
        adapter.indexes.add(indexName);
        return indexName;
    }
    return buildIndexName({
        name,
        adapter,
        appendSuffix,
        number: number + 1
    });
}; //# sourceMappingURL=buildIndexName.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/utilities/buildForeignKeyName.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "buildForeignKeyName",
    ()=>buildForeignKeyName
]);
const buildForeignKeyName = ({ name, adapter, number = 0 })=>{
    let foreignKeyName = `${name}${number ? `_${number}` : ''}_fk`;
    if (foreignKeyName.length > 60) {
        const suffix = `${number ? `_${number}` : ''}_fk`;
        foreignKeyName = `${name.slice(0, 60 - suffix.length)}${suffix}`;
    }
    if (!adapter.foreignKeys.has(foreignKeyName)) {
        adapter.foreignKeys.add(foreignKeyName);
        return foreignKeyName;
    }
    return buildForeignKeyName({
        name,
        adapter,
        number: number + 1
    });
}; //# sourceMappingURL=buildForeignKeyName.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/utilities/hasLocalesTable.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "hasLocalesTable",
    ()=>hasLocalesTable
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/fields/config/types.js [app-route] (ecmascript)");
;
const hasLocalesTable = ({ fields, parentIsLocalized })=>{
    return fields.some((field)=>{
        // arrays always get a separate table
        if (field.type === 'array') {
            return false;
        }
        if ((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["fieldAffectsData"])(field) && (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["fieldShouldBeLocalized"])({
            field,
            parentIsLocalized
        })) {
            return true;
        }
        if ((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["fieldHasSubFields"])(field)) {
            return hasLocalesTable({
                fields: field.fields,
                parentIsLocalized: parentIsLocalized || 'localized' in field && field.localized
            });
        }
        if (field.type === 'tabs') {
            return field.tabs.some((tab)=>hasLocalesTable({
                    fields: tab.fields,
                    parentIsLocalized: parentIsLocalized || tab.localized
                }));
        }
        return false;
    });
}; //# sourceMappingURL=hasLocalesTable.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/schema/idToUUID.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "idToUUID",
    ()=>idToUUID
]);
const idToUUID = (fields)=>fields.map((field)=>{
        if ('name' in field && field.name === 'id') {
            return {
                ...field,
                name: '_uuid'
            };
        }
        return field;
    }); //# sourceMappingURL=idToUUID.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/schema/withDefault.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "withDefault",
    ()=>withDefault
]);
const withDefault = (column, field)=>{
    if (typeof field.defaultValue === 'undefined' || typeof field.defaultValue === 'function') {
        return column;
    }
    return {
        ...column,
        default: field.defaultValue
    };
}; //# sourceMappingURL=withDefault.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/schema/traverseFields.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "traverseFields",
    ()=>traverseFields
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$InvalidConfiguration$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/errors/InvalidConfiguration.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/fields/config/types.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$createTableName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/createTableName.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$buildIndexName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/buildIndexName.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getArrayRelationName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/getArrayRelationName.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$hasLocalesTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/hasLocalesTable.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$validateExistingBlockIsIdentical$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/validateExistingBlockIsIdentical.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$schema$2f$build$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/schema/build.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$schema$2f$idToUUID$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/schema/idToUUID.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$schema$2f$withDefault$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/schema/withDefault.js [app-route] (ecmascript)");
;
;
;
;
;
;
;
;
;
;
;
const traverseFields = ({ adapter, blocksTableNameMap, columnPrefix, columns, disableNotNull, disableRelsTableUnique, disableUnique = false, fieldPrefix, fields, forceLocalized, indexes, localesColumns, localesIndexes, newTableName, parentIsLocalized, parentTableName, relationships, relationsToBuild, rootRelationsToBuild, rootTableIDColType, rootTableName, setColumnID, uniqueRelationships, versions, withinLocalizedArrayOrBlock })=>{
    const throwValidationError = true;
    let hasLocalizedField = false;
    let hasLocalizedRelationshipField = false;
    let hasManyTextField = false;
    let hasLocalizedManyTextField = false;
    let hasManyNumberField = false;
    let hasLocalizedManyNumberField = false;
    let parentIDColType = 'integer';
    const idColumn = columns.id;
    if (idColumn && [
        'numeric',
        'text',
        'uuid',
        'varchar'
    ].includes(idColumn.type)) {
        parentIDColType = idColumn.type;
    }
    fields.forEach((field)=>{
        if ('name' in field && field.name === 'id') {
            return;
        }
        if ((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["fieldIsVirtual"])(field)) {
            return;
        }
        let targetTable = columns;
        let targetIndexes = indexes;
        const columnName = `${columnPrefix || ''}${field.name[0] === '_' ? '_' : ''}${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(field.name)}`;
        const fieldName = `${fieldPrefix?.replace('.', '_') || ''}${field.name}`;
        const isFieldLocalized = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["fieldShouldBeLocalized"])({
            field,
            parentIsLocalized
        });
        // If field is localized,
        // add the column to the locale table instead of main table
        if (adapter.payload.config.localization && (isFieldLocalized || forceLocalized) && field.type !== 'array' && (field.type !== 'blocks' || adapter.blocksAsJSON) && ('hasMany' in field && field.hasMany !== true || !('hasMany' in field))) {
            hasLocalizedField = true;
            targetTable = localesColumns;
            targetIndexes = localesIndexes;
        }
        if ((field.unique || field.index || [
            'relationship',
            'upload'
        ].includes(field.type)) && ![
            'array',
            'blocks',
            'group'
        ].includes(field.type) && !('hasMany' in field && field.hasMany === true) && !('relationTo' in field && Array.isArray(field.relationTo))) {
            const unique = disableUnique !== true && field.unique;
            if (unique) {
                const constraintValue = `${fieldPrefix || ''}${field.name}`;
                if (!adapter.fieldConstraints?.[rootTableName]) {
                    adapter.fieldConstraints[rootTableName] = {};
                }
                adapter.fieldConstraints[rootTableName][`${columnName}_idx`] = constraintValue;
            }
            const indexName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$buildIndexName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildIndexName"])({
                name: `${newTableName}_${columnName}`,
                adapter
            });
            targetIndexes[indexName] = {
                name: indexName,
                on: isFieldLocalized ? [
                    fieldName,
                    '_locale'
                ] : fieldName,
                unique
            };
        }
        switch(field.type){
            case 'array':
                {
                    const disableNotNullFromHere = Boolean(field.admin?.condition) || disableNotNull;
                    const arrayTableName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$createTableName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createTableName"])({
                        adapter,
                        config: field,
                        parentTableName: newTableName,
                        prefix: `${newTableName}_`,
                        throwValidationError,
                        versionsCustomName: versions
                    });
                    const baseColumns = {
                        _order: {
                            name: '_order',
                            type: 'integer',
                            notNull: true
                        },
                        _parentID: {
                            name: '_parent_id',
                            type: parentIDColType,
                            notNull: true
                        }
                    };
                    const baseIndexes = {
                        _orderIdx: {
                            name: `${arrayTableName}_order_idx`,
                            on: [
                                '_order'
                            ]
                        },
                        _parentIDIdx: {
                            name: `${arrayTableName}_parent_id_idx`,
                            on: '_parentID'
                        }
                    };
                    const baseForeignKeys = {
                        _parentIDFk: {
                            name: `${arrayTableName}_parent_id_fk`,
                            columns: [
                                '_parentID'
                            ],
                            foreignColumns: [
                                {
                                    name: 'id',
                                    table: parentTableName
                                }
                            ],
                            onDelete: 'cascade'
                        }
                    };
                    const isLocalized = Boolean(isFieldLocalized && adapter.payload.config.localization) || withinLocalizedArrayOrBlock || forceLocalized;
                    if (isLocalized) {
                        baseColumns._locale = {
                            name: '_locale',
                            type: 'enum',
                            locale: true,
                            notNull: true
                        };
                        baseIndexes._localeIdx = {
                            name: `${arrayTableName}_locale_idx`,
                            on: '_locale'
                        };
                    }
                    const { hasLocalizedManyNumberField: subHasLocalizedManyNumberField, hasLocalizedManyTextField: subHasLocalizedManyTextField, hasLocalizedRelationshipField: subHasLocalizedRelationshipField, hasManyNumberField: subHasManyNumberField, hasManyTextField: subHasManyTextField, relationsToBuild: subRelationsToBuild } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$schema$2f$build$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildTable"])({
                        adapter,
                        baseColumns,
                        baseForeignKeys,
                        baseIndexes,
                        blocksTableNameMap,
                        disableNotNull: disableNotNullFromHere,
                        disableRelsTableUnique: true,
                        disableUnique,
                        fields: disableUnique ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$schema$2f$idToUUID$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["idToUUID"])(field.flattenedFields) : field.flattenedFields,
                        parentIsLocalized: parentIsLocalized || field.localized,
                        rootRelationships: relationships,
                        rootRelationsToBuild,
                        rootTableIDColType,
                        rootTableName,
                        rootUniqueRelationships: uniqueRelationships,
                        setColumnID,
                        tableName: arrayTableName,
                        versions,
                        withinLocalizedArrayOrBlock: isLocalized
                    });
                    if (subHasLocalizedManyNumberField) {
                        hasLocalizedManyNumberField = subHasLocalizedManyNumberField;
                    }
                    if (subHasLocalizedRelationshipField) {
                        hasLocalizedRelationshipField = subHasLocalizedRelationshipField;
                    }
                    if (subHasLocalizedManyTextField) {
                        hasLocalizedManyTextField = subHasLocalizedManyTextField;
                    }
                    if (subHasManyTextField) {
                        if (!hasManyTextField || subHasManyTextField === 'index') {
                            hasManyTextField = subHasManyTextField;
                        }
                    }
                    if (subHasManyNumberField) {
                        if (!hasManyNumberField || subHasManyNumberField === 'index') {
                            hasManyNumberField = subHasManyNumberField;
                        }
                    }
                    const relationName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$getArrayRelationName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getArrayRelationName"])({
                        field,
                        path: fieldName,
                        tableName: arrayTableName
                    });
                    relationsToBuild.set(relationName, {
                        type: 'many',
                        // arrays have their own localized table, independent of the base table.
                        localized: false,
                        target: arrayTableName
                    });
                    const arrayRelations = {
                        _parentID: {
                            type: 'one',
                            fields: [
                                {
                                    name: '_parentID',
                                    table: arrayTableName
                                }
                            ],
                            references: [
                                'id'
                            ],
                            relationName,
                            to: parentTableName
                        }
                    };
                    if ((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$hasLocalesTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["hasLocalesTable"])({
                        fields: field.fields,
                        parentIsLocalized: parentIsLocalized || field.localized
                    })) {
                        arrayRelations._locales = {
                            type: 'many',
                            relationName: '_locales',
                            to: `${arrayTableName}${adapter.localesSuffix}`
                        };
                    }
                    subRelationsToBuild.forEach(({ type, localized, target }, key)=>{
                        if (type === 'one') {
                            const arrayWithLocalized = localized ? `${arrayTableName}${adapter.localesSuffix}` : arrayTableName;
                            arrayRelations[key] = {
                                type: 'one',
                                fields: [
                                    {
                                        name: key,
                                        table: arrayWithLocalized
                                    }
                                ],
                                references: [
                                    'id'
                                ],
                                relationName: key,
                                to: target
                            };
                        }
                        if (type === 'many') {
                            arrayRelations[key] = {
                                type: 'many',
                                relationName: key,
                                to: target
                            };
                        }
                    });
                    adapter.rawRelations[arrayTableName] = arrayRelations;
                    break;
                }
            case 'blocks':
                {
                    if (adapter.blocksAsJSON) {
                        targetTable[fieldName] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$schema$2f$withDefault$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["withDefault"])({
                            name: columnName,
                            type: 'jsonb'
                        }, field);
                        break;
                    }
                    const disableNotNullFromHere = Boolean(field.admin?.condition) || disableNotNull;
                    (field.blockReferences ?? field.blocks).forEach((_block)=>{
                        const block = typeof _block === 'string' ? adapter.payload.blocks[_block] : _block;
                        let blockTableName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$createTableName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createTableName"])({
                            adapter,
                            config: block,
                            parentTableName: rootTableName,
                            prefix: `${rootTableName}_blocks_`,
                            throwValidationError,
                            versionsCustomName: versions
                        });
                        if (typeof blocksTableNameMap[blockTableName] === 'undefined') {
                            blocksTableNameMap[blockTableName] = 1;
                        } else if (!adapter.rawTables[blockTableName] || !(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$validateExistingBlockIsIdentical$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["validateExistingBlockIsIdentical"])({
                            block,
                            localized: field.localized,
                            rootTableName,
                            table: adapter.rawTables[blockTableName],
                            tableLocales: adapter.rawTables[`${blockTableName}${adapter.localesSuffix}`]
                        })) {
                            blocksTableNameMap[blockTableName]++;
                            (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$validateExistingBlockIsIdentical$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["setInternalBlockIndex"])(block, blocksTableNameMap[blockTableName]);
                            blockTableName = `${blockTableName}_${blocksTableNameMap[blockTableName]}`;
                        }
                        let relationName = `_blocks_${block.slug}`;
                        if (typeof block[__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$validateExistingBlockIsIdentical$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["InternalBlockTableNameIndex"]] !== 'undefined') {
                            relationName = `_blocks_${block.slug}_${block[__TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$validateExistingBlockIsIdentical$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["InternalBlockTableNameIndex"]]}`;
                        }
                        if (!adapter.rawTables[blockTableName]) {
                            const baseColumns = {
                                _order: {
                                    name: '_order',
                                    type: 'integer',
                                    notNull: true
                                },
                                _parentID: {
                                    name: '_parent_id',
                                    type: rootTableIDColType,
                                    notNull: true
                                },
                                _path: {
                                    name: '_path',
                                    type: 'text',
                                    notNull: true
                                }
                            };
                            const baseIndexes = {
                                _orderIdx: {
                                    name: `${blockTableName}_order_idx`,
                                    on: '_order'
                                },
                                _parentIDIdx: {
                                    name: `${blockTableName}_parent_id_idx`,
                                    on: [
                                        '_parentID'
                                    ]
                                },
                                _pathIdx: {
                                    name: `${blockTableName}_path_idx`,
                                    on: '_path'
                                }
                            };
                            const baseForeignKeys = {
                                _parentIdFk: {
                                    name: `${blockTableName}_parent_id_fk`,
                                    columns: [
                                        '_parentID'
                                    ],
                                    foreignColumns: [
                                        {
                                            name: 'id',
                                            table: rootTableName
                                        }
                                    ],
                                    onDelete: 'cascade'
                                }
                            };
                            const isLocalized = Boolean(isFieldLocalized && adapter.payload.config.localization) || withinLocalizedArrayOrBlock || forceLocalized;
                            if (isLocalized) {
                                baseColumns._locale = {
                                    name: '_locale',
                                    type: 'enum',
                                    locale: true,
                                    notNull: true
                                };
                                baseIndexes._localeIdx = {
                                    name: `${blockTableName}_locale_idx`,
                                    on: '_locale'
                                };
                            }
                            const { hasLocalizedManyNumberField: subHasLocalizedManyNumberField, hasLocalizedManyTextField: subHasLocalizedManyTextField, hasLocalizedRelationshipField: subHasLocalizedRelationshipField, hasManyNumberField: subHasManyNumberField, hasManyTextField: subHasManyTextField, relationsToBuild: subRelationsToBuild } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$schema$2f$build$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildTable"])({
                                adapter,
                                baseColumns,
                                baseForeignKeys,
                                baseIndexes,
                                blocksTableNameMap,
                                disableNotNull: disableNotNullFromHere,
                                disableRelsTableUnique: true,
                                disableUnique,
                                fields: disableUnique ? (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$schema$2f$idToUUID$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["idToUUID"])(block.flattenedFields) : block.flattenedFields,
                                parentIsLocalized: parentIsLocalized || field.localized,
                                rootRelationships: relationships,
                                rootRelationsToBuild,
                                rootTableIDColType,
                                rootTableName,
                                rootUniqueRelationships: uniqueRelationships,
                                setColumnID,
                                tableName: blockTableName,
                                versions,
                                withinLocalizedArrayOrBlock: isLocalized
                            });
                            if (subHasLocalizedManyNumberField) {
                                hasLocalizedManyNumberField = subHasLocalizedManyNumberField;
                            }
                            if (subHasLocalizedRelationshipField) {
                                hasLocalizedRelationshipField = subHasLocalizedRelationshipField;
                            }
                            if (subHasLocalizedManyTextField) {
                                hasLocalizedManyTextField = subHasLocalizedManyTextField;
                            }
                            if (subHasManyTextField) {
                                if (!hasManyTextField || subHasManyTextField === 'index') {
                                    hasManyTextField = subHasManyTextField;
                                }
                            }
                            if (subHasManyNumberField) {
                                if (!hasManyNumberField || subHasManyNumberField === 'index') {
                                    hasManyNumberField = subHasManyNumberField;
                                }
                            }
                            const blockRelations = {
                                _parentID: {
                                    type: 'one',
                                    fields: [
                                        {
                                            name: '_parentID',
                                            table: blockTableName
                                        }
                                    ],
                                    references: [
                                        'id'
                                    ],
                                    relationName,
                                    to: rootTableName
                                }
                            };
                            if ((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$hasLocalesTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["hasLocalesTable"])({
                                fields: block.fields,
                                parentIsLocalized: parentIsLocalized || field.localized
                            })) {
                                blockRelations._locales = {
                                    type: 'many',
                                    relationName: '_locales',
                                    to: `${blockTableName}${adapter.localesSuffix}`
                                };
                            }
                            subRelationsToBuild.forEach(({ type, localized, target }, key)=>{
                                if (type === 'one') {
                                    const blockWithLocalized = localized ? `${blockTableName}${adapter.localesSuffix}` : blockTableName;
                                    blockRelations[key] = {
                                        type: 'one',
                                        fields: [
                                            {
                                                name: key,
                                                table: blockWithLocalized
                                            }
                                        ],
                                        references: [
                                            'id'
                                        ],
                                        relationName: key,
                                        to: target
                                    };
                                }
                                if (type === 'many') {
                                    blockRelations[key] = {
                                        type: 'many',
                                        relationName: key,
                                        to: target
                                    };
                                }
                            });
                            adapter.rawRelations[blockTableName] = blockRelations;
                        }
                        // blocks relationships are defined from the collection or globals table down to the block, bypassing any subBlocks
                        rootRelationsToBuild.set(relationName, {
                            type: 'many',
                            // blocks are not localized on the parent table
                            localized: false,
                            target: blockTableName
                        });
                    });
                    break;
                }
            case 'checkbox':
                {
                    targetTable[fieldName] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$schema$2f$withDefault$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["withDefault"])({
                        name: columnName,
                        type: 'boolean'
                    }, field);
                    break;
                }
            case 'code':
            case 'email':
            case 'textarea':
                {
                    targetTable[fieldName] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$schema$2f$withDefault$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["withDefault"])({
                        name: columnName,
                        type: 'varchar'
                    }, field);
                    break;
                }
            case 'date':
                {
                    targetTable[fieldName] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$schema$2f$withDefault$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["withDefault"])({
                        name: columnName,
                        type: 'timestamp',
                        mode: 'string',
                        precision: 3,
                        withTimezone: true
                    }, field);
                    break;
                }
            case 'group':
            case 'tab':
                {
                    const disableNotNullFromHere = Boolean(field.admin?.condition) || disableNotNull;
                    const { hasLocalizedField: groupHasLocalizedField, hasLocalizedManyNumberField: groupHasLocalizedManyNumberField, hasLocalizedManyTextField: groupHasLocalizedManyTextField, hasLocalizedRelationshipField: groupHasLocalizedRelationshipField, hasManyNumberField: groupHasManyNumberField, hasManyTextField: groupHasManyTextField } = traverseFields({
                        adapter,
                        blocksTableNameMap,
                        columnPrefix: `${columnName}_`,
                        columns,
                        disableNotNull: disableNotNullFromHere,
                        disableUnique,
                        fieldPrefix: `${fieldName}.`,
                        fields: field.flattenedFields,
                        forceLocalized: isFieldLocalized,
                        indexes,
                        localesColumns,
                        localesIndexes,
                        newTableName: `${parentTableName}_${columnName}`,
                        parentIsLocalized: parentIsLocalized || field.localized,
                        parentTableName,
                        relationships,
                        relationsToBuild,
                        rootRelationsToBuild,
                        rootTableIDColType,
                        rootTableName,
                        setColumnID,
                        uniqueRelationships,
                        versions,
                        withinLocalizedArrayOrBlock: withinLocalizedArrayOrBlock || isFieldLocalized
                    });
                    if (groupHasLocalizedField) {
                        hasLocalizedField = true;
                    }
                    if (groupHasLocalizedRelationshipField) {
                        hasLocalizedRelationshipField = true;
                    }
                    if (groupHasManyTextField) {
                        hasManyTextField = true;
                    }
                    if (groupHasLocalizedManyTextField) {
                        hasLocalizedManyTextField = true;
                    }
                    if (groupHasManyNumberField) {
                        hasManyNumberField = true;
                    }
                    if (groupHasLocalizedManyNumberField) {
                        hasLocalizedManyNumberField = true;
                    }
                    break;
                }
            case 'json':
            case 'richText':
                {
                    targetTable[fieldName] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$schema$2f$withDefault$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["withDefault"])({
                        name: columnName,
                        type: 'jsonb'
                    }, field);
                    break;
                }
            case 'number':
                {
                    if (field.hasMany) {
                        const isLocalized = Boolean(isFieldLocalized && adapter.payload.config.localization) || withinLocalizedArrayOrBlock || forceLocalized;
                        if (isLocalized) {
                            hasLocalizedManyNumberField = true;
                        }
                        if (field.index) {
                            hasManyNumberField = 'index';
                        } else if (!hasManyNumberField) {
                            hasManyNumberField = true;
                        }
                        if (field.unique) {
                            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$InvalidConfiguration$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["InvalidConfiguration"]('Unique is not supported in Postgres for hasMany number fields.');
                        }
                    } else {
                        targetTable[fieldName] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$schema$2f$withDefault$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["withDefault"])({
                            name: columnName,
                            type: 'numeric'
                        }, field);
                    }
                    break;
                }
            case 'point':
                {
                    targetTable[fieldName] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$schema$2f$withDefault$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["withDefault"])({
                        name: columnName,
                        type: 'geometry'
                    }, field);
                    break;
                }
            case 'radio':
            case 'select':
                {
                    const enumName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$createTableName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createTableName"])({
                        adapter,
                        config: field,
                        parentTableName: newTableName,
                        prefix: `enum_${newTableName}_`,
                        target: 'enumName',
                        throwValidationError
                    });
                    const options = field.options.map((option)=>{
                        if ((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["optionIsObject"])(option)) {
                            return option.value;
                        }
                        return option;
                    });
                    if (field.type === 'select' && field.hasMany) {
                        const selectTableName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$createTableName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createTableName"])({
                            adapter,
                            config: field,
                            parentTableName: newTableName,
                            prefix: `${newTableName}_`,
                            throwValidationError,
                            versionsCustomName: versions
                        });
                        const baseColumns = {
                            order: {
                                name: 'order',
                                type: 'integer',
                                notNull: true
                            },
                            parent: {
                                name: 'parent_id',
                                type: parentIDColType,
                                notNull: true
                            },
                            value: {
                                name: 'value',
                                type: 'enum',
                                enumName: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$createTableName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createTableName"])({
                                    adapter,
                                    config: field,
                                    parentTableName: newTableName,
                                    prefix: `enum_${newTableName}_`,
                                    target: 'enumName',
                                    throwValidationError
                                }),
                                options
                            }
                        };
                        const baseIndexes = {
                            orderIdx: {
                                name: `${selectTableName}_order_idx`,
                                on: 'order'
                            },
                            parentIdx: {
                                name: `${selectTableName}_parent_idx`,
                                on: 'parent'
                            }
                        };
                        const baseForeignKeys = {
                            parentFk: {
                                name: `${selectTableName}_parent_fk`,
                                columns: [
                                    'parent'
                                ],
                                foreignColumns: [
                                    {
                                        name: 'id',
                                        table: parentTableName
                                    }
                                ],
                                onDelete: 'cascade'
                            }
                        };
                        const isLocalized = Boolean(isFieldLocalized && adapter.payload.config.localization) || withinLocalizedArrayOrBlock || forceLocalized;
                        if (isLocalized) {
                            baseColumns.locale = {
                                name: 'locale',
                                type: 'enum',
                                locale: true,
                                notNull: true
                            };
                            baseIndexes.localeIdx = {
                                name: `${selectTableName}_locale_idx`,
                                on: 'locale'
                            };
                        }
                        if (field.index) {
                            baseIndexes.value = {
                                name: `${selectTableName}_value_idx`,
                                on: 'value'
                            };
                        }
                        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$schema$2f$build$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildTable"])({
                            adapter,
                            baseColumns,
                            baseForeignKeys,
                            baseIndexes,
                            blocksTableNameMap,
                            disableNotNull,
                            disableUnique,
                            fields: [],
                            parentIsLocalized: parentIsLocalized || field.localized,
                            rootTableName,
                            setColumnID,
                            tableName: selectTableName,
                            versions
                        });
                        relationsToBuild.set(fieldName, {
                            type: 'many',
                            // selects have their own localized table, independent of the base table.
                            localized: false,
                            target: selectTableName
                        });
                        adapter.rawRelations[selectTableName] = {
                            parent: {
                                type: 'one',
                                fields: [
                                    {
                                        name: 'parent',
                                        table: selectTableName
                                    }
                                ],
                                references: [
                                    'id'
                                ],
                                relationName: fieldName,
                                to: parentTableName
                            }
                        };
                    } else {
                        targetTable[fieldName] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$schema$2f$withDefault$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["withDefault"])({
                            name: columnName,
                            type: 'enum',
                            enumName,
                            options
                        }, field);
                    }
                    break;
                }
            case 'relationship':
            case 'upload':
                if (Array.isArray(field.relationTo)) {
                    field.relationTo.forEach((relation)=>{
                        relationships.add(relation);
                        if (field.unique && !disableUnique && !disableRelsTableUnique) {
                            uniqueRelationships.add(relation);
                        }
                    });
                } else if (field.hasMany) {
                    relationships.add(field.relationTo);
                    if (field.unique && !disableUnique && !disableRelsTableUnique) {
                        uniqueRelationships.add(field.relationTo);
                    }
                } else {
                    // simple relationships get a column on the targetTable with a foreign key to the relationTo table
                    const relationshipConfig = adapter.payload.collections[field.relationTo].config;
                    const tableName = adapter.tableNameMap.get((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(field.relationTo));
                    // get the id type of the related collection
                    let colType = adapter.idType === 'uuid' ? 'uuid' : 'integer';
                    const relatedCollectionCustomID = relationshipConfig.fields.find((field)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$fields$2f$config$2f$types$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["fieldAffectsData"])(field) && field.name === 'id');
                    if (relatedCollectionCustomID?.type === 'number') {
                        colType = 'numeric';
                    }
                    if (relatedCollectionCustomID?.type === 'text') {
                        colType = 'varchar';
                    }
                    // make the foreign key column for relationship using the correct id column type
                    targetTable[fieldName] = {
                        name: `${columnName}_id`,
                        type: colType,
                        reference: {
                            name: 'id',
                            onDelete: 'set null',
                            table: tableName
                        }
                    };
                    // add relationship to table
                    relationsToBuild.set(fieldName, {
                        type: 'one',
                        localized: adapter.payload.config.localization && (isFieldLocalized || forceLocalized),
                        target: tableName
                    });
                    // add notNull when not required
                    if (!disableNotNull && field.required && !field.admin?.condition) {
                        targetTable[fieldName].notNull = true;
                    }
                    break;
                }
                if (Boolean(isFieldLocalized && adapter.payload.config.localization) || withinLocalizedArrayOrBlock) {
                    hasLocalizedRelationshipField = true;
                }
                break;
            case 'text':
                {
                    if (field.hasMany) {
                        const isLocalized = Boolean(isFieldLocalized && adapter.payload.config.localization) || withinLocalizedArrayOrBlock || forceLocalized;
                        if (isLocalized) {
                            hasLocalizedManyTextField = true;
                        }
                        if (field.index) {
                            hasManyTextField = 'index';
                        } else if (!hasManyTextField) {
                            hasManyTextField = true;
                        }
                        if (field.unique) {
                            throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$InvalidConfiguration$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["InvalidConfiguration"]('Unique is not supported in Postgres for hasMany text fields.');
                        }
                    } else {
                        targetTable[fieldName] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$schema$2f$withDefault$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["withDefault"])({
                            name: columnName,
                            type: 'varchar'
                        }, field);
                    }
                    break;
                }
            default:
                break;
        }
        const condition = field.admin && field.admin.condition;
        if (!disableNotNull && targetTable[fieldName] && 'required' in field && field.required && !condition) {
            targetTable[fieldName].notNull = true;
        }
    });
    return {
        hasLocalizedField,
        hasLocalizedManyNumberField,
        hasLocalizedManyTextField,
        hasLocalizedRelationshipField,
        hasManyNumberField,
        hasManyTextField
    };
}; //# sourceMappingURL=traverseFields.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/schema/build.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "buildTable",
    ()=>buildTable
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$InvalidConfiguration$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/errors/InvalidConfiguration.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$createTableName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/createTableName.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$buildForeignKeyName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/buildForeignKeyName.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$buildIndexName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/buildIndexName.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$schema$2f$traverseFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/schema/traverseFields.js [app-route] (ecmascript)");
;
;
;
;
;
;
const buildTable = ({ adapter, baseColumns = {}, baseForeignKeys = {}, baseIndexes = {}, blocksTableNameMap, compoundIndexes, disableNotNull, disableRelsTableUnique = false, disableUnique = false, fields, parentIsLocalized, rootRelationships, rootRelationsToBuild, rootTableIDColType, rootTableName: incomingRootTableName, rootUniqueRelationships, setColumnID, tableName, timestamps, versions, withinLocalizedArrayOrBlock })=>{
    const isRoot = !incomingRootTableName;
    const rootTableName = incomingRootTableName || tableName;
    const columns = baseColumns;
    const indexes = baseIndexes;
    const localesColumns = {};
    const localesIndexes = {};
    let localesTable;
    let textsTable;
    let numbersTable;
    // Relationships to the base collection
    const relationships = rootRelationships || new Set();
    // Unique relationships to the base collection
    const uniqueRelationships = rootUniqueRelationships || new Set();
    let relationshipsTable;
    // Drizzle relations
    const relationsToBuild = new Map();
    const idColType = setColumnID({
        adapter,
        columns,
        fields
    });
    const { hasLocalizedField, hasLocalizedManyNumberField, hasLocalizedManyTextField, hasLocalizedRelationshipField, hasManyNumberField, hasManyTextField } = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$schema$2f$traverseFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["traverseFields"])({
        adapter,
        blocksTableNameMap,
        columns,
        disableNotNull,
        disableRelsTableUnique,
        disableUnique,
        fields,
        indexes,
        localesColumns,
        localesIndexes,
        newTableName: tableName,
        parentIsLocalized,
        parentTableName: tableName,
        relationships,
        relationsToBuild,
        rootRelationsToBuild: rootRelationsToBuild || relationsToBuild,
        rootTableIDColType: rootTableIDColType || idColType,
        rootTableName,
        setColumnID,
        uniqueRelationships,
        versions,
        withinLocalizedArrayOrBlock
    });
    // split the relationsToBuild by localized and non-localized
    const localizedRelations = new Map();
    const nonLocalizedRelations = new Map();
    relationsToBuild.forEach(({ type, localized, relationName, target }, key)=>{
        const map = localized ? localizedRelations : nonLocalizedRelations;
        map.set(key, {
            type,
            relationName,
            target
        });
    });
    if (timestamps) {
        columns.createdAt = {
            name: 'created_at',
            type: 'timestamp',
            defaultNow: true,
            mode: 'string',
            notNull: true,
            precision: 3,
            withTimezone: true
        };
        columns.updatedAt = {
            name: 'updated_at',
            type: 'timestamp',
            defaultNow: true,
            mode: 'string',
            notNull: true,
            precision: 3,
            withTimezone: true
        };
    }
    const table = {
        name: tableName,
        columns,
        foreignKeys: baseForeignKeys,
        indexes
    };
    adapter.rawTables[tableName] = table;
    if (hasLocalizedField || localizedRelations.size) {
        const localeTableName = `${tableName}${adapter.localesSuffix}`;
        adapter.rawTables[localeTableName] = localesTable;
        localesColumns.id = {
            name: 'id',
            type: 'serial',
            primaryKey: true
        };
        localesColumns._locale = {
            name: '_locale',
            type: 'enum',
            locale: true,
            notNull: true
        };
        localesColumns._parentID = {
            name: '_parent_id',
            type: idColType,
            notNull: true
        };
        localesIndexes._localeParent = {
            name: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$buildIndexName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildIndexName"])({
                name: `${localeTableName}_locale_parent_id_unique`,
                adapter,
                appendSuffix: false
            }),
            on: [
                '_locale',
                '_parentID'
            ],
            unique: true
        };
        localesTable = {
            name: localeTableName,
            columns: localesColumns,
            foreignKeys: {
                _parentIdFk: {
                    name: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$buildForeignKeyName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildForeignKeyName"])({
                        name: `${localeTableName}_parent_id`,
                        adapter
                    }),
                    columns: [
                        '_parentID'
                    ],
                    foreignColumns: [
                        {
                            name: 'id',
                            table: tableName
                        }
                    ],
                    onDelete: 'cascade'
                }
            },
            indexes: localesIndexes
        };
        adapter.rawTables[localeTableName] = localesTable;
        const localeRelations = {
            _parentID: {
                type: 'one',
                fields: [
                    {
                        name: '_parentID',
                        table: localeTableName
                    }
                ],
                references: [
                    'id'
                ],
                relationName: '_locales',
                to: tableName
            }
        };
        localizedRelations.forEach(({ type, target }, key)=>{
            if (type === 'one') {
                localeRelations[key] = {
                    type: 'one',
                    fields: [
                        {
                            name: key,
                            table: localeTableName
                        }
                    ],
                    references: [
                        'id'
                    ],
                    relationName: key,
                    to: target
                };
            }
            if (type === 'many') {
                localeRelations[key] = {
                    type: 'many',
                    relationName: key,
                    to: target
                };
            }
        });
        adapter.rawRelations[localeTableName] = localeRelations;
    }
    if (compoundIndexes) {
        for (const index of compoundIndexes){
            let someLocalized = null;
            const columns = [];
            const getTableToUse = ()=>{
                if (someLocalized) {
                    return localesTable;
                }
                return table;
            };
            for (const { path, pathHasLocalized } of index.fields){
                if (someLocalized === null) {
                    someLocalized = pathHasLocalized;
                }
                if (someLocalized !== pathHasLocalized) {
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$InvalidConfiguration$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["InvalidConfiguration"](`Compound indexes within localized and non localized fields are not supported in SQL. Expected ${path} to be ${someLocalized ? 'non' : ''} localized.`);
                }
                const columnPath = path.replaceAll('.', '_');
                if (!getTableToUse().columns[columnPath]) {
                    throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$InvalidConfiguration$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["InvalidConfiguration"](`Column ${columnPath} for compound index on ${path} was not found in the ${getTableToUse().name} table.`);
                }
                columns.push(columnPath);
            }
            if (someLocalized) {
                columns.push('_locale');
            }
            let name = columns.join('_');
            // truncate against the limit, buildIndexName will handle collisions
            if (name.length > 63) {
                name = 'compound_index';
            }
            const indexName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$buildIndexName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildIndexName"])({
                name,
                adapter
            });
            getTableToUse().indexes[indexName] = {
                name: indexName,
                on: columns,
                unique: disableUnique ? false : index.unique
            };
        }
    }
    if (isRoot) {
        if (hasManyTextField) {
            const textsTableName = `${rootTableName}_texts`;
            adapter.rawTables[textsTableName] = textsTable;
            const columns = {
                id: {
                    name: 'id',
                    type: 'serial',
                    primaryKey: true
                },
                order: {
                    name: 'order',
                    type: 'integer',
                    notNull: true
                },
                parent: {
                    name: 'parent_id',
                    type: idColType,
                    notNull: true
                },
                path: {
                    name: 'path',
                    type: 'varchar',
                    notNull: true
                },
                text: {
                    name: 'text',
                    type: 'varchar'
                }
            };
            if (hasLocalizedManyTextField) {
                columns.locale = {
                    name: 'locale',
                    type: 'enum',
                    locale: true
                };
            }
            const textsTableIndexes = {
                orderParentIdx: {
                    name: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$buildIndexName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildIndexName"])({
                        name: `${textsTableName}_order_parent`,
                        adapter,
                        appendSuffix: false
                    }),
                    on: [
                        'order',
                        'parent'
                    ]
                }
            };
            if (hasManyTextField === 'index') {
                textsTableIndexes.text_idx = {
                    name: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$buildIndexName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildIndexName"])({
                        name: `${textsTableName}_text`,
                        adapter
                    }),
                    on: 'text'
                };
            }
            if (hasLocalizedManyTextField) {
                textsTableIndexes.localeParent = {
                    name: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$buildIndexName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildIndexName"])({
                        name: `${textsTableName}_locale_parent`,
                        adapter,
                        appendSuffix: false
                    }),
                    on: [
                        'locale',
                        'parent'
                    ]
                };
            }
            textsTable = {
                name: textsTableName,
                columns,
                foreignKeys: {
                    parentFk: {
                        name: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$buildForeignKeyName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildForeignKeyName"])({
                            name: `${textsTableName}_parent`,
                            adapter
                        }),
                        columns: [
                            'parent'
                        ],
                        foreignColumns: [
                            {
                                name: 'id',
                                table: tableName
                            }
                        ],
                        onDelete: 'cascade'
                    }
                },
                indexes: textsTableIndexes
            };
            adapter.rawTables[textsTableName] = textsTable;
            adapter.rawRelations[textsTableName] = {
                parent: {
                    type: 'one',
                    fields: [
                        {
                            name: 'parent',
                            table: textsTableName
                        }
                    ],
                    references: [
                        'id'
                    ],
                    relationName: '_texts',
                    to: tableName
                }
            };
        }
        if (hasManyNumberField) {
            const numbersTableName = `${rootTableName}_numbers`;
            adapter.rawTables[numbersTableName] = numbersTable;
            const columns = {
                id: {
                    name: 'id',
                    type: 'serial',
                    primaryKey: true
                },
                number: {
                    name: 'number',
                    type: 'numeric'
                },
                order: {
                    name: 'order',
                    type: 'integer',
                    notNull: true
                },
                parent: {
                    name: 'parent_id',
                    type: idColType,
                    notNull: true
                },
                path: {
                    name: 'path',
                    type: 'varchar',
                    notNull: true
                }
            };
            if (hasLocalizedManyNumberField) {
                columns.locale = {
                    name: 'locale',
                    type: 'enum',
                    locale: true
                };
            }
            const numbersTableIndexes = {
                orderParentIdx: {
                    name: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$buildIndexName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildIndexName"])({
                        name: `${numbersTableName}_order_parent`,
                        adapter
                    }),
                    on: [
                        'order',
                        'parent'
                    ]
                }
            };
            if (hasManyNumberField === 'index') {
                numbersTableIndexes.numberIdx = {
                    name: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$buildIndexName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildIndexName"])({
                        name: `${numbersTableName}_number`,
                        adapter
                    }),
                    on: 'number'
                };
            }
            if (hasLocalizedManyNumberField) {
                numbersTableIndexes.localeParent = {
                    name: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$buildIndexName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildIndexName"])({
                        name: `${numbersTableName}_locale_parent`,
                        adapter,
                        appendSuffix: false
                    }),
                    on: [
                        'locale',
                        'parent'
                    ]
                };
            }
            numbersTable = {
                name: numbersTableName,
                columns,
                foreignKeys: {
                    parentFk: {
                        name: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$buildForeignKeyName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildForeignKeyName"])({
                            name: `${numbersTableName}_parent`,
                            adapter
                        }),
                        columns: [
                            'parent'
                        ],
                        foreignColumns: [
                            {
                                name: 'id',
                                table: tableName
                            }
                        ],
                        onDelete: 'cascade'
                    }
                },
                indexes: numbersTableIndexes
            };
            adapter.rawTables[numbersTableName] = numbersTable;
            adapter.rawRelations[numbersTableName] = {
                parent: {
                    type: 'one',
                    fields: [
                        {
                            name: 'parent',
                            table: numbersTableName
                        }
                    ],
                    references: [
                        'id'
                    ],
                    relationName: '_numbers',
                    to: tableName
                }
            };
        }
        if (relationships.size) {
            const relationshipColumns = {
                id: {
                    name: 'id',
                    type: 'serial',
                    primaryKey: true
                },
                order: {
                    name: 'order',
                    type: 'integer'
                },
                parent: {
                    name: 'parent_id',
                    type: idColType,
                    notNull: true
                },
                path: {
                    name: 'path',
                    type: 'varchar',
                    notNull: true
                }
            };
            if (hasLocalizedRelationshipField) {
                relationshipColumns.locale = {
                    name: 'locale',
                    type: 'enum',
                    locale: true
                };
            }
            const relationshipsTableName = `${tableName}${adapter.relationshipsSuffix}`;
            const relationshipIndexes = {
                order: {
                    name: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$buildIndexName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildIndexName"])({
                        name: `${relationshipsTableName}_order`,
                        adapter
                    }),
                    on: 'order'
                },
                parentIdx: {
                    name: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$buildIndexName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildIndexName"])({
                        name: `${relationshipsTableName}_parent`,
                        adapter
                    }),
                    on: 'parent'
                },
                pathIdx: {
                    name: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$buildIndexName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildIndexName"])({
                        name: `${relationshipsTableName}_path`,
                        adapter
                    }),
                    on: 'path'
                }
            };
            if (hasLocalizedRelationshipField) {
                relationshipIndexes.localeIdx = {
                    name: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$buildIndexName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildIndexName"])({
                        name: `${relationshipsTableName}_locale`,
                        adapter
                    }),
                    on: 'locale'
                };
            }
            const relationshipForeignKeys = {
                parentFk: {
                    name: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$buildForeignKeyName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildForeignKeyName"])({
                        name: `${relationshipsTableName}_parent`,
                        adapter
                    }),
                    columns: [
                        'parent'
                    ],
                    foreignColumns: [
                        {
                            name: 'id',
                            table: tableName
                        }
                    ],
                    onDelete: 'cascade'
                }
            };
            relationships.forEach((relationTo)=>{
                const relationshipConfig = adapter.payload.collections[relationTo].config;
                const formattedRelationTo = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$createTableName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createTableName"])({
                    adapter,
                    config: relationshipConfig,
                    throwValidationError: true
                });
                let colType = adapter.idType === 'uuid' ? 'uuid' : 'integer';
                const relatedCollectionCustomIDType = adapter.payload.collections[relationshipConfig.slug]?.customIDType;
                if (relatedCollectionCustomIDType === 'number') {
                    colType = 'numeric';
                }
                if (relatedCollectionCustomIDType === 'text') {
                    colType = 'varchar';
                }
                const colName = `${relationTo}ID`;
                relationshipColumns[colName] = {
                    name: `${formattedRelationTo}_id`,
                    type: colType
                };
                relationshipForeignKeys[`${relationTo}IdFk`] = {
                    name: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$buildForeignKeyName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildForeignKeyName"])({
                        name: `${relationshipsTableName}_${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(relationTo)}`,
                        adapter
                    }),
                    columns: [
                        colName
                    ],
                    foreignColumns: [
                        {
                            name: 'id',
                            table: formattedRelationTo
                        }
                    ],
                    onDelete: 'cascade'
                };
                const indexColumns = [
                    colName
                ];
                const unique = !disableUnique && uniqueRelationships.has(relationTo);
                if (unique) {
                    indexColumns.push('path');
                }
                if (hasLocalizedRelationshipField) {
                    indexColumns.push('locale');
                }
                const indexName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$buildIndexName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildIndexName"])({
                    name: `${relationshipsTableName}_${formattedRelationTo}_id`,
                    adapter
                });
                relationshipIndexes[indexName] = {
                    name: indexName,
                    on: indexColumns,
                    unique
                };
            });
            relationshipsTable = {
                name: relationshipsTableName,
                columns: relationshipColumns,
                foreignKeys: relationshipForeignKeys,
                indexes: relationshipIndexes
            };
            adapter.rawTables[relationshipsTableName] = relationshipsTable;
            const relationshipsTableRelations = {
                parent: {
                    type: 'one',
                    fields: [
                        {
                            name: 'parent',
                            table: relationshipsTableName
                        }
                    ],
                    references: [
                        'id'
                    ],
                    relationName: '_rels',
                    to: tableName
                }
            };
            relationships.forEach((relationTo)=>{
                const relatedTableName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$createTableName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createTableName"])({
                    adapter,
                    config: adapter.payload.collections[relationTo].config,
                    throwValidationError: true
                });
                const idColumnName = `${relationTo}ID`;
                relationshipsTableRelations[idColumnName] = {
                    type: 'one',
                    fields: [
                        {
                            name: idColumnName,
                            table: relationshipsTableName
                        }
                    ],
                    references: [
                        'id'
                    ],
                    relationName: relationTo,
                    to: relatedTableName
                };
            });
            adapter.rawRelations[relationshipsTableName] = relationshipsTableRelations;
        }
    }
    const tableRelations = {};
    nonLocalizedRelations.forEach(({ type, relationName, target }, key)=>{
        if (type === 'one') {
            tableRelations[key] = {
                type: 'one',
                fields: [
                    {
                        name: key,
                        table: tableName
                    }
                ],
                references: [
                    'id'
                ],
                relationName: key,
                to: target
            };
        }
        if (type === 'many') {
            tableRelations[key] = {
                type: 'many',
                relationName: relationName || key,
                to: target
            };
        }
    });
    if (hasLocalizedField) {
        tableRelations._locales = {
            type: 'many',
            relationName: '_locales',
            to: localesTable.name
        };
    }
    if (isRoot && textsTable) {
        tableRelations._texts = {
            type: 'many',
            relationName: '_texts',
            to: textsTable.name
        };
    }
    if (isRoot && numbersTable) {
        tableRelations._numbers = {
            type: 'many',
            relationName: '_numbers',
            to: numbersTable.name
        };
    }
    if (relationships.size && relationshipsTable) {
        tableRelations._rels = {
            type: 'many',
            relationName: '_rels',
            to: relationshipsTable.name
        };
    }
    adapter.rawRelations[tableName] = tableRelations;
    return {
        hasLocalizedManyNumberField,
        hasLocalizedManyTextField,
        hasLocalizedRelationshipField,
        hasManyNumberField,
        hasManyTextField,
        relationsToBuild
    };
}; //# sourceMappingURL=build.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/schema/buildRawSchema.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "buildRawSchema",
    ()=>buildRawSchema
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildCollectionFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/versions/buildCollectionFields.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildVersionCompoundIndexes$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/versions/buildVersionCompoundIndexes.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildGlobalFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/versions/buildGlobalFields.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$getVersionsConfig$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/utilities/getVersionsConfig.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/to-snake-case/index.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$createTableName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/createTableName.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$buildIndexName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/buildIndexName.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$schema$2f$build$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/schema/build.js [app-route] (ecmascript)");
;
;
;
;
;
;
const buildRawSchema = ({ adapter, setColumnID })=>{
    adapter.indexes = new Set();
    adapter.foreignKeys = new Set();
    adapter.payload.config.collections.forEach((collection)=>{
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$createTableName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createTableName"])({
            adapter,
            config: collection
        });
        if (collection.versions) {
            (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$createTableName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createTableName"])({
                adapter,
                config: collection,
                versions: true,
                versionsCustomName: true
            });
        }
    });
    adapter.payload.config.collections.forEach((collection)=>{
        const tableName = adapter.tableNameMap.get((0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(collection.slug));
        const config = adapter.payload.config;
        const baseIndexes = {};
        if (collection.upload.filenameCompoundIndex) {
            const indexName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$buildIndexName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildIndexName"])({
                name: `${tableName}_filename_compound`,
                adapter
            });
            baseIndexes.filename_compound_index = {
                name: indexName,
                on: collection.upload.filenameCompoundIndex.map((f)=>f),
                unique: true
            };
        }
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$schema$2f$build$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildTable"])({
            adapter,
            baseIndexes,
            blocksTableNameMap: {},
            compoundIndexes: collection.sanitizedIndexes,
            disableNotNull: !!collection?.versions?.drafts,
            disableUnique: false,
            fields: collection.flattenedFields,
            parentIsLocalized: false,
            setColumnID,
            tableName,
            timestamps: collection.timestamps,
            versions: false
        });
        if (collection.versions) {
            const versionsTableName = adapter.tableNameMap.get(`_${(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$to$2d$snake$2d$case$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])(collection.slug)}${adapter.versionsSuffix}`);
            const versionFields = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildCollectionFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildVersionCollectionFields"])(config, collection, true);
            (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$schema$2f$build$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildTable"])({
                adapter,
                blocksTableNameMap: {},
                compoundIndexes: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildVersionCompoundIndexes$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildVersionCompoundIndexes"])({
                    indexes: collection.sanitizedIndexes
                }),
                disableNotNull: !!collection.versions?.drafts,
                disableUnique: true,
                fields: versionFields,
                parentIsLocalized: false,
                setColumnID,
                tableName: versionsTableName,
                timestamps: true,
                versions: true
            });
        }
    });
    adapter.payload.config.globals.forEach((global)=>{
        const tableName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$createTableName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createTableName"])({
            adapter,
            config: global
        });
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$schema$2f$build$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildTable"])({
            adapter,
            blocksTableNameMap: {},
            disableNotNull: (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$utilities$2f$getVersionsConfig$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["hasDraftsEnabled"])(global),
            disableUnique: false,
            fields: global.flattenedFields,
            parentIsLocalized: false,
            setColumnID,
            tableName,
            timestamps: false,
            versions: false
        });
        if (global.versions) {
            const versionsTableName = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$createTableName$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["createTableName"])({
                adapter,
                config: global,
                versions: true,
                versionsCustomName: true
            });
            const config = adapter.payload.config;
            const versionFields = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$versions$2f$buildGlobalFields$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildVersionGlobalFields"])(config, global, true);
            (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$schema$2f$build$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildTable"])({
                adapter,
                blocksTableNameMap: {},
                disableNotNull: !!global.versions?.drafts,
                disableUnique: true,
                fields: versionFields,
                parentIsLocalized: false,
                setColumnID,
                tableName: versionsTableName,
                timestamps: true,
                versions: true
            });
        }
    });
}; //# sourceMappingURL=buildRawSchema.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/utilities/extendDrizzleTable.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "extendDrizzleTable",
    ()=>extendDrizzleTable
]);
/**
 * Implemented from:
 * https://github.com/drizzle-team/drizzle-orm/blob/main/drizzle-orm/src/pg-core/table.ts#L73
 * Drizzle uses @internal JSDoc to remove their internal methods from types, for example
 * Table.Symbol, columnBuilder.build - but they actually exist.
 */ var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$table$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/table.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$APIError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/payload/dist/errors/APIError.js [app-route] (ecmascript)");
;
;
const { Symbol: DrizzleSymbol } = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$table$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["Table"];
const extendDrizzleTable = ({ columns, extraConfig, table })=>{
    const InlineForeignKeys = Object.getOwnPropertySymbols(table).find((symbol)=>{
        return symbol.description?.includes('InlineForeignKeys');
    });
    if (!InlineForeignKeys) {
        throw new __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$payload$2f$dist$2f$errors$2f$APIError$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["APIError"](`Error when finding InlineForeignKeys Symbol`, 500);
    }
    if (columns) {
        for (const [name, columnBuilder] of Object.entries(columns)){
            const column = columnBuilder.build(table);
            table[name] = column;
            table[InlineForeignKeys].push(...columnBuilder.buildForeignKeys(column, table));
            table[DrizzleSymbol.Columns][name] = column;
            table[DrizzleSymbol.ExtraConfigColumns][name] = 'buildExtraConfigColumn' in columnBuilder ? columnBuilder.buildExtraConfigColumn(table) : column;
        }
    }
    if (extraConfig) {
        const originalExtraConfigBuilder = table[DrizzleSymbol.ExtraConfigBuilder];
        table[DrizzleSymbol.ExtraConfigBuilder] = (t)=>{
            return {
                ...originalExtraConfigBuilder(t),
                ...extraConfig(t)
            };
        };
    }
}; //# sourceMappingURL=extendDrizzleTable.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/utilities/executeSchemaHooks.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "executeSchemaHooks",
    ()=>executeSchemaHooks
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$extendDrizzleTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/extendDrizzleTable.js [app-route] (ecmascript)");
;
const executeSchemaHooks = async ({ type, adapter })=>{
    for (const hook of adapter[type]){
        const result = await hook({
            adapter: adapter,
            extendTable: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$extendDrizzleTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["extendDrizzleTable"],
            schema: {
                enums: adapter.enums,
                relations: adapter.relations,
                tables: adapter.tables
            }
        });
        if (result.enums) {
            adapter.enums = result.enums;
        }
        adapter.tables = result.tables;
        adapter.relations = result.relations;
    }
}; //# sourceMappingURL=executeSchemaHooks.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/postgres/schema/geometryColumn.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "geometryColumn",
    ()=>geometryColumn
]);
// Uses custom one instead of geometry() from drizzle-orm/pg-core because it's broken on pushDevSchema
// Why?
// It tries to give us a prompt "you're about to change.. from geometry(Point) to geometry(point)"
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$custom$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/pg-core/columns/custom.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$postgis_extension$2f$utils$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/pg-core/columns/postgis_extension/utils.js [app-route] (ecmascript)");
;
;
const geometryColumn = (name)=>(0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$custom$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["customType"])({
        dataType () {
            return `geometry(Point)`;
        },
        fromDriver (value) {
            return (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$postgis_extension$2f$utils$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["parseEWKB"])(value);
        },
        toDriver (value) {
            return `SRID=4326;point(${value[0]} ${value[1]})`;
        }
    })(name); //# sourceMappingURL=geometryColumn.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/postgres/schema/buildDrizzleTable.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "buildDrizzleTable",
    ()=>buildDrizzleTable
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$vector_extension$2f$bit$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/pg-core/columns/vector_extension/bit.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$boolean$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/pg-core/columns/boolean.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$foreign$2d$keys$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/pg-core/foreign-keys.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$vector_extension$2f$halfvec$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/pg-core/columns/vector_extension/halfvec.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$indexes$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/pg-core/indexes.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$integer$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/pg-core/columns/integer.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$jsonb$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/pg-core/columns/jsonb.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$numeric$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/pg-core/columns/numeric.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$serial$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/pg-core/columns/serial.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$vector_extension$2f$sparsevec$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/pg-core/columns/vector_extension/sparsevec.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$text$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/pg-core/columns/text.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$timestamp$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/pg-core/columns/timestamp.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$uuid$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/pg-core/columns/uuid.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$varchar$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/pg-core/columns/varchar.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$vector_extension$2f$vector$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/drizzle-orm/pg-core/columns/vector_extension/vector.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$postgres$2f$schema$2f$geometryColumn$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/postgres/schema/geometryColumn.js [app-route] (ecmascript)");
;
;
const rawColumnBuilderMap = {
    boolean: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$boolean$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["boolean"],
    geometry: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$postgres$2f$schema$2f$geometryColumn$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["geometryColumn"],
    integer: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$integer$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["integer"],
    jsonb: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$jsonb$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["jsonb"],
    numeric: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$numeric$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["numeric"],
    serial: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$serial$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["serial"],
    text: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$text$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["text"],
    uuid: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$uuid$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["uuid"],
    varchar: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$varchar$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["varchar"]
};
const buildDrizzleTable = ({ adapter, rawTable })=>{
    const columns = {};
    for (const [key, column] of Object.entries(rawTable.columns)){
        switch(column.type){
            case 'bit':
                {
                    const builder = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$vector_extension$2f$bit$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["bit"])(column.name, {
                        dimensions: column.dimensions
                    });
                    columns[key] = builder;
                    break;
                }
            case 'enum':
                if ('locale' in column) {
                    columns[key] = adapter.enums.enum__locales(column.name);
                } else {
                    adapter.enums[column.enumName] = adapter.pgSchema.enum(column.enumName, column.options);
                    columns[key] = adapter.enums[column.enumName](column.name);
                }
                break;
            case 'halfvec':
                {
                    const builder = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$vector_extension$2f$halfvec$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["halfvec"])(column.name, {
                        dimensions: column.dimensions
                    });
                    columns[key] = builder;
                    break;
                }
            case 'numeric':
                {
                    columns[key] = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$numeric$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["numeric"])(column.name, {
                        mode: 'number'
                    });
                    break;
                }
            case 'sparsevec':
                {
                    const builder = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$vector_extension$2f$sparsevec$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["sparsevec"])(column.name, {
                        dimensions: column.dimensions
                    });
                    columns[key] = builder;
                    break;
                }
            case 'timestamp':
                {
                    let builder = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$timestamp$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["timestamp"])(column.name, {
                        mode: column.mode,
                        precision: column.precision,
                        withTimezone: column.withTimezone
                    });
                    if (column.defaultNow) {
                        builder = builder.defaultNow();
                    }
                    columns[key] = builder;
                    break;
                }
            case 'uuid':
                {
                    let builder = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$uuid$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["uuid"])(column.name);
                    if (column.defaultRandom) {
                        builder = builder.defaultRandom();
                    }
                    columns[key] = builder;
                    break;
                }
            case 'vector':
                {
                    const builder = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$columns$2f$vector_extension$2f$vector$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["vector"])(column.name, {
                        dimensions: column.dimensions
                    });
                    columns[key] = builder;
                    break;
                }
            default:
                columns[key] = rawColumnBuilderMap[column.type](column.name);
                break;
        }
        if (column.reference) {
            columns[key].references(()=>adapter.tables[column.reference.table][column.reference.name], {
                onDelete: column.reference.onDelete
            });
        }
        if (column.primaryKey) {
            columns[key].primaryKey();
        }
        if (column.notNull) {
            columns[key].notNull();
        }
        if (typeof column.default !== 'undefined') {
            let sanitizedDefault = column.default;
            if (column.type === 'geometry' && Array.isArray(column.default)) {
                sanitizedDefault = `SRID=4326;POINT(${column.default[0]} ${column.default[1]})`;
            }
            columns[key].default(sanitizedDefault);
        }
        if (column.type === 'geometry') {
            if (!adapter.extensions.postgis) {
                adapter.extensions.postgis = true;
            }
        }
    }
    const extraConfig = (cols)=>{
        const config = {};
        if (rawTable.indexes) {
            for (const [key, rawIndex] of Object.entries(rawTable.indexes)){
                let fn = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$indexes$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["index"];
                if (rawIndex.unique) {
                    fn = __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$indexes$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["uniqueIndex"];
                }
                if (Array.isArray(rawIndex.on)) {
                    if (rawIndex.on.length) {
                        config[key] = fn(rawIndex.name).on(...rawIndex.on.map((colName)=>cols[colName]));
                    }
                } else {
                    config[key] = fn(rawIndex.name).on(cols[rawIndex.on]);
                }
            }
        }
        if (rawTable.foreignKeys) {
            for (const [key, rawForeignKey] of Object.entries(rawTable.foreignKeys)){
                let builder = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$drizzle$2d$orm$2f$pg$2d$core$2f$foreign$2d$keys$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["foreignKey"])({
                    name: rawForeignKey.name,
                    columns: rawForeignKey.columns.map((colName)=>cols[colName]),
                    foreignColumns: rawForeignKey.foreignColumns.map((column)=>adapter.tables[column.table][column.name])
                });
                if (rawForeignKey.onDelete) {
                    builder = builder.onDelete(rawForeignKey.onDelete);
                }
                if (rawForeignKey.onUpdate) {
                    builder = builder.onDelete(rawForeignKey.onUpdate);
                }
                config[key] = builder;
            }
        }
        return config;
    };
    adapter.tables[rawTable.name] = adapter.pgSchema.table(rawTable.name, columns, extraConfig);
}; //# sourceMappingURL=buildDrizzleTable.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/postgres/schema/setColumnID.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "setColumnID",
    ()=>setColumnID
]);
const setColumnID = ({ adapter, columns, fields })=>{
    const idField = fields.find((field)=>field.name === 'id');
    if (idField) {
        if (idField.type === 'number') {
            columns.id = {
                name: 'id',
                type: 'numeric',
                primaryKey: true
            };
            return 'numeric';
        }
        if (idField.type === 'text') {
            columns.id = {
                name: 'id',
                type: 'varchar',
                primaryKey: true
            };
            return 'varchar';
        }
    }
    if (adapter.idType === 'uuid') {
        columns.id = {
            name: 'id',
            type: 'uuid',
            defaultRandom: true,
            primaryKey: true
        };
        return 'uuid';
    }
    columns.id = {
        name: 'id',
        type: 'serial',
        primaryKey: true
    };
    return 'integer';
}; //# sourceMappingURL=setColumnID.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/postgres/init.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "init",
    ()=>init
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$schema$2f$buildDrizzleRelations$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/schema/buildDrizzleRelations.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$schema$2f$buildRawSchema$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/schema/buildRawSchema.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$executeSchemaHooks$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/utilities/executeSchemaHooks.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$postgres$2f$schema$2f$buildDrizzleTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/postgres/schema/buildDrizzleTable.js [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$postgres$2f$schema$2f$setColumnID$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/@payloadcms/drizzle/dist/postgres/schema/setColumnID.js [app-route] (ecmascript)");
;
;
;
;
;
const init = async function init() {
    this.rawRelations = {};
    this.rawTables = {};
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$schema$2f$buildRawSchema$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildRawSchema"])({
        adapter: this,
        setColumnID: __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$postgres$2f$schema$2f$setColumnID$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["setColumnID"]
    });
    await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$executeSchemaHooks$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["executeSchemaHooks"])({
        type: 'beforeSchemaInit',
        adapter: this
    });
    if (this.payload.config.localization) {
        this.enums.enum__locales = this.pgSchema.enum('_locales', this.payload.config.localization.locales.map(({ code })=>code));
    }
    for(const tableName in this.rawTables){
        (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$postgres$2f$schema$2f$buildDrizzleTable$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildDrizzleTable"])({
            adapter: this,
            rawTable: this.rawTables[tableName]
        });
    }
    (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$schema$2f$buildDrizzleRelations$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["buildDrizzleRelations"])({
        adapter: this
    });
    await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f40$payloadcms$2f$drizzle$2f$dist$2f$utilities$2f$executeSchemaHooks$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["executeSchemaHooks"])({
        type: 'afterSchemaInit',
        adapter: this
    });
    this.schema = {
        pgSchema: this.pgSchema,
        ...this.tables,
        ...this.relations,
        ...this.enums
    };
}; //# sourceMappingURL=init.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/postgres/insert.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "insert",
    ()=>insert
]);
const insert = async function insert({ db, onConflictDoUpdate, tableName, values }) {
    const table = this.tables[tableName];
    let result;
    if (onConflictDoUpdate) {
        result = await db.insert(table).values(values).onConflictDoUpdate(onConflictDoUpdate).returning();
    } else {
        result = await db.insert(table).values(values).returning();
    }
    return result;
}; //# sourceMappingURL=insert.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/postgres/requireDrizzleKit.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "requireDrizzleKit",
    ()=>requireDrizzleKit
]);
var __TURBOPACK__imported__module__$5b$externals$5d2f$module__$5b$external$5d$__$28$module$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/module [external] (module, cjs)");
const __TURBOPACK__import$2e$meta__ = {
    get url () {
        return `file://${__turbopack_context__.P("node_modules/@payloadcms/drizzle/dist/postgres/requireDrizzleKit.js")}`;
    }
};
;
const require = (0, __TURBOPACK__imported__module__$5b$externals$5d2f$module__$5b$external$5d$__$28$module$2c$__cjs$29$__["createRequire"])(__TURBOPACK__import$2e$meta__.url);
const requireDrizzleKit = ()=>{
    const { generateDrizzleJson, generateMigration, pushSchema, upPgSnapshot } = __turbopack_context__.r("[project]/node_modules/drizzle-kit/api.js [app-route] (ecmascript)");
    return {
        generateDrizzleJson,
        generateMigration,
        pushSchema,
        upSnapshot: upPgSnapshot
    };
}; //# sourceMappingURL=requireDrizzleKit.js.map
}),
"[project]/node_modules/@payloadcms/drizzle/dist/utilities/pushDevSchema.js [app-route] (ecmascript)", ((__turbopack_context__) => {
"use strict";

__turbopack_context__.s([
    "pushDevSchema",
    ()=>pushDevSchema
]);
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$dequal$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/dequal/dist/index.mjs [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$prompts$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/prompts/index.js [app-route] (ecmascript)");
;
;
const previousSchema = {
    localeCodes: null,
    rawTables: null
};
const pushDevSchema = async (adapter)=>{
    if (process.env.PAYLOAD_FORCE_DRIZZLE_PUSH !== 'true') {
        const localeCodes = adapter.payload.config.localization && adapter.payload.config.localization.localeCodes;
        const equal = (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$dequal$2f$dist$2f$index$2e$mjs__$5b$app$2d$route$5d$__$28$ecmascript$29$__["dequal"])(previousSchema, {
            localeCodes,
            rawTables: adapter.rawTables
        });
        if (equal) {
            if (adapter.logger) {
                adapter.payload.logger.info('No changes detected in schema, skipping schema push.');
            }
            return;
        } else {
            previousSchema.localeCodes = localeCodes;
            previousSchema.rawTables = adapter.rawTables;
        }
    }
    const { pushSchema } = adapter.requireDrizzleKit();
    const { extensions = {}, tablesFilter } = adapter;
    // This will prompt if clarifications are needed for Drizzle to push new schema
    const { apply, hasDataLoss, warnings } = await pushSchema(adapter.schema, adapter.drizzle, adapter.schemaName ? [
        adapter.schemaName
    ] : undefined, tablesFilter, // https://github.com/drizzle-team/drizzle-orm/blob/83daf2d5cf023112de878bc2249ee2c41a2a5b1b/drizzle-kit/src/cli/validations/cli.ts#L26
    extensions.postgis ? [
        'postgis'
    ] : undefined);
    if (warnings.length) {
        let message = `Warnings detected during schema push: \n\n${warnings.join('\n')}\n\n`;
        if (hasDataLoss) {
            message += `DATA LOSS WARNING: Possible data loss detected if schema is pushed.\n\n`;
        }
        message += `Accept warnings and push schema to database?`;
        const { confirm: acceptWarnings } = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$prompts$2f$index$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["default"])({
            name: 'confirm',
            type: 'confirm',
            initial: false,
            message
        }, {
            onCancel: ()=>{
                process.exit(0);
            }
        });
        // Exit if user does not accept warnings.
        // Q: Is this the right type of exit for this interaction?
        if (!acceptWarnings) {
            process.exit(0);
        }
    }
    await apply();
    const migrationsTable = adapter.schemaName ? `"${adapter.schemaName}"."payload_migrations"` : '"payload_migrations"';
    const drizzle = adapter.drizzle;
    const result = await adapter.execute({
        drizzle,
        raw: `SELECT * FROM ${migrationsTable} WHERE batch = '-1'`
    });
    const devPush = result.rows;
    if (!devPush.length) {
        // Use drizzle for insert so $defaultFn's are called
        await drizzle.insert(adapter.tables.payload_migrations).values({
            name: 'dev',
            batch: -1
        });
    } else {
        await adapter.execute({
            drizzle,
            raw: `UPDATE ${migrationsTable} SET updated_at = CURRENT_TIMESTAMP WHERE batch = '-1'`
        });
    }
}; //# sourceMappingURL=pushDevSchema.js.map
}),
];

//# sourceMappingURL=node_modules_%40payloadcms_drizzle_dist_3e2148ab._.js.map