{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/operations/utilities/buildAfterOperation.ts"],"sourcesContent":["import type { CollectionSlug } from '../../../index.js'\nimport type { AfterOperationArg, OperationMap, OperationResult } from './types.js'\n\nexport const buildAfterOperation = async <\n  TOperationGeneric extends CollectionSlug,\n  O extends keyof OperationMap<TOperationGeneric> = keyof OperationMap<TOperationGeneric>,\n>(\n  operationArgs: { operation: O } & Omit<AfterOperationArg<TOperationGeneric>, 'req'>,\n): Promise<any | OperationResult<TOperationGeneric, O>> => {\n  const { args, collection, operation, overrideAccess, result } = operationArgs\n\n  let newResult = result as OperationResult<TOperationGeneric, O>\n\n  if (args.collection.config.hooks?.afterOperation?.length) {\n    for (const hook of args.collection.config.hooks.afterOperation) {\n      const hookResult = await hook({\n        args,\n        collection,\n        operation,\n        overrideAccess,\n        req: args.req,\n        result: newResult,\n      } as AfterOperationArg<TOperationGeneric>)\n\n      if (hookResult !== undefined) {\n        newResult = hookResult as OperationResult<TOperationGeneric, O>\n      }\n    }\n  }\n\n  return newResult\n}\n"],"names":["buildAfterOperation","operationArgs","args","collection","operation","overrideAccess","result","newResult","config","hooks","afterOperation","length","hook","hookResult","req","undefined"],"mappings":";;;;AAGO,MAAMA,sBAAsB,OAIjCC;IAEA,MAAM,EAAEC,IAAI,EAAEC,UAAU,EAAEC,SAAS,EAAEC,cAAc,EAAEC,MAAM,EAAE,GAAGL;IAEhE,IAAIM,YAAYD;IAEhB,IAAIJ,KAAKC,UAAU,CAACK,MAAM,CAACC,KAAK,EAAEC,gBAAgBC,QAAQ;QACxD,KAAK,MAAMC,QAAQV,KAAKC,UAAU,CAACK,MAAM,CAACC,KAAK,CAACC,cAAc,CAAE;YAC9D,MAAMG,aAAa,MAAMD,KAAK;gBAC5BV;gBACAC;gBACAC;gBACAC;gBACAS,KAAKZ,KAAKY,GAAG;gBACbR,QAAQC;YACV;YAEA,IAAIM,eAAeE,WAAW;gBAC5BR,YAAYM;YACd;QACF;IACF;IAEA,OAAON;AACT,EAAC"}},
    {"offset": {"line": 32, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/operations/utilities/types.ts"],"sourcesContent":["import type { forgotPasswordOperation } from '../../../auth/operations/forgotPassword.js'\nimport type { loginOperation } from '../../../auth/operations/login.js'\nimport type { refreshOperation } from '../../../auth/operations/refresh.js'\nimport type { resetPasswordOperation } from '../../../auth/operations/resetPassword.js'\nimport type { unlockOperation } from '../../../auth/operations/unlock.js'\nimport type { CollectionSlug, RequestContext, restoreVersionOperation } from '../../../index.js'\nimport type { PayloadRequest } from '../../../types/index.js'\nimport type { SanitizedCollectionConfig, SelectFromCollectionSlug } from '../../config/types.js'\nimport type { countOperation } from '../count.js'\nimport type { countVersionsOperation } from '../countVersions.js'\nimport type { createOperation } from '../create.js'\nimport type { deleteOperation } from '../delete.js'\nimport type { deleteByIDOperation } from '../deleteByID.js'\nimport type { findOperation } from '../find.js'\nimport type { findByIDOperation } from '../findByID.js'\nimport type { findDistinctOperation } from '../findDistinct.js'\nimport type { findVersionByIDOperation } from '../findVersionByID.js'\nimport type { findVersionsOperation } from '../findVersions.js'\nimport type { updateOperation } from '../update.js'\nimport type { updateByIDOperation } from '../updateByID.js'\n\nexport type OperationMap<TOperationGeneric extends CollectionSlug> = {\n  count: typeof countOperation<TOperationGeneric>\n  countVersions: typeof countVersionsOperation<TOperationGeneric>\n  create: typeof createOperation<TOperationGeneric, SelectFromCollectionSlug<TOperationGeneric>>\n  delete: typeof deleteOperation<TOperationGeneric, SelectFromCollectionSlug<TOperationGeneric>>\n  deleteByID: typeof deleteByIDOperation<\n    TOperationGeneric,\n    SelectFromCollectionSlug<TOperationGeneric>\n  >\n  find: typeof findOperation<TOperationGeneric, SelectFromCollectionSlug<TOperationGeneric>>\n  findByID: typeof findByIDOperation<\n    TOperationGeneric,\n    boolean,\n    SelectFromCollectionSlug<TOperationGeneric>\n  >\n  findDistinct: typeof findDistinctOperation\n  findVersionByID: typeof findVersionByIDOperation\n  findVersions: typeof findVersionsOperation\n  forgotPassword: typeof forgotPasswordOperation\n  login: typeof loginOperation<TOperationGeneric>\n  refresh: typeof refreshOperation\n  resetPassword: typeof resetPasswordOperation<TOperationGeneric>\n  restoreVersion: typeof restoreVersionOperation\n  unlock: typeof unlockOperation<TOperationGeneric>\n  update: typeof updateOperation<TOperationGeneric, SelectFromCollectionSlug<TOperationGeneric>>\n  updateByID: typeof updateByIDOperation<\n    TOperationGeneric,\n    SelectFromCollectionSlug<TOperationGeneric>\n  >\n}\n\nexport type AfterOperationArg<TOperationGeneric extends CollectionSlug> = {\n  /** The collection which this hook is being run on */\n  collection: SanitizedCollectionConfig\n  /**\n   * Whether access control is being overridden for this operation\n   */\n  overrideAccess?: boolean\n  req: PayloadRequest\n} & (\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['count']>[0]\n      operation: 'count'\n      result: Awaited<ReturnType<OperationMap<TOperationGeneric>['count']>>\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['countVersions']>[0]\n      operation: 'countVersions'\n      result: Awaited<ReturnType<OperationMap<TOperationGeneric>['countVersions']>>\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['create']>[0]\n      operation: 'create'\n      result: Awaited<ReturnType<OperationMap<TOperationGeneric>['create']>>\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['delete']>[0]\n      operation: 'delete'\n      result: Awaited<ReturnType<OperationMap<TOperationGeneric>['delete']>>\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['deleteByID']>[0]\n      operation: 'deleteByID'\n      result: Awaited<ReturnType<OperationMap<TOperationGeneric>['deleteByID']>>\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['find']>[0]\n      /**\n       * @deprecated Use 'find' or 'findByID' operation instead\n       *\n       * TODO: v4 - remove this union option\n       */\n      operation: 'read'\n      result: Awaited<ReturnType<OperationMap<TOperationGeneric>['find']>>\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['find']>[0]\n      operation: 'find'\n      result: Awaited<ReturnType<OperationMap<TOperationGeneric>['find']>>\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['findByID']>[0]\n      operation: 'findByID'\n      result: Awaited<ReturnType<OperationMap<TOperationGeneric>['findByID']>>\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['findDistinct']>[0]\n      operation: 'findDistinct'\n      result: Awaited<ReturnType<OperationMap<TOperationGeneric>['findDistinct']>>\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['findVersionByID']>[0]\n      operation: 'findVersionByID'\n      result: Awaited<ReturnType<OperationMap<TOperationGeneric>['findVersionByID']>>\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['findVersions']>[0]\n      operation: 'findVersions'\n      result: Awaited<ReturnType<OperationMap<TOperationGeneric>['findVersions']>>\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['forgotPassword']>[0]\n      operation: 'forgotPassword'\n      result: Awaited<ReturnType<OperationMap<TOperationGeneric>['forgotPassword']>>\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['login']>[0]\n      operation: 'login'\n      result: Awaited<ReturnType<OperationMap<TOperationGeneric>['login']>>\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['refresh']>[0]\n      operation: 'refresh'\n      result: Awaited<ReturnType<OperationMap<TOperationGeneric>['refresh']>>\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['resetPassword']>[0]\n      operation: 'resetPassword'\n      result: Awaited<ReturnType<OperationMap<TOperationGeneric>['resetPassword']>>\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['restoreVersion']>[0]\n      operation: 'restoreVersion'\n      result: Awaited<ReturnType<OperationMap<TOperationGeneric>['restoreVersion']>>\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['unlock']>[0]\n      operation: 'unlock'\n      result: Awaited<ReturnType<OperationMap<TOperationGeneric>['unlock']>>\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['update']>[0]\n      operation: 'update'\n      result: Awaited<ReturnType<OperationMap<TOperationGeneric>['update']>>\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['updateByID']>[0]\n      operation: 'updateByID'\n      result: Awaited<ReturnType<OperationMap<TOperationGeneric>['updateByID']>>\n    }\n)\n\nexport type OperationResult<\n  TOperationGeneric extends CollectionSlug,\n  O extends keyof OperationMap<TOperationGeneric>,\n> = Awaited<ReturnType<OperationMap<TOperationGeneric>[O]>>\n\nexport type OperationArgs<\n  TOperationGeneric extends CollectionSlug,\n  O extends keyof OperationMap<TOperationGeneric>,\n> = Parameters<OperationMap<TOperationGeneric>[O]>[0]\n\n// Map internal operation names to HookOperationType\nexport const operationToHookOperation = {\n  count: 'count',\n  countVersions: 'countVersions',\n  create: 'create',\n  delete: 'delete',\n  deleteByID: 'delete',\n  find: 'read',\n  findByID: 'read',\n  findDistinct: 'readDistinct',\n  findVersionByID: 'read',\n  findVersions: 'read',\n  forgotPassword: 'forgotPassword',\n  login: 'login',\n  read: 'read',\n  readDistinct: 'readDistinct',\n  refresh: 'refresh',\n  resetPassword: 'resetPassword',\n  restoreVersion: 'restoreVersion',\n  unlock: 'unlock',\n  update: 'update',\n  updateByID: 'update',\n} as const\n\nexport type BeforeOperationArg<TOperationGeneric extends CollectionSlug> = {\n  /** The collection which this hook is being run on */\n  collection: SanitizedCollectionConfig\n  context: RequestContext\n  /**\n   * Whether access control is being overridden for this operation\n   */\n  overrideAccess?: boolean\n  req: PayloadRequest\n} & (\n  | {\n      args:\n        | Parameters<OperationMap<TOperationGeneric>['find']>[0]\n        | Parameters<OperationMap<TOperationGeneric>['findByID']>[0]\n      /**\n       * @deprecated Use 'find' or 'findByID' operation instead\n       *\n       * TODO: v4 - remove this union option\n       */\n      operation: 'read'\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['count']>[0]\n      operation: 'count'\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['countVersions']>[0]\n      operation: 'countVersions'\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['create']>[0]\n      operation: 'create'\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['delete']>[0]\n      operation: 'delete'\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['deleteByID']>[0]\n      operation: 'deleteByID'\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['find']>[0]\n      operation: 'find'\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['findByID']>[0]\n      operation: 'findByID'\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['findDistinct']>[0]\n      /**\n       * @deprecated Use 'findDistinct' operation instead\n       *\n       * TODO: v4 - remove this union option\n       */\n      operation: 'readDistinct'\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['findDistinct']>[0]\n      operation: 'findDistinct'\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['findVersionByID']>[0]\n      operation: 'findVersionByID'\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['findVersions']>[0]\n      operation: 'findVersions'\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['forgotPassword']>[0]\n      operation: 'forgotPassword'\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['login']>[0]\n      operation: 'login'\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['refresh']>[0]\n      operation: 'refresh'\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['resetPassword']>[0]\n      operation: 'resetPassword'\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['restoreVersion']>[0]\n      operation: 'restoreVersion'\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['unlock']>[0]\n      operation: 'unlock'\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['update']>[0]\n      operation: 'update'\n    }\n  | {\n      args: Parameters<OperationMap<TOperationGeneric>['updateByID']>[0]\n      operation: 'updateByID'\n    }\n)\n"],"names":["operationToHookOperation","count","countVersions","create","delete","deleteByID","find","findByID","findDistinct","findVersionByID","findVersions","forgotPassword","login","read","readDistinct","refresh","resetPassword","restoreVersion","unlock","update","updateByID"],"mappings":"AA6KA,oDAAoD;;;;;AAC7C,MAAMA,2BAA2B;IACtCC,OAAO;IACPC,eAAe;IACfC,QAAQ;IACRC,QAAQ;IACRC,YAAY;IACZC,MAAM;IACNC,UAAU;IACVC,cAAc;IACdC,iBAAiB;IACjBC,cAAc;IACdC,gBAAgB;IAChBC,OAAO;IACPC,MAAM;IACNC,cAAc;IACdC,SAAS;IACTC,eAAe;IACfC,gBAAgB;IAChBC,QAAQ;IACRC,QAAQ;IACRC,YAAY;AACd,EAAU"}},
    {"offset": {"line": 63, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/operations/utilities/buildBeforeOperation.ts"],"sourcesContent":["import type { CollectionSlug } from '../../../index.js'\nimport type { BeforeOperationArg, OperationArgs, OperationMap } from './types.js'\n\nimport { operationToHookOperation } from './types.js'\n// Specific overloads with TArgs (these take priority over the general overload)\n// Overload for 'read' operation (deprecated, backward compatibility)\n\n/**\n * TODO V4: remove overloads and operations should be the literal operation that was called\n *\n * - `read`: replace with `find` and `findByID` in both operations\n * - `delete`: replace with `deleteByID` in deleteByID operation\n * - `update`: replace with `updateByID` in updateByID operation\n */\n\n/**\n * @deprecated\n *\n * Should use `find` or `findByID`\n */\nexport async function buildBeforeOperation<TOperationGeneric extends CollectionSlug, TArgs>(\n  operationArgs: {\n    args: TArgs\n    operation: 'read'\n  } & Omit<BeforeOperationArg<TOperationGeneric>, 'args' | 'context' | 'operation' | 'req'>,\n): Promise<TArgs>\n\n/**\n * Overload for 'readDistinct' operation\n *\n * @deprecated - use `findDistinct`\n */\nexport async function buildBeforeOperation<TOperationGeneric extends CollectionSlug, TArgs>(\n  operationArgs: {\n    args: TArgs\n    operation: 'readDistinct'\n  } & Omit<BeforeOperationArg<TOperationGeneric>, 'args' | 'context' | 'operation' | 'req'>,\n): Promise<TArgs>\n\n// Overload for 'update' operation (can be called by both update and updateByID)\nexport async function buildBeforeOperation<TOperationGeneric extends CollectionSlug, TArgs>(\n  operationArgs: {\n    args: TArgs\n    operation: 'update'\n  } & Omit<BeforeOperationArg<TOperationGeneric>, 'args' | 'context' | 'operation' | 'req'>,\n): Promise<TArgs>\n\n// Overload for 'updateByID' operation\nexport async function buildBeforeOperation<TOperationGeneric extends CollectionSlug, TArgs>(\n  operationArgs: {\n    args: TArgs\n    operation: 'updateByID'\n  } & Omit<BeforeOperationArg<TOperationGeneric>, 'args' | 'context' | 'operation' | 'req'>,\n): Promise<TArgs>\n\nexport async function buildBeforeOperation<TOperationGeneric extends CollectionSlug, TArgs>(\n  operationArgs: {\n    args: TArgs\n    operation: 'delete'\n  } & Omit<BeforeOperationArg<TOperationGeneric>, 'args' | 'context' | 'operation' | 'req'>,\n): Promise<TArgs>\n\n// Overload for 'deleteByID' operation\nexport async function buildBeforeOperation<TOperationGeneric extends CollectionSlug, TArgs>(\n  operationArgs: {\n    args: TArgs\n    operation: 'deleteByID'\n  } & Omit<BeforeOperationArg<TOperationGeneric>, 'args' | 'context' | 'operation' | 'req'>,\n): Promise<TArgs>\n\n// General overload for operations that exist in OperationMap (fallback)\nexport async function buildBeforeOperation<\n  TOperationGeneric extends CollectionSlug,\n  O extends keyof OperationMap<TOperationGeneric>,\n>(\n  operationArgs: { operation: O } & Omit<BeforeOperationArg<TOperationGeneric>, 'context' | 'req'>,\n): Promise<OperationArgs<TOperationGeneric, O>>\n\n// Implementation\nexport async function buildBeforeOperation<TOperationGeneric extends CollectionSlug>(\n  operationArgs: Omit<BeforeOperationArg<TOperationGeneric>, 'context' | 'req'>,\n): Promise<unknown> {\n  const { args, collection, operation, overrideAccess } = operationArgs\n\n  let newArgs = args\n\n  if (args.collection.config.hooks?.beforeOperation?.length) {\n    // TODO: v4 should not need this mapping\n    // Map the operation to the hook operation type for backward compatibility\n    const hookOperation = operationToHookOperation[operation]\n\n    for (const hook of args.collection.config.hooks.beforeOperation) {\n      const hookResult = await hook({\n        args: newArgs,\n        collection,\n        context: args.req!.context,\n        operation: hookOperation,\n        overrideAccess,\n        req: args.req!,\n      } as BeforeOperationArg<TOperationGeneric>)\n\n      if (hookResult !== undefined) {\n        newArgs = hookResult\n      }\n    }\n  }\n\n  return newArgs\n}\n"],"names":["operationToHookOperation","buildBeforeOperation","operationArgs","args","collection","operation","overrideAccess","newArgs","config","hooks","beforeOperation","length","hookOperation","hook","hookResult","context","req","undefined"],"mappings":";;;;AAGA,SAASA,wBAAwB,QAAQ,aAAY;;AA4E9C,eAAeC,qBACpBC,aAA6E;IAE7E,MAAM,EAAEC,IAAI,EAAEC,UAAU,EAAEC,SAAS,EAAEC,cAAc,EAAE,GAAGJ;IAExD,IAAIK,UAAUJ;IAEd,IAAIA,KAAKC,UAAU,CAACI,MAAM,CAACC,KAAK,EAAEC,iBAAiBC,QAAQ;QACzD,wCAAwC;QACxC,0EAA0E;QAC1E,MAAMC,gBAAgBZ,gNAAwB,CAACK,UAAU;QAEzD,KAAK,MAAMQ,QAAQV,KAAKC,UAAU,CAACI,MAAM,CAACC,KAAK,CAACC,eAAe,CAAE;YAC/D,MAAMI,aAAa,MAAMD,KAAK;gBAC5BV,MAAMI;gBACNH;gBACAW,SAASZ,KAAKa,GAAG,CAAED,OAAO;gBAC1BV,WAAWO;gBACXN;gBACAU,KAAKb,KAAKa,GAAG;YACf;YAEA,IAAIF,eAAeG,WAAW;gBAC5BV,UAAUO;YACZ;QACF;IACF;IAEA,OAAOP;AACT"}},
    {"offset": {"line": 96, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/dataloader.ts"],"sourcesContent":["import type { BatchLoadFn } from 'dataloader'\n\nimport DataLoader from 'dataloader'\n\nimport type { FindArgs } from '../database/types.js'\nimport type { Payload, TypedFallbackLocale } from '../index.js'\nimport type { PayloadRequest, PopulateType, SelectType } from '../types/index.js'\nimport type { TypeWithID } from './config/types.js'\nimport type { FindOptions } from './operations/local/find.js'\n\nimport { isValidID } from '../utilities/isValidID.js'\n\n// Payload uses `dataloader` to solve the classic GraphQL N+1 problem.\n\n// We keep a list of all documents requested to be populated for any given request\n// and then batch together documents within the same collection,\n// making only 1 find per each collection, rather than `findByID` per each requested doc.\n\n// This dramatically improves performance for REST and Local API `depth` populations,\n// and also ensures complex GraphQL queries perform lightning-fast.\n\nconst batchAndLoadDocs =\n  (req: PayloadRequest): BatchLoadFn<string, TypeWithID> =>\n  async (keys: readonly string[]): Promise<TypeWithID[]> => {\n    const { payload } = req\n\n    // Create docs array of same length as keys, using null as value\n    // We will replace nulls with injected docs as they are retrieved\n    const docs: (null | TypeWithID)[] = keys.map(() => null)\n\n    /**\n    * Batch IDs by their `find` args\n    * so we can make one find query per combination of collection, depth, locale, and fallbackLocale.\n    *\n    * Resulting shape will be as follows:\n      {\n        // key is stringified set of find args\n        '[null,\"pages\",2,0,\"es\",\"en\",false,false]': [\n          // value is array of IDs to find with these args\n          'q34tl23462346234524',\n          '435523540194324280',\n          '2346245j35l3j5234532li',\n        ],\n        // etc\n      };\n    *\n    **/\n\n    const batchByFindArgs: Record<string, string[]> = {}\n\n    for (const key of keys) {\n      const [\n        transactionID,\n        collection,\n        id,\n        depth,\n        currentDepth,\n        locale,\n        fallbackLocale,\n        overrideAccess,\n        showHiddenFields,\n        draft,\n        select,\n        populate,\n      ] = JSON.parse(key)\n\n      const batchKeyArray = [\n        transactionID,\n        collection,\n        depth,\n        currentDepth,\n        locale,\n        fallbackLocale,\n        overrideAccess,\n        showHiddenFields,\n        draft,\n        select,\n        populate,\n      ]\n\n      const batchKey = JSON.stringify(batchKeyArray)\n\n      const idType = payload.collections?.[collection]?.customIDType || payload.db.defaultIDType\n      const sanitizedID = idType === 'number' ? parseFloat(id) : id\n\n      if (isValidID(sanitizedID, idType)) {\n        batchByFindArgs[batchKey] = [...(batchByFindArgs[batchKey] || []), sanitizedID]\n      }\n    }\n\n    // Run find requests one after another, so as to not hang transactions\n\n    for (const [batchKey, ids] of Object.entries(batchByFindArgs)) {\n      const [\n        transactionID,\n        collection,\n        depth,\n        currentDepth,\n        locale,\n        fallbackLocale,\n        overrideAccess,\n        showHiddenFields,\n        draft,\n        select,\n        populate,\n      ] = JSON.parse(batchKey)\n\n      req.transactionID = transactionID\n\n      const result = await payload.find({\n        collection,\n        currentDepth,\n        depth,\n        disableErrors: true,\n        draft,\n        fallbackLocale,\n        locale,\n        overrideAccess: Boolean(overrideAccess),\n        pagination: false,\n        populate,\n        req,\n        select,\n        showHiddenFields: Boolean(showHiddenFields),\n        where: {\n          id: {\n            in: ids,\n          },\n        },\n      })\n\n      // For each returned doc, find index in original keys\n      // Inject doc within docs array if index exists\n      for (const doc of result.docs) {\n        const docKey = createDataloaderCacheKey({\n          collectionSlug: collection,\n          currentDepth,\n          depth,\n          docID: doc.id,\n          draft,\n          fallbackLocale,\n          locale,\n          overrideAccess,\n          populate,\n          select,\n          showHiddenFields,\n          transactionID: req.transactionID!,\n        })\n        const docsIndex = keys.findIndex((key) => key === docKey)\n\n        if (docsIndex > -1) {\n          docs[docsIndex] = doc\n        }\n      }\n    }\n\n    // Return docs array,\n    // which has now been injected with all fetched docs\n    // and should match the length of the incoming keys arg\n    return docs as TypeWithID[]\n  }\n\nexport const getDataLoader = (req: PayloadRequest) => {\n  const findQueries = new Map()\n  const dataLoader = new DataLoader(batchAndLoadDocs(req)) as PayloadRequest['payloadDataLoader']\n\n  dataLoader.find = ((args: FindArgs) => {\n    const key = createFindDataloaderCacheKey(args)\n    const cached = findQueries.get(key)\n    if (cached) {\n      return cached\n    }\n    const request = req.payload.find(args)\n    findQueries.set(key, request)\n    return request\n  }) as Payload['find']\n\n  return dataLoader\n}\n\nconst createFindDataloaderCacheKey = ({\n  collection,\n  currentDepth,\n  depth,\n  disableErrors,\n  draft,\n  includeLockStatus,\n  joins,\n  limit,\n  overrideAccess,\n  page,\n  pagination,\n  populate,\n  req,\n  select,\n  showHiddenFields,\n  sort,\n  where,\n}: FindOptions<string, SelectType>): string =>\n  JSON.stringify([\n    collection,\n    currentDepth,\n    depth,\n    disableErrors,\n    draft,\n    includeLockStatus,\n    joins,\n    limit,\n    overrideAccess,\n    page,\n    pagination,\n    populate,\n    req?.locale,\n    req?.fallbackLocale,\n    req?.user?.id,\n    req?.transactionID,\n    select,\n    showHiddenFields,\n    sort,\n    where,\n  ])\n\ntype CreateCacheKeyArgs = {\n  collectionSlug: string\n  currentDepth: number\n  depth: number\n  docID: number | string\n  draft: boolean\n  fallbackLocale: TypedFallbackLocale\n  locale: string | string[]\n  overrideAccess: boolean\n  populate?: PopulateType\n  select?: SelectType\n  showHiddenFields: boolean\n  transactionID: number | Promise<number | string> | string\n}\nexport const createDataloaderCacheKey = ({\n  collectionSlug,\n  currentDepth,\n  depth,\n  docID,\n  draft,\n  fallbackLocale,\n  locale,\n  overrideAccess,\n  populate,\n  select,\n  showHiddenFields,\n  transactionID,\n}: CreateCacheKeyArgs): string =>\n  JSON.stringify([\n    transactionID,\n    collectionSlug,\n    docID,\n    depth,\n    currentDepth,\n    locale,\n    fallbackLocale,\n    overrideAccess,\n    showHiddenFields,\n    draft,\n    select,\n    populate,\n  ])\n"],"names":["DataLoader","isValidID","batchAndLoadDocs","req","keys","payload","docs","map","batchByFindArgs","key","transactionID","collection","id","depth","currentDepth","locale","fallbackLocale","overrideAccess","showHiddenFields","draft","select","populate","JSON","parse","batchKeyArray","batchKey","stringify","idType","collections","customIDType","db","defaultIDType","sanitizedID","parseFloat","ids","Object","entries","result","find","disableErrors","Boolean","pagination","where","in","doc","docKey","createDataloaderCacheKey","collectionSlug","docID","docsIndex","findIndex","getDataLoader","findQueries","Map","dataLoader","args","createFindDataloaderCacheKey","cached","get","request","set","includeLockStatus","joins","limit","page","sort","user"],"mappings":"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"}},
    {"offset": {"line": 266, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/operations/count.ts"],"sourcesContent":["import type { AccessResult } from '../../config/types.js'\nimport type { CollectionSlug } from '../../index.js'\nimport type { PayloadRequest, Where } from '../../types/index.js'\nimport type { Collection } from '../config/types.js'\n\nimport { executeAccess } from '../../auth/executeAccess.js'\nimport { combineQueries } from '../../database/combineQueries.js'\nimport { validateQueryPaths } from '../../database/queryValidation/validateQueryPaths.js'\nimport { sanitizeWhereQuery } from '../../database/sanitizeWhereQuery.js'\nimport { appendNonTrashedFilter } from '../../utilities/appendNonTrashedFilter.js'\nimport { killTransaction } from '../../utilities/killTransaction.js'\nimport { buildAfterOperation } from './utilities/buildAfterOperation.js'\nimport { buildBeforeOperation } from './utilities/buildBeforeOperation.js'\n\nexport type Arguments = {\n  collection: Collection\n  disableErrors?: boolean\n  overrideAccess?: boolean\n  req?: PayloadRequest\n  trash?: boolean\n  where?: Where\n}\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\nexport const countOperation = async <TSlug extends CollectionSlug>(\n  incomingArgs: Arguments,\n): Promise<{ totalDocs: number }> => {\n  let args = incomingArgs\n\n  try {\n    // /////////////////////////////////////\n    // beforeOperation - Collection\n    // /////////////////////////////////////\n\n    args = await buildBeforeOperation({\n      args,\n      collection: args.collection.config,\n      operation: 'count',\n      overrideAccess: args.overrideAccess!,\n    })\n\n    const {\n      collection: { config: collectionConfig },\n      disableErrors,\n      overrideAccess,\n      req,\n      trash = false,\n      where,\n    } = args\n\n    const { payload } = req!\n\n    // /////////////////////////////////////\n    // Access\n    // /////////////////////////////////////\n\n    let accessResult: AccessResult\n\n    if (!overrideAccess) {\n      accessResult = await executeAccess({ disableErrors, req: req! }, collectionConfig.access.read)\n\n      // If errors are disabled, and access returns false, return empty results\n      if (accessResult === false) {\n        return {\n          totalDocs: 0,\n        }\n      }\n    }\n\n    let result: { totalDocs: number }\n\n    let fullWhere = combineQueries(where!, accessResult!)\n    sanitizeWhereQuery({ fields: collectionConfig.flattenedFields, payload, where: fullWhere })\n\n    // Exclude trashed documents when trash: false\n    fullWhere = appendNonTrashedFilter({\n      enableTrash: collectionConfig.trash,\n      trash,\n      where: fullWhere,\n    })\n\n    await validateQueryPaths({\n      collectionConfig,\n      overrideAccess: overrideAccess!,\n      req: req!,\n      where: where!,\n    })\n\n    result = await payload.db.count({\n      collection: collectionConfig.slug,\n      req,\n      where: fullWhere,\n    })\n\n    // /////////////////////////////////////\n    // afterOperation - Collection\n    // /////////////////////////////////////\n\n    result = await buildAfterOperation({\n      args,\n      collection: collectionConfig,\n      operation: 'count',\n      overrideAccess,\n      result,\n    })\n\n    // /////////////////////////////////////\n    // Return results\n    // /////////////////////////////////////\n\n    return result\n  } catch (error: unknown) {\n    await killTransaction(args.req!)\n    throw error\n  }\n}\n"],"names":["executeAccess","combineQueries","validateQueryPaths","sanitizeWhereQuery","appendNonTrashedFilter","killTransaction","buildAfterOperation","buildBeforeOperation","countOperation","incomingArgs","args","collection","config","operation","overrideAccess","collectionConfig","disableErrors","req","trash","where","payload","accessResult","access","read","totalDocs","result","fullWhere","fields","flattenedFields","enableTrash","db","count","slug","error"],"mappings":";;;;AAKA,SAASA,aAAa,QAAQ,8BAA6B;AAC3D,SAASC,cAAc,QAAQ,mCAAkC;AACjE,SAASC,kBAAkB,QAAQ,uDAAsD;AACzF,SAASC,kBAAkB,QAAQ,uCAAsC;AACzE,SAASC,sBAAsB,QAAQ,4CAA2C;AAClF,SAASC,eAAe,QAAQ,qCAAoC;AACpE,SAASC,mBAAmB,QAAQ,qCAAoC;AACxE,SAASC,oBAAoB,QAAQ,sCAAqC;;;;;;;;;AAYnE,MAAMC,iBAAiB,OAC5BC;IAEA,IAAIC,OAAOD;IAEX,IAAI;QACF,wCAAwC;QACxC,+BAA+B;QAC/B,wCAAwC;QAExCC,OAAO,UAAMH,2NAAAA,EAAqB;YAChCG;YACAC,YAAYD,KAAKC,UAAU,CAACC,MAAM;YAClCC,WAAW;YACXC,gBAAgBJ,KAAKI,cAAc;QACrC;QAEA,MAAM,EACJH,YAAY,EAAEC,QAAQG,gBAAgB,EAAE,EACxCC,aAAa,EACbF,cAAc,EACdG,GAAG,EACHC,QAAQ,KAAK,EACbC,KAAK,EACN,GAAGT;QAEJ,MAAM,EAAEU,OAAO,EAAE,GAAGH;QAEpB,wCAAwC;QACxC,SAAS;QACT,wCAAwC;QAExC,IAAII;QAEJ,IAAI,CAACP,gBAAgB;YACnBO,eAAe,UAAMrB,2KAAAA,EAAc;gBAAEgB;gBAAeC,KAAKA;YAAK,GAAGF,iBAAiBO,MAAM,CAACC,IAAI;YAE7F,yEAAyE;YACzE,IAAIF,iBAAiB,OAAO;gBAC1B,OAAO;oBACLG,WAAW;gBACb;YACF;QACF;QAEA,IAAIC;QAEJ,IAAIC,gBAAYzB,iLAAAA,EAAekB,OAAQE;YACvClB,yLAAAA,EAAmB;YAAEwB,QAAQZ,iBAAiBa,eAAe;YAAER;YAASD,OAAOO;QAAU;QAEzF,8CAA8C;QAC9CA,gBAAYtB,kMAAAA,EAAuB;YACjCyB,aAAad,iBAAiBG,KAAK;YACnCA;YACAC,OAAOO;QACT;QAEA,UAAMxB,4MAAAA,EAAmB;YACvBa;YACAD,gBAAgBA;YAChBG,KAAKA;YACLE,OAAOA;QACT;QAEAM,SAAS,MAAML,QAAQU,EAAE,CAACC,KAAK,CAAC;YAC9BpB,YAAYI,iBAAiBiB,IAAI;YACjCf;YACAE,OAAOO;QACT;QAEA,wCAAwC;QACxC,8BAA8B;QAC9B,wCAAwC;QAExCD,SAAS,UAAMnB,yNAAAA,EAAoB;YACjCI;YACAC,YAAYI;YACZF,WAAW;YACXC;YACAW;QACF;QAEA,wCAAwC;QACxC,iBAAiB;QACjB,wCAAwC;QAExC,OAAOA;IACT,EAAE,OAAOQ,OAAgB;QACvB,UAAM5B,oLAAAA,EAAgBK,KAAKO,GAAG;QAC9B,MAAMgB;IACR;AACF,EAAC"}},
    {"offset": {"line": 363, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/endpoints/count.ts"],"sourcesContent":["import { status as httpStatus } from 'http-status'\n\nimport type { PayloadHandler } from '../../config/types.js'\n\nimport { getRequestCollection } from '../../utilities/getRequestEntity.js'\nimport { parseParams } from '../../utilities/parseParams/index.js'\nimport { countOperation } from '../operations/count.js'\n\nexport const countHandler: PayloadHandler = async (req) => {\n  const collection = getRequestCollection(req)\n\n  const { trash, where } = parseParams(req.query)\n\n  const result = await countOperation({\n    collection,\n    req,\n    trash,\n    where,\n  })\n\n  return Response.json(result, {\n    status: httpStatus.OK,\n  })\n}\n"],"names":["status","httpStatus","getRequestCollection","parseParams","countOperation","countHandler","req","collection","trash","where","query","result","Response","json","OK"],"mappings":";;;;;AAAA,SAASA,UAAUC,UAAU,QAAQ,cAAa;AAIlD,SAASC,oBAAoB,QAAQ,sCAAqC;AAC1E,SAASC,WAAW,QAAQ,uCAAsC;AAClE,SAASC,cAAc,QAAQ,yBAAwB;;;;;AAEhD,MAAMC,eAA+B,OAAOC;IACjD,MAAMC,iBAAaL,0LAAAA,EAAqBI;IAExC,MAAM,EAAEE,KAAK,EAAEC,KAAK,EAAE,OAAGN,qLAAAA,EAAYG,IAAII,KAAK;IAE9C,MAAMC,SAAS,UAAMP,yLAAAA,EAAe;QAClCG;QACAD;QACAE;QACAC;IACF;IAEA,OAAOG,SAASC,IAAI,CAACF,QAAQ;QAC3BX,QAAQC,sMAAAA,CAAWa,EAAE;IACvB;AACF,EAAC"}},
    {"offset": {"line": 393, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/operations/create.ts"],"sourcesContent":["import crypto from 'crypto'\n\nimport type { CollectionSlug, FindOptions, JsonObject } from '../../index.js'\nimport type {\n  Document,\n  PayloadRequest,\n  PopulateType,\n  SelectType,\n  TransformCollectionWithSelect,\n} from '../../types/index.js'\nimport type {\n  Collection,\n  DataFromCollectionSlug,\n  RequiredDataFromCollectionSlug,\n  SelectFromCollectionSlug,\n} from '../config/types.js'\n\nimport { ensureUsernameOrEmail } from '../../auth/ensureUsernameOrEmail.js'\nimport { executeAccess } from '../../auth/executeAccess.js'\nimport { sendVerificationEmail } from '../../auth/sendVerificationEmail.js'\nimport { registerLocalStrategy } from '../../auth/strategies/local/register.js'\nimport { getDuplicateDocumentData } from '../../duplicateDocument/index.js'\nimport { afterChange } from '../../fields/hooks/afterChange/index.js'\nimport { afterRead } from '../../fields/hooks/afterRead/index.js'\nimport { beforeChange } from '../../fields/hooks/beforeChange/index.js'\nimport { beforeValidate } from '../../fields/hooks/beforeValidate/index.js'\nimport { saveVersion } from '../../index.js'\nimport { generateFileData } from '../../uploads/generateFileData.js'\nimport { unlinkTempFiles } from '../../uploads/unlinkTempFiles.js'\nimport { uploadFiles } from '../../uploads/uploadFiles.js'\nimport { commitTransaction } from '../../utilities/commitTransaction.js'\nimport {\n  hasDraftsEnabled,\n  hasDraftValidationEnabled,\n  hasLocalizeStatusEnabled,\n} from '../../utilities/getVersionsConfig.js'\nimport { initTransaction } from '../../utilities/initTransaction.js'\nimport { killTransaction } from '../../utilities/killTransaction.js'\nimport { sanitizeInternalFields } from '../../utilities/sanitizeInternalFields.js'\nimport { sanitizeSelect } from '../../utilities/sanitizeSelect.js'\nimport { buildAfterOperation } from './utilities/buildAfterOperation.js'\nimport { buildBeforeOperation } from './utilities/buildBeforeOperation.js'\n\nexport type Arguments<TSlug extends CollectionSlug> = {\n  autosave?: boolean\n  collection: Collection\n  data: RequiredDataFromCollectionSlug<TSlug>\n  depth?: number\n  disableTransaction?: boolean\n  disableVerificationEmail?: boolean\n  draft?: boolean\n  duplicateFromID?: DataFromCollectionSlug<TSlug>['id']\n  overrideAccess?: boolean\n  overwriteExistingFiles?: boolean\n  populate?: PopulateType\n  publishAllLocales?: boolean\n  publishSpecificLocale?: string\n  req: PayloadRequest\n  selectedLocales?: string[]\n  showHiddenFields?: boolean\n} & Pick<FindOptions<TSlug, SelectType>, 'select'>\n\nexport const createOperation = async <\n  TSlug extends CollectionSlug,\n  TSelect extends SelectFromCollectionSlug<TSlug>,\n>(\n  incomingArgs: Arguments<TSlug>,\n): Promise<TransformCollectionWithSelect<TSlug, TSelect>> => {\n  let args = incomingArgs\n\n  try {\n    const shouldCommit = !args.disableTransaction && (await initTransaction(args.req))\n\n    ensureUsernameOrEmail<TSlug>({\n      authOptions: args.collection.config.auth,\n      collectionSlug: args.collection.config.slug,\n      data: args.data,\n      operation: 'create',\n      req: args.req,\n    })\n\n    // /////////////////////////////////////\n    // beforeOperation - Collection\n    // /////////////////////////////////////\n\n    args = await buildBeforeOperation({\n      args,\n      collection: args.collection.config,\n      operation: 'create',\n      overrideAccess: args.overrideAccess!,\n    })\n\n    if (args.publishSpecificLocale) {\n      args.req.locale = args.publishSpecificLocale\n    }\n\n    const {\n      autosave = false,\n      collection: { config: collectionConfig },\n      collection,\n      depth,\n      disableVerificationEmail,\n      draft = false,\n      duplicateFromID,\n      overrideAccess,\n      overwriteExistingFiles = false,\n      populate,\n      publishAllLocales: publishAllLocalesArg,\n      publishSpecificLocale,\n      req: {\n        fallbackLocale,\n        locale,\n        payload,\n        payload: { config },\n      },\n      req,\n      select: incomingSelect,\n      selectedLocales,\n      showHiddenFields,\n    } = args\n\n    let { data } = args\n\n    const publishAllLocales =\n      !draft &&\n      (publishAllLocalesArg ?? (hasLocalizeStatusEnabled(collectionConfig) ? false : true))\n    const isSavingDraft = Boolean(draft && hasDraftsEnabled(collectionConfig) && !publishAllLocales)\n\n    if (isSavingDraft) {\n      data._status = 'draft'\n    }\n\n    let duplicatedFromDocWithLocales: JsonObject = {}\n    let duplicatedFromDoc: JsonObject = {}\n\n    if (duplicateFromID) {\n      const duplicateResult = await getDuplicateDocumentData({\n        id: duplicateFromID,\n        collectionConfig,\n        draftArg: isSavingDraft,\n        overrideAccess,\n        req,\n        selectedLocales,\n      })\n\n      duplicatedFromDoc = duplicateResult.duplicatedFromDoc\n      duplicatedFromDocWithLocales = duplicateResult.duplicatedFromDocWithLocales\n    }\n\n    // /////////////////////////////////////\n    // Access\n    // /////////////////////////////////////\n\n    if (!overrideAccess) {\n      await executeAccess({ data, req }, collectionConfig.access.create)\n    }\n\n    // /////////////////////////////////////\n    // Generate data for all files and sizes\n    // /////////////////////////////////////\n\n    const { data: newFileData, files: filesToUpload } = await generateFileData({\n      collection,\n      config,\n      data,\n      isDuplicating: Boolean(duplicateFromID),\n      operation: 'create',\n      originalDoc: duplicatedFromDoc,\n      overwriteExistingFiles,\n      req,\n      throwOnMissingFile:\n        !isSavingDraft && collection.config.upload.filesRequiredOnCreate !== false,\n    })\n\n    data = newFileData\n\n    // /////////////////////////////////////\n    // beforeValidate - Fields\n    // /////////////////////////////////////\n\n    data = await beforeValidate({\n      collection: collectionConfig,\n      context: req.context,\n      data,\n      doc: duplicatedFromDoc,\n      global: null,\n      operation: 'create',\n      overrideAccess: overrideAccess!,\n      req,\n    })\n\n    // /////////////////////////////////////\n    // beforeValidate - Collections\n    // /////////////////////////////////////\n\n    if (collectionConfig.hooks.beforeValidate?.length) {\n      for (const hook of collectionConfig.hooks.beforeValidate) {\n        data =\n          (await hook({\n            collection: collectionConfig,\n            context: req.context,\n            data,\n            operation: 'create',\n            originalDoc: duplicatedFromDoc,\n            req,\n          })) || data\n      }\n    }\n\n    // /////////////////////////////////////\n    // beforeChange - Collection\n    // /////////////////////////////////////\n\n    if (collectionConfig.hooks?.beforeChange?.length) {\n      for (const hook of collectionConfig.hooks.beforeChange) {\n        data =\n          (await hook({\n            collection: collectionConfig,\n            context: req.context,\n            data,\n            operation: 'create',\n            originalDoc: duplicatedFromDoc,\n            req,\n          })) || data\n      }\n    }\n\n    // /////////////////////////////////////\n    // beforeChange - Fields\n    // /////////////////////////////////////\n\n    const resultWithLocales = await beforeChange<JsonObject>({\n      collection: collectionConfig,\n      context: req.context,\n      data,\n      doc: duplicatedFromDoc,\n      docWithLocales: duplicatedFromDocWithLocales,\n      global: null,\n      operation: 'create',\n      overrideAccess,\n      req,\n      skipValidation: isSavingDraft && !hasDraftValidationEnabled(collectionConfig),\n    })\n\n    if (\n      config.localization &&\n      collectionConfig.versions &&\n      collectionConfig.versions.drafts &&\n      collectionConfig.versions.drafts.localizeStatus &&\n      publishAllLocales\n    ) {\n      let accessibleLocaleCodes = config.localization.localeCodes\n\n      if (config.localization.filterAvailableLocales) {\n        const filteredLocales = await config.localization.filterAvailableLocales({\n          locales: config.localization.locales,\n          req,\n        })\n        accessibleLocaleCodes = filteredLocales.map((locale) =>\n          typeof locale === 'string' ? locale : locale.code,\n        )\n      }\n\n      if (typeof resultWithLocales._status !== 'object' || resultWithLocales._status === null) {\n        resultWithLocales._status = {}\n      }\n\n      for (const localeCode of accessibleLocaleCodes) {\n        resultWithLocales._status[localeCode] = 'published'\n      }\n    }\n\n    // /////////////////////////////////////\n    // Write files to local storage\n    // /////////////////////////////////////\n\n    if (!collectionConfig.upload.disableLocalStorage) {\n      await uploadFiles(payload, filesToUpload, req)\n    }\n\n    // /////////////////////////////////////\n    // Create\n    // /////////////////////////////////////\n\n    let doc\n\n    const select = sanitizeSelect({\n      fields: collectionConfig.flattenedFields,\n      forceSelect: collectionConfig.forceSelect,\n      select: incomingSelect,\n    })\n\n    if (collectionConfig.auth && !collectionConfig.auth.disableLocalStrategy) {\n      if (collectionConfig.auth.verify) {\n        resultWithLocales._verified = Boolean(resultWithLocales._verified) || false\n        resultWithLocales._verificationToken = crypto.randomBytes(20).toString('hex')\n      }\n\n      doc = await registerLocalStrategy({\n        collection: collectionConfig,\n        doc: resultWithLocales,\n        password: data.password as string,\n        payload: req.payload,\n        req,\n      })\n    } else {\n      doc = await payload.db.create({\n        collection: collectionConfig.slug,\n        data: resultWithLocales,\n        req,\n      })\n    }\n\n    const verificationToken = doc._verificationToken\n    let result: Document = sanitizeInternalFields(doc)\n\n    // /////////////////////////////////////\n    // Create version\n    // /////////////////////////////////////\n\n    if (collectionConfig.versions) {\n      await saveVersion({\n        id: result.id,\n        autosave,\n        collection: collectionConfig,\n        docWithLocales: result,\n        operation: 'create',\n        payload,\n        publishSpecificLocale,\n        req,\n        returning: false,\n      })\n    }\n\n    // /////////////////////////////////////\n    // Send verification email if applicable\n    // /////////////////////////////////////\n\n    if (collectionConfig.auth && collectionConfig.auth.verify && result.email) {\n      await sendVerificationEmail({\n        collection: { config: collectionConfig },\n        config: payload.config,\n        disableEmail: disableVerificationEmail!,\n        email: payload.email,\n        req,\n        token: verificationToken,\n        user: result,\n      })\n    }\n\n    // /////////////////////////////////////\n    // afterRead - Fields\n    // /////////////////////////////////////\n\n    result = await afterRead({\n      collection: collectionConfig,\n      context: req.context,\n      depth: depth!,\n      doc: result,\n      draft,\n      fallbackLocale: fallbackLocale!,\n      global: null,\n      locale: locale!,\n      overrideAccess: overrideAccess!,\n      populate,\n      req,\n      select,\n      showHiddenFields: showHiddenFields!,\n    })\n\n    // /////////////////////////////////////\n    // afterRead - Collection\n    // /////////////////////////////////////\n\n    if (collectionConfig.hooks?.afterRead?.length) {\n      for (const hook of collectionConfig.hooks.afterRead) {\n        result =\n          (await hook({\n            collection: collectionConfig,\n            context: req.context,\n            doc: result,\n            overrideAccess,\n            req,\n          })) || result\n      }\n    }\n\n    // /////////////////////////////////////\n    // afterChange - Fields\n    // /////////////////////////////////////\n\n    result = await afterChange({\n      collection: collectionConfig,\n      context: req.context,\n      data,\n      doc: result,\n      global: null,\n      operation: 'create',\n      previousDoc: {},\n      req,\n    })\n\n    // /////////////////////////////////////\n    // afterChange - Collection\n    // /////////////////////////////////////\n\n    if (collectionConfig.hooks?.afterChange?.length) {\n      for (const hook of collectionConfig.hooks.afterChange) {\n        result =\n          (await hook({\n            collection: collectionConfig,\n            context: req.context,\n            data,\n            doc: result,\n            operation: 'create',\n            overrideAccess,\n            previousDoc: {},\n            req: args.req,\n          })) || result\n      }\n    }\n\n    // /////////////////////////////////////\n    // afterOperation - Collection\n    // /////////////////////////////////////\n\n    result = await buildAfterOperation<TSlug>({\n      args,\n      collection: collectionConfig,\n      operation: 'create',\n      overrideAccess: args.overrideAccess!,\n      result,\n    })\n\n    await unlinkTempFiles({ collectionConfig, config, req })\n\n    // /////////////////////////////////////\n    // Return results\n    // /////////////////////////////////////\n\n    if (shouldCommit) {\n      await commitTransaction(req)\n    }\n\n    return result\n  } catch (error: unknown) {\n    await killTransaction(args.req)\n    throw error\n  }\n}\n"],"names":["crypto","ensureUsernameOrEmail","executeAccess","sendVerificationEmail","registerLocalStrategy","getDuplicateDocumentData","afterChange","afterRead","beforeChange","beforeValidate","saveVersion","generateFileData","unlinkTempFiles","uploadFiles","commitTransaction","hasDraftsEnabled","hasDraftValidationEnabled","hasLocalizeStatusEnabled","initTransaction","killTransaction","sanitizeInternalFields","sanitizeSelect","buildAfterOperation","buildBeforeOperation","createOperation","incomingArgs","args","shouldCommit","disableTransaction","req","authOptions","collection","config","auth","collectionSlug","slug","data","operation","overrideAccess","publishSpecificLocale","locale","autosave","collectionConfig","depth","disableVerificationEmail","draft","duplicateFromID","overwriteExistingFiles","populate","publishAllLocales","publishAllLocalesArg","fallbackLocale","payload","select","incomingSelect","selectedLocales","showHiddenFields","isSavingDraft","Boolean","_status","duplicatedFromDocWithLocales","duplicatedFromDoc","duplicateResult","id","draftArg","access","create","newFileData","files","filesToUpload","isDuplicating","originalDoc","throwOnMissingFile","upload","filesRequiredOnCreate","context","doc","global","hooks","length","hook","resultWithLocales","docWithLocales","skipValidation","localization","versions","drafts","localizeStatus","accessibleLocaleCodes","localeCodes","filterAvailableLocales","filteredLocales","locales","map","code","localeCode","disableLocalStorage","fields","flattenedFields","forceSelect","disableLocalStrategy","verify","_verified","_verificationToken","randomBytes","toString","password","db","verificationToken","result","returning","email","disableEmail","token","user","previousDoc","error"],"mappings":"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"}},
    {"offset": {"line": 744, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/endpoints/create.ts"],"sourcesContent":["import { getTranslation } from '@payloadcms/translations'\nimport { status as httpStatus } from 'http-status'\n\nimport type { PayloadHandler } from '../../config/types.js'\n\nimport { getRequestCollection } from '../../utilities/getRequestEntity.js'\nimport { headersWithCors } from '../../utilities/headersWithCors.js'\nimport { parseParams } from '../../utilities/parseParams/index.js'\nimport { createOperation } from '../operations/create.js'\n\nexport const createHandler: PayloadHandler = async (req) => {\n  const collection = getRequestCollection(req)\n\n  const { autosave, depth, draft, populate, publishAllLocales, select } = parseParams(req.query)\n\n  const publishSpecificLocale = req.query.publishSpecificLocale as string | undefined\n\n  const doc = await createOperation({\n    autosave,\n    collection,\n    data: req.data!,\n    depth,\n    draft,\n    populate,\n    publishAllLocales,\n    publishSpecificLocale,\n    req,\n    select,\n  })\n\n  return Response.json(\n    {\n      doc,\n      message: req.t('general:successfullyCreated', {\n        label: getTranslation(collection.config.labels.singular, req.i18n),\n      }),\n    },\n    {\n      headers: headersWithCors({\n        headers: new Headers(),\n        req,\n      }),\n      status: httpStatus.CREATED,\n    },\n  )\n}\n"],"names":["getTranslation","status","httpStatus","getRequestCollection","headersWithCors","parseParams","createOperation","createHandler","req","collection","autosave","depth","draft","populate","publishAllLocales","select","query","publishSpecificLocale","doc","data","Response","json","message","t","label","config","labels","singular","i18n","headers","Headers","CREATED"],"mappings":";;;;AAAA,SAASA,cAAc,QAAQ,2BAA0B;;AACzD,SAASC,UAAUC,UAAU,QAAQ,cAAa;AAIlD,SAASC,oBAAoB,QAAQ,sCAAqC;AAC1E,SAASC,eAAe,QAAQ,qCAAoC;AACpE,SAASC,WAAW,QAAQ,uCAAsC;AAClE,SAASC,eAAe,QAAQ,0BAAyB;;;;;;;AAElD,MAAMC,gBAAgC,OAAOC;IAClD,MAAMC,iBAAaN,0LAAAA,EAAqBK;IAExC,MAAM,EAAEE,QAAQ,EAAEC,KAAK,EAAEC,KAAK,EAAEC,QAAQ,EAAEC,iBAAiB,EAAEC,MAAM,EAAE,OAAGV,qLAAAA,EAAYG,IAAIQ,KAAK;IAE7F,MAAMC,wBAAwBT,IAAIQ,KAAK,CAACC,qBAAqB;IAE7D,MAAMC,MAAM,UAAMZ,2LAAAA,EAAgB;QAChCI;QACAD;QACAU,MAAMX,IAAIW,IAAI;QACdR;QACAC;QACAC;QACAC;QACAG;QACAT;QACAO;IACF;IAEA,OAAOK,SAASC,IAAI,CAClB;QACEH;QACAI,SAASd,IAAIe,CAAC,CAAC,+BAA+B;YAC5CC,WAAOxB,uMAAAA,EAAeS,WAAWgB,MAAM,CAACC,MAAM,CAACC,QAAQ,EAAEnB,IAAIoB,IAAI;QACnE;IACF,GACA;QACEC,aAASzB,oLAAAA,EAAgB;YACvByB,SAAS,IAAIC;YACbtB;QACF;QACAP,QAAQC,sMAAAA,CAAW6B,OAAO;IAC5B;AAEJ,EAAC"}},
    {"offset": {"line": 794, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/operations/delete.ts"],"sourcesContent":["import { status as httpStatus } from 'http-status'\n\nimport type { AccessResult } from '../../config/types.js'\nimport type { CollectionSlug, FindOptions } from '../../index.js'\nimport type { PayloadRequest, PopulateType, SelectType, Where } from '../../types/index.js'\nimport type {\n  BulkOperationResult,\n  Collection,\n  DataFromCollectionSlug,\n  SelectFromCollectionSlug,\n} from '../config/types.js'\n\nimport { executeAccess } from '../../auth/executeAccess.js'\nimport { combineQueries } from '../../database/combineQueries.js'\nimport { validateQueryPaths } from '../../database/queryValidation/validateQueryPaths.js'\nimport { sanitizeWhereQuery } from '../../database/sanitizeWhereQuery.js'\nimport { APIError } from '../../errors/index.js'\nimport { afterRead } from '../../fields/hooks/afterRead/index.js'\nimport { deleteUserPreferences } from '../../preferences/deleteUserPreferences.js'\nimport { deleteAssociatedFiles } from '../../uploads/deleteAssociatedFiles.js'\nimport { appendNonTrashedFilter } from '../../utilities/appendNonTrashedFilter.js'\nimport { checkDocumentLockStatus } from '../../utilities/checkDocumentLockStatus.js'\nimport { commitTransaction } from '../../utilities/commitTransaction.js'\nimport { hasScheduledPublishEnabled } from '../../utilities/getVersionsConfig.js'\nimport { initTransaction } from '../../utilities/initTransaction.js'\nimport { isErrorPublic } from '../../utilities/isErrorPublic.js'\nimport { killTransaction } from '../../utilities/killTransaction.js'\nimport { sanitizeSelect } from '../../utilities/sanitizeSelect.js'\nimport { deleteCollectionVersions } from '../../versions/deleteCollectionVersions.js'\nimport { deleteScheduledPublishJobs } from '../../versions/deleteScheduledPublishJobs.js'\nimport { buildAfterOperation } from './utilities/buildAfterOperation.js'\nimport { buildBeforeOperation } from './utilities/buildBeforeOperation.js'\n\nexport type Arguments = {\n  collection: Collection\n  depth?: number\n  disableTransaction?: boolean\n  overrideAccess?: boolean\n  overrideLock?: boolean\n  populate?: PopulateType\n  req: PayloadRequest\n  showHiddenFields?: boolean\n  trash?: boolean\n  where: Where\n} & Pick<FindOptions<string, SelectType>, 'select'>\n\nexport const deleteOperation = async <\n  TSlug extends CollectionSlug,\n  TSelect extends SelectFromCollectionSlug<TSlug>,\n>(\n  incomingArgs: Arguments,\n): Promise<BulkOperationResult<TSlug, TSelect>> => {\n  let args = incomingArgs\n\n  try {\n    const shouldCommit = !args.disableTransaction && (await initTransaction(args.req))\n    // /////////////////////////////////////\n    // beforeOperation - Collection\n    // /////////////////////////////////////\n\n    args = await buildBeforeOperation({\n      args,\n      collection: args.collection.config,\n      operation: 'delete',\n      overrideAccess: args.overrideAccess!,\n    })\n\n    const {\n      collection: { config: collectionConfig },\n      depth,\n      overrideAccess,\n      overrideLock,\n      populate,\n      req: {\n        fallbackLocale,\n        locale,\n        payload: { config },\n        payload,\n      },\n      req,\n      select: incomingSelect,\n      showHiddenFields,\n      trash = false,\n      where,\n    } = args\n\n    if (!where) {\n      throw new APIError(\"Missing 'where' query of documents to delete.\", httpStatus.BAD_REQUEST)\n    }\n\n    // /////////////////////////////////////\n    // Access\n    // /////////////////////////////////////\n\n    let accessResult: AccessResult\n\n    if (!overrideAccess) {\n      accessResult = await executeAccess({ req }, collectionConfig.access.delete)\n    }\n\n    await validateQueryPaths({\n      collectionConfig,\n      overrideAccess: overrideAccess!,\n      req,\n      where,\n    })\n\n    let fullWhere = combineQueries(where, accessResult!)\n\n    // Exclude trashed documents when trash: false\n    fullWhere = appendNonTrashedFilter({\n      enableTrash: collectionConfig.trash,\n      trash,\n      where: fullWhere,\n    })\n\n    sanitizeWhereQuery({ fields: collectionConfig.flattenedFields, payload, where: fullWhere })\n\n    const select = sanitizeSelect({\n      fields: collectionConfig.flattenedFields,\n      forceSelect: collectionConfig.forceSelect,\n      select: incomingSelect,\n    })\n\n    // /////////////////////////////////////\n    // Retrieve documents\n    // /////////////////////////////////////\n\n    const { docs } = await payload.db.find<DataFromCollectionSlug<TSlug>>({\n      collection: collectionConfig.slug,\n      locale: locale!,\n      req,\n      select,\n      where: fullWhere,\n    })\n\n    const errors: BulkOperationResult<TSlug, TSelect>['errors'] = []\n\n    const promises = docs.map(async (doc) => {\n      let result\n\n      const { id } = doc\n\n      try {\n        // Each document gets its own transaction when singleTransaction is enabled\n        let docShouldCommit = false\n        if (req.payload.db.bulkOperationsSingleTransaction) {\n          docShouldCommit = await initTransaction(req)\n        }\n\n        // /////////////////////////////////////\n        // Handle potentially locked documents\n        // /////////////////////////////////////\n\n        await checkDocumentLockStatus({\n          id,\n          collectionSlug: collectionConfig.slug,\n          lockErrorMessage: `Document with ID ${id} is currently locked and cannot be deleted.`,\n          overrideLock,\n          req,\n        })\n\n        // /////////////////////////////////////\n        // beforeDelete - Collection\n        // /////////////////////////////////////\n\n        if (collectionConfig.hooks?.beforeDelete?.length) {\n          for (const hook of collectionConfig.hooks.beforeDelete) {\n            await hook({\n              id,\n              collection: collectionConfig,\n              context: req.context,\n              req,\n            })\n          }\n        }\n\n        await deleteAssociatedFiles({\n          collectionConfig,\n          config,\n          doc,\n          overrideDelete: true,\n          req,\n        })\n\n        // /////////////////////////////////////\n        // Delete versions\n        // /////////////////////////////////////\n\n        if (collectionConfig.versions) {\n          await deleteCollectionVersions({\n            id,\n            slug: collectionConfig.slug,\n            payload,\n            req,\n          })\n        }\n\n        // /////////////////////////////////////\n        // Delete scheduled posts\n        // /////////////////////////////////////\n        if (hasScheduledPublishEnabled(collectionConfig)) {\n          await deleteScheduledPublishJobs({\n            id,\n            slug: collectionConfig.slug,\n            payload,\n            req,\n          })\n        }\n\n        // /////////////////////////////////////\n        // Delete document\n        // /////////////////////////////////////\n\n        await payload.db.deleteOne({\n          collection: collectionConfig.slug,\n          req,\n          returning: false,\n          where: {\n            id: {\n              equals: id,\n            },\n          },\n        })\n\n        // /////////////////////////////////////\n        // afterRead - Fields\n        // /////////////////////////////////////\n\n        result = await afterRead({\n          collection: collectionConfig,\n          context: req.context,\n          depth: depth!,\n          doc: result || doc,\n          // @ts-expect-error - vestiges of when tsconfig was not strict. Feel free to improve\n          draft: undefined,\n          fallbackLocale: fallbackLocale!,\n          global: null,\n          locale: locale!,\n          overrideAccess: overrideAccess!,\n          populate,\n          req,\n          select,\n          showHiddenFields: showHiddenFields!,\n        })\n\n        // /////////////////////////////////////\n        // afterRead - Collection\n        // /////////////////////////////////////\n\n        if (collectionConfig.hooks?.afterRead?.length) {\n          for (const hook of collectionConfig.hooks.afterRead) {\n            result =\n              (await hook({\n                collection: collectionConfig,\n                context: req.context,\n                doc: result || doc,\n                overrideAccess,\n                req,\n              })) || result\n          }\n        }\n\n        // /////////////////////////////////////\n        // afterDelete - Collection\n        // /////////////////////////////////////\n\n        if (collectionConfig.hooks?.afterDelete?.length) {\n          for (const hook of collectionConfig.hooks.afterDelete) {\n            result =\n              (await hook({\n                id,\n                collection: collectionConfig,\n                context: req.context,\n                doc: result,\n                req,\n              })) || result\n          }\n        }\n\n        // /////////////////////////////////////\n        // 8. Return results\n        // /////////////////////////////////////\n        if (docShouldCommit) {\n          await commitTransaction(req)\n        }\n\n        return result\n      } catch (error) {\n        const isPublic = error instanceof Error ? isErrorPublic(error, config) : false\n\n        if (req.payload.db.bulkOperationsSingleTransaction) {\n          await killTransaction(req)\n        }\n        errors.push({\n          id: doc.id,\n          isPublic,\n          message: error instanceof Error ? error.message : 'Unknown error',\n        })\n      }\n      return null\n    })\n\n    // Process sequentially when using single transaction mode to avoid shared state issues\n    // Process in parallel when using one transaction for better performance\n    let awaitedDocs\n    if (req.payload.db.bulkOperationsSingleTransaction) {\n      awaitedDocs = []\n      for (const promise of promises) {\n        awaitedDocs.push(await promise)\n      }\n    } else {\n      awaitedDocs = await Promise.all(promises)\n    }\n\n    // /////////////////////////////////////\n    // Delete Preferences\n    // /////////////////////////////////////\n\n    await deleteUserPreferences({\n      collectionConfig,\n      ids: docs.map(({ id }) => id),\n      payload,\n      req,\n    })\n\n    let result = {\n      docs: awaitedDocs.filter(Boolean),\n      errors,\n    }\n\n    // /////////////////////////////////////\n    // afterOperation - Collection\n    // /////////////////////////////////////\n\n    result = await buildAfterOperation({\n      args,\n      collection: collectionConfig,\n      operation: 'delete',\n      overrideAccess,\n      result,\n    })\n\n    if (shouldCommit) {\n      await commitTransaction(req)\n    }\n\n    return result\n  } catch (error: unknown) {\n    await killTransaction(args.req)\n    throw error\n  }\n}\n"],"names":["status","httpStatus","executeAccess","combineQueries","validateQueryPaths","sanitizeWhereQuery","APIError","afterRead","deleteUserPreferences","deleteAssociatedFiles","appendNonTrashedFilter","checkDocumentLockStatus","commitTransaction","hasScheduledPublishEnabled","initTransaction","isErrorPublic","killTransaction","sanitizeSelect","deleteCollectionVersions","deleteScheduledPublishJobs","buildAfterOperation","buildBeforeOperation","deleteOperation","incomingArgs","args","shouldCommit","disableTransaction","req","collection","config","operation","overrideAccess","collectionConfig","depth","overrideLock","populate","fallbackLocale","locale","payload","select","incomingSelect","showHiddenFields","trash","where","BAD_REQUEST","accessResult","access","delete","fullWhere","enableTrash","fields","flattenedFields","forceSelect","docs","db","find","slug","errors","promises","map","doc","result","id","docShouldCommit","bulkOperationsSingleTransaction","collectionSlug","lockErrorMessage","hooks","beforeDelete","length","hook","context","overrideDelete","versions","deleteOne","returning","equals","draft","undefined","global","afterDelete","error","isPublic","Error","push","message","awaitedDocs","promise","Promise","all","ids","filter","Boolean"],"mappings":"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"}},
    {"offset": {"line": 1089, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/endpoints/delete.ts"],"sourcesContent":["import { getTranslation } from '@payloadcms/translations'\nimport { status as httpStatus } from 'http-status'\n\nimport type { PayloadHandler } from '../../config/types.js'\n\nimport { getRequestCollection } from '../../utilities/getRequestEntity.js'\nimport { headersWithCors } from '../../utilities/headersWithCors.js'\nimport { parseParams } from '../../utilities/parseParams/index.js'\nimport { deleteOperation } from '../operations/delete.js'\n\nexport const deleteHandler: PayloadHandler = async (req) => {\n  const collection = getRequestCollection(req)\n\n  const { depth, overrideLock, populate, select, trash, where } = parseParams(req.query)\n\n  const result = await deleteOperation({\n    collection,\n    depth,\n    overrideLock: overrideLock ?? false,\n    populate,\n    req,\n    select,\n    trash,\n    where: where!,\n  })\n\n  const headers = headersWithCors({\n    headers: new Headers(),\n    req,\n  })\n\n  if (result.errors.length === 0) {\n    const message = req.t('general:deletedCountSuccessfully', {\n      count: result.docs.length,\n      label: getTranslation(\n        collection.config.labels[result.docs.length === 1 ? 'singular' : 'plural'],\n        req.i18n,\n      ),\n    })\n\n    return Response.json(\n      {\n        ...result,\n        message,\n      },\n      {\n        headers,\n        status: httpStatus.OK,\n      },\n    )\n  }\n\n  result.errors = result.errors.map((error) =>\n    error.isPublic\n      ? error\n      : {\n          ...error,\n          message: 'Something went wrong.',\n        },\n  )\n\n  const total = result.docs.length + result.errors.length\n\n  const message = req.t('error:unableToDeleteCount', {\n    count: result.errors.length,\n    label: getTranslation(collection.config.labels[total === 1 ? 'singular' : 'plural'], req.i18n),\n    total,\n  })\n\n  return Response.json(\n    {\n      ...result,\n      message,\n    },\n    {\n      headers,\n      status: httpStatus.BAD_REQUEST,\n    },\n  )\n}\n"],"names":["getTranslation","status","httpStatus","getRequestCollection","headersWithCors","parseParams","deleteOperation","deleteHandler","req","collection","depth","overrideLock","populate","select","trash","where","query","result","headers","Headers","errors","length","message","t","count","docs","label","config","labels","i18n","Response","json","OK","map","error","isPublic","total","BAD_REQUEST"],"mappings":";;;;AAAA,SAASA,cAAc,QAAQ,2BAA0B;;AACzD,SAASC,UAAUC,UAAU,QAAQ,cAAa;AAIlD,SAASC,oBAAoB,QAAQ,sCAAqC;AAC1E,SAASC,eAAe,QAAQ,qCAAoC;AACpE,SAASC,WAAW,QAAQ,uCAAsC;AAClE,SAASC,eAAe,QAAQ,0BAAyB;;;;;;;AAElD,MAAMC,gBAAgC,OAAOC;IAClD,MAAMC,iBAAaN,0LAAAA,EAAqBK;IAExC,MAAM,EAAEE,KAAK,EAAEC,YAAY,EAAEC,QAAQ,EAAEC,MAAM,EAAEC,KAAK,EAAEC,KAAK,EAAE,OAAGV,qLAAAA,EAAYG,IAAIQ,KAAK;IAErF,MAAMC,SAAS,UAAMX,2LAAAA,EAAgB;QACnCG;QACAC;QACAC,cAAcA,gBAAgB;QAC9BC;QACAJ;QACAK;QACAC;QACAC,OAAOA;IACT;IAEA,MAAMG,cAAUd,oLAAAA,EAAgB;QAC9Bc,SAAS,IAAIC;QACbX;IACF;IAEA,IAAIS,OAAOG,MAAM,CAACC,MAAM,KAAK,GAAG;QAC9B,MAAMC,UAAUd,IAAIe,CAAC,CAAC,oCAAoC;YACxDC,OAAOP,OAAOQ,IAAI,CAACJ,MAAM;YACzBK,WAAO1B,uMAAAA,EACLS,WAAWkB,MAAM,CAACC,MAAM,CAACX,OAAOQ,IAAI,CAACJ,MAAM,KAAK,IAAI,aAAa,SAAS,EAC1Eb,IAAIqB,IAAI;QAEZ;QAEA,OAAOC,SAASC,IAAI,CAClB;YACE,GAAGd,MAAM;YACTK;QACF,GACA;YACEJ;YACAjB,QAAQC,sMAAAA,CAAW8B,EAAE;QACvB;IAEJ;IAEAf,OAAOG,MAAM,GAAGH,OAAOG,MAAM,CAACa,GAAG,CAAC,CAACC,QACjCA,MAAMC,QAAQ,GACVD,QACA;YACE,GAAGA,KAAK;YACRZ,SAAS;QACX;IAGN,MAAMc,QAAQnB,OAAOQ,IAAI,CAACJ,MAAM,GAAGJ,OAAOG,MAAM,CAACC,MAAM;IAEvD,MAAMC,UAAUd,IAAIe,CAAC,CAAC,6BAA6B;QACjDC,OAAOP,OAAOG,MAAM,CAACC,MAAM;QAC3BK,WAAO1B,uMAAAA,EAAeS,WAAWkB,MAAM,CAACC,MAAM,CAACQ,UAAU,IAAI,aAAa,SAAS,EAAE5B,IAAIqB,IAAI;QAC7FO;IACF;IAEA,OAAON,SAASC,IAAI,CAClB;QACE,GAAGd,MAAM;QACTK;IACF,GACA;QACEJ;QACAjB,QAAQC,sMAAAA,CAAWmC,WAAW;IAChC;AAEJ,EAAC"}},
    {"offset": {"line": 1158, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/operations/deleteByID.ts"],"sourcesContent":["import type { CollectionSlug, FindOptions } from '../../index.js'\nimport type {\n  PayloadRequest,\n  PopulateType,\n  SelectType,\n  TransformCollectionWithSelect,\n} from '../../types/index.js'\nimport type { Collection, DataFromCollectionSlug } from '../config/types.js'\n\nimport { executeAccess } from '../../auth/executeAccess.js'\nimport { hasWhereAccessResult } from '../../auth/types.js'\nimport { combineQueries } from '../../database/combineQueries.js'\nimport { Forbidden, NotFound } from '../../errors/index.js'\nimport { afterRead } from '../../fields/hooks/afterRead/index.js'\nimport { deleteUserPreferences } from '../../preferences/deleteUserPreferences.js'\nimport { deleteAssociatedFiles } from '../../uploads/deleteAssociatedFiles.js'\nimport { appendNonTrashedFilter } from '../../utilities/appendNonTrashedFilter.js'\nimport { checkDocumentLockStatus } from '../../utilities/checkDocumentLockStatus.js'\nimport { commitTransaction } from '../../utilities/commitTransaction.js'\nimport { hasScheduledPublishEnabled } from '../../utilities/getVersionsConfig.js'\nimport { initTransaction } from '../../utilities/initTransaction.js'\nimport { killTransaction } from '../../utilities/killTransaction.js'\nimport { sanitizeSelect } from '../../utilities/sanitizeSelect.js'\nimport { deleteCollectionVersions } from '../../versions/deleteCollectionVersions.js'\nimport { deleteScheduledPublishJobs } from '../../versions/deleteScheduledPublishJobs.js'\nimport { buildAfterOperation } from './utilities/buildAfterOperation.js'\nimport { buildBeforeOperation } from './utilities/buildBeforeOperation.js'\n\nexport type Arguments<TSlug extends CollectionSlug, TSelect extends SelectType> = {\n  collection: Collection\n  depth?: number\n  disableTransaction?: boolean\n  id: number | string\n  overrideAccess?: boolean\n  overrideLock?: boolean\n  populate?: PopulateType\n  req: PayloadRequest\n  showHiddenFields?: boolean\n  trash?: boolean\n} & Pick<FindOptions<TSlug, TSelect>, 'select'>\n\nexport const deleteByIDOperation = async <TSlug extends CollectionSlug, TSelect extends SelectType>(\n  incomingArgs: Arguments<TSlug, TSelect>,\n): Promise<TransformCollectionWithSelect<TSlug, TSelect>> => {\n  let args = incomingArgs\n\n  try {\n    const shouldCommit = !args.disableTransaction && (await initTransaction(args.req))\n\n    // /////////////////////////////////////\n    // beforeOperation - Collection\n    // /////////////////////////////////////\n\n    args = await buildBeforeOperation({\n      args,\n      collection: args.collection.config,\n      operation: 'delete',\n      overrideAccess: args.overrideAccess!,\n    })\n\n    const {\n      id,\n      collection: { config: collectionConfig },\n      depth,\n      overrideAccess,\n      overrideLock,\n      populate,\n      req: {\n        fallbackLocale,\n        locale,\n        payload: { config },\n        payload,\n      },\n      req,\n      select: incomingSelect,\n      showHiddenFields,\n      trash = false,\n    } = args\n\n    // /////////////////////////////////////\n    // Access\n    // /////////////////////////////////////\n\n    const accessResults = !overrideAccess\n      ? await executeAccess({ id, req }, collectionConfig.access.delete)\n      : true\n    const hasWhereAccess = hasWhereAccessResult(accessResults)\n\n    // /////////////////////////////////////\n    // beforeDelete - Collection\n    // /////////////////////////////////////\n\n    if (collectionConfig.hooks?.beforeDelete?.length) {\n      for (const hook of collectionConfig.hooks.beforeDelete) {\n        await hook({\n          id,\n          collection: collectionConfig,\n          context: req.context,\n          req,\n        })\n      }\n    }\n\n    // /////////////////////////////////////\n    // Retrieve document\n    // /////////////////////////////////////\n\n    let where = combineQueries({ id: { equals: id } }, accessResults)\n\n    // Exclude trashed documents when trash: false\n    where = appendNonTrashedFilter({\n      enableTrash: collectionConfig.trash,\n      trash,\n      where,\n    })\n\n    const docToDelete = await req.payload.db.findOne({\n      collection: collectionConfig.slug,\n      locale: req.locale!,\n      req,\n      where,\n    })\n\n    if (!docToDelete && !hasWhereAccess) {\n      throw new NotFound(req.t)\n    }\n    if (!docToDelete && hasWhereAccess) {\n      throw new Forbidden(req.t)\n    }\n\n    // /////////////////////////////////////\n    // Handle potentially locked documents\n    // /////////////////////////////////////\n\n    await checkDocumentLockStatus({\n      id,\n      collectionSlug: collectionConfig.slug,\n      lockErrorMessage: `Document with ID ${id} is currently locked and cannot be deleted.`,\n      overrideLock,\n      req,\n    })\n\n    await deleteAssociatedFiles({\n      collectionConfig,\n      config,\n      doc: docToDelete!,\n      overrideDelete: true,\n      req,\n    })\n\n    // /////////////////////////////////////\n    // Delete versions\n    // /////////////////////////////////////\n\n    if (collectionConfig.versions) {\n      await deleteCollectionVersions({\n        id,\n        slug: collectionConfig.slug,\n        payload,\n        req,\n      })\n    }\n\n    // /////////////////////////////////////\n    // Delete scheduled posts\n    // /////////////////////////////////////\n    if (hasScheduledPublishEnabled(collectionConfig)) {\n      await deleteScheduledPublishJobs({\n        id,\n        slug: collectionConfig.slug,\n        payload,\n        req,\n      })\n    }\n\n    const select = sanitizeSelect({\n      fields: collectionConfig.flattenedFields,\n      forceSelect: collectionConfig.forceSelect,\n      select: incomingSelect,\n    })\n\n    // /////////////////////////////////////\n    // Delete document\n    // /////////////////////////////////////\n\n    let result: DataFromCollectionSlug<TSlug> = await req.payload.db.deleteOne({\n      collection: collectionConfig.slug,\n      req,\n      select,\n      where: { id: { equals: id } },\n    })\n\n    // /////////////////////////////////////\n    // Delete Preferences\n    // /////////////////////////////////////\n\n    await deleteUserPreferences({\n      collectionConfig,\n      ids: [id],\n      payload,\n      req,\n    })\n\n    // /////////////////////////////////////\n    // afterRead - Fields\n    // /////////////////////////////////////\n\n    result = await afterRead({\n      collection: collectionConfig,\n      context: req.context,\n      depth: depth!,\n      doc: result,\n      draft: undefined!,\n      fallbackLocale: fallbackLocale!,\n      global: null,\n      locale: locale!,\n      overrideAccess: overrideAccess!,\n      populate,\n      req,\n      select,\n      showHiddenFields: showHiddenFields!,\n    })\n\n    // /////////////////////////////////////\n    // afterRead - Collection\n    // /////////////////////////////////////\n\n    if (collectionConfig.hooks?.afterRead?.length) {\n      for (const hook of collectionConfig.hooks.afterRead) {\n        result =\n          (await hook({\n            collection: collectionConfig,\n            context: req.context,\n            doc: result,\n            overrideAccess,\n            req,\n          })) || result\n      }\n    }\n\n    // /////////////////////////////////////\n    // afterDelete - Collection\n    // /////////////////////////////////////\n\n    if (collectionConfig.hooks?.afterDelete?.length) {\n      for (const hook of collectionConfig.hooks.afterDelete) {\n        result =\n          (await hook({\n            id,\n            collection: collectionConfig,\n            context: req.context,\n            doc: result,\n            req,\n          })) || result\n      }\n    }\n\n    // /////////////////////////////////////\n    // afterOperation - Collection\n    // /////////////////////////////////////\n\n    result = await buildAfterOperation({\n      args,\n      collection: collectionConfig,\n      operation: 'deleteByID',\n      overrideAccess,\n      result,\n    })\n\n    // /////////////////////////////////////\n    // 8. Return results\n    // /////////////////////////////////////\n\n    if (shouldCommit) {\n      await commitTransaction(req)\n    }\n\n    return result as TransformCollectionWithSelect<TSlug, TSelect>\n  } catch (error: unknown) {\n    await killTransaction(args.req)\n    throw error\n  }\n}\n"],"names":["executeAccess","hasWhereAccessResult","combineQueries","Forbidden","NotFound","afterRead","deleteUserPreferences","deleteAssociatedFiles","appendNonTrashedFilter","checkDocumentLockStatus","commitTransaction","hasScheduledPublishEnabled","initTransaction","killTransaction","sanitizeSelect","deleteCollectionVersions","deleteScheduledPublishJobs","buildAfterOperation","buildBeforeOperation","deleteByIDOperation","incomingArgs","args","shouldCommit","disableTransaction","req","collection","config","operation","overrideAccess","id","collectionConfig","depth","overrideLock","populate","fallbackLocale","locale","payload","select","incomingSelect","showHiddenFields","trash","accessResults","access","delete","hasWhereAccess","hooks","beforeDelete","length","hook","context","where","equals","enableTrash","docToDelete","db","findOne","slug","t","collectionSlug","lockErrorMessage","doc","overrideDelete","versions","fields","flattenedFields","forceSelect","result","deleteOne","ids","draft","undefined","global","afterDelete","error"],"mappings":"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"}},
    {"offset": {"line": 1400, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/endpoints/deleteByID.ts"],"sourcesContent":["import { status as httpStatus } from 'http-status'\n\nimport type { PayloadHandler } from '../../config/types.js'\n\nimport { getRequestCollectionWithID } from '../../utilities/getRequestEntity.js'\nimport { headersWithCors } from '../../utilities/headersWithCors.js'\nimport { parseParams } from '../../utilities/parseParams/index.js'\nimport { deleteByIDOperation } from '../operations/deleteByID.js'\n\nexport const deleteByIDHandler: PayloadHandler = async (req) => {\n  const { id, collection } = getRequestCollectionWithID(req)\n\n  const { depth, overrideLock, populate, select, trash } = parseParams(req.query)\n\n  const doc = await deleteByIDOperation({\n    id,\n    collection,\n    depth,\n    overrideLock: overrideLock ?? false,\n    populate,\n    req,\n    select,\n    trash,\n  })\n\n  const headers = headersWithCors({\n    headers: new Headers(),\n    req,\n  })\n\n  if (!doc) {\n    return Response.json(\n      {\n        message: req.t('general:notFound'),\n      },\n      {\n        headers,\n        status: httpStatus.NOT_FOUND,\n      },\n    )\n  }\n\n  return Response.json(\n    {\n      doc,\n      message: req.t('general:deletedSuccessfully'),\n    },\n    {\n      headers,\n      status: httpStatus.OK,\n    },\n  )\n}\n"],"names":["status","httpStatus","getRequestCollectionWithID","headersWithCors","parseParams","deleteByIDOperation","deleteByIDHandler","req","id","collection","depth","overrideLock","populate","select","trash","query","doc","headers","Headers","Response","json","message","t","NOT_FOUND","OK"],"mappings":";;;;;AAAA,SAASA,UAAUC,UAAU,QAAQ,cAAa;AAIlD,SAASC,0BAA0B,QAAQ,sCAAqC;AAChF,SAASC,eAAe,QAAQ,qCAAoC;AACpE,SAASC,WAAW,QAAQ,uCAAsC;AAClE,SAASC,mBAAmB,QAAQ,8BAA6B;;;;;;AAE1D,MAAMC,oBAAoC,OAAOC;IACtD,MAAM,EAAEC,EAAE,EAAEC,UAAU,EAAE,OAAGP,gMAAAA,EAA2BK;IAEtD,MAAM,EAAEG,KAAK,EAAEC,YAAY,EAAEC,QAAQ,EAAEC,MAAM,EAAEC,KAAK,EAAE,OAAGV,qLAAAA,EAAYG,IAAIQ,KAAK;IAE9E,MAAMC,MAAM,UAAMX,mMAAAA,EAAoB;QACpCG;QACAC;QACAC;QACAC,cAAcA,gBAAgB;QAC9BC;QACAL;QACAM;QACAC;IACF;IAEA,MAAMG,cAAUd,oLAAAA,EAAgB;QAC9Bc,SAAS,IAAIC;QACbX;IACF;IAEA,IAAI,CAACS,KAAK;QACR,OAAOG,SAASC,IAAI,CAClB;YACEC,SAASd,IAAIe,CAAC,CAAC;QACjB,GACA;YACEL;YACAjB,QAAQC,sMAAAA,CAAWsB,SAAS;QAC9B;IAEJ;IAEA,OAAOJ,SAASC,IAAI,CAClB;QACEJ;QACAK,SAASd,IAAIe,CAAC,CAAC;IACjB,GACA;QACEL;QACAjB,QAAQC,sMAAAA,CAAWuB,EAAE;IACvB;AAEJ,EAAC"}},
    {"offset": {"line": 1452, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/operations/docAccess.ts"],"sourcesContent":["import type { SanitizedCollectionPermission } from '../../auth/index.js'\nimport type { AllOperations, JsonObject, PayloadRequest } from '../../types/index.js'\nimport type { Collection } from '../config/types.js'\n\nimport { getEntityPermissions } from '../../utilities/getEntityPermissions/getEntityPermissions.js'\nimport { killTransaction } from '../../utilities/killTransaction.js'\nimport { sanitizePermissions } from '../../utilities/sanitizePermissions.js'\n\nconst allOperations: AllOperations[] = ['create', 'read', 'update', 'delete']\n\ntype Arguments = {\n  collection: Collection\n  /**\n   * If the document data is passed, it will be used to check access instead of fetching the document from the database.\n   */\n  data?: JsonObject\n  /**\n   * When called for creating a new document, id is not provided.\n   */\n  id?: number | string\n  req: PayloadRequest\n}\n\nexport async function docAccessOperation(args: Arguments): Promise<SanitizedCollectionPermission> {\n  const {\n    id,\n    collection: { config },\n    data,\n    req,\n  } = args\n\n  const collectionOperations = [...allOperations]\n\n  if (\n    config.auth &&\n    typeof config.auth.maxLoginAttempts !== 'undefined' &&\n    config.auth.maxLoginAttempts !== 0\n  ) {\n    collectionOperations.push('unlock')\n  }\n\n  if (config.versions) {\n    collectionOperations.push('readVersions')\n  }\n\n  try {\n    const result = await getEntityPermissions({\n      id: id!,\n      blockReferencesPermissions: {},\n      data,\n      entity: config,\n      entityType: 'collection',\n      fetchData: id ? true : (false as true),\n      operations: collectionOperations,\n      req,\n    })\n\n    const sanitizedPermissions = sanitizePermissions({\n      collections: {\n        [config.slug]: result,\n      },\n    })\n\n    const collectionPermissions = sanitizedPermissions?.collections?.[config.slug]\n    return collectionPermissions ?? { fields: {} }\n  } catch (e: unknown) {\n    await killTransaction(req)\n    throw e\n  }\n}\n"],"names":["getEntityPermissions","killTransaction","sanitizePermissions","allOperations","docAccessOperation","args","id","collection","config","data","req","collectionOperations","auth","maxLoginAttempts","push","versions","result","blockReferencesPermissions","entity","entityType","fetchData","operations","sanitizedPermissions","collections","slug","collectionPermissions","fields","e"],"mappings":";;;;AAIA,SAASA,oBAAoB,QAAQ,+DAA8D;AACnG,SAASC,eAAe,QAAQ,qCAAoC;AACpE,SAASC,mBAAmB,QAAQ,yCAAwC;;;;AAE5E,MAAMC,gBAAiC;IAAC;IAAU;IAAQ;IAAU;CAAS;AAetE,eAAeC,mBAAmBC,IAAe;IACtD,MAAM,EACJC,EAAE,EACFC,YAAY,EAAEC,MAAM,EAAE,EACtBC,IAAI,EACJC,GAAG,EACJ,GAAGL;IAEJ,MAAMM,uBAAuB;WAAIR;KAAc;IAE/C,IACEK,OAAOI,IAAI,IACX,OAAOJ,OAAOI,IAAI,CAACC,gBAAgB,KAAK,eACxCL,OAAOI,IAAI,CAACC,gBAAgB,KAAK,GACjC;QACAF,qBAAqBG,IAAI,CAAC;IAC5B;IAEA,IAAIN,OAAOO,QAAQ,EAAE;QACnBJ,qBAAqBG,IAAI,CAAC;IAC5B;IAEA,IAAI;QACF,MAAME,SAAS,UAAMhB,sNAAAA,EAAqB;YACxCM,IAAIA;YACJW,4BAA4B,CAAC;YAC7BR;YACAS,QAAQV;YACRW,YAAY;YACZC,WAAWd,KAAK,OAAQ;YACxBe,YAAYV;YACZD;QACF;QAEA,MAAMY,2BAAuBpB,4LAAAA,EAAoB;YAC/CqB,aAAa;gBACX,CAACf,OAAOgB,IAAI,CAAC,EAAER;YACjB;QACF;QAEA,MAAMS,wBAAwBH,sBAAsBC,aAAa,CAACf,OAAOgB,IAAI,CAAC;QAC9E,OAAOC,yBAAyB;YAAEC,QAAQ,CAAC;QAAE;IAC/C,EAAE,OAAOC,GAAY;QACnB,UAAM1B,oLAAAA,EAAgBS;QACtB,MAAMiB;IACR;AACF"}},
    {"offset": {"line": 1508, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/endpoints/docAccess.ts"],"sourcesContent":["import { status as httpStatus } from 'http-status'\n\nimport type { PayloadHandler } from '../../config/types.js'\n\nimport { getRequestCollectionWithID } from '../../utilities/getRequestEntity.js'\nimport { headersWithCors } from '../../utilities/headersWithCors.js'\nimport { docAccessOperation } from '../operations/docAccess.js'\n\nexport const docAccessHandler: PayloadHandler = async (req) => {\n  const { id, collection } = getRequestCollectionWithID(req, { optionalID: true })\n\n  const result = await docAccessOperation({\n    id,\n    collection,\n    data: req.data,\n    req,\n  })\n\n  return Response.json(result, {\n    headers: headersWithCors({\n      headers: new Headers(),\n      req,\n    }),\n    status: httpStatus.OK,\n  })\n}\n"],"names":["status","httpStatus","getRequestCollectionWithID","headersWithCors","docAccessOperation","docAccessHandler","req","id","collection","optionalID","result","data","Response","json","headers","Headers","OK"],"mappings":";;;;;AAAA,SAASA,UAAUC,UAAU,QAAQ,cAAa;AAIlD,SAASC,0BAA0B,QAAQ,sCAAqC;AAChF,SAASC,eAAe,QAAQ,qCAAoC;AACpE,SAASC,kBAAkB,QAAQ,6BAA4B;;;;;AAExD,MAAMC,mBAAmC,OAAOC;IACrD,MAAM,EAAEC,EAAE,EAAEC,UAAU,EAAE,OAAGN,gMAAAA,EAA2BI,KAAK;QAAEG,YAAY;IAAK;IAE9E,MAAMC,SAAS,UAAMN,iMAAAA,EAAmB;QACtCG;QACAC;QACAG,MAAML,IAAIK,IAAI;QACdL;IACF;IAEA,OAAOM,SAASC,IAAI,CAACH,QAAQ;QAC3BI,aAASX,oLAAAA,EAAgB;YACvBW,SAAS,IAAIC;YACbT;QACF;QACAN,QAAQC,sMAAAA,CAAWe,EAAE;IACvB;AACF,EAAC"}},
    {"offset": {"line": 1543, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/operations/duplicate.ts"],"sourcesContent":["import type { DeepPartial } from 'ts-essentials'\n\nimport type { CollectionSlug } from '../../index.js'\nimport type { TransformCollectionWithSelect } from '../../types/index.js'\nimport type { RequiredDataFromCollectionSlug, SelectFromCollectionSlug } from '../config/types.js'\n\nimport { type Arguments as CreateArguments, createOperation } from './create.js'\n\nexport type Arguments<TSlug extends CollectionSlug> = {\n  data?: DeepPartial<RequiredDataFromCollectionSlug<TSlug>>\n  id: number | string\n} & Omit<CreateArguments<TSlug>, 'data' | 'duplicateFromID'>\n\nexport const duplicateOperation = async <\n  TSlug extends CollectionSlug,\n  TSelect extends SelectFromCollectionSlug<TSlug>,\n>(\n  incomingArgs: Arguments<TSlug>,\n): Promise<TransformCollectionWithSelect<TSlug, TSelect>> => {\n  const { id, ...args } = incomingArgs\n  return createOperation({\n    ...args,\n    data: incomingArgs?.data || {},\n    duplicateFromID: id,\n  })\n}\n"],"names":["createOperation","duplicateOperation","incomingArgs","id","args","data","duplicateFromID"],"mappings":";;;;AAMA,SAA4CA,eAAe,QAAQ,cAAa;;AAOzE,MAAMC,qBAAqB,OAIhCC;IAEA,MAAM,EAAEC,EAAE,EAAE,GAAGC,MAAM,GAAGF;IACxB,WAAOF,2LAAAA,EAAgB;QACrB,GAAGI,IAAI;QACPC,MAAMH,cAAcG,QAAQ,CAAC;QAC7BC,iBAAiBH;IACnB;AACF,EAAC"}},
    {"offset": {"line": 1561, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/endpoints/duplicate.ts"],"sourcesContent":["import { getTranslation } from '@payloadcms/translations'\nimport { status as httpStatus } from 'http-status'\n\nimport type { PayloadHandler } from '../../config/types.js'\n\nimport { getRequestCollectionWithID } from '../../utilities/getRequestEntity.js'\nimport { headersWithCors } from '../../utilities/headersWithCors.js'\nimport { parseParams } from '../../utilities/parseParams/index.js'\nimport { duplicateOperation } from '../operations/duplicate.js'\n\nexport const duplicateHandler: PayloadHandler = async (req) => {\n  const { id, collection } = getRequestCollectionWithID(req)\n\n  const { depth, draft, populate, select, selectedLocales } = parseParams(req.query)\n\n  const doc = await duplicateOperation({\n    id,\n    collection,\n    data: req.data,\n    depth,\n    draft,\n    populate,\n    req,\n    select,\n    selectedLocales,\n  })\n\n  const message = req.t('general:successfullyDuplicated', {\n    label: getTranslation(collection.config.labels.singular, req.i18n),\n  })\n\n  return Response.json(\n    {\n      doc,\n      message,\n    },\n    {\n      headers: headersWithCors({\n        headers: new Headers(),\n        req,\n      }),\n      status: httpStatus.OK,\n    },\n  )\n}\n"],"names":["getTranslation","status","httpStatus","getRequestCollectionWithID","headersWithCors","parseParams","duplicateOperation","duplicateHandler","req","id","collection","depth","draft","populate","select","selectedLocales","query","doc","data","message","t","label","config","labels","singular","i18n","Response","json","headers","Headers","OK"],"mappings":";;;;AAAA,SAASA,cAAc,QAAQ,2BAA0B;;AACzD,SAASC,UAAUC,UAAU,QAAQ,cAAa;AAIlD,SAASC,0BAA0B,QAAQ,sCAAqC;AAChF,SAASC,eAAe,QAAQ,qCAAoC;AACpE,SAASC,WAAW,QAAQ,uCAAsC;AAClE,SAASC,kBAAkB,QAAQ,6BAA4B;;;;;;;AAExD,MAAMC,mBAAmC,OAAOC;IACrD,MAAM,EAAEC,EAAE,EAAEC,UAAU,EAAE,OAAGP,gMAAAA,EAA2BK;IAEtD,MAAM,EAAEG,KAAK,EAAEC,KAAK,EAAEC,QAAQ,EAAEC,MAAM,EAAEC,eAAe,EAAE,OAAGV,qLAAAA,EAAYG,IAAIQ,KAAK;IAEjF,MAAMC,MAAM,UAAMX,iMAAAA,EAAmB;QACnCG;QACAC;QACAQ,MAAMV,IAAIU,IAAI;QACdP;QACAC;QACAC;QACAL;QACAM;QACAC;IACF;IAEA,MAAMI,UAAUX,IAAIY,CAAC,CAAC,kCAAkC;QACtDC,WAAOrB,uMAAAA,EAAeU,WAAWY,MAAM,CAACC,MAAM,CAACC,QAAQ,EAAEhB,IAAIiB,IAAI;IACnE;IAEA,OAAOC,SAASC,IAAI,CAClB;QACEV;QACAE;IACF,GACA;QACES,aAASxB,oLAAAA,EAAgB;YACvBwB,SAAS,IAAIC;YACbrB;QACF;QACAP,QAAQC,sMAAAA,CAAW4B,EAAE;IACvB;AAEJ,EAAC"}},
    {"offset": {"line": 1610, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/operations/utilities/sanitizeSortQuery.ts"],"sourcesContent":["import type { FlattenedField } from '../../../fields/config/types.js'\n\nconst sanitizeSort = ({ fields, sort }: { fields: FlattenedField[]; sort: string }): string => {\n  let sortProperty = sort\n  let desc = false\n  if (sort.indexOf('-') === 0) {\n    desc = true\n    sortProperty = sortProperty.substring(1)\n  }\n\n  const segments = sortProperty.split('.')\n\n  for (const segment of segments) {\n    const field = fields.find((each) => each.name === segment)\n    if (!field) {\n      return sort\n    }\n\n    if ('fields' in field) {\n      fields = field.flattenedFields\n      continue\n    }\n\n    if ('virtual' in field && typeof field.virtual === 'string') {\n      return `${desc ? '-' : ''}${field.virtual}`\n    }\n  }\n\n  return sort\n}\n\n/**\n * Sanitizes the sort parameter, for example virtual fields linked to relationships are replaced with the full path.\n */\nexport const sanitizeSortQuery = ({\n  fields,\n  sort,\n}: {\n  fields: FlattenedField[]\n  sort?: string | string[]\n}): string | string[] | undefined => {\n  if (!sort) {\n    return undefined\n  }\n\n  if (Array.isArray(sort)) {\n    return sort.map((sort) => sanitizeSort({ fields, sort }))\n  }\n\n  return sanitizeSort({ fields, sort })\n}\n"],"names":["sanitizeSort","fields","sort","sortProperty","desc","indexOf","substring","segments","split","segment","field","find","each","name","flattenedFields","virtual","sanitizeSortQuery","undefined","Array","isArray","map"],"mappings":";;;;AAEA,MAAMA,eAAe,CAAC,EAAEC,MAAM,EAAEC,IAAI,EAA8C;IAChF,IAAIC,eAAeD;IACnB,IAAIE,OAAO;IACX,IAAIF,KAAKG,OAAO,CAAC,SAAS,GAAG;QAC3BD,OAAO;QACPD,eAAeA,aAAaG,SAAS,CAAC;IACxC;IAEA,MAAMC,WAAWJ,aAAaK,KAAK,CAAC;IAEpC,KAAK,MAAMC,WAAWF,SAAU;QAC9B,MAAMG,QAAQT,OAAOU,IAAI,CAAC,CAACC,OAASA,KAAKC,IAAI,KAAKJ;QAClD,IAAI,CAACC,OAAO;YACV,OAAOR;QACT;QAEA,IAAI,YAAYQ,OAAO;YACrBT,SAASS,MAAMI,eAAe;YAC9B;QACF;QAEA,IAAI,aAAaJ,SAAS,OAAOA,MAAMK,OAAO,KAAK,UAAU;YAC3D,OAAO,GAAGX,OAAO,MAAM,KAAKM,MAAMK,OAAO,EAAE;QAC7C;IACF;IAEA,OAAOb;AACT;AAKO,MAAMc,oBAAoB,CAAC,EAChCf,MAAM,EACNC,IAAI,EAIL;IACC,IAAI,CAACA,MAAM;QACT,OAAOe;IACT;IAEA,IAAIC,MAAMC,OAAO,CAACjB,OAAO;QACvB,OAAOA,KAAKkB,GAAG,CAAC,CAAClB,OAASF,aAAa;gBAAEC;gBAAQC;YAAK;IACxD;IAEA,OAAOF,aAAa;QAAEC;QAAQC;IAAK;AACrC,EAAC"}},
    {"offset": {"line": 1656, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/operations/find.ts"],"sourcesContent":["import type { AccessResult } from '../../config/types.js'\nimport type { PaginatedDocs } from '../../database/types.js'\nimport type { CollectionSlug, FindOptions, JoinQuery } from '../../index.js'\nimport type {\n  PayloadRequest,\n  PopulateType,\n  SelectType,\n  Sort,\n  TransformCollectionWithSelect,\n  Where,\n} from '../../types/index.js'\nimport type {\n  Collection,\n  DataFromCollectionSlug,\n  SelectFromCollectionSlug,\n} from '../config/types.js'\n\nimport { executeAccess } from '../../auth/executeAccess.js'\nimport { combineQueries } from '../../database/combineQueries.js'\nimport { validateQueryPaths } from '../../database/queryValidation/validateQueryPaths.js'\nimport { sanitizeJoinQuery } from '../../database/sanitizeJoinQuery.js'\nimport { sanitizeWhereQuery } from '../../database/sanitizeWhereQuery.js'\nimport { afterRead } from '../../fields/hooks/afterRead/index.js'\nimport { lockedDocumentsCollectionSlug } from '../../locked-documents/config.js'\nimport { appendNonTrashedFilter } from '../../utilities/appendNonTrashedFilter.js'\nimport { hasDraftsEnabled } from '../../utilities/getVersionsConfig.js'\nimport { killTransaction } from '../../utilities/killTransaction.js'\nimport { sanitizeSelect } from '../../utilities/sanitizeSelect.js'\nimport { buildVersionCollectionFields } from '../../versions/buildCollectionFields.js'\nimport { appendVersionToQueryKey } from '../../versions/drafts/appendVersionToQueryKey.js'\nimport { getQueryDraftsSelect } from '../../versions/drafts/getQueryDraftsSelect.js'\nimport { getQueryDraftsSort } from '../../versions/drafts/getQueryDraftsSort.js'\nimport { buildAfterOperation } from './utilities/buildAfterOperation.js'\nimport { buildBeforeOperation } from './utilities/buildBeforeOperation.js'\nimport { sanitizeSortQuery } from './utilities/sanitizeSortQuery.js'\n\nexport type Arguments = {\n  collection: Collection\n  currentDepth?: number\n  depth?: number\n  disableErrors?: boolean\n  draft?: boolean\n  includeLockStatus?: boolean\n  joins?: JoinQuery\n  limit?: number\n  overrideAccess?: boolean\n  page?: number\n  pagination?: boolean\n  populate?: PopulateType\n  req?: PayloadRequest\n  showHiddenFields?: boolean\n  sort?: Sort\n  trash?: boolean\n  where?: Where\n} & Pick<FindOptions<string, SelectType>, 'select'>\n\nconst lockDurationDefault = 300 // Default 5 minutes in seconds\n\nexport const findOperation = async <\n  TSlug extends CollectionSlug,\n  TSelect extends SelectFromCollectionSlug<TSlug>,\n>(\n  incomingArgs: Arguments,\n): Promise<PaginatedDocs<TransformCollectionWithSelect<TSlug, TSelect>>> => {\n  let args = incomingArgs\n\n  try {\n    // /////////////////////////////////////\n    // beforeOperation - Collection\n    // /////////////////////////////////////\n\n    args = await buildBeforeOperation({\n      args,\n      collection: args.collection.config,\n      operation: 'read',\n      overrideAccess: args.overrideAccess!,\n    })\n\n    const {\n      collection: { config: collectionConfig },\n      collection,\n      currentDepth,\n      depth,\n      disableErrors,\n      draft: draftsEnabled,\n      includeLockStatus: includeLockStatusFromArgs,\n      joins,\n      limit,\n      overrideAccess,\n      page,\n      pagination = true,\n      populate,\n      select: incomingSelect,\n      showHiddenFields,\n      sort: incomingSort,\n      trash = false,\n      where,\n    } = args\n\n    const req = args.req!\n\n    const includeLockStatus =\n      includeLockStatusFromArgs && req.payload.collections?.[lockedDocumentsCollectionSlug]\n\n    const { fallbackLocale, locale, payload } = req\n\n    const select = sanitizeSelect({\n      fields: collectionConfig.flattenedFields,\n      forceSelect: collectionConfig.forceSelect,\n      select: incomingSelect,\n    })\n\n    // /////////////////////////////////////\n    // Access\n    // /////////////////////////////////////\n\n    let accessResult: AccessResult\n\n    if (!overrideAccess) {\n      accessResult = await executeAccess({ disableErrors, req }, collectionConfig.access.read)\n\n      // If errors are disabled, and access returns false, return empty results\n      if (accessResult === false) {\n        return {\n          docs: [],\n          hasNextPage: false,\n          hasPrevPage: false,\n          limit: limit!,\n          nextPage: null,\n          page: 1,\n          pagingCounter: 1,\n          prevPage: null,\n          totalDocs: 0,\n          totalPages: 1,\n        }\n      }\n    }\n\n    // /////////////////////////////////////\n    // Find\n    // /////////////////////////////////////\n\n    const usePagination = pagination && limit !== 0\n    const sanitizedLimit = limit ?? (usePagination ? 10 : 0)\n    const sanitizedPage = page || 1\n\n    let result: PaginatedDocs<DataFromCollectionSlug<TSlug>>\n\n    let fullWhere = combineQueries(where!, accessResult!)\n    sanitizeWhereQuery({ fields: collectionConfig.flattenedFields, payload, where: fullWhere })\n\n    // Exclude trashed documents when trash: false\n    fullWhere = appendNonTrashedFilter({\n      enableTrash: collectionConfig.trash,\n      trash,\n      where: fullWhere,\n    })\n\n    const sort = sanitizeSortQuery({\n      fields: collection.config.flattenedFields,\n      sort: incomingSort,\n    })\n\n    const sanitizedJoins = await sanitizeJoinQuery({\n      collectionConfig,\n      joins,\n      overrideAccess: overrideAccess!,\n      req,\n    })\n\n    if (hasDraftsEnabled(collectionConfig) && draftsEnabled) {\n      fullWhere = appendVersionToQueryKey(fullWhere)\n\n      await validateQueryPaths({\n        collectionConfig: collection.config,\n        overrideAccess: overrideAccess!,\n        req,\n        versionFields: buildVersionCollectionFields(payload.config, collection.config, true),\n        where: appendVersionToQueryKey(where),\n      })\n\n      result = await payload.db.queryDrafts<DataFromCollectionSlug<TSlug>>({\n        collection: collectionConfig.slug,\n        joins: req.payloadAPI === 'GraphQL' ? false : sanitizedJoins,\n        limit: sanitizedLimit,\n        locale: locale!,\n        page: sanitizedPage,\n        pagination: usePagination,\n        req,\n        select: getQueryDraftsSelect({ select }),\n        sort: getQueryDraftsSort({\n          collectionConfig,\n          sort,\n        }),\n        where: fullWhere,\n      })\n    } else {\n      await validateQueryPaths({\n        collectionConfig,\n        overrideAccess: overrideAccess!,\n        req,\n        where: where!,\n      })\n\n      result = await payload.db.find<DataFromCollectionSlug<TSlug>>({\n        collection: collectionConfig.slug,\n        draftsEnabled,\n        joins: req.payloadAPI === 'GraphQL' ? false : sanitizedJoins,\n        limit: sanitizedLimit,\n        locale: locale!,\n        page: sanitizedPage,\n        pagination,\n        req,\n        select,\n        sort,\n        where: fullWhere,\n      })\n    }\n\n    if (includeLockStatus) {\n      try {\n        const lockDocumentsProp = collectionConfig?.lockDocuments\n\n        const lockDuration =\n          typeof lockDocumentsProp === 'object' ? lockDocumentsProp.duration : lockDurationDefault\n        const lockDurationInMilliseconds = lockDuration * 1000\n\n        const now = new Date().getTime()\n\n        const lockedDocuments = await payload.find({\n          collection: lockedDocumentsCollectionSlug,\n          depth: 1,\n          limit: sanitizedLimit,\n          overrideAccess: false,\n          pagination: false,\n          req,\n          where: {\n            and: [\n              {\n                'document.relationTo': {\n                  equals: collectionConfig.slug,\n                },\n              },\n              {\n                'document.value': {\n                  in: result.docs.map((doc) => doc.id),\n                },\n              },\n              // Query where the lock is newer than the current time minus lock time\n              {\n                updatedAt: {\n                  greater_than: new Date(now - lockDurationInMilliseconds),\n                },\n              },\n            ],\n          },\n        })\n\n        const lockedDocs = Array.isArray(lockedDocuments?.docs) ? lockedDocuments.docs : []\n\n        // Filter out stale locks\n        const validLockedDocs = lockedDocs.filter((lock) => {\n          const lastEditedAt = new Date(lock?.updatedAt).getTime()\n          return lastEditedAt + lockDurationInMilliseconds > now\n        })\n\n        for (const doc of result.docs) {\n          const lockedDoc = validLockedDocs.find((lock) => lock?.document?.value === doc.id)\n          doc._isLocked = !!lockedDoc\n          doc._userEditing = lockedDoc ? lockedDoc?.user?.value : null\n        }\n      } catch (_err) {\n        for (const doc of result.docs) {\n          doc._isLocked = false\n          doc._userEditing = null\n        }\n      }\n    }\n\n    // /////////////////////////////////////\n    // beforeRead - Collection\n    // /////////////////////////////////////\n\n    if (collectionConfig?.hooks?.beforeRead?.length) {\n      result.docs = await Promise.all(\n        result.docs.map(async (doc) => {\n          let docRef = doc\n\n          for (const hook of collectionConfig.hooks.beforeRead) {\n            docRef =\n              (await hook({\n                collection: collectionConfig,\n                context: req.context,\n                doc: docRef,\n                overrideAccess: overrideAccess!,\n                query: fullWhere,\n                req,\n              })) || docRef\n          }\n\n          return docRef\n        }),\n      )\n    }\n\n    // /////////////////////////////////////\n    // afterRead - Fields\n    // /////////////////////////////////////\n\n    result.docs = await Promise.all(\n      result.docs.map(async (doc) =>\n        afterRead<DataFromCollectionSlug<TSlug>>({\n          collection: collectionConfig,\n          context: req.context,\n          currentDepth,\n          depth: depth!,\n          doc,\n          draft: draftsEnabled!,\n          fallbackLocale: fallbackLocale!,\n          findMany: true,\n          global: null,\n          locale: locale!,\n          overrideAccess: overrideAccess!,\n          populate,\n          req,\n          select,\n          showHiddenFields: showHiddenFields!,\n        }),\n      ),\n    )\n\n    // /////////////////////////////////////\n    // afterRead - Collection\n    // /////////////////////////////////////\n\n    if (collectionConfig?.hooks?.afterRead?.length) {\n      result.docs = await Promise.all(\n        result.docs.map(async (doc) => {\n          let docRef = doc\n\n          for (const hook of collectionConfig.hooks.afterRead) {\n            docRef =\n              (await hook({\n                collection: collectionConfig,\n                context: req.context,\n                doc: docRef,\n                findMany: true,\n                overrideAccess: overrideAccess!,\n                query: fullWhere,\n                req,\n              })) || docRef\n          }\n\n          return docRef\n        }),\n      )\n    }\n\n    // /////////////////////////////////////\n    // afterOperation - Collection\n    // /////////////////////////////////////\n\n    result = await buildAfterOperation({\n      args,\n      collection: collectionConfig,\n      operation: 'find',\n      overrideAccess: overrideAccess!,\n      result,\n    })\n\n    // /////////////////////////////////////\n    // Return results\n    // /////////////////////////////////////\n\n    return result as PaginatedDocs<TransformCollectionWithSelect<TSlug, TSelect>>\n  } catch (error: unknown) {\n    await killTransaction(args.req!)\n    throw error\n  }\n}\n"],"names":["executeAccess","combineQueries","validateQueryPaths","sanitizeJoinQuery","sanitizeWhereQuery","afterRead","lockedDocumentsCollectionSlug","appendNonTrashedFilter","hasDraftsEnabled","killTransaction","sanitizeSelect","buildVersionCollectionFields","appendVersionToQueryKey","getQueryDraftsSelect","getQueryDraftsSort","buildAfterOperation","buildBeforeOperation","sanitizeSortQuery","lockDurationDefault","findOperation","incomingArgs","args","collection","config","operation","overrideAccess","collectionConfig","currentDepth","depth","disableErrors","draft","draftsEnabled","includeLockStatus","includeLockStatusFromArgs","joins","limit","page","pagination","populate","select","incomingSelect","showHiddenFields","sort","incomingSort","trash","where","req","payload","collections","fallbackLocale","locale","fields","flattenedFields","forceSelect","accessResult","access","read","docs","hasNextPage","hasPrevPage","nextPage","pagingCounter","prevPage","totalDocs","totalPages","usePagination","sanitizedLimit","sanitizedPage","result","fullWhere","enableTrash","sanitizedJoins","versionFields","db","queryDrafts","slug","payloadAPI","find","lockDocumentsProp","lockDocuments","lockDuration","duration","lockDurationInMilliseconds","now","Date","getTime","lockedDocuments","and","equals","in","map","doc","id","updatedAt","greater_than","lockedDocs","Array","isArray","validLockedDocs","filter","lock","lastEditedAt","lockedDoc","document","value","_isLocked","_userEditing","user","_err","hooks","beforeRead","length","Promise","all","docRef","hook","context","query","findMany","global","error"],"mappings":"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"}},
    {"offset": {"line": 1954, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/endpoints/find.ts"],"sourcesContent":["import { status as httpStatus } from 'http-status'\n\nimport type { PayloadHandler } from '../../config/types.js'\n\nimport { getRequestCollection } from '../../utilities/getRequestEntity.js'\nimport { headersWithCors } from '../../utilities/headersWithCors.js'\nimport { parseParams } from '../../utilities/parseParams/index.js'\nimport { findOperation } from '../operations/find.js'\n\nexport const findHandler: PayloadHandler = async (req) => {\n  const collection = getRequestCollection(req)\n\n  const { depth, draft, joins, limit, page, pagination, populate, select, sort, trash, where } =\n    parseParams(req.query)\n\n  const result = await findOperation({\n    collection,\n    depth,\n    draft,\n    joins,\n    limit,\n    page,\n    pagination,\n    populate,\n    req,\n    select,\n    sort,\n    trash,\n    where,\n  })\n\n  return Response.json(result, {\n    headers: headersWithCors({\n      headers: new Headers(),\n      req,\n    }),\n    status: httpStatus.OK,\n  })\n}\n"],"names":["status","httpStatus","getRequestCollection","headersWithCors","parseParams","findOperation","findHandler","req","collection","depth","draft","joins","limit","page","pagination","populate","select","sort","trash","where","query","result","Response","json","headers","Headers","OK"],"mappings":";;;;;AAAA,SAASA,UAAUC,UAAU,QAAQ,cAAa;AAIlD,SAASC,oBAAoB,QAAQ,sCAAqC;AAC1E,SAASC,eAAe,QAAQ,qCAAoC;AACpE,SAASC,WAAW,QAAQ,uCAAsC;AAClE,SAASC,aAAa,QAAQ,wBAAuB;;;;;;AAE9C,MAAMC,cAA8B,OAAOC;IAChD,MAAMC,iBAAaN,0LAAAA,EAAqBK;IAExC,MAAM,EAAEE,KAAK,EAAEC,KAAK,EAAEC,KAAK,EAAEC,KAAK,EAAEC,IAAI,EAAEC,UAAU,EAAEC,QAAQ,EAAEC,MAAM,EAAEC,IAAI,EAAEC,KAAK,EAAEC,KAAK,EAAE,OAC1Ff,qLAAAA,EAAYG,IAAIa,KAAK;IAEvB,MAAMC,SAAS,UAAMhB,uLAAAA,EAAc;QACjCG;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAC;QACAR;QACAS;QACAC;QACAC;QACAC;IACF;IAEA,OAAOG,SAASC,IAAI,CAACF,QAAQ;QAC3BG,aAASrB,oLAAAA,EAAgB;YACvBqB,SAAS,IAAIC;YACblB;QACF;QACAP,QAAQC,sMAAAA,CAAWyB,EAAE;IACvB;AACF,EAAC"}},
    {"offset": {"line": 1999, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/operations/findByID.ts"],"sourcesContent":["import type { FindOneArgs } from '../../database/types.js'\nimport type { CollectionSlug, FindOptions, JoinQuery } from '../../index.js'\nimport type {\n  ApplyDisableErrors,\n  JsonObject,\n  PayloadRequest,\n  PopulateType,\n  SelectType,\n  TransformCollectionWithSelect,\n} from '../../types/index.js'\nimport type {\n  Collection,\n  DataFromCollectionSlug,\n  SelectFromCollectionSlug,\n  TypeWithID,\n} from '../config/types.js'\n\nimport { executeAccess } from '../../auth/executeAccess.js'\nimport { combineQueries } from '../../database/combineQueries.js'\nimport { sanitizeJoinQuery } from '../../database/sanitizeJoinQuery.js'\nimport { sanitizeWhereQuery } from '../../database/sanitizeWhereQuery.js'\nimport { NotFound } from '../../errors/index.js'\nimport { afterRead, type AfterReadArgs } from '../../fields/hooks/afterRead/index.js'\nimport { validateQueryPaths } from '../../index.js'\nimport { lockedDocumentsCollectionSlug } from '../../locked-documents/config.js'\nimport { appendNonTrashedFilter } from '../../utilities/appendNonTrashedFilter.js'\nimport { getSelectMode } from '../../utilities/getSelectMode.js'\nimport { hasDraftsEnabled } from '../../utilities/getVersionsConfig.js'\nimport { killTransaction } from '../../utilities/killTransaction.js'\nimport { sanitizeSelect } from '../../utilities/sanitizeSelect.js'\nimport { replaceWithDraftIfAvailable } from '../../versions/drafts/replaceWithDraftIfAvailable.js'\nimport { buildAfterOperation } from './utilities/buildAfterOperation.js'\nimport { buildBeforeOperation } from './utilities/buildBeforeOperation.js'\n\nexport type FindByIDArgs = {\n  collection: Collection\n  currentDepth?: number\n  /**\n   * You may pass the document data directly which will skip the `db.findOne` database query.\n   * This is useful if you want to use this endpoint solely for running hooks and populating data.\n   */\n  data?: Record<string, unknown>\n  depth?: number\n  disableErrors?: boolean\n  draft?: boolean\n  id: number | string\n  includeLockStatus?: boolean\n  joins?: JoinQuery\n  overrideAccess?: boolean\n  populate?: PopulateType\n  req: PayloadRequest\n  showHiddenFields?: boolean\n  trash?: boolean\n} & Pick<AfterReadArgs<JsonObject>, 'flattenLocales'> &\n  Pick<FindOptions<string, SelectType>, 'select'>\n\nexport const findByIDOperation = async <\n  TSlug extends CollectionSlug,\n  TDisableErrors extends boolean,\n  TSelect extends SelectFromCollectionSlug<TSlug>,\n>(\n  incomingArgs: FindByIDArgs,\n): Promise<ApplyDisableErrors<TransformCollectionWithSelect<TSlug, TSelect>, TDisableErrors>> => {\n  let args = incomingArgs\n\n  try {\n    // /////////////////////////////////////\n    // beforeOperation - Collection\n    // /////////////////////////////////////\n\n    args = await buildBeforeOperation({\n      args,\n      collection: args.collection.config,\n      operation: 'read',\n      overrideAccess: args.overrideAccess!,\n    })\n\n    const {\n      id,\n      collection: { config: collectionConfig },\n      currentDepth,\n      depth,\n      disableErrors,\n      draft: replaceWithVersion = false,\n      flattenLocales,\n      includeLockStatus: includeLockStatusFromArgs,\n      joins,\n      overrideAccess = false,\n      populate,\n      req: { fallbackLocale, locale, t },\n      req,\n      select: incomingSelect,\n      showHiddenFields,\n      trash = false,\n    } = args\n\n    const includeLockStatus =\n      includeLockStatusFromArgs && req.payload.collections?.[lockedDocumentsCollectionSlug]\n\n    const select = sanitizeSelect({\n      fields: collectionConfig.flattenedFields,\n      forceSelect: collectionConfig.forceSelect,\n      select: incomingSelect,\n    })\n\n    // /////////////////////////////////////\n    // Access\n    // /////////////////////////////////////\n\n    const accessResult = !overrideAccess\n      ? await executeAccess({ id, disableErrors, req }, collectionConfig.access.read)\n      : true\n\n    // If errors are disabled, and access returns false, return null\n    if (accessResult === false) {\n      return null!\n    }\n\n    const where = { id: { equals: id } }\n\n    let fullWhere = combineQueries(where, accessResult)\n\n    // Exclude trashed documents when trash: false\n    fullWhere = appendNonTrashedFilter({\n      enableTrash: collectionConfig.trash,\n      trash,\n      where: fullWhere,\n    })\n\n    sanitizeWhereQuery({\n      fields: collectionConfig.flattenedFields,\n      payload: args.req.payload,\n      where: fullWhere,\n    })\n\n    const sanitizedJoins = await sanitizeJoinQuery({\n      collectionConfig,\n      joins,\n      overrideAccess,\n      req,\n    })\n\n    // execute only if there's a custom ID and potentially overwriten access on id\n    if (req.payload.collections[collectionConfig.slug]!.customIDType) {\n      await validateQueryPaths({\n        collectionConfig,\n        overrideAccess,\n        req,\n        where,\n      })\n    }\n\n    // /////////////////////////////////////\n    // Find by ID\n    // /////////////////////////////////////\n\n    let dbSelect = select\n\n    if (\n      collectionConfig.versions?.drafts &&\n      replaceWithVersion &&\n      select &&\n      getSelectMode(select) === 'include'\n    ) {\n      dbSelect = { ...select, createdAt: true, updatedAt: true }\n    }\n\n    const findOneArgs: FindOneArgs = {\n      collection: collectionConfig.slug,\n      draftsEnabled: replaceWithVersion,\n      joins: req.payloadAPI === 'GraphQL' ? false : sanitizedJoins,\n      locale: locale!,\n      req: {\n        transactionID: req.transactionID,\n      } as PayloadRequest,\n      select: dbSelect,\n      where: fullWhere,\n    }\n\n    if (!findOneArgs.where?.and?.[0]?.id) {\n      throw new NotFound(t)\n    }\n\n    const docFromDB = await req.payload.db.findOne(findOneArgs)\n\n    if (!docFromDB && !args.data) {\n      if (!disableErrors) {\n        throw new NotFound(req.t)\n      }\n      return null!\n    }\n\n    let result: DataFromCollectionSlug<TSlug> =\n      (args.data as DataFromCollectionSlug<TSlug>) ?? docFromDB!\n\n    // /////////////////////////////////////\n    // Include Lock Status if required\n    // /////////////////////////////////////\n\n    if (includeLockStatus && id) {\n      let lockStatus: (JsonObject & TypeWithID) | null = null\n\n      try {\n        const lockDocumentsProp = collectionConfig?.lockDocuments\n\n        const lockDurationDefault = 300 // Default 5 minutes in seconds\n        const lockDuration =\n          typeof lockDocumentsProp === 'object' ? lockDocumentsProp.duration : lockDurationDefault\n        const lockDurationInMilliseconds = lockDuration * 1000\n\n        const lockedDocument = await req.payload.find({\n          collection: lockedDocumentsCollectionSlug,\n          depth: 1,\n          limit: 1,\n          overrideAccess: false,\n          pagination: false,\n          req,\n          where: {\n            and: [\n              {\n                'document.relationTo': {\n                  equals: collectionConfig.slug,\n                },\n              },\n              {\n                'document.value': {\n                  equals: id,\n                },\n              },\n              // Query where the lock is newer than the current time minus lock time\n              {\n                updatedAt: {\n                  greater_than: new Date(new Date().getTime() - lockDurationInMilliseconds),\n                },\n              },\n            ],\n          },\n        })\n\n        if (lockedDocument && lockedDocument.docs.length > 0) {\n          lockStatus = lockedDocument.docs[0]!\n        }\n      } catch {\n        // swallow error\n      }\n\n      result._isLocked = !!lockStatus\n      result._userEditing = lockStatus?.user?.value ?? null\n    }\n\n    // /////////////////////////////////////\n    // Replace document with draft if available\n    // /////////////////////////////////////\n\n    if (replaceWithVersion && hasDraftsEnabled(collectionConfig)) {\n      result = await replaceWithDraftIfAvailable({\n        accessResult,\n        doc: result,\n        entity: collectionConfig,\n        entityType: 'collection',\n        overrideAccess,\n        req,\n        select,\n      })\n    }\n\n    // /////////////////////////////////////\n    // beforeRead - Collection\n    // /////////////////////////////////////\n\n    if (collectionConfig.hooks?.beforeRead?.length) {\n      for (const hook of collectionConfig.hooks.beforeRead) {\n        result =\n          (await hook({\n            collection: collectionConfig,\n            context: req.context,\n            doc: result,\n            overrideAccess,\n            query: findOneArgs.where,\n            req,\n          })) || result\n      }\n    }\n\n    // /////////////////////////////////////\n    // afterRead - Fields\n    // /////////////////////////////////////\n\n    result = await afterRead({\n      collection: collectionConfig,\n      context: req.context,\n      currentDepth,\n      depth: depth!,\n      doc: result,\n      draft: replaceWithVersion,\n      fallbackLocale: fallbackLocale!,\n      flattenLocales,\n      global: null,\n      locale: locale!,\n      overrideAccess,\n      populate,\n      req,\n      select,\n      showHiddenFields: showHiddenFields!,\n    })\n\n    // /////////////////////////////////////\n    // afterRead - Collection\n    // /////////////////////////////////////\n\n    if (collectionConfig.hooks?.afterRead?.length) {\n      for (const hook of collectionConfig.hooks.afterRead) {\n        result =\n          (await hook({\n            collection: collectionConfig,\n            context: req.context,\n            doc: result,\n            overrideAccess,\n            query: findOneArgs.where,\n            req,\n          })) || result\n      }\n    }\n\n    // /////////////////////////////////////\n    // afterOperation - Collection\n    // /////////////////////////////////////\n\n    result = await buildAfterOperation({\n      args,\n      collection: collectionConfig,\n      operation: 'findByID',\n      overrideAccess,\n      result,\n    })\n\n    // /////////////////////////////////////\n    // Return results\n    // /////////////////////////////////////\n\n    return result as ApplyDisableErrors<\n      TransformCollectionWithSelect<TSlug, TSelect>,\n      TDisableErrors\n    >\n  } catch (error: unknown) {\n    await killTransaction(args.req)\n    throw error\n  }\n}\n"],"names":["executeAccess","combineQueries","sanitizeJoinQuery","sanitizeWhereQuery","NotFound","afterRead","validateQueryPaths","lockedDocumentsCollectionSlug","appendNonTrashedFilter","getSelectMode","hasDraftsEnabled","killTransaction","sanitizeSelect","replaceWithDraftIfAvailable","buildAfterOperation","buildBeforeOperation","findByIDOperation","incomingArgs","args","collection","config","operation","overrideAccess","id","collectionConfig","currentDepth","depth","disableErrors","draft","replaceWithVersion","flattenLocales","includeLockStatus","includeLockStatusFromArgs","joins","populate","req","fallbackLocale","locale","t","select","incomingSelect","showHiddenFields","trash","payload","collections","fields","flattenedFields","forceSelect","accessResult","access","read","where","equals","fullWhere","enableTrash","sanitizedJoins","slug","customIDType","dbSelect","versions","drafts","createdAt","updatedAt","findOneArgs","draftsEnabled","payloadAPI","transactionID","and","docFromDB","db","findOne","data","result","lockStatus","lockDocumentsProp","lockDocuments","lockDurationDefault","lockDuration","duration","lockDurationInMilliseconds","lockedDocument","find","limit","pagination","greater_than","Date","getTime","docs","length","_isLocked","_userEditing","user","value","doc","entity","entityType","hooks","beforeRead","hook","context","query","global","error"],"mappings":"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"}},
    {"offset": {"line": 2266, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/endpoints/findByID.ts"],"sourcesContent":["import { status as httpStatus } from 'http-status'\n\nimport type { PayloadHandler } from '../../config/types.js'\n\nimport { getRequestCollectionWithID } from '../../utilities/getRequestEntity.js'\nimport { headersWithCors } from '../../utilities/headersWithCors.js'\nimport { parseParams } from '../../utilities/parseParams/index.js'\nimport { findByIDOperation } from '../operations/findByID.js'\n\nexport const findByIDHandler: PayloadHandler = async (req) => {\n  const { data: dataArg } = req\n  const { id, collection } = getRequestCollectionWithID(req)\n\n  const { data, depth, draft, flattenLocales, joins, populate, select, trash } = parseParams({\n    ...req.query,\n    ...dataArg,\n  })\n\n  const result = await findByIDOperation({\n    id,\n    collection,\n    data,\n    depth,\n    draft,\n    flattenLocales,\n    joins,\n    populate,\n    req,\n    select,\n    trash,\n  })\n\n  return Response.json(result, {\n    headers: headersWithCors({\n      headers: new Headers(),\n      req,\n    }),\n    status: httpStatus.OK,\n  })\n}\n"],"names":["status","httpStatus","getRequestCollectionWithID","headersWithCors","parseParams","findByIDOperation","findByIDHandler","req","data","dataArg","id","collection","depth","draft","flattenLocales","joins","populate","select","trash","query","result","Response","json","headers","Headers","OK"],"mappings":";;;;;AAAA,SAASA,UAAUC,UAAU,QAAQ,cAAa;AAIlD,SAASC,0BAA0B,QAAQ,sCAAqC;AAChF,SAASC,eAAe,QAAQ,qCAAoC;AACpE,SAASC,WAAW,QAAQ,uCAAsC;AAClE,SAASC,iBAAiB,QAAQ,4BAA2B;;;;;;AAEtD,MAAMC,kBAAkC,OAAOC;IACpD,MAAM,EAAEC,MAAMC,OAAO,EAAE,GAAGF;IAC1B,MAAM,EAAEG,EAAE,EAAEC,UAAU,EAAE,OAAGT,gMAAAA,EAA2BK;IAEtD,MAAM,EAAEC,IAAI,EAAEI,KAAK,EAAEC,KAAK,EAAEC,cAAc,EAAEC,KAAK,EAAEC,QAAQ,EAAEC,MAAM,EAAEC,KAAK,EAAE,OAAGd,qLAAAA,EAAY;QACzF,GAAGG,IAAIY,KAAK;QACZ,GAAGV,OAAO;IACZ;IAEA,MAAMW,SAAS,UAAMf,+LAAAA,EAAkB;QACrCK;QACAC;QACAH;QACAI;QACAC;QACAC;QACAC;QACAC;QACAT;QACAU;QACAC;IACF;IAEA,OAAOG,SAASC,IAAI,CAACF,QAAQ;QAC3BG,aAASpB,oLAAAA,EAAgB;YACvBoB,SAAS,IAAIC;YACbjB;QACF;QACAP,QAAQC,sMAAAA,CAAWwB,EAAE;IACvB;AACF,EAAC"}},
    {"offset": {"line": 2313, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/operations/findVersionByID.ts"],"sourcesContent":["import { status as httpStatus } from 'http-status'\n\nimport type { FindOptions } from '../../index.js'\nimport type { PayloadRequest, PopulateType, SelectType } from '../../types/index.js'\nimport type { TypeWithVersion } from '../../versions/types.js'\nimport type { Collection, TypeWithID } from '../config/types.js'\n\nimport { executeAccess } from '../../auth/executeAccess.js'\nimport { combineQueries } from '../../database/combineQueries.js'\nimport { APIError, Forbidden, NotFound } from '../../errors/index.js'\nimport { afterRead } from '../../fields/hooks/afterRead/index.js'\nimport { appendNonTrashedFilter } from '../../utilities/appendNonTrashedFilter.js'\nimport { killTransaction } from '../../utilities/killTransaction.js'\nimport { sanitizeSelect } from '../../utilities/sanitizeSelect.js'\nimport { buildVersionCollectionFields } from '../../versions/buildCollectionFields.js'\nimport { getQueryDraftsSelect } from '../../versions/drafts/getQueryDraftsSelect.js'\nimport { buildAfterOperation } from './utilities/buildAfterOperation.js'\nimport { buildBeforeOperation } from './utilities/buildBeforeOperation.js'\n\nexport type Arguments = {\n  collection: Collection\n  currentDepth?: number\n  depth?: number\n  disableErrors?: boolean\n  id: number | string\n  overrideAccess?: boolean\n  populate?: PopulateType\n  req: PayloadRequest\n  showHiddenFields?: boolean\n  trash?: boolean\n} & Pick<FindOptions<string, SelectType>, 'select'>\n\nexport const findVersionByIDOperation = async <TData extends TypeWithID = any>(\n  args: Arguments,\n): Promise<TypeWithVersion<TData>> => {\n  const {\n    id,\n    collection: { config: collectionConfig },\n    currentDepth,\n    depth,\n    disableErrors,\n    overrideAccess,\n    populate,\n    req: { fallbackLocale, locale, payload },\n    req,\n    select: incomingSelect,\n    showHiddenFields,\n    trash = false,\n  } = args\n\n  if (!id) {\n    throw new APIError('Missing ID of version.', httpStatus.BAD_REQUEST)\n  }\n\n  try {\n    // /////////////////////////////////////\n    // beforeOperation - Collection\n    // /////////////////////////////////////\n\n    args = await buildBeforeOperation({\n      args,\n      collection: collectionConfig,\n      operation: 'findVersionByID',\n      overrideAccess,\n    })\n\n    // /////////////////////////////////////\n    // Access\n    // /////////////////////////////////////\n\n    const accessResults = !overrideAccess\n      ? await executeAccess({ id, disableErrors, req }, collectionConfig.access.readVersions)\n      : true\n\n    // If errors are disabled, and access returns false, return null\n    if (accessResults === false) {\n      return null!\n    }\n\n    const hasWhereAccess = typeof accessResults === 'object'\n\n    const where = { id: { equals: id } }\n\n    let fullWhere = combineQueries(where, accessResults)\n\n    fullWhere = appendNonTrashedFilter({\n      deletedAtPath: 'version.deletedAt',\n      enableTrash: collectionConfig.trash,\n      trash,\n      where: fullWhere,\n    })\n\n    // /////////////////////////////////////\n    // Find by ID\n    // /////////////////////////////////////\n\n    const select = sanitizeSelect({\n      fields: buildVersionCollectionFields(payload.config, collectionConfig, true),\n      forceSelect: getQueryDraftsSelect({ select: collectionConfig.forceSelect }),\n      select: incomingSelect,\n      versions: true,\n    })\n\n    const versionsQuery = await payload.db.findVersions<TData>({\n      collection: collectionConfig.slug,\n      limit: 1,\n      locale: locale!,\n      pagination: false,\n      req,\n      select,\n      where: fullWhere,\n    })\n\n    let result = versionsQuery.docs[0]!\n\n    if (!result) {\n      if (!disableErrors) {\n        if (!hasWhereAccess) {\n          throw new NotFound(req.t)\n        }\n        if (hasWhereAccess) {\n          throw new Forbidden(req.t)\n        }\n      }\n\n      return null!\n    }\n\n    if (!result.version) {\n      // Fallback if not selected\n      ;(result as any).version = {}\n    }\n\n    // /////////////////////////////////////\n    // beforeRead - Collection\n    // /////////////////////////////////////\n\n    if (collectionConfig.hooks?.beforeRead?.length) {\n      for (const hook of collectionConfig.hooks.beforeRead) {\n        result.version =\n          (await hook({\n            collection: collectionConfig,\n            context: req.context,\n            doc: result.version,\n            overrideAccess,\n            query: fullWhere,\n            req,\n          })) || result.version\n      }\n    }\n\n    // /////////////////////////////////////\n    // afterRead - Fields\n    // /////////////////////////////////////\n\n    result.version = await afterRead({\n      collection: collectionConfig,\n      context: req.context,\n      currentDepth,\n      depth: depth!,\n      doc: result.version,\n      // @ts-expect-error - vestiges of when tsconfig was not strict. Feel free to improve\n      draft: undefined,\n      fallbackLocale: fallbackLocale!,\n      global: null,\n      locale: locale!,\n      overrideAccess: overrideAccess!,\n      populate,\n      req,\n      select: typeof select?.version === 'object' ? select.version : undefined,\n      showHiddenFields: showHiddenFields!,\n    })\n\n    // /////////////////////////////////////\n    // afterRead - Collection\n    // /////////////////////////////////////\n\n    if (collectionConfig.hooks?.afterRead?.length) {\n      for (const hook of collectionConfig.hooks.afterRead) {\n        result.version =\n          (await hook({\n            collection: collectionConfig,\n            context: req.context,\n            doc: result.version,\n            overrideAccess,\n            query: fullWhere,\n            req,\n          })) || result.version\n      }\n    }\n\n    // /////////////////////////////////////\n    // afterOperation - Collection\n    // /////////////////////////////////////\n\n    result = await buildAfterOperation({\n      args,\n      collection: collectionConfig,\n      operation: 'findVersionByID',\n      overrideAccess,\n      result,\n    })\n\n    // /////////////////////////////////////\n    // Return results\n    // /////////////////////////////////////\n\n    return result\n  } catch (error: unknown) {\n    await killTransaction(req)\n    throw error\n  }\n}\n"],"names":["status","httpStatus","executeAccess","combineQueries","APIError","Forbidden","NotFound","afterRead","appendNonTrashedFilter","killTransaction","sanitizeSelect","buildVersionCollectionFields","getQueryDraftsSelect","buildAfterOperation","buildBeforeOperation","findVersionByIDOperation","args","id","collection","config","collectionConfig","currentDepth","depth","disableErrors","overrideAccess","populate","req","fallbackLocale","locale","payload","select","incomingSelect","showHiddenFields","trash","BAD_REQUEST","operation","accessResults","access","readVersions","hasWhereAccess","where","equals","fullWhere","deletedAtPath","enableTrash","fields","forceSelect","versions","versionsQuery","db","findVersions","slug","limit","pagination","result","docs","t","version","hooks","beforeRead","length","hook","context","doc","query","draft","undefined","global","error"],"mappings":"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"}},
    {"offset": {"line": 2494, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/endpoints/findVersionByID.ts"],"sourcesContent":["import { status as httpStatus } from 'http-status'\n\nimport type { PayloadHandler } from '../../config/types.js'\n\nimport { getRequestCollectionWithID } from '../../utilities/getRequestEntity.js'\nimport { headersWithCors } from '../../utilities/headersWithCors.js'\nimport { parseParams } from '../../utilities/parseParams/index.js'\nimport { findVersionByIDOperation } from '../operations/findVersionByID.js'\n\nexport const findVersionByIDHandler: PayloadHandler = async (req) => {\n  const { depth, populate, select, trash } = parseParams(req.query)\n\n  const { id, collection } = getRequestCollectionWithID(req)\n\n  const result = await findVersionByIDOperation({\n    id,\n    collection,\n    depth,\n    populate,\n    req,\n    select,\n    trash,\n  })\n\n  return Response.json(result, {\n    headers: headersWithCors({\n      headers: new Headers(),\n      req,\n    }),\n    status: httpStatus.OK,\n  })\n}\n"],"names":["status","httpStatus","getRequestCollectionWithID","headersWithCors","parseParams","findVersionByIDOperation","findVersionByIDHandler","req","depth","populate","select","trash","query","id","collection","result","Response","json","headers","Headers","OK"],"mappings":";;;;;AAAA,SAASA,UAAUC,UAAU,QAAQ,cAAa;AAIlD,SAASC,0BAA0B,QAAQ,sCAAqC;AAChF,SAASC,eAAe,QAAQ,qCAAoC;AACpE,SAASC,WAAW,QAAQ,uCAAsC;AAClE,SAASC,wBAAwB,QAAQ,mCAAkC;;;;;;AAEpE,MAAMC,yBAAyC,OAAOC;IAC3D,MAAM,EAAEC,KAAK,EAAEC,QAAQ,EAAEC,MAAM,EAAEC,KAAK,EAAE,OAAGP,qLAAAA,EAAYG,IAAIK,KAAK;IAEhE,MAAM,EAAEC,EAAE,EAAEC,UAAU,EAAE,OAAGZ,gMAAAA,EAA2BK;IAEtD,MAAMQ,SAAS,UAAMV,6MAAAA,EAAyB;QAC5CQ;QACAC;QACAN;QACAC;QACAF;QACAG;QACAC;IACF;IAEA,OAAOK,SAASC,IAAI,CAACF,QAAQ;QAC3BG,aAASf,oLAAAA,EAAgB;YACvBe,SAAS,IAAIC;YACbZ;QACF;QACAP,QAAQC,sMAAAA,CAAWmB,EAAE;IACvB;AACF,EAAC"}},
    {"offset": {"line": 2533, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/operations/findVersions.ts"],"sourcesContent":["import type { AccessResult } from '../../config/types.js'\nimport type { PaginatedDocs } from '../../database/types.js'\nimport type { PayloadRequest, PopulateType, SelectType, Sort, Where } from '../../types/index.js'\nimport type { TypeWithVersion } from '../../versions/types.js'\nimport type { Collection } from '../config/types.js'\nimport type { FindOptions } from './local/find.js'\n\nimport { executeAccess } from '../../auth/executeAccess.js'\nimport { combineQueries } from '../../database/combineQueries.js'\nimport { validateQueryPaths } from '../../database/queryValidation/validateQueryPaths.js'\nimport { sanitizeWhereQuery } from '../../database/sanitizeWhereQuery.js'\nimport { afterRead } from '../../fields/hooks/afterRead/index.js'\nimport { appendNonTrashedFilter } from '../../utilities/appendNonTrashedFilter.js'\nimport { killTransaction } from '../../utilities/killTransaction.js'\nimport { sanitizeInternalFields } from '../../utilities/sanitizeInternalFields.js'\nimport { sanitizeSelect } from '../../utilities/sanitizeSelect.js'\nimport { buildVersionCollectionFields } from '../../versions/buildCollectionFields.js'\nimport { getQueryDraftsSelect } from '../../versions/drafts/getQueryDraftsSelect.js'\nimport { buildAfterOperation } from './utilities/buildAfterOperation.js'\nimport { buildBeforeOperation } from './utilities/buildBeforeOperation.js'\n\nexport type Arguments = {\n  collection: Collection\n  depth?: number\n  limit?: number\n  overrideAccess?: boolean\n  page?: number\n  pagination?: boolean\n  populate?: PopulateType\n  req?: PayloadRequest\n  showHiddenFields?: boolean\n  sort?: Sort\n  trash?: boolean\n  where?: Where\n} & Pick<FindOptions<string, SelectType>, 'select'>\n\nexport const findVersionsOperation = async <TData extends TypeWithVersion<TData>>(\n  args: Arguments,\n): Promise<PaginatedDocs<TData>> => {\n  try {\n    // /////////////////////////////////////\n    // beforeOperation - Collection\n    // /////////////////////////////////////\n\n    args = await buildBeforeOperation({\n      args,\n      collection: args.collection.config,\n      operation: 'findVersions',\n      overrideAccess: args.overrideAccess!,\n    })\n\n    const {\n      collection: { config: collectionConfig },\n      depth,\n      limit,\n      overrideAccess,\n      page,\n      pagination = true,\n      populate,\n      select: incomingSelect,\n      showHiddenFields,\n      sort,\n      trash = false,\n      where,\n    } = args\n\n    const req = args.req!\n    const { fallbackLocale, locale, payload } = req\n\n    // /////////////////////////////////////\n    // Access\n    // /////////////////////////////////////\n\n    let accessResults!: AccessResult\n\n    if (!overrideAccess) {\n      accessResults = await executeAccess({ req }, collectionConfig.access.readVersions)\n    }\n\n    const versionFields = buildVersionCollectionFields(payload.config, collectionConfig, true)\n\n    await validateQueryPaths({\n      collectionConfig,\n      overrideAccess: overrideAccess!,\n      req,\n      versionFields,\n      where: where!,\n    })\n\n    let fullWhere = combineQueries(where!, accessResults)\n\n    // Exclude trashed documents when trash: false\n    fullWhere = appendNonTrashedFilter({\n      deletedAtPath: 'version.deletedAt',\n      enableTrash: collectionConfig.trash,\n      trash,\n      where: fullWhere,\n    })\n\n    sanitizeWhereQuery({ fields: versionFields, payload, where: fullWhere })\n\n    const select = sanitizeSelect({\n      fields: versionFields,\n      forceSelect: getQueryDraftsSelect({ select: collectionConfig.forceSelect }),\n      select: incomingSelect,\n      versions: true,\n    })\n\n    // /////////////////////////////////////\n    // Find\n    // /////////////////////////////////////\n\n    const usePagination = pagination && limit !== 0\n    const sanitizedLimit = limit ?? (usePagination ? 10 : 0)\n    const sanitizedPage = page || 1\n\n    const paginatedDocs = await payload.db.findVersions<TData>({\n      collection: collectionConfig.slug,\n      limit: sanitizedLimit,\n      locale: locale!,\n      page: sanitizedPage,\n      pagination,\n      req,\n      select,\n      sort,\n      where: fullWhere,\n    })\n\n    // /////////////////////////////////////\n    // beforeRead - Collection\n    // /////////////////////////////////////\n    let result: PaginatedDocs<TData> = paginatedDocs as unknown as PaginatedDocs<TData>\n    result.docs = (await Promise.all(\n      paginatedDocs.docs.map(async (doc) => {\n        const docRef = doc\n        // Fallback if not selected\n        if (!docRef.version) {\n          ;(docRef as any).version = {}\n        }\n\n        if (collectionConfig.hooks?.beforeRead?.length) {\n          for (const hook of collectionConfig.hooks.beforeRead) {\n            docRef.version =\n              (await hook({\n                collection: collectionConfig,\n                context: req.context,\n                doc: docRef.version,\n                overrideAccess,\n                query: fullWhere,\n                req,\n              })) || docRef.version\n          }\n        }\n\n        return docRef\n      }),\n    )) as TData[]\n    // /////////////////////////////////////\n    // afterRead - Fields\n    // /////////////////////////////////////\n\n    result.docs = await Promise.all(\n      result.docs.map(async (data) => {\n        data.version = await afterRead({\n          collection: collectionConfig,\n          context: req.context,\n          depth: depth!,\n          doc: data.version,\n          // @ts-expect-error - vestiges of when tsconfig was not strict. Feel free to improve\n          draft: undefined,\n          fallbackLocale: fallbackLocale!,\n          findMany: true,\n          global: null,\n          locale: locale!,\n          overrideAccess: overrideAccess!,\n          populate,\n          req,\n          select: typeof select?.version === 'object' ? select.version : undefined,\n          showHiddenFields: showHiddenFields!,\n        })\n        return data\n      }),\n    )\n\n    // /////////////////////////////////////\n    // afterRead - Collection\n    // /////////////////////////////////////\n\n    if (collectionConfig.hooks.afterRead?.length) {\n      result.docs = await Promise.all(\n        result.docs.map(async (doc) => {\n          const docRef = doc\n\n          for (const hook of collectionConfig.hooks.afterRead) {\n            docRef.version =\n              (await hook({\n                collection: collectionConfig,\n                context: req.context,\n                doc: doc.version,\n                findMany: true,\n                overrideAccess,\n                query: fullWhere,\n                req,\n              })) || doc.version\n          }\n\n          return docRef\n        }),\n      )\n    }\n\n    // /////////////////////////////////////\n    // Return results\n    // /////////////////////////////////////\n    result.docs = result.docs.map((doc) => sanitizeInternalFields<TData>(doc))\n\n    // /////////////////////////////////////\n    // afterOperation - Collection\n    // /////////////////////////////////////\n\n    result = await buildAfterOperation({\n      args,\n      collection: collectionConfig,\n      operation: 'findVersions',\n      overrideAccess,\n      result,\n    })\n\n    return result\n  } catch (error: unknown) {\n    await killTransaction(args.req!)\n    throw error\n  }\n}\n"],"names":["executeAccess","combineQueries","validateQueryPaths","sanitizeWhereQuery","afterRead","appendNonTrashedFilter","killTransaction","sanitizeInternalFields","sanitizeSelect","buildVersionCollectionFields","getQueryDraftsSelect","buildAfterOperation","buildBeforeOperation","findVersionsOperation","args","collection","config","operation","overrideAccess","collectionConfig","depth","limit","page","pagination","populate","select","incomingSelect","showHiddenFields","sort","trash","where","req","fallbackLocale","locale","payload","accessResults","access","readVersions","versionFields","fullWhere","deletedAtPath","enableTrash","fields","forceSelect","versions","usePagination","sanitizedLimit","sanitizedPage","paginatedDocs","db","findVersions","slug","result","docs","Promise","all","map","doc","docRef","version","hooks","beforeRead","length","hook","context","query","data","draft","undefined","findMany","global","error"],"mappings":"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"}},
    {"offset": {"line": 2724, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/endpoints/findVersions.ts"],"sourcesContent":["import { status as httpStatus } from 'http-status'\n\nimport type { PayloadHandler } from '../../config/types.js'\n\nimport { getRequestCollection } from '../../utilities/getRequestEntity.js'\nimport { headersWithCors } from '../../utilities/headersWithCors.js'\nimport { parseParams } from '../../utilities/parseParams/index.js'\nimport { findVersionsOperation } from '../operations/findVersions.js'\n\nexport const findVersionsHandler: PayloadHandler = async (req) => {\n  const collection = getRequestCollection(req)\n\n  const { depth, limit, page, pagination, populate, select, sort, trash, where } = parseParams(\n    req.query,\n  )\n\n  const result = await findVersionsOperation({\n    collection,\n    depth,\n    limit,\n    page,\n    pagination,\n    populate,\n    req,\n    select,\n    sort,\n    trash,\n    where,\n  })\n\n  return Response.json(result, {\n    headers: headersWithCors({\n      headers: new Headers(),\n      req,\n    }),\n    status: httpStatus.OK,\n  })\n}\n"],"names":["status","httpStatus","getRequestCollection","headersWithCors","parseParams","findVersionsOperation","findVersionsHandler","req","collection","depth","limit","page","pagination","populate","select","sort","trash","where","query","result","Response","json","headers","Headers","OK"],"mappings":";;;;;AAAA,SAASA,UAAUC,UAAU,QAAQ,cAAa;AAIlD,SAASC,oBAAoB,QAAQ,sCAAqC;AAC1E,SAASC,eAAe,QAAQ,qCAAoC;AACpE,SAASC,WAAW,QAAQ,uCAAsC;AAClE,SAASC,qBAAqB,QAAQ,gCAA+B;;;;;;AAE9D,MAAMC,sBAAsC,OAAOC;IACxD,MAAMC,iBAAaN,0LAAAA,EAAqBK;IAExC,MAAM,EAAEE,KAAK,EAAEC,KAAK,EAAEC,IAAI,EAAEC,UAAU,EAAEC,QAAQ,EAAEC,MAAM,EAAEC,IAAI,EAAEC,KAAK,EAAEC,KAAK,EAAE,OAAGb,qLAAAA,EAC/EG,IAAIW,KAAK;IAGX,MAAMC,SAAS,UAAMd,uMAAAA,EAAsB;QACzCG;QACAC;QACAC;QACAC;QACAC;QACAC;QACAN;QACAO;QACAC;QACAC;QACAC;IACF;IAEA,OAAOG,SAASC,IAAI,CAACF,QAAQ;QAC3BG,aAASnB,oLAAAA,EAAgB;YACvBmB,SAAS,IAAIC;YACbhB;QACF;QACAP,QAAQC,sMAAAA,CAAWuB,EAAE;IACvB;AACF,EAAC"}},
    {"offset": {"line": 2767, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/operations/restoreVersion.ts"],"sourcesContent":["import { status as httpStatus } from 'http-status'\n\nimport type { FindOneArgs } from '../../database/types.js'\nimport type { JsonObject, PayloadRequest, PopulateType, SelectType } from '../../types/index.js'\nimport type { Collection, TypeWithID } from '../config/types.js'\nimport type { FindOptions } from './local/find.js'\n\nimport { executeAccess } from '../../auth/executeAccess.js'\nimport { hasWhereAccessResult } from '../../auth/types.js'\nimport { combineQueries } from '../../database/combineQueries.js'\nimport { APIError, Forbidden, NotFound } from '../../errors/index.js'\nimport { afterChange } from '../../fields/hooks/afterChange/index.js'\nimport { afterRead } from '../../fields/hooks/afterRead/index.js'\nimport { beforeChange } from '../../fields/hooks/beforeChange/index.js'\nimport { beforeValidate } from '../../fields/hooks/beforeValidate/index.js'\nimport { commitTransaction } from '../../utilities/commitTransaction.js'\nimport { deepCopyObjectSimple } from '../../utilities/deepCopyObject.js'\nimport { hasDraftValidationEnabled } from '../../utilities/getVersionsConfig.js'\nimport { initTransaction } from '../../utilities/initTransaction.js'\nimport { killTransaction } from '../../utilities/killTransaction.js'\nimport { sanitizeSelect } from '../../utilities/sanitizeSelect.js'\nimport { getLatestCollectionVersion } from '../../versions/getLatestCollectionVersion.js'\nimport { saveVersion } from '../../versions/saveVersion.js'\nimport { buildAfterOperation } from './utilities/buildAfterOperation.js'\nimport { buildBeforeOperation } from './utilities/buildBeforeOperation.js'\nexport type Arguments = {\n  collection: Collection\n  currentDepth?: number\n  depth?: number\n  disableErrors?: boolean\n  disableTransaction?: boolean\n  draft?: boolean\n  id: number | string\n  overrideAccess?: boolean\n  populate?: PopulateType\n  req: PayloadRequest\n  showHiddenFields?: boolean\n} & Pick<FindOptions<string, SelectType>, 'select'>\n\nexport const restoreVersionOperation = async <\n  TData extends JsonObject & TypeWithID = JsonObject & TypeWithID,\n>(\n  args: Arguments,\n): Promise<TData> => {\n  const {\n    id,\n    collection: { config: collectionConfig },\n    depth,\n    draft: draftArg = false,\n    overrideAccess = false,\n    populate,\n    req,\n    req: { fallbackLocale, locale, payload },\n    select: incomingSelect,\n    showHiddenFields,\n  } = args\n\n  try {\n    const shouldCommit = !args.disableTransaction && (await initTransaction(args.req))\n\n    // /////////////////////////////////////\n    // beforeOperation - Collection\n    // /////////////////////////////////////\n\n    args = await buildBeforeOperation({\n      args,\n      collection: args.collection.config,\n      operation: 'restoreVersion',\n      overrideAccess,\n    })\n\n    if (!id) {\n      throw new APIError('Missing ID of version to restore.', httpStatus.BAD_REQUEST)\n    }\n\n    // /////////////////////////////////////\n    // Retrieve original raw version\n    // /////////////////////////////////////\n\n    const { docs: versionDocs } = await req.payload.db.findVersions({\n      collection: collectionConfig.slug,\n      limit: 1,\n      locale: locale!,\n      pagination: false,\n      req,\n      where: { id: { equals: id } },\n    })\n\n    const [rawVersionToRestore] = versionDocs\n\n    if (!rawVersionToRestore) {\n      throw new NotFound(req.t)\n    }\n\n    const { parent: parentDocID, version: versionToRestoreWithLocales } = rawVersionToRestore\n\n    // /////////////////////////////////////\n    // Access\n    // /////////////////////////////////////\n\n    const accessResults = !overrideAccess\n      ? await executeAccess({ id: parentDocID, req }, collectionConfig.access.update)\n      : true\n    const hasWherePolicy = hasWhereAccessResult(accessResults)\n\n    // /////////////////////////////////////\n    // Retrieve document\n    // /////////////////////////////////////\n\n    const findOneArgs: FindOneArgs = {\n      collection: collectionConfig.slug,\n      locale: locale!,\n      req,\n      where: combineQueries({ id: { equals: parentDocID } }, accessResults),\n    }\n\n    // Get the document from the non versioned collection\n    const doc = await req.payload.db.findOne<TData>(findOneArgs)\n\n    if (!doc && !hasWherePolicy) {\n      throw new NotFound(req.t)\n    }\n    if (!doc && hasWherePolicy) {\n      throw new Forbidden(req.t)\n    }\n\n    if (collectionConfig.trash && doc?.deletedAt) {\n      throw new APIError(\n        `Cannot restore a version of a trashed document (ID: ${parentDocID}). Restore the document first.`,\n        httpStatus.FORBIDDEN,\n      )\n    }\n\n    // /////////////////////////////////////\n    // fetch previousDoc\n    // /////////////////////////////////////\n    const prevDocWithLocales = await getLatestCollectionVersion({\n      id: parentDocID,\n      config: collectionConfig,\n      payload,\n      query: findOneArgs,\n      req,\n    })\n\n    // originalDoc with hoisted localized data\n    const originalDoc = await afterRead({\n      collection: collectionConfig,\n      context: req.context,\n      depth: 0,\n      doc: deepCopyObjectSimple(prevDocWithLocales),\n      draft: draftArg,\n      fallbackLocale: null,\n      global: null,\n      locale: locale!,\n      overrideAccess: true,\n      req,\n      showHiddenFields: true,\n    })\n\n    // version data with hoisted localized data\n    const prevVersionDoc = await afterRead({\n      collection: collectionConfig,\n      context: req.context,\n      depth: 0,\n      doc: deepCopyObjectSimple(rawVersionToRestore.version),\n      draft: draftArg,\n      fallbackLocale: null,\n      global: null,\n      locale: locale!,\n      overrideAccess: true,\n      req,\n      showHiddenFields: true,\n    })\n\n    // /////////////////////////////////////\n    // beforeValidate - Fields\n    // /////////////////////////////////////\n\n    let data = await beforeValidate({\n      id: parentDocID,\n      collection: collectionConfig,\n      context: req.context,\n      data: deepCopyObjectSimple(prevVersionDoc),\n      doc: originalDoc,\n      global: null,\n      operation: 'update',\n      overrideAccess,\n      req,\n    })\n\n    // /////////////////////////////////////\n    // beforeValidate - Collection\n    // /////////////////////////////////////\n\n    if (collectionConfig.hooks?.beforeValidate?.length) {\n      for (const hook of collectionConfig.hooks.beforeValidate) {\n        data =\n          (await hook({\n            collection: collectionConfig,\n            context: req.context,\n            data,\n            operation: 'update',\n            originalDoc,\n            req,\n          })) || data\n      }\n    }\n\n    // /////////////////////////////////////\n    // beforeChange - Collection\n    // /////////////////////////////////////\n\n    if (collectionConfig.hooks?.beforeChange?.length) {\n      for (const hook of collectionConfig.hooks.beforeChange) {\n        data =\n          (await hook({\n            collection: collectionConfig,\n            context: req.context,\n            data,\n            operation: 'update',\n            originalDoc,\n            req,\n          })) || data\n      }\n    }\n\n    // /////////////////////////////////////\n    // beforeChange - Fields\n    // /////////////////////////////////////\n\n    let result = await beforeChange({\n      id: parentDocID,\n      collection: collectionConfig,\n      context: req.context,\n      data: { ...data, id: parentDocID },\n      doc: originalDoc,\n      docWithLocales: versionToRestoreWithLocales,\n      global: null,\n      operation: 'update',\n      overrideAccess,\n      req,\n      skipValidation: draftArg && !hasDraftValidationEnabled(collectionConfig),\n    })\n\n    // /////////////////////////////////////\n    // Update\n    // /////////////////////////////////////\n\n    const select = sanitizeSelect({\n      fields: collectionConfig.flattenedFields,\n      forceSelect: collectionConfig.forceSelect,\n      select: incomingSelect,\n    })\n\n    // Ensure updatedAt date is always updated\n    result.updatedAt = new Date().toISOString()\n    // Ensure status respects restoreAsDraft arg\n    result._status = draftArg ? 'draft' : result._status\n    if (!draftArg) {\n      result = await req.payload.db.updateOne({\n        id: parentDocID,\n        collection: collectionConfig.slug,\n        data: result,\n        req,\n        select,\n      })\n    }\n\n    // /////////////////////////////////////\n    // Save restored doc as a new version\n    // /////////////////////////////////////\n\n    result = await saveVersion({\n      id: parentDocID,\n      autosave: false,\n      collection: collectionConfig,\n      docWithLocales: result,\n      draft: draftArg,\n      operation: 'restoreVersion',\n      payload,\n      req,\n      select,\n    })\n\n    // /////////////////////////////////////\n    // afterRead - Fields\n    // /////////////////////////////////////\n\n    result = await afterRead({\n      collection: collectionConfig,\n      context: req.context,\n      depth: depth!,\n      doc: result,\n      // @ts-expect-error - vestiges of when tsconfig was not strict. Feel free to improve\n      draft: undefined,\n      fallbackLocale: fallbackLocale!,\n      global: null,\n      locale: locale!,\n      overrideAccess,\n      populate,\n      req,\n      select,\n      showHiddenFields: showHiddenFields!,\n    })\n\n    // /////////////////////////////////////\n    // afterRead - Collection\n    // /////////////////////////////////////\n\n    if (collectionConfig.hooks?.afterRead?.length) {\n      for (const hook of collectionConfig.hooks.afterRead) {\n        result =\n          (await hook({\n            collection: collectionConfig,\n            context: req.context,\n            doc: result,\n            overrideAccess,\n            req,\n          })) || result\n      }\n    }\n\n    // /////////////////////////////////////\n    // afterChange - Fields\n    // /////////////////////////////////////\n\n    result = await afterChange({\n      collection: collectionConfig,\n      context: req.context,\n      data: result,\n      doc: result,\n      global: null,\n      operation: 'update',\n      previousDoc: prevDocWithLocales,\n      req,\n    })\n\n    // /////////////////////////////////////\n    // afterChange - Collection\n    // /////////////////////////////////////\n\n    if (collectionConfig.hooks?.afterChange?.length) {\n      for (const hook of collectionConfig.hooks.afterChange) {\n        result =\n          (await hook({\n            collection: collectionConfig,\n            context: req.context,\n            data: result,\n            doc: result,\n            operation: 'update',\n            overrideAccess,\n            previousDoc: prevDocWithLocales,\n            req,\n          })) || result\n      }\n    }\n\n    // /////////////////////////////////////\n    // afterOperation - Collection\n    // /////////////////////////////////////\n\n    result = await buildAfterOperation({\n      args,\n      collection: collectionConfig,\n      operation: 'restoreVersion',\n      overrideAccess,\n      result,\n    })\n\n    if (shouldCommit) {\n      await commitTransaction(req)\n    }\n\n    return result\n  } catch (error: unknown) {\n    await killTransaction(req)\n    throw error\n  }\n}\n"],"names":["status","httpStatus","executeAccess","hasWhereAccessResult","combineQueries","APIError","Forbidden","NotFound","afterChange","afterRead","beforeChange","beforeValidate","commitTransaction","deepCopyObjectSimple","hasDraftValidationEnabled","initTransaction","killTransaction","sanitizeSelect","getLatestCollectionVersion","saveVersion","buildAfterOperation","buildBeforeOperation","restoreVersionOperation","args","id","collection","config","collectionConfig","depth","draft","draftArg","overrideAccess","populate","req","fallbackLocale","locale","payload","select","incomingSelect","showHiddenFields","shouldCommit","disableTransaction","operation","BAD_REQUEST","docs","versionDocs","db","findVersions","slug","limit","pagination","where","equals","rawVersionToRestore","t","parent","parentDocID","version","versionToRestoreWithLocales","accessResults","access","update","hasWherePolicy","findOneArgs","doc","findOne","trash","deletedAt","FORBIDDEN","prevDocWithLocales","query","originalDoc","context","global","prevVersionDoc","data","hooks","length","hook","result","docWithLocales","skipValidation","fields","flattenedFields","forceSelect","updatedAt","Date","toISOString","_status","updateOne","autosave","undefined","previousDoc","error"],"mappings":"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"}},
    {"offset": {"line": 3102, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/endpoints/restoreVersion.ts"],"sourcesContent":["import { status as httpStatus } from 'http-status'\n\nimport type { PayloadHandler } from '../../config/types.js'\n\nimport { getRequestCollectionWithID } from '../../utilities/getRequestEntity.js'\nimport { headersWithCors } from '../../utilities/headersWithCors.js'\nimport { parseParams } from '../../utilities/parseParams/index.js'\nimport { restoreVersionOperation } from '../operations/restoreVersion.js'\n\nexport const restoreVersionHandler: PayloadHandler = async (req) => {\n  const { id, collection } = getRequestCollectionWithID(req)\n\n  const { depth, draft, populate } = parseParams(req.query)\n\n  const result = await restoreVersionOperation({\n    id,\n    collection,\n    depth,\n    draft,\n    populate,\n    req,\n  })\n\n  return Response.json(\n    {\n      ...result,\n      message: req.t('version:restoredSuccessfully'),\n    },\n    {\n      headers: headersWithCors({\n        headers: new Headers(),\n        req,\n      }),\n      status: httpStatus.OK,\n    },\n  )\n}\n"],"names":["status","httpStatus","getRequestCollectionWithID","headersWithCors","parseParams","restoreVersionOperation","restoreVersionHandler","req","id","collection","depth","draft","populate","query","result","Response","json","message","t","headers","Headers","OK"],"mappings":";;;;;AAAA,SAASA,UAAUC,UAAU,QAAQ,cAAa;AAIlD,SAASC,0BAA0B,QAAQ,sCAAqC;AAChF,SAASC,eAAe,QAAQ,qCAAoC;AACpE,SAASC,WAAW,QAAQ,uCAAsC;AAClE,SAASC,uBAAuB,QAAQ,kCAAiC;;;;;;AAElE,MAAMC,wBAAwC,OAAOC;IAC1D,MAAM,EAAEC,EAAE,EAAEC,UAAU,EAAE,OAAGP,gMAAAA,EAA2BK;IAEtD,MAAM,EAAEG,KAAK,EAAEC,KAAK,EAAEC,QAAQ,EAAE,OAAGR,qLAAAA,EAAYG,IAAIM,KAAK;IAExD,MAAMC,SAAS,UAAMT,2MAAAA,EAAwB;QAC3CG;QACAC;QACAC;QACAC;QACAC;QACAL;IACF;IAEA,OAAOQ,SAASC,IAAI,CAClB;QACE,GAAGF,MAAM;QACTG,SAASV,IAAIW,CAAC,CAAC;IACjB,GACA;QACEC,aAAShB,oLAAAA,EAAgB;YACvBgB,SAAS,IAAIC;YACbb;QACF;QACAP,QAAQC,sMAAAA,CAAWoB,EAAE;IACvB;AAEJ,EAAC"}},
    {"offset": {"line": 3143, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/operations/utilities/update.ts"],"sourcesContent":["import type { DeepPartial } from 'ts-essentials'\n\nimport type { Args } from '../../../fields/hooks/beforeChange/index.js'\nimport type {\n  CollectionSlug,\n  FileToSave,\n  SanitizedConfig,\n  TypedFallbackLocale,\n} from '../../../index.js'\nimport type {\n  JsonObject,\n  Payload,\n  PayloadRequest,\n  PopulateType,\n  SelectType,\n  TransformCollectionWithSelect,\n} from '../../../types/index.js'\nimport type {\n  DataFromCollectionSlug,\n  SanitizedCollectionConfig,\n  SelectFromCollectionSlug,\n  TypeWithID,\n} from '../../config/types.js'\n\nimport { ensureUsernameOrEmail } from '../../../auth/ensureUsernameOrEmail.js'\nimport { generatePasswordSaltHash } from '../../../auth/strategies/local/generatePasswordSaltHash.js'\nimport { afterChange } from '../../../fields/hooks/afterChange/index.js'\nimport { afterRead } from '../../../fields/hooks/afterRead/index.js'\nimport { beforeChange } from '../../../fields/hooks/beforeChange/index.js'\nimport { beforeValidate } from '../../../fields/hooks/beforeValidate/index.js'\nimport { deepCopyObjectSimple, getLatestCollectionVersion, saveVersion } from '../../../index.js'\nimport { deleteAssociatedFiles } from '../../../uploads/deleteAssociatedFiles.js'\nimport { uploadFiles } from '../../../uploads/uploadFiles.js'\nimport { checkDocumentLockStatus } from '../../../utilities/checkDocumentLockStatus.js'\nimport {\n  hasDraftsEnabled,\n  hasDraftValidationEnabled,\n  hasLocalizeStatusEnabled,\n} from '../../../utilities/getVersionsConfig.js'\nimport { mergeLocalizedData } from '../../../utilities/mergeLocalizedData.js'\nexport type SharedUpdateDocumentArgs<TSlug extends CollectionSlug> = {\n  autosave: boolean\n  collectionConfig: SanitizedCollectionConfig\n  config: SanitizedConfig\n  data: DeepPartial<DataFromCollectionSlug<TSlug>>\n  depth: number\n  docWithLocales: JsonObject & TypeWithID\n  draftArg: boolean\n  fallbackLocale: TypedFallbackLocale\n  filesToUpload: FileToSave[]\n  id: number | string\n  locale: string\n  overrideAccess: boolean\n  overrideLock: boolean\n  payload: Payload\n  populate?: PopulateType\n  publishAllLocales?: boolean\n  publishSpecificLocale?: string\n  req: PayloadRequest\n  select: SelectType\n  showHiddenFields: boolean\n  unpublishAllLocales?: boolean\n}\n\n/**\n * This function is used to update a document in the DB and return the result.\n *\n * It runs the following hooks in order:\n * - beforeValidate - Fields\n * - beforeValidate - Collection\n * - beforeChange - Collection\n * - beforeChange - Fields\n * - afterRead - Fields\n * - afterRead - Collection\n * - afterChange - Fields\n * - afterChange - Collection\n */\nexport const updateDocument = async <\n  TSlug extends CollectionSlug,\n  TSelect extends SelectFromCollectionSlug<TSlug> = SelectType,\n>({\n  id,\n  autosave,\n  collectionConfig,\n  config,\n  data,\n  depth,\n  docWithLocales,\n  draftArg,\n  fallbackLocale,\n  filesToUpload,\n  locale,\n  overrideAccess,\n  overrideLock,\n  payload,\n  populate,\n  publishAllLocales: publishAllLocalesArg,\n  publishSpecificLocale,\n  req,\n  select,\n  showHiddenFields,\n  unpublishAllLocales: unpublishAllLocalesArg,\n}: SharedUpdateDocumentArgs<TSlug>): Promise<TransformCollectionWithSelect<TSlug, TSelect>> => {\n  const password = data?.password\n  const publishAllLocales =\n    !draftArg &&\n    (publishAllLocalesArg ?? (hasLocalizeStatusEnabled(collectionConfig) ? false : true))\n  const unpublishAllLocales =\n    typeof unpublishAllLocalesArg === 'string'\n      ? unpublishAllLocalesArg === 'true'\n      : !!unpublishAllLocalesArg\n  const isSavingDraft =\n    Boolean(draftArg && hasDraftsEnabled(collectionConfig)) &&\n    data._status !== 'published' &&\n    !publishAllLocales\n  const shouldSavePassword = Boolean(\n    password &&\n      collectionConfig.auth &&\n      (!collectionConfig.auth.disableLocalStrategy ||\n        (typeof collectionConfig.auth.disableLocalStrategy === 'object' &&\n          collectionConfig.auth.disableLocalStrategy.enableFields)) &&\n      !isSavingDraft,\n  )\n\n  if (isSavingDraft) {\n    data._status = 'draft'\n  }\n\n  // /////////////////////////////////////\n  // Handle potentially locked documents\n  // /////////////////////////////////////\n\n  await checkDocumentLockStatus({\n    id,\n    collectionSlug: collectionConfig.slug,\n    lockErrorMessage: `Document with ID ${id} is currently locked by another user and cannot be updated.`,\n    overrideLock,\n    req,\n  })\n\n  const originalDoc = await afterRead({\n    collection: collectionConfig,\n    context: req.context,\n    depth: 0,\n    doc: deepCopyObjectSimple(docWithLocales),\n    draft: draftArg,\n    fallbackLocale: id ? null : fallbackLocale,\n    global: null,\n    locale,\n    overrideAccess: true,\n    req,\n    showHiddenFields: true,\n  })\n\n  const isRestoringDraftFromTrash = Boolean(originalDoc?.deletedAt) && data?._status !== 'published'\n\n  if (collectionConfig.auth) {\n    ensureUsernameOrEmail<TSlug>({\n      authOptions: collectionConfig.auth,\n      collectionSlug: collectionConfig.slug,\n      data,\n      operation: 'update',\n      originalDoc,\n      req,\n    })\n  }\n\n  // /////////////////////////////////////\n  // Delete any associated files\n  // /////////////////////////////////////\n\n  await deleteAssociatedFiles({\n    collectionConfig,\n    config,\n    doc: docWithLocales,\n    files: filesToUpload,\n    overrideDelete: false,\n    req,\n  })\n\n  // /////////////////////////////////////\n  // beforeValidate - Fields\n  // /////////////////////////////////////\n\n  data = await beforeValidate<DeepPartial<DataFromCollectionSlug<TSlug>>>({\n    id,\n    collection: collectionConfig,\n    context: req.context,\n    data,\n    doc: originalDoc,\n    global: null,\n    operation: 'update',\n    overrideAccess,\n    req,\n  })\n\n  // /////////////////////////////////////\n  // beforeValidate - Collection\n  // /////////////////////////////////////\n\n  if (collectionConfig.hooks?.beforeValidate?.length) {\n    for (const hook of collectionConfig.hooks.beforeValidate) {\n      data =\n        (await hook({\n          collection: collectionConfig,\n          context: req.context,\n          data,\n          operation: 'update',\n          originalDoc,\n          req,\n        })) || data\n    }\n  }\n\n  // /////////////////////////////////////\n  // Write files to local storage\n  // /////////////////////////////////////\n\n  if (!collectionConfig.upload.disableLocalStorage) {\n    await uploadFiles(payload, filesToUpload, req)\n  }\n\n  // /////////////////////////////////////\n  // beforeChange - Collection\n  // /////////////////////////////////////\n\n  if (collectionConfig.hooks?.beforeChange?.length) {\n    for (const hook of collectionConfig.hooks.beforeChange) {\n      data =\n        (await hook({\n          collection: collectionConfig,\n          context: req.context,\n          data,\n          operation: 'update',\n          originalDoc,\n          req,\n        })) || data\n    }\n  }\n\n  // /////////////////////////////////////\n  // beforeChange - Fields\n  // /////////////////////////////////////\n\n  const beforeChangeArgs: Args<DataFromCollectionSlug<TSlug>> = {\n    id,\n    collection: collectionConfig,\n    context: req.context,\n    data: { ...data, id },\n    doc: originalDoc,\n    docWithLocales,\n    global: null,\n    operation: 'update',\n    overrideAccess,\n    req,\n    skipValidation:\n      // only skip validation for drafts when draft validation is false\n      (isSavingDraft && !hasDraftValidationEnabled(collectionConfig)) ||\n      // Skip validation for trash operations since they're just metadata updates\n      (collectionConfig.trash && (Boolean(data?.deletedAt) || isRestoringDraftFromTrash)),\n  }\n\n  // /////////////////////////////////////\n  // Handle Localized Data Merging\n  // /////////////////////////////////////\n\n  let result: JsonObject = await beforeChange(beforeChangeArgs)\n  let snapshotToSave: JsonObject | undefined\n\n  if (config.localization && collectionConfig.versions) {\n    let snapshotData: JsonObject | undefined\n    let currentDoc\n\n    if (collectionConfig.versions.drafts && collectionConfig.versions.drafts.localizeStatus) {\n      if (publishAllLocales || unpublishAllLocales) {\n        let accessibleLocaleCodes = config.localization.localeCodes\n\n        if (config.localization.filterAvailableLocales) {\n          const filteredLocales = await config.localization.filterAvailableLocales({\n            locales: config.localization.locales,\n            req,\n          })\n          accessibleLocaleCodes = filteredLocales.map((locale) =>\n            typeof locale === 'string' ? locale : locale.code,\n          )\n        }\n\n        if (typeof result._status !== 'object' || result._status === null) {\n          result._status = {}\n        }\n\n        for (const localeCode of accessibleLocaleCodes) {\n          result._status[localeCode] = unpublishAllLocales ? 'draft' : 'published'\n        }\n      } else if (!isSavingDraft) {\n        // publishing a single locale\n        currentDoc = await payload.db.findOne<DataFromCollectionSlug<TSlug>>({\n          collection: collectionConfig.slug,\n          req,\n          where: { id: { equals: id } },\n        })\n        snapshotData = result\n      }\n    } else if (publishSpecificLocale) {\n      // previous way of publishing a single locale\n      currentDoc = await getLatestCollectionVersion({\n        id,\n        config: collectionConfig,\n        payload,\n        published: true,\n        query: {\n          collection: collectionConfig.slug,\n          locale: 'all',\n          req,\n          where: { id: { equals: id } },\n        },\n        req,\n      })\n      snapshotData = {\n        ...result,\n        _status: 'draft',\n      }\n    }\n\n    if (snapshotData) {\n      snapshotToSave = deepCopyObjectSimple(snapshotData || {})\n\n      result = mergeLocalizedData({\n        configBlockReferences: config.blocks,\n        dataWithLocales: result || {},\n        docWithLocales: currentDoc || {},\n        fields: collectionConfig.fields,\n        selectedLocales: [locale],\n      })\n    }\n  }\n\n  const dataToUpdate: JsonObject = { ...result }\n\n  // /////////////////////////////////////\n  // Handle potential password update\n  // /////////////////////////////////////\n\n  if (shouldSavePassword && typeof password === 'string') {\n    const { hash, salt } = await generatePasswordSaltHash({\n      collection: collectionConfig,\n      password,\n      req,\n    })\n    dataToUpdate.salt = salt\n    dataToUpdate.hash = hash\n    delete dataToUpdate.password\n    delete data.password\n  }\n\n  // /////////////////////////////////////\n  // Update\n  // /////////////////////////////////////\n\n  if (!isSavingDraft) {\n    // Ensure updatedAt date is always updated\n    dataToUpdate.updatedAt = new Date().toISOString()\n    result = await req.payload.db.updateOne({\n      id,\n      collection: collectionConfig.slug,\n      data: dataToUpdate,\n      locale,\n      req,\n    })\n  }\n\n  // /////////////////////////////////////\n  // Create version\n  // /////////////////////////////////////\n\n  if (collectionConfig.versions) {\n    result = await saveVersion({\n      id,\n      autosave,\n      collection: collectionConfig,\n      docWithLocales: result,\n      draft: isSavingDraft,\n      operation: 'update',\n      payload,\n      publishSpecificLocale,\n      req,\n      snapshot: snapshotToSave,\n    })\n  }\n\n  // /////////////////////////////////////\n  // afterRead - Fields\n  // /////////////////////////////////////\n\n  result = await afterRead({\n    collection: collectionConfig,\n    context: req.context,\n    depth,\n    doc: result,\n    draft: draftArg,\n    fallbackLocale,\n    global: null,\n    locale,\n    overrideAccess,\n    populate,\n    req,\n    select,\n    showHiddenFields,\n  })\n\n  // /////////////////////////////////////\n  // afterRead - Collection\n  // /////////////////////////////////////\n\n  if (collectionConfig.hooks?.afterRead?.length) {\n    for (const hook of collectionConfig.hooks.afterRead) {\n      result =\n        (await hook({\n          collection: collectionConfig,\n          context: req.context,\n          doc: result,\n          overrideAccess,\n          req,\n        })) || result\n    }\n  }\n\n  // /////////////////////////////////////\n  // afterChange - Fields\n  // /////////////////////////////////////\n\n  result = await afterChange({\n    collection: collectionConfig,\n    context: req.context,\n    data,\n    doc: result,\n    global: null,\n    operation: 'update',\n    previousDoc: originalDoc,\n    req,\n  })\n\n  // /////////////////////////////////////\n  // afterChange - Collection\n  // /////////////////////////////////////\n\n  if (collectionConfig.hooks?.afterChange?.length) {\n    for (const hook of collectionConfig.hooks.afterChange) {\n      result =\n        (await hook({\n          collection: collectionConfig,\n          context: req.context,\n          data,\n          doc: result,\n          operation: 'update',\n          overrideAccess,\n          previousDoc: originalDoc,\n          req,\n        })) || result\n    }\n  }\n\n  return result as TransformCollectionWithSelect<TSlug, TSelect>\n}\n"],"names":["ensureUsernameOrEmail","generatePasswordSaltHash","afterChange","afterRead","beforeChange","beforeValidate","deepCopyObjectSimple","getLatestCollectionVersion","saveVersion","deleteAssociatedFiles","uploadFiles","checkDocumentLockStatus","hasDraftsEnabled","hasDraftValidationEnabled","hasLocalizeStatusEnabled","mergeLocalizedData","updateDocument","id","autosave","collectionConfig","config","data","depth","docWithLocales","draftArg","fallbackLocale","filesToUpload","locale","overrideAccess","overrideLock","payload","populate","publishAllLocales","publishAllLocalesArg","publishSpecificLocale","req","select","showHiddenFields","unpublishAllLocales","unpublishAllLocalesArg","password","isSavingDraft","Boolean","_status","shouldSavePassword","auth","disableLocalStrategy","enableFields","collectionSlug","slug","lockErrorMessage","originalDoc","collection","context","doc","draft","global","isRestoringDraftFromTrash","deletedAt","authOptions","operation","files","overrideDelete","hooks","length","hook","upload","disableLocalStorage","beforeChangeArgs","skipValidation","trash","result","snapshotToSave","localization","versions","snapshotData","currentDoc","drafts","localizeStatus","accessibleLocaleCodes","localeCodes","filterAvailableLocales","filteredLocales","locales","map","code","localeCode","db","findOne","where","equals","published","query","configBlockReferences","blocks","dataWithLocales","fields","selectedLocales","dataToUpdate","hash","salt","updatedAt","Date","toISOString","updateOne","snapshot","previousDoc"],"mappings":"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"}},
    {"offset": {"line": 3487, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/operations/update.ts"],"sourcesContent":["import type { DeepPartial } from 'ts-essentials'\n\nimport { status as httpStatus } from 'http-status'\n\nimport type { AccessResult } from '../../config/types.js'\nimport type { PayloadRequest, PopulateType, SelectType, Sort, Where } from '../../types/index.js'\nimport type {\n  BulkOperationResult,\n  Collection,\n  DataFromCollectionSlug,\n  RequiredDataFromCollectionSlug,\n  SelectFromCollectionSlug,\n} from '../config/types.js'\n\nimport { executeAccess } from '../../auth/executeAccess.js'\nimport { combineQueries } from '../../database/combineQueries.js'\nimport { validateQueryPaths } from '../../database/queryValidation/validateQueryPaths.js'\nimport { sanitizeWhereQuery } from '../../database/sanitizeWhereQuery.js'\nimport { APIError } from '../../errors/index.js'\nimport { type CollectionSlug, deepCopyObjectSimple, type FindOptions } from '../../index.js'\nimport { generateFileData } from '../../uploads/generateFileData.js'\nimport { unlinkTempFiles } from '../../uploads/unlinkTempFiles.js'\nimport { appendNonTrashedFilter } from '../../utilities/appendNonTrashedFilter.js'\nimport { commitTransaction } from '../../utilities/commitTransaction.js'\nimport { hasDraftsEnabled } from '../../utilities/getVersionsConfig.js'\nimport { initTransaction } from '../../utilities/initTransaction.js'\nimport { isErrorPublic } from '../../utilities/isErrorPublic.js'\nimport { killTransaction } from '../../utilities/killTransaction.js'\nimport { sanitizeSelect } from '../../utilities/sanitizeSelect.js'\nimport { buildVersionCollectionFields } from '../../versions/buildCollectionFields.js'\nimport { appendVersionToQueryKey } from '../../versions/drafts/appendVersionToQueryKey.js'\nimport { getQueryDraftsSort } from '../../versions/drafts/getQueryDraftsSort.js'\nimport { buildAfterOperation } from './utilities/buildAfterOperation.js'\nimport { buildBeforeOperation } from './utilities/buildBeforeOperation.js'\nimport { sanitizeSortQuery } from './utilities/sanitizeSortQuery.js'\nimport { updateDocument } from './utilities/update.js'\n\nexport type Arguments<TSlug extends CollectionSlug> = {\n  autosave?: boolean\n  collection: Collection\n  data: DeepPartial<RequiredDataFromCollectionSlug<TSlug>>\n  depth?: number\n  disableTransaction?: boolean\n  disableVerificationEmail?: boolean\n  draft?: boolean\n  limit?: number\n  overrideAccess?: boolean\n  overrideLock?: boolean\n  overwriteExistingFiles?: boolean\n  populate?: PopulateType\n  publishAllLocales?: boolean\n  publishSpecificLocale?: string\n  req: PayloadRequest\n  showHiddenFields?: boolean\n  /**\n   * Sort the documents, can be a string or an array of strings\n   * @example '-createdAt' // Sort DESC by createdAt\n   * @example ['group', '-createdAt'] // sort by 2 fields, ASC group and DESC createdAt\n   */\n  sort?: Sort\n  trash?: boolean\n  unpublishAllLocales?: boolean\n  where: Where\n} & Pick<FindOptions<TSlug, SelectType>, 'select'>\n\nexport const updateOperation = async <\n  TSlug extends CollectionSlug,\n  TSelect extends SelectFromCollectionSlug<TSlug>,\n>(\n  incomingArgs: Arguments<TSlug>,\n): Promise<BulkOperationResult<TSlug, TSelect>> => {\n  let args = incomingArgs\n\n  if (args.collection.config.disableBulkEdit && !args.overrideAccess) {\n    throw new APIError(`Collection ${args.collection.config.slug} has disabled bulk edit`, 403)\n  }\n\n  try {\n    const shouldCommit = !args.disableTransaction && (await initTransaction(args.req))\n\n    // /////////////////////////////////////\n    // beforeOperation - Collection\n    // /////////////////////////////////////\n\n    args = await buildBeforeOperation({\n      args,\n      collection: args.collection.config,\n      operation: 'update',\n      overrideAccess: args.overrideAccess!,\n    })\n\n    const {\n      autosave = false,\n      collection: { config: collectionConfig },\n      collection,\n      depth,\n      draft: draftArg = false,\n      limit = 0,\n      overrideAccess,\n      overrideLock,\n      overwriteExistingFiles = false,\n      populate,\n      publishAllLocales,\n      publishSpecificLocale,\n      req: {\n        fallbackLocale,\n        locale,\n        payload: { config },\n        payload,\n      },\n      req,\n      select: incomingSelect,\n      showHiddenFields,\n      sort: incomingSort,\n      trash = false,\n      unpublishAllLocales,\n      where,\n    } = args\n\n    if (!where) {\n      throw new APIError(\"Missing 'where' query of documents to update.\", httpStatus.BAD_REQUEST)\n    }\n\n    const { data: bulkUpdateData } = args\n    const shouldSaveDraft = Boolean(draftArg && hasDraftsEnabled(collectionConfig))\n\n    // /////////////////////////////////////\n    // Access\n    // /////////////////////////////////////\n\n    let accessResult: AccessResult\n    if (!overrideAccess) {\n      accessResult = await executeAccess({ req }, collectionConfig.access.update)\n    }\n\n    await validateQueryPaths({\n      collectionConfig,\n      overrideAccess: overrideAccess!,\n      req,\n      where,\n    })\n\n    // /////////////////////////////////////\n    // Retrieve documents\n    // /////////////////////////////////////\n\n    let fullWhere = combineQueries(where, accessResult!)\n\n    const isTrashAttempt =\n      collectionConfig.trash &&\n      typeof bulkUpdateData === 'object' &&\n      bulkUpdateData !== null &&\n      'deletedAt' in bulkUpdateData &&\n      bulkUpdateData.deletedAt != null\n\n    // Enforce delete access if performing a soft-delete (trash)\n    if (isTrashAttempt && !overrideAccess) {\n      const deleteAccessResult = await executeAccess({ req }, collectionConfig.access.delete)\n      fullWhere = combineQueries(fullWhere, deleteAccessResult)\n    }\n\n    // Exclude trashed documents when trash: false\n    fullWhere = appendNonTrashedFilter({\n      enableTrash: collectionConfig.trash,\n      trash,\n      where: fullWhere,\n    })\n\n    sanitizeWhereQuery({ fields: collectionConfig.flattenedFields, payload, where: fullWhere })\n\n    const sort = sanitizeSortQuery({\n      fields: collection.config.flattenedFields,\n      sort: incomingSort,\n    })\n\n    let docs\n\n    if (hasDraftsEnabled(collectionConfig) && shouldSaveDraft) {\n      const versionsWhere = appendVersionToQueryKey(fullWhere)\n\n      await validateQueryPaths({\n        collectionConfig: collection.config,\n        overrideAccess: overrideAccess!,\n        req,\n        versionFields: buildVersionCollectionFields(payload.config, collection.config, true),\n        where: appendVersionToQueryKey(where),\n      })\n\n      const query = await payload.db.queryDrafts<DataFromCollectionSlug<TSlug>>({\n        collection: collectionConfig.slug,\n        limit,\n        locale: locale!,\n        pagination: false,\n        req,\n        sort: getQueryDraftsSort({ collectionConfig, sort }),\n        where: versionsWhere,\n      })\n\n      docs = query.docs\n    } else {\n      const query = await payload.db.find({\n        collection: collectionConfig.slug,\n        limit,\n        locale: locale!,\n        pagination: false,\n        req,\n        sort,\n        where: fullWhere,\n      })\n\n      docs = query.docs\n    }\n\n    // /////////////////////////////////////\n    // Generate data for all files and sizes\n    // /////////////////////////////////////\n\n    const { data, files: filesToUpload } = await generateFileData({\n      collection,\n      config,\n      data: bulkUpdateData,\n      operation: 'update',\n      overwriteExistingFiles,\n      req,\n      throwOnMissingFile: false,\n    })\n\n    const errors: BulkOperationResult<TSlug, TSelect>['errors'] = []\n\n    const promises = docs.map(async (docWithLocales) => {\n      const { id } = docWithLocales\n\n      try {\n        // Each document gets its own transaction when singleTransaction is enabled\n        let docShouldCommit = false\n        if (req.payload.db.bulkOperationsSingleTransaction) {\n          docShouldCommit = await initTransaction(req)\n        }\n\n        const select = sanitizeSelect({\n          fields: collectionConfig.flattenedFields,\n          forceSelect: collectionConfig.forceSelect,\n          select: incomingSelect,\n        })\n\n        // ///////////////////////////////////////////////\n        // Update document, runs all document level hooks\n        // ///////////////////////////////////////////////\n        const updatedDoc = await updateDocument({\n          id,\n          autosave,\n          collectionConfig,\n          config,\n          data: deepCopyObjectSimple(data),\n          depth: depth!,\n          docWithLocales,\n          draftArg,\n          fallbackLocale: fallbackLocale!,\n          filesToUpload,\n          locale: locale!,\n          overrideAccess: overrideAccess!,\n          overrideLock: overrideLock!,\n          payload,\n          populate,\n          publishAllLocales,\n          publishSpecificLocale,\n          req,\n          select: select!,\n          showHiddenFields: showHiddenFields!,\n          unpublishAllLocales,\n        })\n\n        if (docShouldCommit) {\n          await commitTransaction(req)\n        }\n\n        return updatedDoc\n      } catch (error) {\n        const isPublic = error instanceof Error ? isErrorPublic(error, config) : false\n\n        if (req.payload.db.bulkOperationsSingleTransaction) {\n          await killTransaction(req)\n        }\n        errors.push({\n          id,\n          isPublic,\n          message: error instanceof Error ? error.message : 'Unknown error',\n        })\n      }\n      return null\n    })\n\n    await unlinkTempFiles({\n      collectionConfig,\n      config,\n      req,\n    })\n\n    // Process sequentially when using single transaction mode to avoid shared state issues\n    // Process in parallel when using one transaction for better performance\n    let awaitedDocs: (DataFromCollectionSlug<TSlug> | null)[]\n    if (req.payload.db.bulkOperationsSingleTransaction) {\n      awaitedDocs = []\n      for (const promise of promises) {\n        awaitedDocs.push(await promise)\n      }\n    } else {\n      awaitedDocs = await Promise.all(promises)\n    }\n\n    let result = {\n      docs: awaitedDocs.filter(Boolean),\n      errors,\n    }\n\n    // /////////////////////////////////////\n    // afterOperation - Collection\n    // /////////////////////////////////////\n\n    result = await buildAfterOperation({\n      args,\n      collection: collectionConfig,\n      operation: 'update',\n      overrideAccess,\n      // @ts-expect-error - vestiges of when tsconfig was not strict. Feel free to improve\n      result,\n    })\n\n    if (shouldCommit) {\n      await commitTransaction(req)\n    }\n\n    // @ts-expect-error - vestiges of when tsconfig was not strict. Feel free to improve\n    return result\n  } catch (error: unknown) {\n    await killTransaction(args.req)\n    throw error\n  }\n}\n"],"names":["status","httpStatus","executeAccess","combineQueries","validateQueryPaths","sanitizeWhereQuery","APIError","deepCopyObjectSimple","generateFileData","unlinkTempFiles","appendNonTrashedFilter","commitTransaction","hasDraftsEnabled","initTransaction","isErrorPublic","killTransaction","sanitizeSelect","buildVersionCollectionFields","appendVersionToQueryKey","getQueryDraftsSort","buildAfterOperation","buildBeforeOperation","sanitizeSortQuery","updateDocument","updateOperation","incomingArgs","args","collection","config","disableBulkEdit","overrideAccess","slug","shouldCommit","disableTransaction","req","operation","autosave","collectionConfig","depth","draft","draftArg","limit","overrideLock","overwriteExistingFiles","populate","publishAllLocales","publishSpecificLocale","fallbackLocale","locale","payload","select","incomingSelect","showHiddenFields","sort","incomingSort","trash","unpublishAllLocales","where","BAD_REQUEST","data","bulkUpdateData","shouldSaveDraft","Boolean","accessResult","access","update","fullWhere","isTrashAttempt","deletedAt","deleteAccessResult","delete","enableTrash","fields","flattenedFields","docs","versionsWhere","versionFields","query","db","queryDrafts","pagination","find","files","filesToUpload","throwOnMissingFile","errors","promises","map","docWithLocales","id","docShouldCommit","bulkOperationsSingleTransaction","forceSelect","updatedDoc","error","isPublic","Error","push","message","awaitedDocs","promise","Promise","all","result","filter"],"mappings":"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"}},
    {"offset": {"line": 3751, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/endpoints/update.ts"],"sourcesContent":["import { getTranslation } from '@payloadcms/translations'\nimport { status as httpStatus } from 'http-status'\n\nimport type { PayloadHandler } from '../../config/types.js'\n\nimport { getRequestCollection } from '../../utilities/getRequestEntity.js'\nimport { headersWithCors } from '../../utilities/headersWithCors.js'\nimport { parseParams } from '../../utilities/parseParams/index.js'\nimport { updateOperation } from '../operations/update.js'\n\nexport const updateHandler: PayloadHandler = async (req) => {\n  const collection = getRequestCollection(req)\n\n  const {\n    depth,\n    draft,\n    limit,\n    overrideLock,\n    populate,\n    publishAllLocales,\n    select,\n    sort,\n    trash,\n    unpublishAllLocales,\n    where,\n  } = parseParams(req.query)\n\n  const result = await updateOperation({\n    collection,\n    data: req.data!,\n    depth,\n    draft,\n    limit,\n    overrideLock: overrideLock ?? false,\n    populate,\n    publishAllLocales,\n    req,\n    select,\n    sort,\n    trash,\n    unpublishAllLocales,\n    where: where!,\n  })\n\n  const headers = headersWithCors({\n    headers: new Headers(),\n    req,\n  })\n\n  if (result.errors.length === 0) {\n    const message = req.t('general:updatedCountSuccessfully', {\n      count: result.docs.length,\n      label: getTranslation(\n        collection.config.labels[result.docs.length === 1 ? 'singular' : 'plural'],\n        req.i18n,\n      ),\n    })\n\n    return Response.json(\n      {\n        ...result,\n        message,\n      },\n      {\n        headers,\n        status: httpStatus.OK,\n      },\n    )\n  }\n\n  result.errors = result.errors.map((error) =>\n    error.isPublic\n      ? error\n      : {\n          ...error,\n          message: 'Something went wrong.',\n        },\n  )\n\n  const total = result.docs.length + result.errors.length\n  const message = req.t('error:unableToUpdateCount', {\n    count: result.errors.length,\n    label: getTranslation(collection.config.labels[total === 1 ? 'singular' : 'plural'], req.i18n),\n    total,\n  })\n\n  return Response.json(\n    {\n      ...result,\n      message,\n    },\n    {\n      headers,\n      status: httpStatus.BAD_REQUEST,\n    },\n  )\n}\n"],"names":["getTranslation","status","httpStatus","getRequestCollection","headersWithCors","parseParams","updateOperation","updateHandler","req","collection","depth","draft","limit","overrideLock","populate","publishAllLocales","select","sort","trash","unpublishAllLocales","where","query","result","data","headers","Headers","errors","length","message","t","count","docs","label","config","labels","i18n","Response","json","OK","map","error","isPublic","total","BAD_REQUEST"],"mappings":";;;;AAAA,SAASA,cAAc,QAAQ,2BAA0B;;AACzD,SAASC,UAAUC,UAAU,QAAQ,cAAa;AAIlD,SAASC,oBAAoB,QAAQ,sCAAqC;AAC1E,SAASC,eAAe,QAAQ,qCAAoC;AACpE,SAASC,WAAW,QAAQ,uCAAsC;AAClE,SAASC,eAAe,QAAQ,0BAAyB;;;;;;;AAElD,MAAMC,gBAAgC,OAAOC;IAClD,MAAMC,iBAAaN,0LAAAA,EAAqBK;IAExC,MAAM,EACJE,KAAK,EACLC,KAAK,EACLC,KAAK,EACLC,YAAY,EACZC,QAAQ,EACRC,iBAAiB,EACjBC,MAAM,EACNC,IAAI,EACJC,KAAK,EACLC,mBAAmB,EACnBC,KAAK,EACN,OAAGf,qLAAAA,EAAYG,IAAIa,KAAK;IAEzB,MAAMC,SAAS,UAAMhB,2LAAAA,EAAgB;QACnCG;QACAc,MAAMf,IAAIe,IAAI;QACdb;QACAC;QACAC;QACAC,cAAcA,gBAAgB;QAC9BC;QACAC;QACAP;QACAQ;QACAC;QACAC;QACAC;QACAC,OAAOA;IACT;IAEA,MAAMI,cAAUpB,oLAAAA,EAAgB;QAC9BoB,SAAS,IAAIC;QACbjB;IACF;IAEA,IAAIc,OAAOI,MAAM,CAACC,MAAM,KAAK,GAAG;QAC9B,MAAMC,UAAUpB,IAAIqB,CAAC,CAAC,oCAAoC;YACxDC,OAAOR,OAAOS,IAAI,CAACJ,MAAM;YACzBK,WAAOhC,uMAAAA,EACLS,WAAWwB,MAAM,CAACC,MAAM,CAACZ,OAAOS,IAAI,CAACJ,MAAM,KAAK,IAAI,aAAa,SAAS,EAC1EnB,IAAI2B,IAAI;QAEZ;QAEA,OAAOC,SAASC,IAAI,CAClB;YACE,GAAGf,MAAM;YACTM;QACF,GACA;YACEJ;YACAvB,QAAQC,sMAAAA,CAAWoC,EAAE;QACvB;IAEJ;IAEAhB,OAAOI,MAAM,GAAGJ,OAAOI,MAAM,CAACa,GAAG,CAAC,CAACC,QACjCA,MAAMC,QAAQ,GACVD,QACA;YACE,GAAGA,KAAK;YACRZ,SAAS;QACX;IAGN,MAAMc,QAAQpB,OAAOS,IAAI,CAACJ,MAAM,GAAGL,OAAOI,MAAM,CAACC,MAAM;IACvD,MAAMC,UAAUpB,IAAIqB,CAAC,CAAC,6BAA6B;QACjDC,OAAOR,OAAOI,MAAM,CAACC,MAAM;QAC3BK,WAAOhC,uMAAAA,EAAeS,WAAWwB,MAAM,CAACC,MAAM,CAACQ,UAAU,IAAI,aAAa,SAAS,EAAElC,IAAI2B,IAAI;QAC7FO;IACF;IAEA,OAAON,SAASC,IAAI,CAClB;QACE,GAAGf,MAAM;QACTM;IACF,GACA;QACEJ;QACAvB,QAAQC,sMAAAA,CAAWyC,WAAW;IAChC;AAEJ,EAAC"}},
    {"offset": {"line": 3826, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/operations/updateByID.ts"],"sourcesContent":["import type { DeepPartial } from 'ts-essentials'\n\nimport { status as httpStatus } from 'http-status'\n\nimport type { FindOneArgs } from '../../database/types.js'\nimport type {\n  PayloadRequest,\n  PopulateType,\n  SelectType,\n  TransformCollectionWithSelect,\n} from '../../types/index.js'\nimport type {\n  Collection,\n  RequiredDataFromCollectionSlug,\n  SelectFromCollectionSlug,\n  TypeWithID,\n} from '../config/types.js'\n\nimport { executeAccess } from '../../auth/executeAccess.js'\nimport { hasWhereAccessResult } from '../../auth/types.js'\nimport { combineQueries } from '../../database/combineQueries.js'\nimport { APIError, Forbidden, NotFound } from '../../errors/index.js'\nimport { type CollectionSlug, deepCopyObjectSimple, type FindOptions } from '../../index.js'\nimport { generateFileData } from '../../uploads/generateFileData.js'\nimport { unlinkTempFiles } from '../../uploads/unlinkTempFiles.js'\nimport { appendNonTrashedFilter } from '../../utilities/appendNonTrashedFilter.js'\nimport { commitTransaction } from '../../utilities/commitTransaction.js'\nimport { initTransaction } from '../../utilities/initTransaction.js'\nimport { killTransaction } from '../../utilities/killTransaction.js'\nimport { sanitizeSelect } from '../../utilities/sanitizeSelect.js'\nimport { getLatestCollectionVersion } from '../../versions/getLatestCollectionVersion.js'\nimport { buildAfterOperation } from './utilities/buildAfterOperation.js'\nimport { buildBeforeOperation } from './utilities/buildBeforeOperation.js'\nimport { updateDocument } from './utilities/update.js'\n\nexport type Arguments<TSlug extends CollectionSlug> = {\n  autosave?: boolean\n  collection: Collection\n  data: DeepPartial<RequiredDataFromCollectionSlug<TSlug>>\n  depth?: number\n  disableTransaction?: boolean\n  disableVerificationEmail?: boolean\n  draft?: boolean\n  id: number | string\n  overrideAccess?: boolean\n  overrideLock?: boolean\n  overwriteExistingFiles?: boolean\n  populate?: PopulateType\n  publishAllLocales?: boolean\n  publishSpecificLocale?: string\n  req: PayloadRequest\n  showHiddenFields?: boolean\n  trash?: boolean\n  unpublishAllLocales?: boolean\n} & Pick<FindOptions<TSlug, SelectType>, 'select'>\n\nexport const updateByIDOperation = async <\n  TSlug extends CollectionSlug,\n  TSelect extends SelectFromCollectionSlug<TSlug> = SelectType,\n>(\n  incomingArgs: Arguments<TSlug>,\n): Promise<TransformCollectionWithSelect<TSlug, TSelect>> => {\n  let args = incomingArgs\n\n  try {\n    const shouldCommit = !args.disableTransaction && (await initTransaction(args.req))\n\n    // /////////////////////////////////////\n    // beforeOperation - Collection\n    // /////////////////////////////////////\n\n    args = await buildBeforeOperation({\n      args,\n      collection: args.collection.config,\n      operation: 'update',\n      overrideAccess: args.overrideAccess!,\n    })\n\n    if (args.publishSpecificLocale) {\n      args.req.locale = args.publishSpecificLocale\n    }\n\n    const {\n      id,\n      autosave = false,\n      collection: { config: collectionConfig },\n      collection,\n      depth,\n      draft: draftArg = false,\n      overrideAccess,\n      overrideLock,\n      overwriteExistingFiles = false,\n      populate,\n      publishAllLocales,\n      publishSpecificLocale,\n      req: {\n        fallbackLocale,\n        locale,\n        payload: { config },\n        payload,\n      },\n      req,\n      select: incomingSelect,\n      showHiddenFields,\n      trash = false,\n      unpublishAllLocales,\n    } = args\n\n    if (!id) {\n      throw new APIError('Missing ID of document to update.', httpStatus.BAD_REQUEST)\n    }\n\n    const { data } = args\n\n    // /////////////////////////////////////\n    // Access\n    // /////////////////////////////////////\n\n    const accessResults = !overrideAccess\n      ? await executeAccess({ id, data, req }, collectionConfig.access.update)\n      : true\n    const hasWherePolicy = hasWhereAccessResult(accessResults)\n\n    // /////////////////////////////////////\n    // Retrieve document\n    // /////////////////////////////////////\n\n    const where = { id: { equals: id } }\n\n    let fullWhere = combineQueries(where, accessResults)\n\n    const isTrashAttempt =\n      collectionConfig.trash &&\n      typeof data === 'object' &&\n      data !== null &&\n      'deletedAt' in data &&\n      data.deletedAt != null\n\n    if (isTrashAttempt && !overrideAccess) {\n      const deleteAccessResult = await executeAccess({ req }, collectionConfig.access.delete)\n      fullWhere = combineQueries(fullWhere, deleteAccessResult)\n    }\n\n    // Exclude trashed documents when trash: false\n    fullWhere = appendNonTrashedFilter({\n      enableTrash: collectionConfig.trash,\n      trash,\n      where: fullWhere,\n    })\n\n    const findOneArgs: FindOneArgs = {\n      collection: collectionConfig.slug,\n      locale: locale!,\n      req,\n      where: fullWhere,\n    }\n\n    const docWithLocales = await getLatestCollectionVersion<\n      RequiredDataFromCollectionSlug<TSlug> & TypeWithID\n    >({\n      id,\n      config: collectionConfig,\n      payload,\n      query: findOneArgs,\n      req,\n    })\n\n    if (!docWithLocales && !hasWherePolicy) {\n      throw new NotFound(req.t)\n    }\n    if (!docWithLocales && hasWherePolicy) {\n      throw new Forbidden(req.t)\n    }\n    if (!docWithLocales) {\n      throw new NotFound(req.t)\n    }\n\n    // /////////////////////////////////////\n    // Generate data for all files and sizes\n    // /////////////////////////////////////\n\n    const { data: newFileData, files: filesToUpload } = await generateFileData({\n      collection,\n      config,\n      data,\n      operation: 'update',\n      overwriteExistingFiles,\n      req,\n      throwOnMissingFile: false,\n    })\n\n    const select = sanitizeSelect({\n      fields: collectionConfig.flattenedFields,\n      forceSelect: collectionConfig.forceSelect,\n      select: incomingSelect,\n    })\n\n    // ///////////////////////////////////////////////\n    // Update document, runs all document level hooks\n    // ///////////////////////////////////////////////\n\n    let result = await updateDocument<TSlug, TSelect>({\n      id,\n      autosave,\n      collectionConfig,\n      config,\n      data: deepCopyObjectSimple(newFileData),\n      depth: depth!,\n      docWithLocales,\n      draftArg,\n      fallbackLocale: fallbackLocale!,\n      filesToUpload,\n      locale: locale!,\n      overrideAccess: overrideAccess!,\n      overrideLock: overrideLock!,\n      payload,\n      populate,\n      publishAllLocales,\n      publishSpecificLocale,\n      req,\n      select: select!,\n      showHiddenFields: showHiddenFields!,\n      unpublishAllLocales,\n    })\n\n    await unlinkTempFiles({\n      collectionConfig,\n      config,\n      req,\n    })\n\n    // /////////////////////////////////////\n    // afterOperation - Collection\n    // /////////////////////////////////////\n\n    result = (await buildAfterOperation({\n      args,\n      collection: collectionConfig,\n      operation: 'updateByID',\n      overrideAccess,\n      result,\n    })) as TransformCollectionWithSelect<TSlug, TSelect>\n\n    // /////////////////////////////////////\n    // Return results\n    // /////////////////////////////////////\n\n    if (shouldCommit) {\n      await commitTransaction(req)\n    }\n\n    return result\n  } catch (error: unknown) {\n    await killTransaction(args.req)\n    throw error\n  }\n}\n"],"names":["status","httpStatus","executeAccess","hasWhereAccessResult","combineQueries","APIError","Forbidden","NotFound","deepCopyObjectSimple","generateFileData","unlinkTempFiles","appendNonTrashedFilter","commitTransaction","initTransaction","killTransaction","sanitizeSelect","getLatestCollectionVersion","buildAfterOperation","buildBeforeOperation","updateDocument","updateByIDOperation","incomingArgs","args","shouldCommit","disableTransaction","req","collection","config","operation","overrideAccess","publishSpecificLocale","locale","id","autosave","collectionConfig","depth","draft","draftArg","overrideLock","overwriteExistingFiles","populate","publishAllLocales","fallbackLocale","payload","select","incomingSelect","showHiddenFields","trash","unpublishAllLocales","BAD_REQUEST","data","accessResults","access","update","hasWherePolicy","where","equals","fullWhere","isTrashAttempt","deletedAt","deleteAccessResult","delete","enableTrash","findOneArgs","slug","docWithLocales","query","t","newFileData","files","filesToUpload","throwOnMissingFile","fields","flattenedFields","forceSelect","result","error"],"mappings":"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"}},
    {"offset": {"line": 4015, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/endpoints/updateByID.ts"],"sourcesContent":["import { status as httpStatus } from 'http-status'\n\nimport type { PayloadHandler } from '../../config/types.js'\n\nimport { getRequestCollectionWithID } from '../../utilities/getRequestEntity.js'\nimport { headersWithCors } from '../../utilities/headersWithCors.js'\nimport { parseParams } from '../../utilities/parseParams/index.js'\nimport { updateByIDOperation } from '../operations/updateByID.js'\n\nexport const updateByIDHandler: PayloadHandler = async (req) => {\n  const { id, collection } = getRequestCollectionWithID(req)\n\n  const {\n    autosave,\n    depth,\n    draft,\n    overrideLock,\n    populate,\n    publishAllLocales,\n    publishSpecificLocale,\n    select,\n    trash,\n    unpublishAllLocales,\n  } = parseParams(req.query)\n\n  const doc = await updateByIDOperation({\n    id,\n    autosave,\n    collection,\n    data: req.data!,\n    depth,\n    draft,\n    overrideLock: overrideLock ?? false,\n    populate,\n    publishAllLocales,\n    publishSpecificLocale,\n    req,\n    select,\n    trash,\n    unpublishAllLocales,\n  })\n\n  let message = req.t('general:updatedSuccessfully')\n\n  if (draft) {\n    message = req.t('version:draftSavedSuccessfully')\n  }\n  if (autosave) {\n    message = req.t('version:autosavedSuccessfully')\n  }\n\n  return Response.json(\n    {\n      doc,\n      message,\n    },\n    {\n      headers: headersWithCors({\n        headers: new Headers(),\n        req,\n      }),\n      status: httpStatus.OK,\n    },\n  )\n}\n"],"names":["status","httpStatus","getRequestCollectionWithID","headersWithCors","parseParams","updateByIDOperation","updateByIDHandler","req","id","collection","autosave","depth","draft","overrideLock","populate","publishAllLocales","publishSpecificLocale","select","trash","unpublishAllLocales","query","doc","data","message","t","Response","json","headers","Headers","OK"],"mappings":";;;;;AAAA,SAASA,UAAUC,UAAU,QAAQ,cAAa;AAIlD,SAASC,0BAA0B,QAAQ,sCAAqC;AAChF,SAASC,eAAe,QAAQ,qCAAoC;AACpE,SAASC,WAAW,QAAQ,uCAAsC;AAClE,SAASC,mBAAmB,QAAQ,8BAA6B;;;;;;AAE1D,MAAMC,oBAAoC,OAAOC;IACtD,MAAM,EAAEC,EAAE,EAAEC,UAAU,EAAE,OAAGP,gMAAAA,EAA2BK;IAEtD,MAAM,EACJG,QAAQ,EACRC,KAAK,EACLC,KAAK,EACLC,YAAY,EACZC,QAAQ,EACRC,iBAAiB,EACjBC,qBAAqB,EACrBC,MAAM,EACNC,KAAK,EACLC,mBAAmB,EACpB,OAAGf,qLAAAA,EAAYG,IAAIa,KAAK;IAEzB,MAAMC,MAAM,UAAMhB,mMAAAA,EAAoB;QACpCG;QACAE;QACAD;QACAa,MAAMf,IAAIe,IAAI;QACdX;QACAC;QACAC,cAAcA,gBAAgB;QAC9BC;QACAC;QACAC;QACAT;QACAU;QACAC;QACAC;IACF;IAEA,IAAII,UAAUhB,IAAIiB,CAAC,CAAC;IAEpB,IAAIZ,OAAO;QACTW,UAAUhB,IAAIiB,CAAC,CAAC;IAClB;IACA,IAAId,UAAU;QACZa,UAAUhB,IAAIiB,CAAC,CAAC;IAClB;IAEA,OAAOC,SAASC,IAAI,CAClB;QACEL;QACAE;IACF,GACA;QACEI,aAASxB,oLAAAA,EAAgB;YACvBwB,SAAS,IAAIC;YACbrB;QACF;QACAP,QAAQC,sMAAAA,CAAW4B,EAAE;IACvB;AAEJ,EAAC"}},
    {"offset": {"line": 4071, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/endpoints/index.ts"],"sourcesContent":["import type { Endpoint } from '../../config/types.js'\n\nimport { wrapInternalEndpoints } from '../../utilities/wrapInternalEndpoints.js'\nimport { countHandler } from './count.js'\nimport { createHandler } from './create.js'\nimport { deleteHandler } from './delete.js'\nimport { deleteByIDHandler } from './deleteByID.js'\nimport { docAccessHandler } from './docAccess.js'\nimport { duplicateHandler } from './duplicate.js'\nimport { findHandler } from './find.js'\nimport { findByIDHandler } from './findByID.js'\n// import { findDistinctHandler } from './findDistinct.js'\nimport { findVersionByIDHandler } from './findVersionByID.js'\nimport { findVersionsHandler } from './findVersions.js'\nimport { restoreVersionHandler } from './restoreVersion.js'\nimport { updateHandler } from './update.js'\nimport { updateByIDHandler } from './updateByID.js'\n\nexport const defaultCollectionEndpoints: Endpoint[] = [\n  ...wrapInternalEndpoints([\n    {\n      handler: countHandler,\n      method: 'get',\n      path: '/count',\n    },\n    {\n      handler: createHandler,\n      method: 'post',\n      path: '/',\n    },\n    {\n      handler: deleteHandler,\n      method: 'delete',\n      path: '/',\n    },\n    {\n      handler: deleteByIDHandler,\n      method: 'delete',\n      path: '/:id',\n    },\n    {\n      handler: docAccessHandler,\n      method: 'post',\n      path: '/access/:id?',\n    },\n    {\n      handler: findVersionsHandler,\n      method: 'get',\n      path: '/versions',\n    },\n    // Might be uncommented in the future\n    // {\n    //   handler: findDistinctHandler,\n    //   method: 'get',\n    //   path: '/distinct',\n    // },\n    {\n      handler: duplicateHandler,\n      method: 'post',\n      path: '/:id/duplicate',\n    },\n    {\n      handler: findHandler,\n      method: 'get',\n      path: '/',\n    },\n    {\n      handler: findByIDHandler,\n      method: 'get',\n      path: '/:id',\n    },\n    {\n      handler: findVersionByIDHandler,\n      method: 'get',\n      path: '/versions/:id',\n    },\n    {\n      handler: restoreVersionHandler,\n      method: 'post',\n      path: '/versions/:id',\n    },\n    {\n      handler: updateHandler,\n      method: 'patch',\n      path: '/',\n    },\n    {\n      handler: updateByIDHandler,\n      method: 'patch',\n      path: '/:id',\n    },\n  ]),\n]\n"],"names":["wrapInternalEndpoints","countHandler","createHandler","deleteHandler","deleteByIDHandler","docAccessHandler","duplicateHandler","findHandler","findByIDHandler","findVersionByIDHandler","findVersionsHandler","restoreVersionHandler","updateHandler","updateByIDHandler","defaultCollectionEndpoints","handler","method","path"],"mappings":";;;;AAEA,SAASA,qBAAqB,QAAQ,2CAA0C;AAChF,SAASC,YAAY,QAAQ,aAAY;AACzC,SAASC,aAAa,QAAQ,cAAa;AAC3C,SAASC,aAAa,QAAQ,cAAa;AAC3C,SAASC,iBAAiB,QAAQ,kBAAiB;AACnD,SAASC,gBAAgB,QAAQ,iBAAgB;AACjD,SAASC,gBAAgB,QAAQ,iBAAgB;AACjD,SAASC,WAAW,QAAQ,YAAW;AACvC,SAASC,eAAe,QAAQ,gBAAe;AAC/C,0DAA0D;AAC1D,SAASC,sBAAsB,QAAQ,uBAAsB;AAC7D,SAASC,mBAAmB,QAAQ,oBAAmB;AACvD,SAASC,qBAAqB,QAAQ,sBAAqB;AAC3D,SAASC,aAAa,QAAQ,cAAa;AAC3C,SAASC,iBAAiB,QAAQ,kBAAiB;;;;;;;;;;;;;;;AAE5C,MAAMC,6BAAyC;WACjDd,gMAAAA,EAAsB;QACvB;YACEe,SAASd,sLAAAA;YACTe,QAAQ;YACRC,MAAM;QACR;QACA;YACEF,SAASb,wLAAAA;YACTc,QAAQ;YACRC,MAAM;QACR;QACA;YACEF,SAASZ,wLAAAA;YACTa,QAAQ;YACRC,MAAM;QACR;QACA;YACEF,SAASX,gMAAAA;YACTY,QAAQ;YACRC,MAAM;QACR;QACA;YACEF,SAASV,8LAAAA;YACTW,QAAQ;YACRC,MAAM;QACR;QACA;YACEF,SAASL,oMAAAA;YACTM,QAAQ;YACRC,MAAM;QACR;QACA,qCAAqC;QACrC,IAAI;QACJ,kCAAkC;QAClC,mBAAmB;QACnB,uBAAuB;QACvB,KAAK;QACL;YACEF,SAAST,8LAAAA;YACTU,QAAQ;YACRC,MAAM;QACR;QACA;YACEF,SAASR,oLAAAA;YACTS,QAAQ;YACRC,MAAM;QACR;QACA;YACEF,SAASP,4LAAAA;YACTQ,QAAQ;YACRC,MAAM;QACR;QACA;YACEF,SAASN,0MAAAA;YACTO,QAAQ;YACRC,MAAM;QACR;QACA;YACEF,SAASJ,wMAAAA;YACTK,QAAQ;YACRC,MAAM;QACR;QACA;YACEF,SAASH,wLAAAA;YACTI,QAAQ;YACRC,MAAM;QACR;QACA;YACEF,SAASF,gMAAAA;YACTG,QAAQ;YACRC,MAAM;QACR;KACD;CACF,CAAA"}},
    {"offset": {"line": 4183, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/config/defaults.ts"],"sourcesContent":["import type { IncomingAuthType, LoginWithUsernameOptions } from '../../auth/types.js'\nimport type { CollectionConfig } from './types.js'\n\nimport { defaultAccess } from '../../auth/defaultAccess.js'\n\n/**\n * @deprecated - remove in 4.0. This is error-prone, as mutating this object will affect any objects that use the defaults as a base.\n */\nexport const defaults: Partial<CollectionConfig> = {\n  access: {\n    create: defaultAccess,\n    delete: defaultAccess,\n    read: defaultAccess,\n    unlock: defaultAccess,\n    update: defaultAccess,\n  },\n  admin: {\n    components: {},\n    custom: {},\n    enableRichTextLink: true,\n    enableRichTextRelationship: true,\n    pagination: {\n      defaultLimit: 10,\n      limits: [5, 10, 25, 50, 100],\n    },\n    useAsTitle: 'id',\n  },\n  auth: false,\n  custom: {},\n  endpoints: [],\n  fields: [],\n  hooks: {\n    afterChange: [],\n    afterDelete: [],\n    afterForgotPassword: [],\n    afterLogin: [],\n    afterLogout: [],\n    afterMe: [],\n    afterOperation: [],\n    afterRead: [],\n    afterRefresh: [],\n    beforeChange: [],\n    beforeDelete: [],\n    beforeLogin: [],\n    beforeOperation: [],\n    beforeRead: [],\n    beforeValidate: [],\n    me: [],\n    refresh: [],\n  },\n  indexes: [],\n  timestamps: true,\n  upload: false,\n  versions: false,\n}\n\nexport const addDefaultsToCollectionConfig = (collection: CollectionConfig): CollectionConfig => {\n  collection.access = {\n    create: defaultAccess,\n    delete: defaultAccess,\n    read: defaultAccess,\n    unlock: defaultAccess,\n    update: defaultAccess,\n    ...(collection.access || {}),\n  }\n\n  collection.admin = {\n    components: {},\n    custom: {},\n    enableRichTextLink: true,\n    enableRichTextRelationship: true,\n    useAsTitle: 'id',\n    ...(collection.admin || {}),\n    pagination: {\n      defaultLimit: 10,\n      limits: [5, 10, 25, 50, 100],\n      ...(collection.admin?.pagination || {}),\n    },\n  }\n\n  collection.auth = collection.auth ?? false\n  collection.custom = collection.custom ?? {}\n  collection.endpoints = collection.endpoints ?? []\n  collection.fields = collection.fields ?? []\n  collection.folders = collection.folders ?? false\n\n  collection.hooks = {\n    afterChange: [],\n    afterDelete: [],\n    afterForgotPassword: [],\n    afterLogin: [],\n    afterLogout: [],\n    afterMe: [],\n    afterOperation: [],\n    afterRead: [],\n    afterRefresh: [],\n    beforeChange: [],\n    beforeDelete: [],\n    beforeLogin: [],\n    beforeOperation: [],\n    beforeRead: [],\n    beforeValidate: [],\n    me: [],\n    refresh: [],\n    ...(collection.hooks || {}),\n  }\n\n  collection.timestamps = collection.timestamps ?? true\n  collection.upload = collection.upload ?? false\n  collection.versions = collection.versions ?? false\n\n  collection.indexes = collection.indexes ?? []\n\n  return collection\n}\n\n/**\n * @deprecated - remove in 4.0. This is error-prone, as mutating this object will affect any objects that use the defaults as a base.\n */\nexport const authDefaults: IncomingAuthType = {\n  cookies: {\n    sameSite: 'Lax',\n    secure: false,\n  },\n  forgotPassword: {},\n  lockTime: 600000, // 10 minutes\n  loginWithUsername: false,\n  maxLoginAttempts: 5,\n  tokenExpiration: 7200,\n  useSessions: true,\n  verify: false,\n}\n\nexport const addDefaultsToAuthConfig = (auth: IncomingAuthType): IncomingAuthType => {\n  auth.cookies = {\n    sameSite: 'Lax',\n    secure: false,\n    ...(auth.cookies || {}),\n  }\n\n  auth.forgotPassword = auth.forgotPassword ?? {}\n  auth.lockTime = auth.lockTime ?? 600000 // 10 minutes\n  auth.loginWithUsername = auth.loginWithUsername ?? false\n  auth.maxLoginAttempts = auth.maxLoginAttempts ?? 5\n  auth.tokenExpiration = auth.tokenExpiration ?? 7200\n  auth.useSessions = auth.useSessions ?? true\n  auth.verify = auth.verify ?? false\n  auth.strategies = auth.strategies ?? []\n\n  if (!auth.disableLocalStrategy && auth.verify === true) {\n    auth.verify = {}\n  }\n\n  return auth\n}\n\n/**\n * @deprecated - remove in 4.0. This is error-prone, as mutating this object will affect any objects that use the defaults as a base.\n */\nexport const loginWithUsernameDefaults: LoginWithUsernameOptions = {\n  allowEmailLogin: false,\n  requireEmail: false,\n  requireUsername: true,\n}\n\nexport const addDefaultsToLoginWithUsernameConfig = (\n  loginWithUsername: LoginWithUsernameOptions,\n): LoginWithUsernameOptions =>\n  ({\n    allowEmailLogin: false,\n    requireEmail: false,\n    requireUsername: true,\n    ...(loginWithUsername || {}),\n  }) as LoginWithUsernameOptions\n"],"names":["defaultAccess","defaults","access","create","delete","read","unlock","update","admin","components","custom","enableRichTextLink","enableRichTextRelationship","pagination","defaultLimit","limits","useAsTitle","auth","endpoints","fields","hooks","afterChange","afterDelete","afterForgotPassword","afterLogin","afterLogout","afterMe","afterOperation","afterRead","afterRefresh","beforeChange","beforeDelete","beforeLogin","beforeOperation","beforeRead","beforeValidate","me","refresh","indexes","timestamps","upload","versions","addDefaultsToCollectionConfig","collection","folders","authDefaults","cookies","sameSite","secure","forgotPassword","lockTime","loginWithUsername","maxLoginAttempts","tokenExpiration","useSessions","verify","addDefaultsToAuthConfig","strategies","disableLocalStrategy","loginWithUsernameDefaults","allowEmailLogin","requireEmail","requireUsername","addDefaultsToLoginWithUsernameConfig"],"mappings":";;;;;;;;;;;;;;AAGA,SAASA,aAAa,QAAQ,8BAA6B;;AAKpD,MAAMC,WAAsC;IACjDC,QAAQ;QACNC,QAAQH,2KAAAA;QACRI,QAAQJ,2KAAAA;QACRK,MAAML,2KAAAA;QACNM,QAAQN,2KAAAA;QACRO,QAAQP,2KAAAA;IACV;IACAQ,OAAO;QACLC,YAAY,CAAC;QACbC,QAAQ,CAAC;QACTC,oBAAoB;QACpBC,4BAA4B;QAC5BC,YAAY;YACVC,cAAc;YACdC,QAAQ;gBAAC;gBAAG;gBAAI;gBAAI;gBAAI;aAAI;QAC9B;QACAC,YAAY;IACd;IACAC,MAAM;IACNP,QAAQ,CAAC;IACTQ,WAAW,EAAE;IACbC,QAAQ,EAAE;IACVC,OAAO;QACLC,aAAa,EAAE;QACfC,aAAa,EAAE;QACfC,qBAAqB,EAAE;QACvBC,YAAY,EAAE;QACdC,aAAa,EAAE;QACfC,SAAS,EAAE;QACXC,gBAAgB,EAAE;QAClBC,WAAW,EAAE;QACbC,cAAc,EAAE;QAChBC,cAAc,EAAE;QAChBC,cAAc,EAAE;QAChBC,aAAa,EAAE;QACfC,iBAAiB,EAAE;QACnBC,YAAY,EAAE;QACdC,gBAAgB,EAAE;QAClBC,IAAI,EAAE;QACNC,SAAS,EAAE;IACb;IACAC,SAAS,EAAE;IACXC,YAAY;IACZC,QAAQ;IACRC,UAAU;AACZ,EAAC;AAEM,MAAMC,gCAAgC,CAACC;IAC5CA,WAAWzC,MAAM,GAAG;QAClBC,QAAQH,2KAAAA;QACRI,QAAQJ,2KAAAA;QACRK,MAAML,2KAAAA;QACNM,QAAQN,2KAAAA;QACRO,QAAQP,2KAAAA;QACR,GAAI2C,WAAWzC,MAAM,IAAI,CAAC,CAAC;IAC7B;IAEAyC,WAAWnC,KAAK,GAAG;QACjBC,YAAY,CAAC;QACbC,QAAQ,CAAC;QACTC,oBAAoB;QACpBC,4BAA4B;QAC5BI,YAAY;QACZ,GAAI2B,WAAWnC,KAAK,IAAI,CAAC,CAAC;QAC1BK,YAAY;YACVC,cAAc;YACdC,QAAQ;gBAAC;gBAAG;gBAAI;gBAAI;gBAAI;aAAI;YAC5B,GAAI4B,WAAWnC,KAAK,EAAEK,cAAc,CAAC,CAAC;QACxC;IACF;IAEA8B,WAAW1B,IAAI,GAAG0B,WAAW1B,IAAI,IAAI;IACrC0B,WAAWjC,MAAM,GAAGiC,WAAWjC,MAAM,IAAI,CAAC;IAC1CiC,WAAWzB,SAAS,GAAGyB,WAAWzB,SAAS,IAAI,EAAE;IACjDyB,WAAWxB,MAAM,GAAGwB,WAAWxB,MAAM,IAAI,EAAE;IAC3CwB,WAAWC,OAAO,GAAGD,WAAWC,OAAO,IAAI;IAE3CD,WAAWvB,KAAK,GAAG;QACjBC,aAAa,EAAE;QACfC,aAAa,EAAE;QACfC,qBAAqB,EAAE;QACvBC,YAAY,EAAE;QACdC,aAAa,EAAE;QACfC,SAAS,EAAE;QACXC,gBAAgB,EAAE;QAClBC,WAAW,EAAE;QACbC,cAAc,EAAE;QAChBC,cAAc,EAAE;QAChBC,cAAc,EAAE;QAChBC,aAAa,EAAE;QACfC,iBAAiB,EAAE;QACnBC,YAAY,EAAE;QACdC,gBAAgB,EAAE;QAClBC,IAAI,EAAE;QACNC,SAAS,EAAE;QACX,GAAIM,WAAWvB,KAAK,IAAI,CAAC,CAAC;IAC5B;IAEAuB,WAAWJ,UAAU,GAAGI,WAAWJ,UAAU,IAAI;IACjDI,WAAWH,MAAM,GAAGG,WAAWH,MAAM,IAAI;IACzCG,WAAWF,QAAQ,GAAGE,WAAWF,QAAQ,IAAI;IAE7CE,WAAWL,OAAO,GAAGK,WAAWL,OAAO,IAAI,EAAE;IAE7C,OAAOK;AACT,EAAC;AAKM,MAAME,eAAiC;IAC5CC,SAAS;QACPC,UAAU;QACVC,QAAQ;IACV;IACAC,gBAAgB,CAAC;IACjBC,UAAU;IACVC,mBAAmB;IACnBC,kBAAkB;IAClBC,iBAAiB;IACjBC,aAAa;IACbC,QAAQ;AACV,EAAC;AAEM,MAAMC,0BAA0B,CAACvC;IACtCA,KAAK6B,OAAO,GAAG;QACbC,UAAU;QACVC,QAAQ;QACR,GAAI/B,KAAK6B,OAAO,IAAI,CAAC,CAAC;IACxB;IAEA7B,KAAKgC,cAAc,GAAGhC,KAAKgC,cAAc,IAAI,CAAC;IAC9ChC,KAAKiC,QAAQ,GAAGjC,KAAKiC,QAAQ,IAAI,QAAO,aAAa;IACrDjC,KAAKkC,iBAAiB,GAAGlC,KAAKkC,iBAAiB,IAAI;IACnDlC,KAAKmC,gBAAgB,GAAGnC,KAAKmC,gBAAgB,IAAI;IACjDnC,KAAKoC,eAAe,GAAGpC,KAAKoC,eAAe,IAAI;IAC/CpC,KAAKqC,WAAW,GAAGrC,KAAKqC,WAAW,IAAI;IACvCrC,KAAKsC,MAAM,GAAGtC,KAAKsC,MAAM,IAAI;IAC7BtC,KAAKwC,UAAU,GAAGxC,KAAKwC,UAAU,IAAI,EAAE;IAEvC,IAAI,CAACxC,KAAKyC,oBAAoB,IAAIzC,KAAKsC,MAAM,KAAK,MAAM;QACtDtC,KAAKsC,MAAM,GAAG,CAAC;IACjB;IAEA,OAAOtC;AACT,EAAC;AAKM,MAAM0C,4BAAsD;IACjEC,iBAAiB;IACjBC,cAAc;IACdC,iBAAiB;AACnB,EAAC;AAEM,MAAMC,uCAAuC,CAClDZ,oBAEC,CAAA;QACCS,iBAAiB;QACjBC,cAAc;QACdC,iBAAiB;QACjB,GAAIX,qBAAqB,CAAC,CAAC;IAC7B,CAAA,EAA8B"}},
    {"offset": {"line": 4358, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/config/sanitizeCompoundIndexes.ts"],"sourcesContent":["import type { FlattenedField } from '../../fields/config/types.js'\nimport type { CompoundIndex, SanitizedCompoundIndex } from './types.js'\n\nimport { InvalidConfiguration } from '../../errors/InvalidConfiguration.js'\nimport { getFieldByPath } from '../../utilities/getFieldByPath.js'\n\nexport const sanitizeCompoundIndexes = ({\n  fields,\n  indexes,\n}: {\n  fields: FlattenedField[]\n  indexes: CompoundIndex[]\n}): SanitizedCompoundIndex[] => {\n  const sanitizedCompoundIndexes: SanitizedCompoundIndex[] = []\n\n  for (const index of indexes) {\n    const sanitized: SanitizedCompoundIndex = { fields: [], unique: index.unique ?? false }\n    for (const path of index.fields) {\n      const result = getFieldByPath({ fields, path })\n\n      if (!result) {\n        throw new InvalidConfiguration(`Field ${path} was not found`)\n      }\n\n      const { field, localizedPath, pathHasLocalized } = result\n\n      if (['array', 'blocks', 'group', 'tab'].includes(field.type)) {\n        throw new InvalidConfiguration(\n          `Compound index on ${field.type} cannot be set. Path: ${localizedPath}`,\n        )\n      }\n\n      sanitized.fields.push({ field, localizedPath, path, pathHasLocalized })\n    }\n\n    sanitizedCompoundIndexes.push(sanitized)\n  }\n\n  return sanitizedCompoundIndexes\n}\n"],"names":["InvalidConfiguration","getFieldByPath","sanitizeCompoundIndexes","fields","indexes","sanitizedCompoundIndexes","index","sanitized","unique","path","result","field","localizedPath","pathHasLocalized","includes","type","push"],"mappings":";;;;AAGA,SAASA,oBAAoB,QAAQ,uCAAsC;AAC3E,SAASC,cAAc,QAAQ,oCAAmC;;;AAE3D,MAAMC,0BAA0B,CAAC,EACtCC,MAAM,EACNC,OAAO,EAIR;IACC,MAAMC,2BAAqD,EAAE;IAE7D,KAAK,MAAMC,SAASF,QAAS;QAC3B,MAAMG,YAAoC;YAAEJ,QAAQ,EAAE;YAAEK,QAAQF,MAAME,MAAM,IAAI;QAAM;QACtF,KAAK,MAAMC,QAAQH,MAAMH,MAAM,CAAE;YAC/B,MAAMO,aAAST,kLAAAA,EAAe;gBAAEE;gBAAQM;YAAK;YAE7C,IAAI,CAACC,QAAQ;gBACX,MAAM,IAAIV,2LAAAA,CAAqB,CAAC,MAAM,EAAES,KAAK,cAAc,CAAC;YAC9D;YAEA,MAAM,EAAEE,KAAK,EAAEC,aAAa,EAAEC,gBAAgB,EAAE,GAAGH;YAEnD,IAAI;gBAAC;gBAAS;gBAAU;gBAAS;aAAM,CAACI,QAAQ,CAACH,MAAMI,IAAI,GAAG;gBAC5D,MAAM,IAAIf,2LAAAA,CACR,CAAC,kBAAkB,EAAEW,MAAMI,IAAI,CAAC,sBAAsB,EAAEH,eAAe;YAE3E;YAEAL,UAAUJ,MAAM,CAACa,IAAI,CAAC;gBAAEL;gBAAOC;gBAAeH;gBAAMI;YAAiB;QACvE;QAEAR,yBAAyBW,IAAI,CAACT;IAChC;IAEA,OAAOF;AACT,EAAC"}},
    {"offset": {"line": 4405, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/config/useAsTitle.ts"],"sourcesContent":["import type { CollectionConfig } from '../../index.js'\n\nimport { InvalidConfiguration } from '../../errors/InvalidConfiguration.js'\nimport { fieldAffectsData } from '../../fields/config/types.js'\nimport { flattenTopLevelFields } from '../../utilities/flattenTopLevelFields.js'\n\n/**\n * Validate useAsTitle for collections.\n */\nexport const validateUseAsTitle = (config: CollectionConfig) => {\n  if (config.admin?.useAsTitle?.includes('.')) {\n    throw new InvalidConfiguration(\n      `\"useAsTitle\" cannot be a nested field. Please specify a top-level field in the collection \"${config.slug}\"`,\n    )\n  }\n\n  if (config?.admin && config.admin?.useAsTitle && config.admin.useAsTitle !== 'id') {\n    const fields = flattenTopLevelFields(config.fields)\n    const useAsTitleField = fields.find((field) => {\n      if (fieldAffectsData(field) && config.admin) {\n        return field.name === config.admin.useAsTitle\n      }\n      return false\n    })\n\n    // If auth is enabled then we don't need to\n    if (config.auth) {\n      if (config.admin.useAsTitle !== 'email') {\n        if (!useAsTitleField) {\n          throw new InvalidConfiguration(\n            `The field \"${config.admin.useAsTitle}\" specified in \"admin.useAsTitle\" does not exist in the collection \"${config.slug}\"`,\n          )\n        }\n      }\n    } else {\n      if (useAsTitleField && 'virtual' in useAsTitleField && useAsTitleField.virtual === true) {\n        throw new InvalidConfiguration(\n          `The field \"${config.admin.useAsTitle}\" specified in \"admin.useAsTitle\" in the collection \"${config.slug}\" is virtual. A virtual field can be used as the title only when linked to a relationship field.`,\n        )\n      }\n      if (!useAsTitleField) {\n        throw new InvalidConfiguration(\n          `The field \"${config.admin.useAsTitle}\" specified in \"admin.useAsTitle\" does not exist in the collection \"${config.slug}\"`,\n        )\n      }\n    }\n  }\n}\n"],"names":["InvalidConfiguration","fieldAffectsData","flattenTopLevelFields","validateUseAsTitle","config","admin","useAsTitle","includes","slug","fields","useAsTitleField","find","field","name","auth","virtual"],"mappings":";;;;AAEA,SAASA,oBAAoB,QAAQ,uCAAsC;AAC3E,SAASC,gBAAgB,QAAQ,+BAA8B;AAC/D,SAASC,qBAAqB,QAAQ,2CAA0C;;;;AAKzE,MAAMC,qBAAqB,CAACC;IACjC,IAAIA,OAAOC,KAAK,EAAEC,YAAYC,SAAS,MAAM;QAC3C,MAAM,IAAIP,2LAAAA,CACR,CAAC,2FAA2F,EAAEI,OAAOI,IAAI,CAAC,CAAC,CAAC;IAEhH;IAEA,IAAIJ,QAAQC,SAASD,OAAOC,KAAK,EAAEC,cAAcF,OAAOC,KAAK,CAACC,UAAU,KAAK,MAAM;QACjF,MAAMG,aAASP,gMAAAA,EAAsBE,OAAOK,MAAM;QAClD,MAAMC,kBAAkBD,OAAOE,IAAI,CAAC,CAACC;YACnC,QAAIX,kLAAAA,EAAiBW,UAAUR,OAAOC,KAAK,EAAE;gBAC3C,OAAOO,MAAMC,IAAI,KAAKT,OAAOC,KAAK,CAACC,UAAU;YAC/C;YACA,OAAO;QACT;QAEA,2CAA2C;QAC3C,IAAIF,OAAOU,IAAI,EAAE;YACf,IAAIV,OAAOC,KAAK,CAACC,UAAU,KAAK,SAAS;gBACvC,IAAI,CAACI,iBAAiB;oBACpB,MAAM,IAAIV,2LAAAA,CACR,CAAC,WAAW,EAAEI,OAAOC,KAAK,CAACC,UAAU,CAAC,oEAAoE,EAAEF,OAAOI,IAAI,CAAC,CAAC,CAAC;gBAE9H;YACF;QACF,OAAO;YACL,IAAIE,mBAAmB,aAAaA,mBAAmBA,gBAAgBK,OAAO,KAAK,MAAM;gBACvF,MAAM,IAAIf,2LAAAA,CACR,CAAC,WAAW,EAAEI,OAAOC,KAAK,CAACC,UAAU,CAAC,qDAAqD,EAAEF,OAAOI,IAAI,CAAC,gGAAgG,CAAC;YAE9M;YACA,IAAI,CAACE,iBAAiB;gBACpB,MAAM,IAAIV,2LAAAA,CACR,CAAC,WAAW,EAAEI,OAAOC,KAAK,CAACC,UAAU,CAAC,oEAAoE,EAAEF,OAAOI,IAAI,CAAC,CAAC,CAAC;YAE9H;QACF;IACF;AACF,EAAC"}},
    {"offset": {"line": 4448, "column": 0}, "map": {"version":3,"sources":["file:///Users/atamanov/Documents/Projects/ways2spain-landing/node_modules/payload/src/collections/config/sanitize.ts"],"sourcesContent":["import type { Config, SanitizedConfig } from '../../config/types.js'\nimport type {\n  CollectionConfig,\n  SanitizedCollectionConfig,\n  SanitizedJoin,\n  SanitizedJoins,\n} from './types.js'\n\nimport { authCollectionEndpoints } from '../../auth/endpoints/index.js'\nimport { getBaseAuthFields } from '../../auth/getAuthFields.js'\nimport { TimestampsRequired } from '../../errors/TimestampsRequired.js'\nimport { sanitizeFields } from '../../fields/config/sanitize.js'\nimport { fieldAffectsData } from '../../fields/config/types.js'\nimport { mergeBaseFields } from '../../fields/mergeBaseFields.js'\nimport { uploadCollectionEndpoints } from '../../uploads/endpoints/index.js'\nimport { getBaseUploadFields } from '../../uploads/getBaseFields.js'\nimport { flattenAllFields } from '../../utilities/flattenAllFields.js'\nimport { formatLabels } from '../../utilities/formatLabels.js'\nimport { miniChalk } from '../../utilities/miniChalk.js'\nimport { traverseForLocalizedFields } from '../../utilities/traverseForLocalizedFields.js'\nimport { baseVersionFields } from '../../versions/baseFields.js'\nimport { versionDefaults } from '../../versions/defaults.js'\nimport { defaultCollectionEndpoints } from '../endpoints/index.js'\nimport {\n  addDefaultsToAuthConfig,\n  addDefaultsToCollectionConfig,\n  addDefaultsToLoginWithUsernameConfig,\n} from './defaults.js'\nimport { sanitizeCompoundIndexes } from './sanitizeCompoundIndexes.js'\nimport { validateUseAsTitle } from './useAsTitle.js'\n\nexport const sanitizeCollection = async (\n  config: Config,\n  collection: CollectionConfig,\n  /**\n   * If this property is set, RichText fields won't be sanitized immediately. Instead, they will be added to this array as promises\n   * so that you can sanitize them together, after the config has been sanitized.\n   */\n  richTextSanitizationPromises?: Array<(config: SanitizedConfig) => Promise<void>>,\n  _validRelationships?: string[],\n): Promise<SanitizedCollectionConfig> => {\n  if (collection._sanitized) {\n    return collection as SanitizedCollectionConfig\n  }\n\n  collection._sanitized = true\n\n  // /////////////////////////////////\n  // Make copy of collection config\n  // /////////////////////////////////\n\n  const sanitized: CollectionConfig = addDefaultsToCollectionConfig(collection)\n\n  // /////////////////////////////////\n  // Sanitize fields\n  // /////////////////////////////////\n\n  const validRelationships = _validRelationships ?? config.collections!.map((c) => c.slug) ?? []\n\n  const joins: SanitizedJoins = {}\n\n  const polymorphicJoins: SanitizedJoin[] = []\n\n  sanitized.fields = await sanitizeFields({\n    collectionConfig: sanitized,\n    config,\n    fields: sanitized.fields,\n    joinPath: '',\n    joins,\n    parentIsLocalized: false,\n    polymorphicJoins,\n    richTextSanitizationPromises,\n    validRelationships,\n  })\n\n  if (sanitized.endpoints !== false) {\n    if (!sanitized.endpoints) {\n      sanitized.endpoints = []\n    }\n\n    if (sanitized.auth) {\n      for (const endpoint of authCollectionEndpoints) {\n        sanitized.endpoints.push(endpoint)\n      }\n    }\n\n    if (sanitized.upload) {\n      for (const endpoint of uploadCollectionEndpoints) {\n        sanitized.endpoints.push(endpoint)\n      }\n    }\n\n    for (const endpoint of defaultCollectionEndpoints) {\n      sanitized.endpoints.push(endpoint)\n    }\n  }\n\n  if (sanitized.timestamps !== false) {\n    // add default timestamps fields only as needed\n    let hasUpdatedAt: boolean | null = null\n    let hasCreatedAt: boolean | null = null\n    let hasDeletedAt: boolean | null = null\n\n    sanitized.fields.some((field) => {\n      if (fieldAffectsData(field)) {\n        if (field.name === 'updatedAt') {\n          hasUpdatedAt = true\n        }\n\n        if (field.name === 'createdAt') {\n          hasCreatedAt = true\n        }\n\n        if (field.name === 'deletedAt') {\n          hasDeletedAt = true\n        }\n      }\n\n      return hasCreatedAt && hasUpdatedAt && (!sanitized.trash || hasDeletedAt)\n    })\n\n    if (!hasUpdatedAt) {\n      sanitized.fields.push({\n        name: 'updatedAt',\n        type: 'date',\n        admin: {\n          disableBulkEdit: true,\n          hidden: true,\n        },\n        index: true,\n        label: ({ t }) => t('general:updatedAt'),\n      })\n    }\n\n    if (!hasCreatedAt) {\n      sanitized.fields.push({\n        name: 'createdAt',\n        admin: {\n          disableBulkEdit: true,\n          hidden: true,\n        },\n        // The default sort for list view is createdAt. Thus, enabling indexing by default, is a major performance improvement, especially for large or a large amount of collections.\n        type: 'date',\n        index: true,\n        label: ({ t }) => t('general:createdAt'),\n      })\n    }\n\n    if (sanitized.trash && !hasDeletedAt) {\n      sanitized.fields.push({\n        name: 'deletedAt',\n        type: 'date',\n        admin: {\n          disableBulkEdit: true,\n          hidden: true,\n        },\n        index: true,\n        label: ({ t }) => t('general:deletedAt'),\n      })\n    }\n  }\n\n  const defaultLabels = formatLabels(sanitized.slug)\n\n  sanitized.labels = {\n    plural: sanitized.labels?.plural || defaultLabels.plural,\n    singular: sanitized.labels?.singular || defaultLabels.singular,\n  }\n\n  if (sanitized.versions) {\n    if (sanitized.timestamps === false) {\n      throw new TimestampsRequired(collection)\n    }\n\n    if (sanitized.versions === true) {\n      sanitized.versions = {\n        drafts: false,\n        maxPerDoc: 100,\n      }\n    }\n\n    sanitized.versions.maxPerDoc =\n      typeof sanitized.versions.maxPerDoc === 'number' ? sanitized.versions.maxPerDoc : 100\n\n    if (sanitized.versions.drafts) {\n      if (sanitized.versions.drafts === true) {\n        sanitized.versions.drafts = {\n          autosave: false,\n          validate: false,\n        }\n      }\n\n      const hasLocalizedFields = traverseForLocalizedFields(sanitized.fields)\n\n      if (config.localization) {\n        if (hasLocalizedFields && sanitized.versions.drafts.localizeStatus === undefined) {\n          sanitized.versions.drafts.localizeStatus = false\n        }\n      }\n\n      // TODO v4: remove this sanitization check, should not need to enable the experimental flag\n      if (sanitized.versions.drafts.localizeStatus && !config.experimental?.localizeStatus) {\n        sanitized.versions.drafts.localizeStatus = false\n        console.log(\n          miniChalk.yellowBold(\n            `Warning: \"localizeStatus\" for drafts is an experimental feature. To enable, set \"experimental.localizeStatus\" to true in your Payload config.`,\n          ),\n        )\n      }\n\n      if (sanitized.versions.drafts.autosave === true) {\n        sanitized.versions.drafts.autosave = {\n          interval: versionDefaults.autosaveInterval,\n        }\n      }\n\n      if (sanitized.versions.drafts.validate === undefined) {\n        sanitized.versions.drafts.validate = false\n      }\n\n      sanitized.fields = mergeBaseFields(\n        sanitized.fields,\n        baseVersionFields({\n          localized: sanitized.versions.drafts.localizeStatus ?? false,\n        }),\n      )\n    }\n  } else {\n    delete sanitized.versions\n  }\n\n  if (sanitized.folders === true) {\n    sanitized.folders = {\n      browseByFolder: true,\n    }\n  } else if (sanitized.folders) {\n    sanitized.folders.browseByFolder = sanitized.folders.browseByFolder ?? true\n  }\n\n  if (sanitized.upload) {\n    if (sanitized.upload === true) {\n      sanitized.upload = {}\n    }\n\n    sanitized.upload.cacheTags = sanitized.upload?.cacheTags ?? true\n    sanitized.upload.bulkUpload = sanitized.upload?.bulkUpload ?? true\n    sanitized.upload.staticDir = sanitized.upload.staticDir || sanitized.slug\n    sanitized.admin!.useAsTitle =\n      sanitized.admin?.useAsTitle && sanitized.admin.useAsTitle !== 'id'\n        ? sanitized.admin.useAsTitle\n        : 'filename'\n\n    const uploadFields = getBaseUploadFields({\n      collection: sanitized,\n      config,\n    })\n\n    sanitized.fields = mergeBaseFields(sanitized.fields, uploadFields)\n  }\n\n  if (sanitized.auth) {\n    sanitized.auth = addDefaultsToAuthConfig(\n      typeof sanitized.auth === 'boolean' ? {} : sanitized.auth,\n    )\n\n    // disable duplicate for auth enabled collections by default\n    sanitized.disableDuplicate = sanitized.disableDuplicate ?? true\n\n    if (sanitized.auth.loginWithUsername) {\n      if (sanitized.auth.loginWithUsername === true) {\n        sanitized.auth.loginWithUsername = addDefaultsToLoginWithUsernameConfig({})\n      } else {\n        const loginWithUsernameWithDefaults = addDefaultsToLoginWithUsernameConfig(\n          sanitized.auth.loginWithUsername,\n        )\n\n        // if allowEmailLogin is false, requireUsername must be true\n        if (loginWithUsernameWithDefaults.allowEmailLogin === false) {\n          loginWithUsernameWithDefaults.requireUsername = true\n        }\n        sanitized.auth.loginWithUsername = loginWithUsernameWithDefaults\n      }\n    } else {\n      sanitized.auth.loginWithUsername = false\n    }\n\n    if (!collection?.admin?.useAsTitle) {\n      sanitized.admin!.useAsTitle = sanitized.auth.loginWithUsername ? 'username' : 'email'\n    }\n\n    sanitized.fields = mergeBaseFields(sanitized.fields, getBaseAuthFields(sanitized.auth))\n  }\n\n  if (collection?.admin?.pagination?.limits?.length) {\n    sanitized.admin!.pagination!.limits = collection.admin.pagination.limits\n  }\n\n  validateUseAsTitle(sanitized)\n\n  const sanitizedConfig = sanitized as SanitizedCollectionConfig\n\n  sanitizedConfig.joins = joins\n  sanitizedConfig.polymorphicJoins = polymorphicJoins\n\n  sanitizedConfig.flattenedFields = flattenAllFields({ fields: sanitizedConfig.fields })\n\n  sanitizedConfig.sanitizedIndexes = sanitizeCompoundIndexes({\n    fields: sanitizedConfig.flattenedFields,\n    indexes: sanitizedConfig.indexes,\n  })\n\n  return sanitizedConfig\n}\n"],"names":["authCollectionEndpoints","getBaseAuthFields","TimestampsRequired","sanitizeFields","fieldAffectsData","mergeBaseFields","uploadCollectionEndpoints","getBaseUploadFields","flattenAllFields","formatLabels","miniChalk","traverseForLocalizedFields","baseVersionFields","versionDefaults","defaultCollectionEndpoints","addDefaultsToAuthConfig","addDefaultsToCollectionConfig","addDefaultsToLoginWithUsernameConfig","sanitizeCompoundIndexes","validateUseAsTitle","sanitizeCollection","config","collection","richTextSanitizationPromises","_validRelationships","_sanitized","sanitized","validRelationships","collections","map","c","slug","joins","polymorphicJoins","fields","collectionConfig","joinPath","parentIsLocalized","endpoints","auth","endpoint","push","upload","timestamps","hasUpdatedAt","hasCreatedAt","hasDeletedAt","some","field","name","trash","type","admin","disableBulkEdit","hidden","index","label","t","defaultLabels","labels","plural","singular","versions","drafts","maxPerDoc","autosave","validate","hasLocalizedFields","localization","localizeStatus","undefined","experimental","console","log","yellowBold","interval","autosaveInterval","localized","folders","browseByFolder","cacheTags","bulkUpload","staticDir","useAsTitle","uploadFields","disableDuplicate","loginWithUsername","loginWithUsernameWithDefaults","allowEmailLogin","requireUsername","pagination","limits","length","sanitizedConfig","flattenedFields","sanitizedIndexes","indexes"],"mappings":";;;;AAQA,SAASA,uBAAuB,QAAQ,gCAA+B;AACvE,SAASC,iBAAiB,QAAQ,8BAA6B;AAC/D,SAASC,kBAAkB,QAAQ,qCAAoC;AACvE,SAASC,cAAc,QAAQ,kCAAiC;AAChE,SAASC,gBAAgB,QAAQ,+BAA8B;AAC/D,SAASC,eAAe,QAAQ,kCAAiC;AACjE,SAASC,yBAAyB,QAAQ,mCAAkC;AAC5E,SAASC,mBAAmB,QAAQ,iCAAgC;AACpE,SAASC,gBAAgB,QAAQ,sCAAqC;AACtE,SAASC,YAAY,QAAQ,kCAAiC;AAC9D,SAASC,SAAS,QAAQ,+BAA8B;AACxD,SAASC,0BAA0B,QAAQ,gDAA+C;AAC1F,SAASC,iBAAiB,QAAQ,+BAA8B;AAChE,SAASC,eAAe,QAAQ,6BAA4B;AAC5D,SAASC,0BAA0B,QAAQ,wBAAuB;AAClE,SACEC,uBAAuB,EACvBC,6BAA6B,EAC7BC,oCAAoC,QAC/B,gBAAe;AACtB,SAASC,uBAAuB,QAAQ,+BAA8B;AACtE,SAASC,kBAAkB,QAAQ,kBAAiB;;;;;;;;;;;;;;;;;;;AAE7C,MAAMC,qBAAqB,OAChCC,QACAC,YACA;;;GAGC,GACDC,8BACAC;IAEA,IAAIF,WAAWG,UAAU,EAAE;QACzB,OAAOH;IACT;IAEAA,WAAWG,UAAU,GAAG;IAExB,oCAAoC;IACpC,iCAAiC;IACjC,oCAAoC;IAEpC,MAAMC,gBAA8BV,uMAAAA,EAA8BM;IAElE,oCAAoC;IACpC,kBAAkB;IAClB,oCAAoC;IAEpC,MAAMK,qBAAqBH,uBAAuBH,OAAOO,WAAW,CAAEC,GAAG,CAAC,CAACC,IAAMA,EAAEC,IAAI,KAAK,EAAE;IAE9F,MAAMC,QAAwB,CAAC;IAE/B,MAAMC,mBAAoC,EAAE;IAE5CP,UAAUQ,MAAM,GAAG,UAAM/B,mLAAAA,EAAe;QACtCgC,kBAAkBT;QAClBL;QACAa,QAAQR,UAAUQ,MAAM;QACxBE,UAAU;QACVJ;QACAK,mBAAmB;QACnBJ;QACAV;QACAI;IACF;IAEA,IAAID,UAAUY,SAAS,KAAK,OAAO;QACjC,IAAI,CAACZ,UAAUY,SAAS,EAAE;YACxBZ,UAAUY,SAAS,GAAG,EAAE;QAC1B;QAEA,IAAIZ,UAAUa,IAAI,EAAE;YAClB,KAAK,MAAMC,YAAYxC,0LAAAA,CAAyB;gBAC9C0B,UAAUY,SAAS,CAACG,IAAI,CAACD;YAC3B;QACF;QAEA,IAAId,UAAUgB,MAAM,EAAE;YACpB,KAAK,MAAMF,YAAYlC,+LAAAA,CAA2B;gBAChDoB,UAAUY,SAAS,CAACG,IAAI,CAACD;YAC3B;QACF;QAEA,KAAK,MAAMA,YAAY1B,oMAAAA,CAA4B;YACjDY,UAAUY,SAAS,CAACG,IAAI,CAACD;QAC3B;IACF;IAEA,IAAId,UAAUiB,UAAU,KAAK,OAAO;QAClC,+CAA+C;QAC/C,IAAIC,eAA+B;QACnC,IAAIC,eAA+B;QACnC,IAAIC,eAA+B;QAEnCpB,UAAUQ,MAAM,CAACa,IAAI,CAAC,CAACC;YACrB,QAAI5C,kLAAAA,EAAiB4C,QAAQ;gBAC3B,IAAIA,MAAMC,IAAI,KAAK,aAAa;oBAC9BL,eAAe;gBACjB;gBAEA,IAAII,MAAMC,IAAI,KAAK,aAAa;oBAC9BJ,eAAe;gBACjB;gBAEA,IAAIG,MAAMC,IAAI,KAAK,aAAa;oBAC9BH,eAAe;gBACjB;YACF;YAEA,OAAOD,gBAAgBD,gBAAiB,CAAA,CAAClB,UAAUwB,KAAK,IAAIJ,YAAW;QACzE;QAEA,IAAI,CAACF,cAAc;YACjBlB,UAAUQ,MAAM,CAACO,IAAI,CAAC;gBACpBQ,MAAM;gBACNE,MAAM;gBACNC,OAAO;oBACLC,iBAAiB;oBACjBC,QAAQ;gBACV;gBACAC,OAAO;gBACPC,OAAO,CAAC,EAAEC,CAAC,EAAE,GAAKA,EAAE;YACtB;QACF;QAEA,IAAI,CAACZ,cAAc;YACjBnB,UAAUQ,MAAM,CAACO,IAAI,CAAC;gBACpBQ,MAAM;gBACNG,OAAO;oBACLC,iBAAiB;oBACjBC,QAAQ;gBACV;gBACA,8KAA8K;gBAC9KH,MAAM;gBACNI,OAAO;gBACPC,OAAO,CAAC,EAAEC,CAAC,EAAE,GAAKA,EAAE;YACtB;QACF;QAEA,IAAI/B,UAAUwB,KAAK,IAAI,CAACJ,cAAc;YACpCpB,UAAUQ,MAAM,CAACO,IAAI,CAAC;gBACpBQ,MAAM;gBACNE,MAAM;gBACNC,OAAO;oBACLC,iBAAiB;oBACjBC,QAAQ;gBACV;gBACAC,OAAO;gBACPC,OAAO,CAAC,EAAEC,CAAC,EAAE,GAAKA,EAAE;YACtB;QACF;IACF;IAEA,MAAMC,oBAAgBjD,8KAAAA,EAAaiB,UAAUK,IAAI;IAEjDL,UAAUiC,MAAM,GAAG;QACjBC,QAAQlC,UAAUiC,MAAM,EAAEC,UAAUF,cAAcE,MAAM;QACxDC,UAAUnC,UAAUiC,MAAM,EAAEE,YAAYH,cAAcG,QAAQ;IAChE;IAEA,IAAInC,UAAUoC,QAAQ,EAAE;QACtB,IAAIpC,UAAUiB,UAAU,KAAK,OAAO;YAClC,MAAM,IAAIzC,uLAAAA,CAAmBoB;QAC/B;QAEA,IAAII,UAAUoC,QAAQ,KAAK,MAAM;YAC/BpC,UAAUoC,QAAQ,GAAG;gBACnBC,QAAQ;gBACRC,WAAW;YACb;QACF;QAEAtC,UAAUoC,QAAQ,CAACE,SAAS,GAC1B,OAAOtC,UAAUoC,QAAQ,CAACE,SAAS,KAAK,WAAWtC,UAAUoC,QAAQ,CAACE,SAAS,GAAG;QAEpF,IAAItC,UAAUoC,QAAQ,CAACC,MAAM,EAAE;YAC7B,IAAIrC,UAAUoC,QAAQ,CAACC,MAAM,KAAK,MAAM;gBACtCrC,UAAUoC,QAAQ,CAACC,MAAM,GAAG;oBAC1BE,UAAU;oBACVC,UAAU;gBACZ;YACF;YAEA,MAAMC,yBAAqBxD,0MAAAA,EAA2Be,UAAUQ,MAAM;YAEtE,IAAIb,OAAO+C,YAAY,EAAE;gBACvB,IAAID,sBAAsBzC,UAAUoC,QAAQ,CAACC,MAAM,CAACM,cAAc,KAAKC,WAAW;oBAChF5C,UAAUoC,QAAQ,CAACC,MAAM,CAACM,cAAc,GAAG;gBAC7C;YACF;YAEA,2FAA2F;YAC3F,IAAI3C,UAAUoC,QAAQ,CAACC,MAAM,CAACM,cAAc,IAAI,CAAChD,OAAOkD,YAAY,EAAEF,gBAAgB;gBACpF3C,UAAUoC,QAAQ,CAACC,MAAM,CAACM,cAAc,GAAG;gBAC3CG,QAAQC,GAAG,CACT/D,wKAAAA,CAAUgE,UAAU,CAClB,CAAC,6IAA6I,CAAC;YAGrJ;YAEA,IAAIhD,UAAUoC,QAAQ,CAACC,MAAM,CAACE,QAAQ,KAAK,MAAM;gBAC/CvC,UAAUoC,QAAQ,CAACC,MAAM,CAACE,QAAQ,GAAG;oBACnCU,UAAU9D,4KAAAA,CAAgB+D,gBAAgB;gBAC5C;YACF;YAEA,IAAIlD,UAAUoC,QAAQ,CAACC,MAAM,CAACG,QAAQ,KAAKI,WAAW;gBACpD5C,UAAUoC,QAAQ,CAACC,MAAM,CAACG,QAAQ,GAAG;YACvC;YAEAxC,UAAUQ,MAAM,OAAG7B,iLAAAA,EACjBqB,UAAUQ,MAAM,MAChBtB,gLAAAA,EAAkB;gBAChBiE,WAAWnD,UAAUoC,QAAQ,CAACC,MAAM,CAACM,cAAc,IAAI;YACzD;QAEJ;IACF,OAAO;QACL,OAAO3C,UAAUoC,QAAQ;IAC3B;IAEA,IAAIpC,UAAUoD,OAAO,KAAK,MAAM;QAC9BpD,UAAUoD,OAAO,GAAG;YAClBC,gBAAgB;QAClB;IACF,OAAO,IAAIrD,UAAUoD,OAAO,EAAE;QAC5BpD,UAAUoD,OAAO,CAACC,cAAc,GAAGrD,UAAUoD,OAAO,CAACC,cAAc,IAAI;IACzE;IAEA,IAAIrD,UAAUgB,MAAM,EAAE;QACpB,IAAIhB,UAAUgB,MAAM,KAAK,MAAM;YAC7BhB,UAAUgB,MAAM,GAAG,CAAC;QACtB;QAEAhB,UAAUgB,MAAM,CAACsC,SAAS,GAAGtD,UAAUgB,MAAM,EAAEsC,aAAa;QAC5DtD,UAAUgB,MAAM,CAACuC,UAAU,GAAGvD,UAAUgB,MAAM,EAAEuC,cAAc;QAC9DvD,UAAUgB,MAAM,CAACwC,SAAS,GAAGxD,UAAUgB,MAAM,CAACwC,SAAS,IAAIxD,UAAUK,IAAI;QACzEL,UAAU0B,KAAK,CAAE+B,UAAU,GACzBzD,UAAU0B,KAAK,EAAE+B,cAAczD,UAAU0B,KAAK,CAAC+B,UAAU,KAAK,OAC1DzD,UAAU0B,KAAK,CAAC+B,UAAU,GAC1B;QAEN,MAAMC,mBAAe7E,oLAAAA,EAAoB;YACvCe,YAAYI;YACZL;QACF;QAEAK,UAAUQ,MAAM,OAAG7B,iLAAAA,EAAgBqB,UAAUQ,MAAM,EAAEkD;IACvD;IAEA,IAAI1D,UAAUa,IAAI,EAAE;QAClBb,UAAUa,IAAI,OAAGxB,iMAAAA,EACf,OAAOW,UAAUa,IAAI,KAAK,YAAY,CAAC,IAAIb,UAAUa,IAAI;QAG3D,4DAA4D;QAC5Db,UAAU2D,gBAAgB,GAAG3D,UAAU2D,gBAAgB,IAAI;QAE3D,IAAI3D,UAAUa,IAAI,CAAC+C,iBAAiB,EAAE;YACpC,IAAI5D,UAAUa,IAAI,CAAC+C,iBAAiB,KAAK,MAAM;gBAC7C5D,UAAUa,IAAI,CAAC+C,iBAAiB,OAAGrE,8MAAAA,EAAqC,CAAC;YAC3E,OAAO;gBACL,MAAMsE,oCAAgCtE,8MAAAA,EACpCS,UAAUa,IAAI,CAAC+C,iBAAiB;gBAGlC,4DAA4D;gBAC5D,IAAIC,8BAA8BC,eAAe,KAAK,OAAO;oBAC3DD,8BAA8BE,eAAe,GAAG;gBAClD;gBACA/D,UAAUa,IAAI,CAAC+C,iBAAiB,GAAGC;YACrC;QACF,OAAO;YACL7D,UAAUa,IAAI,CAAC+C,iBAAiB,GAAG;QACrC;QAEA,IAAI,CAAChE,YAAY8B,OAAO+B,YAAY;YAClCzD,UAAU0B,KAAK,CAAE+B,UAAU,GAAGzD,UAAUa,IAAI,CAAC+C,iBAAiB,GAAG,aAAa;QAChF;QAEA5D,UAAUQ,MAAM,OAAG7B,iLAAAA,EAAgBqB,UAAUQ,MAAM,MAAEjC,+KAAAA,EAAkByB,UAAUa,IAAI;IACvF;IAEA,IAAIjB,YAAY8B,OAAOsC,YAAYC,QAAQC,QAAQ;QACjDlE,UAAU0B,KAAK,CAAEsC,UAAU,CAAEC,MAAM,GAAGrE,WAAW8B,KAAK,CAACsC,UAAU,CAACC,MAAM;IAC1E;QAEAxE,8LAAAA,EAAmBO;IAEnB,MAAMmE,kBAAkBnE;IAExBmE,gBAAgB7D,KAAK,GAAGA;IACxB6D,gBAAgB5D,gBAAgB,GAAGA;IAEnC4D,gBAAgBC,eAAe,OAAGtF,sLAAAA,EAAiB;QAAE0B,QAAQ2D,gBAAgB3D,MAAM;IAAC;IAEpF2D,gBAAgBE,gBAAgB,OAAG7E,gNAAAA,EAAwB;QACzDgB,QAAQ2D,gBAAgBC,eAAe;QACvCE,SAASH,gBAAgBG,OAAO;IAClC;IAEA,OAAOH;AACT,EAAC"}}]
}